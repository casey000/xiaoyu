<!--故障详情-->
<ui-view name=""></ui-view>

<!--标题栏-->
<div class="navbar navbar-app navbar-absolute-top">
    <div class="navbar-brand navbar-brand-center">损伤详情</div>
    <div class="btn-group btn-back" style="z-index: 1000">
        <div class="btn" ng-click="damageDetailGoBack()">
            <i class="icon-maoc icon-back"></i>
        </div>
    </div>
    <div class="btn-group btn-group-right" style="z-index: 1000">
        <div class="btn" ng-click="go('searchDamageByHand.damageDetail.damageReference', 'slideLeft',{info:info.qrCodeInfo,type:2})">
            二维码
        </div>
    </div>
</div>

<!--横向选项栏-->
<div class="app-body scrollable damage-detal-h">
    <!--头部选项卡-->
    <ul class="nav damage-detail-pill">
        <li ng-class="{'damage':activeNav == 0}" ng-click="changeNavIndex(0)">
            <span class="span-text">基本信息</span>
        </li>
        <li ng-class="{'damage':activeNav == 1}" ng-click="changeNavIndex(1)">
            <span class="span-text">评估信息</span><br>
        </li>
        <li ng-class="{'damage':activeNav == 2}" ng-click="changeNavIndex(2)">
            <span class="span-text">完善信息</span><br>
        </li>
    </ul>
    <div class="damage-detail-wrapper">
        <!--Basic Damage-->
        <div class="damage-draft-detail" ng-if="activeNav == 0">
            <div class="section-1">
                <div class="header">基础信息</div>
                <div class="whole-top-line"></div>
                <div class="item">
                    <span class="title">关联故障</span>
                    <div class="right" ng-click="goDefect(info.baseInfo.relationBusinessNo)">{{info.baseInfo.relationBusinessNo||'无'}}</div>
                </div>
                <div class="item">
                    <span class="title">飞机号</span>
                    <div class="right">{{info.baseInfo.aircraft}}</div>
                </div>
                <div class="item">
                    <span class="title">ATA章节号</span>
                    <div class="right">{{info.baseInfo.ata}}</div>
                </div>
                <div class="item">
                    <span class="title">区域</span>
                    <div class="right">{{info.baseInfo.zone}}</div>
                </div>
                <div class="item">
                    <span class="title">工作指令号</span>
                    <div class="right">{{info.baseInfo.wo}}</div>
                </div>

                <div class="item">
                    <span class="title">维护级别</span>
                    <div class="right">{{info.baseInfo.maintenanceLevel}}</div>
                </div>
                <div class="item">
                    <span class="title">相关工卡</span>
                    <div class="right">{{info.baseInfo.cardNumber}}</div>
                </div>
                <div class="item">
                    <span class="title">外观是否可见</span>
                    <div class="right">{{info.baseInfo.defect == 'y' ? '可见':'不可见'}}</div>
                </div>
                <div class="item">
                    <span class="title">接近方式</span>
                    <div class="right" ng-switch="info.baseInfo.checkType">
                        <span ng-switch-when="1">内部检查</span>
                        <span ng-switch-when="2">外部检查</span>
                    </div>
                </div>
                <div class="item">
                    <span class="title">检查方法</span>
                    <div class="right" ng-switch="info.baseInfo.checkMethod">
                        <span ng-switch-when="1">一般目视</span>
                        <span ng-switch-when="2">详细目视</span>
                        <span ng-switch-when="3">NDT</span>
                        <span ng-switch-when="4">其它</span>
                        <span ng-switch-when="5">敲击检查</span>
                    </div>
                </div>
                <div class="item" ng-if="info.baseInfo.checkMethod==3">
                    <span class="title">NDT类别</span>
                    <div class="right">
                        <span ng-repeat="item in info.toolInfos.ndtCategorys" ng-if="info.baseInfo.checkMode == item.value">
                            {{item.name}}
                        </span>
                    </div>
                </div>
                <div class="textarea-item" ng-if="info.baseInfo.checkMethod == 4">
                    <div class="title">其它</div>
                    <div class="right">{{info.baseInfo.checkModeOther}}</div>
                </div>
                <div class="item">
                    <span class="title">运营人</span>
                    <div class="right">顺丰航空</div>
                </div>
                <div class="item">
                    <span class="title">发现日期</span>
                    <div class="right">{{info.baseInfo.drDate | date:'yyyy-MM-dd'}}</div>
                </div>
                <div class="item">
                    <span class="title">维修站点</span>
                    <div class="right">{{info.baseInfo.repairSite}}</div>
                </div>
                <div class="item">
                    <span class="title">流程状态</span>
                    <div class="right" ng-switch="info.baseInfo.status">
                        <span ng-switch-when="Evaluating">评估中</span>
                        <span ng-switch-when="Approving">审批中</span>
                        <span ng-switch-when="Approved">审批通过</span>
                        <span ng-switch-when="History">历史版本</span>
                    </div>
                </div>
                <div class="item none-border-bottom">
                    <span class="title">完善状态</span>
                    <div class="right" ng-switch="info.baseInfo.perfectStatus">
                        <span ng-switch-when="Perfect">待完善</span>
                        <span ng-switch-when="Perfected">已完善</span>
                        <span ng-switch-when="Perfecting">完善中</span>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>
            <div class="section-2">
                <div class="header">缺陷描述</div>
                <div class="whole-top-line"></div>
                <div class="textarea-item">
                    <div class="title">
                        <span>中文描述</span>
                    </div>
                    <div>
                        <textarea disabled ng-model="info.baseInfo.cnDescribe"></textarea>
                    </div>
                    <div class="line"></div>
                </div>
                <div class="textarea-item none-border-bottom">
                    <div class="title">
                        <span>English</span>
                    </div>
                    <div>
                        <textarea disabled ng-model="info.baseInfo.enDescribe"></textarea>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>

            <div class="section-3">
                <div class="header">处置说明</div>
                <div class="whole-top-line"></div>
                <div class="textarea-item none-border-bottom">
                    <div style="padding-top: 10px">
                        <textarea disabled ng-model="info.baseInfo.disposalInstructions"></textarea>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>

            <div class="section-4">
                <div>
                    <div class="header">缺陷信息</div>
                    <div class="item">
                        <div class="title">缺陷类型</div>
                        <div class="right">
                            <div class="check-method">
                               <span ng-repeat="selectTypeNumber in info.toolInfos.selectedDamageTypes | orderBy: sortNumberArray">
                                   <label ng-repeat="typeItem in info.toolInfos.damageTypes | filter:{value: selectTypeNumber}"
                                          ng-if="selectTypeNumber == typeItem.value && $parent.$index < info.toolInfos.selectedDamageTypes.length - 1">
                                        {{typeItem.name}}、
                                   </label>
                                   <label ng-repeat="typeItem in info.toolInfos.damageTypes | filter:{value: selectTypeNumber}"
                                          ng-if="selectTypeNumber == typeItem.value && $parent.$index == info.toolInfos.selectedDamageTypes.length - 1">
                                        {{typeItem.name}}
                                   </label>
                               </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="textarea-item" ng-if="info.toolInfos.selectedDamageTypes.indexOf('12') != -1">
                    <div class="title">其它</div>
                    <textarea disabled ng-model="info.baseInfo.defectTypeOther" placeholder="勾选其它请输入详细内容">
                   </textarea>
                </div>
                <div>
                    <div class="item">
                        <div class="title">缺陷原因</div>
                        <!--显示结果-->
                        <div class="right">
                            <div class="check-method">
                               <span ng-repeat="selectReasonNumber in info.toolInfos.selectedDamageReasons | orderBy:'value'">
                                   <label ng-repeat="reasonItem in info.toolInfos.damageReasons | filter:{value: selectReasonNumber}"
                                          ng-if="reasonItem.value == selectReasonNumber && $parent.$index < info.toolInfos.selectedDamageReasons.length - 1">
                                        {{reasonItem.name}}、
                                   </label>
                                  <label ng-repeat="reasonItem in info.toolInfos.damageReasons | filter:{value: selectReasonNumber}"
                                         ng-if="reasonItem.value == selectReasonNumber && $parent.$index == info.toolInfos.selectedDamageReasons.length - 1">
                                        {{reasonItem.name}}
                                   </label>

                               </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="textarea-item" ng-if="info.toolInfos.selectedDamageReasons.indexOf('12') != -1">
                    <div class="title">其它</div>
                    <textarea disabled ng-model="info.baseInfo.defectReasonOther" placeholder="勾选其它请输入详细内容">
                   </textarea>
                </div>
                <div>
                    <div class="item none-border-bottom">
                        <div class="title">损伤类型</div>
                        <!--显示结果-->
                        <div class="right">
                            <div class="check-method">
                               <span ng-repeat="selectDrNumber in info.toolInfos.selectedDrTypes | orderBy:'value'">
                                   <label ng-repeat="typeItem in info.toolInfos.drTypes | filter:{value: selectDrNumber}"
                                          ng-if="typeItem.value == selectDrNumber && $parent.$index < info.toolInfos.selectedDrTypes.length - 1">
                                        {{typeItem.name}}、
                                   </label>
                                  <label ng-repeat="typeItem in info.toolInfos.drTypes | filter:{value: selectDrNumber}"
                                         ng-if="typeItem.value == selectDrNumber && $parent.$index == info.toolInfos.selectedDrTypes.length - 1">
                                        {{typeItem.name}}
                                   </label>
                               </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>
            <div class="section-5" ng-show="info.baseInfo.drAssessDefectDTOList.length > 0">
                <div class="header">位置与尺寸信息</div>
                <div class="whole-top-line"></div>
                <div class="damage-location-item-wrapper">
                    <div ng-repeat="item in info.baseInfo.drAssessDefectDTOList" class="damage-location-item"
                         ng-click="go('damageLocation','',{listItemInfo:{}, damageInfo:{},locationItem: item,from:'damageDetail'})" >
                        <div>
                            <div class="title">
                                <div class="left-title">
                                    <span>部件类型</span>
                                    <span class="">{{item.structureType}}</span>
                                </div>
                                <div class="right-title">
                                    <span class="">件号</span>
                                    <span>{{item.pn}}</span>
                                </div>
                            </div>
                            <div class="line"></div>
                            <div class="location-content">
                                <div class="left">
                                    <span class="loc-name">STA</span>&nbsp;
                                    <span class="loc-num">{{item.sta}}</span>
                                </div>
                                <div class="right">
                                    <span class="loc-name">WL</span> &nbsp;
                                    <span class="loc-num">{{item.wl}}</span>
                                </div>
                                <div>
                                    <span class="loc-name">BL</span>&nbsp;
                                    <span class="loc-num">{{item.bl}}</span>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>

        </div>
        <!--Ref&work-->
        <div class="damage-draft-detail" ng-if="activeNav == 1">
            <div class="section-1">
                <div class="header">处置依据</div>
                <div class="whole-top-line"></div>
                <div class="item">
                    <span class="title">构建关键尺寸（长*宽）</span>
                    <div class="right" ng-show="info.assessInfo.length && info.assessInfo.wide">{{info.assessInfo.length}}*{{info.assessInfo.wide}}</div>
                </div>
                <div class="item">
                    <span class="title">原始厚度</span>
                    <div class="right">{{info.assessInfo.originalThickness}}</div>
                </div>
                <div class="item">
                    <span class="title">图纸号</span>
                    <div class="right">{{info.assessInfo.drawingNo}}</div>
                </div>
                <div class="item">
                    <span class="title">损伤许可依据</span>
                    <div class="right">{{info.assessInfo.licenseBasisManufacturer}}&nbsp;&nbsp;{{info.assessInfo.licenseBasisSrmstyle}} &nbsp;{{info.assessInfo.licenseBasisSrm}}</div>
                </div>
                <div class="item">
                    <span class="title">损伤许可</span>
                    <div class="right" ng-switch="info.assessInfo.drLicense">
                        <span ng-switch-when="0">否</span>
                        <span ng-switch-when="1">是</span>
                    </div>
                </div>
                <div class="item">
                    <span class="title">超手册</span>
                    <div class="right" ng-switch="info.assessInfo.exceedSrm">
                        <span ng-switch-when="0">否</span>
                        <span ng-switch-when="1">是</span>
                    </div>
                </div>
                <div class="item">
                    <span class="title">服务申请</span>
                    <div class="right">{{info.assessInfo.sr}}</div>
                </div>
                <div class="item">
                    <span class="title">处置依据</span>
                    <div class="right">{{info.assessInfo.dealBasisManufacturer}}&nbsp;{{info.assessInfo.dealBasisSrmstyle}} &nbsp;{{info.assessInfo.dealBasisSrm}}</div>
                </div>
                <div class="item none-border-bottom">
                    <span class="title">处置类型</span>
                    <div class="right">
                        <span ng-repeat="dealtypeItem in info.toolInfos.dealTypes" ng-if="dealtypeItem.value == info.assessInfo.dealType">
                            {{dealtypeItem.name}}
                        </span>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>
            <div class="section-2" ng-if="info.assessInfo.executableFileDTOList.length > 0">
                <div class="header">决策信息</div>
                <div class="whole-top-line"></div>
                <div class="item assess-item" ng-repeat="exeItem in info.assessInfo.executableFileDTOList">
                    <span class="title">{{exeItem.exeFileNo}}</span>
                    <div class="right" ng-if="exeItem.completionDate">{{exeItem.completionDate | date:'yyyy-MM-dd'}}</div>
                    <div ng-if="exeItem.attachments.length > 0" class="line"></div>
                    <div class="damage-dimension-image-warpper" ng-if="exeItem.attachments.length > 0">
                        <img class="damage-dimension-image"
                             ng-click="go('searchDamageByHand.damageDetail.damageReference', 'slideLeft',{info:image,type:1})"
                             ng-repeat="image in exeItem.attachments"
                             ng-src="data:image/{{image.type}};base64,{{image.content}}"
                             ng-if="image.type =='jpg' || image.type == 'jpeg' || image.type == 'png'">
                    </div>
                    <div ng-if="exeItem.attachments.length > 0">
                        <div ng-repeat="file in exeItem.attachments" ng-if="file.type == 'pdf' || file.type =='doc' || file.type =='xls'">
                            <img src="" alt="">
                            <span ng-if="file.type == 'pdf'" ng-click="openNewPageWithData(file)"
                            >{{file.name}}</span>
                            <span ng-if="file.type != 'pdf'" ng-click="">{{file.name}}</span>
                        </div>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>
        </div>
        <!--Attachment-->
        <div class="attachment-tab damage-draft-detail" ng-if="activeNav == 2">
            <div class="section-1" ng-if="info.prefectInfo.drAssessFeedbackDTOS.length > 0">
                <div class="header">处置依据</div>
                <div class="whole-top-line"></div>
                <div class="atta-item" ng-repeat="item in info.prefectInfo.drAssessFeedbackDTOS">
                    <div class="title">
                        <div class="left">{{item.typeName}}</div>
                        <div class="right" ng-if="item.order == 4" ng-switch="item.evlResult">
                            <span>评估结果：</span>
                            <span ng-switch-when="0">临时</span>
                            <span ng-switch-when="1">永久</span>
                            <span ng-switch-when="2">时限</span>
                            <span ng-switch-when="3">A类</span>
                            <span ng-switch-when="4">B类</span>
                            <span ng-switch-when="5">C类</span>
                            <span ng-switch-when="6">TBD</span>
                            <span ng-switch-default>无</span>
                        </div>
                        <div class="right" ng-if="item.order != 4" ng-switch="item.evlResult">
                            <span>评估结果：</span>
                            <span ng-switch-when="0">否</span>
                            <span ng-switch-when="1">是</span>
                            <span ng-switch-default>无</span>
                        </div>
                    </div>
                    <div ng-if="item.attachmentDTO" class="line"></div>
                    <div ng-if="item.attachmentDTO">
                        <div class="file-title" ng-click="goToReadFile(item.attachmentDTO)">
                            <img class="file-img" src="dist/images/damage/file@2x.png" alt="">
                            <span>{{item.attachmentDTO.name}}</span>
                        </div>
                    </div>
                    <div ng-if="item.remark.length > 0" class="line"></div>
                    <div ng-if="item.remark.length > 0">
                        <div class="note">
                            <span>备注：</span>&nbsp;<span>{{item.remark}}</span>
                        </div>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>
            <div class="section-2" ng-if="info.assessPitList.length > 0">
                <div class="header">允许损伤控制清单</div>
                <div class="whole-top-line"></div>
                <div class="whole-top-line"></div>
                <div class="phy-item" ng-repeat="pit in info.assessPitList">
                    <div class="phy-param">
                        <div><span class="left">类型</span>
                            <span class="right" ng-if="pit.pitType == 1">凹坑</span>
                            <span class="right" ng-if="pit.pitType == 2">其他</span>
                        </div>
                        <div><span class="left">宽(A)</span><span class="right">{{pit.pitA}}</span></div>
                        <div><span class="left">深(Y)</span><span class="right">{{pit.pitY}}</span></div>
                        <div><span class="left">长(L)</span><span class="right">{{pit.pitLength}}</span></div>
                        <div><span class="left">宽深比(A/Y)</span>
                            <span class="right" ng-if="pit.pitType == 1">{{(pit.pitA/pit.pitY).toFixed(1)}}</span>
                        </div>
                    </div>
                    <div class="whole-bottom-line"></div>
                </div>
            </div>

            <div class="section-2" ng-if="info.prefectInfo.drAssessPhysicalInfoDTOS.length > 0">
                <div class="header">物理信息</div>
                <div class="whole-top-line"></div>
                <div class="whole-top-line"></div>
                <div class="phy-item" ng-repeat="item in info.prefectInfo.drAssessPhysicalInfoDTOS">
                    <div class="phy-param">
                        <div><span class="left">长</span><span class="right">{{item.length}}</span></div>
                        <div><span class="left">宽</span><span class="right">{{item.wide}}</span></div>
                        <div><span class="left">面积</span><span class="right">{{item.area}}</span></div>
                        <div><span class="left">重量</span><span class="right">{{item.weight}}</span></div>
                        <div><span class="left">力矩变化</span><span class="right">{{item.torqueChange}}</span></div>
                        <div ng-switch="item.inorout">
                            <span class="left">内外部</span>
                            <span ng-switch-when="1" class="right">内部</span>
                            <span ng-switch-when="2" class="right">外部</span>
                        </div>
                    </div>
                    <div class="phy-file">

                        <div ng-repeat="attaItem in item.attachmentDTOList"
                             ng-if="attaItem.type =='jpg' || attaItem.type == 'jpeg' || attaItem.type == 'png'"
                             ng-click="go('searchDamageByHand.damageDetail.damageReference', 'slideLeft',{info:attaItem,type:1})"
                        >
                            <p class="file-name">{{attaItem.name}}</p>
                        </div>
                        <div   ng-click="openNewPageWithData(attaItem)"
                               ng-if="attaItem.type != 'jpg' &&  attaItem.type != 'jpeg' && attaItem.type != 'png'"
                               ng-repeat="attaItem in item.attachmentDTOList">
                            <p class="file-name">{{attaItem.name}}</p>
                        </div>
                    </div>
                </div>
                <div class="whole-bottom-line"></div>
            </div>
        </div>

    </div>

</div>

