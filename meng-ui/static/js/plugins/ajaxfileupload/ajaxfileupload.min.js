jQuery.extend({createUploadIframe:function(e,t){var a="jUploadFrame"+e,r='<iframe id="'+a+'" name="'+a+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&("boolean"==typeof t?r+=' src="javascript:false"':"string"==typeof t&&(r+=' src="'+t+'"')),r+=" />",jQuery(r).appendTo(document.body),jQuery("#"+a).get(0)},createUploadForm:function(e,t,a,r){var n="jUploadForm"+e,o="jUploadFile"+e,u=jQuery('<form  action="" method="POST" name="'+n+'" id="'+n+'" enctype="multipart/form-data"></form>');if(a)for(var d in a)jQuery('<input type="hidden" name="'+d+'" value="'+a[d]+'" />').appendTo(u);var c=t.split(",");if(c.length>1)for(var d=0;d<c.length;d++){o="jUploadFile"+c[d];var i=jQuery("#"+c[d]),l=jQuery(i).clone();jQuery(i).attr("id",o),jQuery(i).before(l),jQuery(i).appendTo(u)}else{var i=jQuery("#"+t),l=jQuery(i).clone();jQuery(i).attr("id",o),jQuery(i).before(l),jQuery(i).appendTo(u)}if(r)for(var y in r)jQuery("<input type='hidden' name='"+y+"' value='"+r[y]+"'/>").appendTo(u);return jQuery(u).css("position","absolute"),jQuery(u).css("top","-1200px"),jQuery(u).css("left","-1200px"),jQuery(u).appendTo("body"),u},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),a=jQuery.createUploadForm(t,e.fileElementId,"undefined"==typeof e.data?!1:e.data,e.param),r=(jQuery.createUploadIframe(t,e.secureuri),"jUploadFrame"+t),n="jUploadForm"+t;e.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var o=!1,u={};e.global&&jQuery.event.trigger("ajaxSend",[u,e]);var d=function(t){var n=document.getElementById(r);try{n.contentWindow?(u.responseText=n.contentWindow.document.body?n.contentWindow.document.body.innerHTML:null,u.responseXML=n.contentWindow.document.XMLDocument?n.contentWindow.document.XMLDocument:n.contentWindow.document):n.contentDocument&&(u.responseText=n.contentDocument.document.body?n.contentDocument.document.body.innerHTML:null,u.responseXML=n.contentDocument.document.XMLDocument?n.contentDocument.document.XMLDocument:n.contentDocument.document)}catch(d){alert("文件上传异常，请检查文件类型及大小是否正确")}if(u||"timeout"==t){o=!0;var c;try{if(c="timeout"!=t?"success":"error","error"!=c){var i=jQuery.uploadHttpData(u,e.dataType);e.success&&e.success(i,c),e.global&&jQuery.event.trigger("ajaxSuccess",[u,e])}else alert("文件上传异常，请检查文件类型及大小是否正确")}catch(d){c="error",alert("文件上传异常，请检查文件类型及大小是否正确")}e.global&&jQuery.event.trigger("ajaxComplete",[u,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(u,c),jQuery(n).unbind(),setTimeout(function(){try{jQuery(n).remove(),jQuery(a).remove()}catch(e){alert("文件上传异常，请检查文件类型及大小是否正确")}},100),u=null}};e.timeout>0&&setTimeout(function(){o||d("timeout")},e.timeout);try{var a=jQuery("#"+n);jQuery(a).attr("action",e.url),jQuery(a).attr("method","POST"),jQuery(a).attr("target",r),a.encoding?jQuery(a).attr("encoding","multipart/form-data"):jQuery(a).attr("enctype","multipart/form-data"),jQuery(a).submit()}catch(c){alert("文件上传异常，请检查文件类型及大小是否正确")}return jQuery("#"+r).load(d),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;if(data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type)if(-1!=data.indexOf("{")&&-1!=data.indexOf("}")){var data=data.substring(data.indexOf("{"),data.lastIndexOf("}")+1);eval("data = "+data)}else eval("data = "+data);return"html"==type&&jQuery("<div>").html(data).evalScripts(),data}});