<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>外部文件接收其他</title>
</head>

<body>
<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="mform">
                <input type="hidden" id="pkid" name="pkid" />
                <input type="hidden" id="createBy" name="createBy" />
                <input type="hidden" id="createTime" name="createTime" />
                <input type="hidden" id="dataSort" name="dataSort" />
                <table class="table table-bordered table-info">
                    <tr>
                        <th class="th" align="right" style="width: 80px;">资料类型：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-combobox" id="dataType" name="dataType" data-options="required:true,editable:false" style="width: 180px;"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">紧急程度：</th>
                        <td class="tdr" style="width: 180px">
                            <input class="easyui-combobox" id="urgentLevel" name="urgentLevel" data-options="required:true,editable:true" style="width: 180px;"/>
                        </td>
                        <th class="th" align="right">资料来源：</th>
                        <td class="tdr">
                            <input class="easyui-combogrid" id="dataFrom" name="dataFrom" data-options="required:true" style="width: 180px;" />
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">资料编号：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-textbox" id="dataNo" name="dataNo" data-options="required:true" style="width: 180px;" />
                        </td>
                        <th class="th" align="right" style="width: 80px;">资料版次：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-textbox" id="dataVer" name="dataVer" data-options="required:true" style="width: 180px;" />
                        </td>
                        <th class="th" align="right" style="width: 80px;">章节：</th>
                        <td class="tdr">
                            <input class="easyui-combogrid" id="ata" name="ata" data-options="required:true" style="width: 180px;" />
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">标题：</th>
                        <td class="tdr" colspan="5">
                            <textarea id="dataTitle" name="dataTitle" data-options="required:true"
                                      style="width: 730px;height:50px"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">适用型号：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-combobox" id="applyModel" name="applyModel" data-options="required:true,editable:true" style="width: 180px;"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">注册日期：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-datebox" id="registerDate" name="registerDate" data-options="required:true,editable:true" style="width: 180px;"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">颁发日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="issueDate" name="issueDate" data-options="required:true,editable:true" />
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">适用类型：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-combobox" id="applyType" name="applyType" data-options="required:true,editable:true" style="width: 180px;"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">处理要求：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-combobox" id="howDealwith" name="howDealwith" data-options="required:true,editable:true" style="width: 180px;"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">评估期限：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="evaLimitDate" name="evaLimitDate" data-options="required:true,editable:true" />
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">备注：</th>
                        <td class="tdr" colspan="5">
                            <textarea id="memo" name="memo" data-options="editable:true" style="width:730px;height:60px" ></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">参考CAD号：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-textbox" id="refAdNo" name="refAdNo" data-options="required:true,editable:true"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">参考AD版次：</th>
                        <td class="tdr" style = "width:180px">
                            <input class="easyui-textbox" id="refAdVer" name="refAdVer" data-options="required:true,editable:true" />
                        </td>
                        <th class="th" align="right" style="width: 80px;">文件格式：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="fileEditType" name="fileEditType" data-options="editable:false,required:true"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">SB编号：</th>
                        <td class="tdr" style="width: 180px;">
                            <input class="easyui-textbox" id="sbNo" name="sbNo" data-options="required:true,editable:true" />
                        </td>
                        <th class="th" align="right" style="width: 80px;">SB级别：</th>
                        <td class="tdr" colspan="3">
                            <input class="easyui-combobox" id="sbGrade" name="sbGrade" data-options="required:true,editable:true" />
                        </td>
                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">评估人：</th>
                        <td class="tdr" colspan="5">
                            <input class="easyui-combogrid" id="userId" name="userId" data-options="required:true,editable:true"/>
                        </td>
                    </tr>
                    <tr id = "view">
                        <td class="tdr" colspan="6" align="right">
                            <input class="btn btn-primary" type="button" onclick="distribute()" value="下发" style="width: 50px;margin:5px;"/>
                            <input class="btn btn-primary" type="button" onclick="CloseWindowIframe();" value="关闭" style="width: 50px;margin:5px;"/>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var param;
    var operation;
    var PAGE_DATA = {};
    var mpkid = '';

    function i18nCallBack() {
        param = getParentParam_();
        operation = param.operation;
        row = param.rowData;
        mpkid= row.RECORD_ID;
        if(operation == "view"){
            $("#view").hide();
        }
        InitFuncCodeRequest_({
            data: {
                domainCode: "DM_FILE_EDIT_TYPE,DM_EXTER_TYPE,REVSUG_FLEET,DM_URGENT_LEVEL,EM_APPLY_TYPE,DM_HOW_DEALWITH,DM_ATA",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    //文件格式
                    $('#fileEditType').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_FILE_EDIT_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });

                    $("#dataType").combobox({
                        panelHeight: '100px',
                        data: jdata.data.DM_EXTER_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onHidePanel: function() {
                            validSelectValue_(this, "输入值不存在！");
                        }
                    });
                    $('#applyModel').combobox({
                        panelHeight: '70px',
                        data: jdata.data.REVSUG_FLEET,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#urgentLevel').combobox({
                        panelHeight: '70px',
                        data: jdata.data.DM_URGENT_LEVEL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#howDealwith').combobox({
                        panelHeight: '50px',
                        data: jdata.data.DM_HOW_DEALWITH,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#applyType').combobox({
                        panelHeight: '70px',
                        data: jdata.data.EM_APPLY_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $("#dataFrom").MyComboGrid({
                        panelWidth: '120',
                        width: '150px',
                        idField: 'VALUE',  //实际选择值
                        textField: 'TEXT', //文本显示值
                        editable: true,
                        required: false,
                        pagination: true,
                        tipPosition: 'top',
                        mode:'remote',
                        params: {FunctionCode: 'DM_DATA_FROM_F'},
                        url : Constant.API_URL + 'DM_DATA_FROM_F',
                        columns: [[
                            {field: 'VALUE', title: 'CODE', width: 100, sortable: true},
                            {field: 'TEXT', title: 'NAME', width: 100, sortable: true}
                        ]]
                    });
                    $('#ata').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_ATA,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });


                    $("#userId").MyComboGrid({
                        panelWidth: 420,
                        width: 240,
                        idField: 'NO',  //实际选择值
                        textField: 'NAME', //文本显示值
                        editable: true,
                        required: false,
                        pagination: true,
                        tipPosition: 'top',
                        mode:'remote',
                        params: {FunctionCode: 'WS_USER'},
                        url : Constant.API_URL + 'WS_USER',
                        multiple: true,
                        columns: [[
                            {field: 'NO', title: '员工编号', width: 100, sortable: true},
                            {field: 'NAME', title: '名称', width: 100, sortable: true}
                        ]]
                    });


                    PAGE_DATA['dataType'] = DomainCodeToMap_(jdata.data["DM_EXTER_TYPE"]);
                    PAGE_DATA['applyModel'] = DomainCodeToMap_(jdata.data["REVSUG_FLEET"]);
                    PAGE_DATA['urgentLevel'] = DomainCodeToMap_(jdata.data["DM_URGENT_LEVEL"]);
                    PAGE_DATA['dataFrom'] = DomainCodeToMap_(jdata.data["DM_DATA_FROM_F"]);
                    PAGE_DATA['howDealwith'] = DomainCodeToMap_(jdata.data["DM_HOW_DEALWITH"]);
                    PAGE_DATA['applyType'] = DomainCodeToMap_(jdata.data["EM_APPLY_TYPE"]);
                    PAGE_DATA['ata'] = DomainCodeToMap_(jdata.data["DA_ATA_F"]);
                }
                $("#dataType").combobox({onlyview:true,editable:false});
                $("#urgentLevel").combobox({onlyview:true,editable:false});
                $("#dataFrom").combobox({onlyview:true,editable:false});
                $("#dataNo").combobox({onlyview:true,editable:false});
                $("#dataVer").combobox({onlyview:true,editable:false});
                $("#ata").combobox({onlyview:true,editable:false});
                $("#dataTitle").combobox({onlyview:true,editable:false});
                $("#applyModel").combobox({onlyview:true,editable:false});
                $("#applyType").combobox({onlyview:true,editable:false});
                $("#registerDate").combobox({onlyview:true,editable:false});
                $("#issueDate").combobox({onlyview:true,editable:false});
                $("#memo").combobox({onlyview:true,editable:false});
                $("#howDealwith").combobox({onlyview:true,editable:false});
                $("#evaLimitDate").combobox({onlyview:true,editable:false});
                $("#refAdNo").combobox({onlyview:true,editable:false});
                $("#refAdVer").combobox({onlyview:true,editable:false});
                $("#sbNo").combobox({onlyview:true,editable:false});
                $("#sbGrade").combobox({onlyview:true,editable:false});

                $("#howDealwith").combobox('setValue',"Y");
                if (mpkid){
                    $("#dataType").combobox({onlyview:true});
                    InitDataForm(mpkid);
                }
            }
        })
    }

    function InitDataForm(mpkid) {
        InitFuncCodeRequest_({
            data: {pkid: mpkid, FunctionCode: "DM_DATA_REC_EXTER_PK"}, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ParseFormField_(jdata.data, $("#mform"), Constant.CAMEL_CASE);
                    $('#userId').combogrid({value:jdata.data.USER_ID});

                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }

    //下发
    function distribute(){
        var $form = $("#mform");
        var datas = $form.serializeObject();
        var userId = '';
        if(datas.userId && Object.prototype.toString.call(datas.userId) == '[object Array]'){
            $.each(datas.userId, function(k,v){
                userId += v + ',';
            });
            userId = userId.substring(0,userId.length - 1);
            datas.userId = userId;
        }
        datas = $.extend({userId:userId}, datas, {FunctionCode: 'DM_DATA_REC_EXTER_PUB'});
        InitFuncCodeRequest_({
            data: datas, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if(param.OWindow.onSearch_){
                        param.OWindow.onSearch_('dg', '#ffSearch');
                    }
                    param.OWindow.MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    CloseWindowIframe();
                } else {
                    MsgAlert({content: jdata.msg ? jdata.msg : jdata.data, type: 'error'});
                }
            }
        });

    }


</script>
</html>