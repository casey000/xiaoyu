<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <script src="/js/jquery/easyui/jquery-1.8.0.min.js" type="text/javascript"></script>
    <!-- 这一段里面包含resource_.shtml里的内容，但是除去了jquery-1.12.0.min.js和easyui-lang-zh_CN.js，因为新旧版本共用会导致冲突
         但是不引入这一段的话会导致页面样式失效，我也不知道哪些是有用的哪些是没用的 -->

    <link href="/css/style.min862f.css?v=4.1.0" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet" type="text/css">
    <link href="/css/icon.css" rel="stylesheet" type="text/css">

    <link href="/css/plugins/easyui/themes/icon.css" rel="stylesheet" type="text/css">
    <link href="/css/plugins/easyui/themes/color.css" rel="stylesheet" type="text/css">
    <!--<script type="text/javascript" src="/js/jquery-3.1.0.min.js"></script>-->
    <script src="/js/constants.js" type="text/javascript"></script>
    <!--<script type="text/javascript" src="/js/plugins/Validform_v5.3.2/Validform_v5.3.2.js"></script>
    <link rel="stylesheet" type="text/css" href="/js/plugins/Validform_v5.3.2/css/style.css">-->
    <script src="/js/plugins/easyui/jquery.easyui.custom.min.js" type="text/javascript"></script>
    <script src="/js/plugins/cookie/jquery.cookie.js" type="text/javascript"></script>
    <script src="/js/base64.js" type="text/javascript"></script>
    <script src="/js/plugins/layer/layer.js?style=default" type="text/javascript"></script>
    <script src="/js/plugins/i18next/i18next.min.js"></script>
    <script src="/js/common.js" type="text/javascript"></script>
    <script src="/js/combobox_utils.js" type="text/javascript"></script>
    <script src="/js/plugins/laytpl/laytpl.js" type="text/javascript"></script>
    <script src="/js/pdf.worker.js" type="text/javascript"></script>
    <script src="/js/axios.min.js" type="text/javascript"></script>
    <script src="/js/sfa-query-1.0.js" type="text/javascript"></script>
    <!-- most content of resource_.shtml but without jquery-1.12.0.min.js and easyui-lang-zh_CN.js -->
    <!-- <script type="text/javascript" src="/js/plugins/easyui/jquery.easyui.custom.min.js"></script> -->
    <!-- <script type="text/javascript" src="/js/plugins/easyui/locale/easyui-lang-zh_CN.js"></script> -->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <link href="/css/common_new.css" rel="stylesheet" type="text/css"/>
    <link href="/css/jquery-ui-1.8.2.custom.css" rel="stylesheet" type="text/css"/>
    <link href="/css/ui.jqgrid.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_new.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_from_me.css" rel="stylesheet" type="text/css"/>
    <link href="/css/dialog_default.css" rel="stylesheet" type="text/css"/>

    <link href="/js/jquery/ztree/zTreeStyle.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_qc.css" rel="stylesheet" type="text/css"/>
    <link href="/js/jquery/jquery-ui-multiselect/jquery.multiselect.css" rel="stylesheet" type="text/css"/>


    <script src="/js/global_var.js"></script>


    <!-- multiSelect -->
    <!-- <script src="/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script> -->
    <!-- <script src="/js/jquery/jquery-ui-multiselect/src/jquery.multiselect.js" type="text/javascript"></script> -->

    <!-- easy UI -->
    <!--<script src="/js/jquery/easyui/jquery.easyui.min.js" type="text/javascript"></script>-->
    <script src="/js/jquery/easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>

    <!-- Ztree 使用了tree类型的查询条件定义则需要引入此js -->
    <script src="/js/jquery/ztree/jquery.ztree.core-3.4.js" type="text/javascript"></script>
    <script src="/js/jquery/ztree/jquery.ztree.excheck-3.4.js" type="text/javascript"></script>

    <!-- jqGrid-->
    <script src="/js/jquery/jqGrid/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="/js/jquery/jqGrid/i18n/grid.locale-cn.js" type="text/javascript"></script>

    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>

    <script src="/js/sfa-query-1.0.js" type="text/javascript"></script>
    <script src="/js/date_utils_from_me.js" type="text/javascript"></script>
    <script src="/js/sfa-executor.js" type="text/javascript"></script>
    <script src="/js/sfa-export.js" type="text/javascript"></script>


    <title></title>
    <style type="text/css">
        th {
            height: 30px;
        }

        td {
            text-indent: 1em;
        }

        .save {
            display: inline-block;
            cursor: pointer;
            background: #2465a8;
            color: #fff;
            border-radius: 4px;
            padding: 3px 20px;
            border: none;
            font-size: 14px;
            margin-top: 5px;
            float: right;
        }
    </style>
</head>
<body>
<div class="listbox" style="margin: 2px auto;min-width: 798px;">
    <div id="qc_box"></div>
    <div class="list_btn_row_s qc_template" id="qc_template_box"></div>
    <div class="qc_advance" id="qc_advance_box"></div>
    <div class="list_btn_row">


    </div>
    <div class="listbox">
        <div class="gridbox">
            <div class="grid_tab">
                <table id="common_list_grid"></table>
                <div id="gridPager"></div>

            </div>
        </div>
    </div>
    <div class="easyui-window" data-options="iconCls:'icon-save',modal:true" id="edit_popup"
         style="width:450px;height:350px;padding:10px;display: none"
         title="Card Edit">
        <table class="table table-bordered table-info">
            <tr>
                <th>Model</th>
                <td><span id="model"></span></td>
            </tr>
            <tr>
                <th>Card Type</th>
                <td><span id="type"></span></td>
            </tr>
            <tr>
                <th>Card NO.</th>
                <td><span id="no"></span></td>
            </tr>
            <tr>
                <th>Desc</th>
                <td><span id="desc"></span></td>
            </tr>
            <tr>
                <th>Group</th>
                <td><input class="easyui-combobox" id="skill" name="skill"
                           style="width: 40%"/></td>
            </tr>
        </table>
        <div class="save" onclick="save_card_data()">保存</div>
    </div>

    <script type="text/javascript">
        let params = getParentParam_();
        $(function () {

            $('#edit_popup').window('close');
            var options = {
                view: 'V_JC_ALL',
                qcOptions: {
                    qcBoxId: 'qc_box'
                },
                gridOptions: {
                    gridId: 'common_list_grid',
                    optsFirst: true,
                    optsCols: ["edit"],     //可能要加权限控制
                    jqGridSettings: {
                        multiselect: true,
                        id: "id",
                    },
                    allColModels: {
                        'edit': {
                            name: 'E',
                            colNameEn: 'E',
                            isOpts: true,
                            width: 25,
                            formatter: function (cellValue, options, rowObj) {
                                if (rowObj.status && rowObj.status === 'ISSUED') {
                                    var ele = '<div id="rowData_' + rowObj.id + '" class="ui-corner-all clever-jqgrid-action clever-jqgrid-edit edit icon-edit" title="Edit"></div>';
                                    $('#rowData_' + rowObj.id).live('click', function () {
                                        nrc_edit(rowObj)
                                    });
                                    return ele;
                                } else {
                                    return '';
                                }
                            }
                        },
                    }
                }
            };

            $(document).sfaQuery(options);

            function nrc_delete(obj) {
                params.success(obj);
                close_window();
            }

            /**
             * 关闭当前窗口
             * @return {void}
             */
            function close_window() {
                window.opener = null;
                window.open('', '_self');
                window.close();
            }

            // 导出
            $("#export_btn").click(function () {
                dynamicExportMVC({
                    sfaQuery: $(document).sfaQuery(),
                    container: $(this).parent(),
                    fileName: 'CARD_GROUP_LIST.xls',//导出文件命名
                    url: "/api/v1/jc/all/export_by_page"//后端提供的接口

                });
            });

            $("#gongka").click(function () {

                var curWidth = ($(window).width() * 0.6).toString();
                var curheight = $(window).height().toString();
                ShowWindowIframe({
                    width: curWidth,
                    height: curheight,
                    title: "",
                    param: {nrcid: ""},
                    url: "/views/fixed/nrc_process.shtml"
                });
            });

            var card_data = {};

            function nrc_edit(obj) {
                card_data = obj;
                var screenHeight = $(window).height();
                var scrolltop = $(document).scrollTop();
                var objTop = (screenHeight - 350) / 2 + scrolltop;
                $("#edit_popup").window({
                    resizable: false,
                    modal: true,
                    top: objTop + "px"
                });
                $("#model").text(obj.model);
                $("#type").text(obj.jcType);
                $("#no").text(obj.jcNo);
                $("#desc").text(obj.ctitle);
                $("#skill").combobox(
                    {
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        data: getDataDictionary(),
                    }
                );

            }
        });

        function getDataDictionary() {
            let groupList = [];
            var _url = "/api/v1/plugins/ANALYSIS_DOMAIN_BYCODE";
            var params_ = {
                "domainCode": "PCHECK_PART_GROUP",
                "FunctionCode": "ANALYSIS_DOMAIN_BYCODE"
            };
            $.ajax({
                url: _url,
                data: params_,
                type: "POST",
                dataType: "json",
                cache: false,
                async: false,
                success: function (data) {
                    groupList = data.data.PCHECK_PART_GROUP;
                }
            });
            return groupList;
        }

        function save_card_data() {
            if ($("#skill").combobox("getValue") == "") {
                alert("请选择Group！");
                return
            }
            $.ajax({
                type: "POST",
                url: "/api/v1/pcheck/part/save_part_group",
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({
                    cardNo: $("#no").text(),
                    cardType: $("#type").text(),
                    partGroup: $("#skill").combobox("getValue"),
                }),
                dataType: "json",
                success: function (data) {
                    if (data.code == 200) {
                        MsgAlert({type: "success", content: "分组成功！"});
                        $('#edit_popup').window('close');
                        Refresh();
                    } else if (data.msgData && data.msgData[0]) {
                        MsgAlert({type: "error", content: data.msgData[0]});
                    } else {
                        MsgAlert({type: "error", content: data.msg});
                    }
                },
                error: function () {
                    MsgAlert({type: "error", content: "分组失败！"});
                }
            });

        }

        function Refresh() {
            $(".qc_btn_srh").click();
        }

    </script>

</div>
</body>
</html>