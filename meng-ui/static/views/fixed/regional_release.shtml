<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <meta charset="UTF-8">
    <title></title>

    <style type="text/css">
        .addnrc_table {
            width: 100%;
            height: auto;
            table-layout: fixed;
            border-width: 1px;
            display: table;
            border-collapse: collapse;
        }

        .addnrc_table td {
            height: 40px;
            border: 1px solid #ccc;
            word-break: break-all;
            text-align: center;
            position: relative;
        }
        th {
            text-align: center;
            border: 1px solid #ccc;
            background: #F5F5F6;
        }

        tr {
            height: 30px!important;
        }

        td {
            text-align: center;
            color: #000;
        }

        .name_rep input {
            text-align: center;
        }

        .name_rep span {
            border: 0;

        }

    </style>
</head>
<body style="height: 100%;">
<table class="addnrc_table" id="table_data">
    <tr >
        <th style="width: 50px"></th>
        <th style='width: 50px'></th>
        <th>工具清点</th>
        <th>维修记录</th>
        <th>区域适航</th>
        <th>放行人员工号</th>
        <th>放行人员姓名</th>
        <th>状态</th>
        <th>放行时间</th>
        <th>系统操作人</th>
        <th>放行</th>
    </tr>

</table>

</body>
<script src="/js/plugins/ajaxfileupload/ajaxfileupload.js" type="text/javascript"></script>
<script src="../../../js/datagrid_utils.js" type="text/javascript"></script>
<script src="/js/nrc/assembly.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        data_list();
    });

    function data_list() {
        let id_data = window.parent.document.getElementById("workId").innerHTML;
        $.ajax({
            type: "GET",
            url: "/api/v1/periodic/delivery/list_area_delivery?workId=" + id_data,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.code == 200) {
                    $(".table_data_tr").remove();
                    for (let i in data.data) {
                        let file = " <tr class=\"table_data_tr\">\n" +
                            "        <td style='width: 50px'>" + (parseInt(i)+1) + "</td>\n" +
                            "        <td id=\"checkItem" + data.data[i].id + "\" style='width: 50px'>" + data.data[i].checkItem + "</td>\n" +
                            "        <td><input class=\"check"+ data.data[i].id +"\" type=\"checkbox\" id=\"qingdian" + data.data[i].id + "\"></td>\n" +
                            "        <td><input class=\"check"+ data.data[i].id +"\" type=\"checkbox\" id=\"weixiu" + data.data[i].id + "\"></td>\n" +
                            "        <td><input class=\"check"+ data.data[i].id +"\" type=\"checkbox\" id=\"shihang" + data.data[i].id + "\"></td>\n" +
                            "        <td><input class=\"easyui-textbox easyui-validatebox\" data-options=\"validType:['maxLength[20]'] \"\n" +
                            "                   id=\"repId" + data.data[i].id + "\" name=\"repId\" style=\" width:85%;\"/></td>\n" +
                            "        <td class=\"name_rep repId" + data.data[i].id + "\" ><input style='width:85%;' class=\"easyui-textbox name_in\" readonly=\"readonly\" id=\"name" + data.data[i].id + "\"></td>\n" +
                            "        <td><span id=\"type" + data.data[i].id + "\">OPEN</span></td>\n" +
                            "        <td><span id=\"updateDate" + data.data[i].id + "\"></span></td>\n" +
                            "        <td><span id=\"updatorName" + data.data[i].id + "\"></span></td>\n" +
                            "        <td><input style=\"padding: 1px 10px;\" auth=\"TD_Release\" type=\"button\" value=\"放行\" id=\"fangxin" + data.data[i].id + "\" onclick=\"release_button(" + data.data[i].id + ")\"></td>\n" +
                            "    </tr> ";
                        let html_row = $(file);
                        $("#table_data").append(html_row);
                        fengzhuang("repId" + data.data[i].id);
                        $("#name" + data.data[i].id).textbox();
                        if (data.data[i].status != "ISSUED") {
                            $("#fangxin" + data.data[i].id).hide();
                            $("#type" + data.data[i].id).text("CLOSE");
                            $("#updateDate" + data.data[i].id).text(data.data[i].updateDate);
                            $("#updatorName" + data.data[i].id).text(data.data[i].updatorName);
                            $("#repId" + data.data[i].id).textbox("setValue", data.data[i].mechanicSn);
                            $("#name" + data.data[i].id).textbox("setValue", data.data[i].mechanicName);
                            $("#qingdian" + data.data[i].id).prop("checked", true);
                            $("#weixiu" + data.data[i].id).prop("checked", true);
                            $("#shihang" + data.data[i].id).prop("checked", true);
                            $(".check"+data.data[i].id).attr("disabled", "disabled");
                        }

                    }

                } else if (data.msgData && data.msgData[0]) {
                    alert(data.msgData[0]);
                } else {
                    alert(data.msg);
                }
            },
            error: function () {
                window.alert("失败！");
            }
        });
    }

    function release_button(id) {
        if (!$("#qingdian" + id).is(":checked")) {
            MsgAlert({content: '工具清点必选勾选', type: 'error'});
            return
        }
        if (!$("#weixiu" + id).is(":checked")) {
            MsgAlert({content: '维修记录必选勾选', type: 'error'});
            return
        }
        if (!$("#shihang" + id).is(":checked")) {
            MsgAlert({content: '区域适航必选勾选', type: 'error'});
            return
        }
        if ($("#repId" + id).textbox("getValue") == "") {
            MsgAlert({content: '放行人员不能为空', type: 'error'});
            return
        }
        let data_name = {
            staffNo: $("#repId" + id).textbox("getValue"),
            signature: $("#name" + id).textbox("getValue")
        };
        $.ajax({
            type: "POST",
            url: "/api/v1/periodic/delivery/release_check_list/" + id,
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(data_name),
            dataType: "json",
            success: function (data) {
                if (data.code == 200) {
                    MsgAlert({content: '成功！', type: 'open'});
                    data_list();
                } else if (data.msgData && data.msgData[0]) {
                    alert(data.msgData[0]);
                } else {
                    alert(data.msg);
                }
            },
            error: function () {
                window.alert("保存失败！");
            }
        });
    }
</script>
</html>