<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <script src="/js/jquery/easyui/jquery-1.8.0.min.js" type="text/javascript"></script>
    <!-- 这一段里面包含resource_.shtml里的内容，但是除去了jquery-1.12.0.min.js和easyui-lang-zh_CN.js，因为新旧版本共用会导致冲突
         但是不引入这一段的话会导致页面样式失效，我也不知道哪些是有用的哪些是没用的 -->

    <link href="/css/style.min862f.css?v=4.1.0" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet" type="text/css">
    <link href="/css/icon.css" rel="stylesheet" type="text/css">
    <link href="/css/plugins/easyui/themes/bootstrap/easyui.css" id="swicth-style" rel="stylesheet" type="text/css">
    <link href="/css/plugins/easyui/themes/icon.css" rel="stylesheet" type="text/css">
    <link href="/css/plugins/easyui/themes/color.css" rel="stylesheet" type="text/css">
    <!--<script type="text/javascript" src="/js/jquery-3.1.0.min.js"></script>-->
    <script src="/js/constants.js" type="text/javascript"></script>
    <!--<script type="text/javascript" src="/js/plugins/Validform_v5.3.2/Validform_v5.3.2.js"></script>
    <link rel="stylesheet" type="text/css" href="/js/plugins/Validform_v5.3.2/css/style.css">-->
    <script src="/js/plugins/easyui/jquery.easyui.custom.min.js" type="text/javascript"></script>
    <script src="/js/plugins/cookie/jquery.cookie.js" type="text/javascript"></script>
    <script src="/js/base64.js" type="text/javascript"></script>
    <script src="/js/plugins/layer/layer.js?style=default" type="text/javascript"></script>
    <script src="/js/plugins/i18next/i18next.min.js"></script>
    <script src="/js/common.js" type="text/javascript"></script>
    <script src="/js/combobox_utils.js" type="text/javascript"></script>
    <script src="/js/plugins/laytpl/laytpl.js" type="text/javascript"></script>
    <script src="/js/pdf.worker.js" type="text/javascript"></script>
    <script src="/js/axios.min.js" type="text/javascript"></script>
    <script src="/js/sfa-query-1.0.js" type="text/javascript"></script>
    <!-- most content of resource_.shtml but without jquery-1.12.0.min.js and easyui-lang-zh_CN.js -->
    <!-- <script type="text/javascript" src="/js/plugins/easyui/jquery.easyui.custom.min.js"></script> -->
    <!-- <script type="text/javascript" src="/js/plugins/easyui/locale/easyui-lang-zh_CN.js"></script> -->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <link href="/css/common_new.css" rel="stylesheet" type="text/css"/>
    <link href="/css/jquery-ui-1.8.2.custom.css" rel="stylesheet" type="text/css"/>
    <link href="/css/ui.jqgrid.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_new.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_from_me.css" rel="stylesheet" type="text/css"/>
    <link href="/css/dialog_default.css" rel="stylesheet" type="text/css"/>
    <link href="/css/easyui.css" rel="stylesheet" type="text/css"/>
    <link href="/js/jquery/ztree/zTreeStyle.css" rel="stylesheet" type="text/css"/>
    <!-- <link rel="stylesheet" type="text/css" href="/css/easyui/gray/easyui.css"/> -->
    <link href="/css/common_qc.css" rel="stylesheet" type="text/css"/>
    <link href="/js/jquery/jquery-ui-multiselect/jquery.multiselect.css" rel="stylesheet" type="text/css"/>


    <script src="/js/global_var.js"></script>


    <!-- multiSelect -->
    <!-- <script src="/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script> -->
    <!-- <script src="/js/jquery/jquery-ui-multiselect/src/jquery.multiselect.js" type="text/javascript"></script> -->

    <!-- easy UI -->
    <script src="/js/jquery/easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="/js/jquery/easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>

    <!-- Ztree 使用了tree类型的查询条件定义则需要引入此js -->
    <script src="/js/jquery/ztree/jquery.ztree.core-3.4.js" type="text/javascript"></script>
    <script src="/js/jquery/ztree/jquery.ztree.excheck-3.4.js" type="text/javascript"></script>

    <!-- jqGrid-->
    <script src="/js/jquery/jqGrid/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="/js/jquery/jqGrid/i18n/grid.locale-cn.js" type="text/javascript"></script>

    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>

    <script src="/js/sfa-query-1.0.js" type="text/javascript"></script>
    <script src="/js/date_utils_from_me.js" type="text/javascript"></script>
    <script src="/js/sfa-executor.js" type="text/javascript"></script>
    <script src="/js/sfa-export.js" type="text/javascript"></script>


    <title></title>
    <style type="text/css">
        .html_view_a {
            cursor: pointer;
            color: #f60;
        }

    </style>
</head>
<body>
<div class="listbox" style="margin: 2px auto;min-width: 798px;">
    <div id="qc_box"></div>
    <div class="list_btn_row_s qc_template" id="qc_template_box"></div>
    <div class="qc_advance" id="qc_advance_box"></div>
    <div class="list_btn_row">
        <ul>
<!--            <li class="right_button"><input class="btn" id="add_btn" type="button" value="Add"/></li>-->
        </ul>

    </div>
    <div class="listbox">
        <div class="gridbox">
            <div class="grid_tab">
                <table id="common_list_grid"></table>
                <div id="gridPager"></div>

            </div>
        </div>
    </div>

    <script type="text/javascript">
        let params = getParentParam_();
        $(function () {
            var options = {
                view: 'V_PCHECK',
                qcOptions: {
                    qcBoxId: 'qc_box',
                    allConds: {
                        planStartDate: {hidden: true}, planEndDate: {hidden: true},
                        actualStartDate: {hidden: true},
                        // 隐藏配置中冗余字段，重新配置日期搜索字段
                        planstd: {
                            name: 'planstd',
                            colNameEn: 'Plan Start Date',
                            colNameCn: '计划开始时间',
                            type: 'date'
                        },
                        planend: {
                            name: 'planend',
                            colNameEn: 'Plan End Date',
                            colNameCn: '计划结束时间',
                            type: 'date'
                        }, actustd: {
                            name: 'actustd',
                            colNameEn: 'Actual Start Date',
                            colNameCn: '实际开始时间',
                            type: 'date'
                        }
                    },
                },
                gridOptions: {
                    gridId: 'common_list_grid',
                    optsFirst: true,
                    optsCols: ["edit"],     //可能要加权限控制
                    jqGridSettings: {
                        multiselect: true,
                        id: "id",
                    },
                    allColModels: {
                        'edit2': {
                            name: 'E',
                            colNameEn: 'E',
                            isOpts: true,
                            width: 25,
                            formatter: function (cellValue, options, rowObj) {
                                var ele = '<div id="rowData_' + rowObj.pkid + '" class="ui-corner-all clever-jqgrid-action clever-jqgrid-edit edit icon-edit" title="Edit"></div>';
                                $('#rowData_' + rowObj.pkid).live('click', function () {
                                    fixed_edit(rowObj);
                                });
                                return ele;
                            }
                        },
                        'edit': {
                            isOpts: true,
                            index: 'revtp',
                            width: 100,
                            name: 'revtp',
                            colNameEn: '工包类型',
                            colNameCn: '工包类型',
                            formatter: "select",
                            editoptions: {
                                value: {"D": "定检", "F": "封存", "L": "零散", "Z": "专项","K":"客改"}
                            },
                            formatType: 'map',
                            pattern: {"D": "定检", "F": "封存", "L": "零散", "Z": "专项","K":"客改"}
                        },
                        'acStatus': {
                            formatter: "select",
                            editoptions: {
                                value: {0: "待引进", 1: "引进中", 2: "过渡检准备", 3: "运行", 4: "退出"}
                            },
                            formatType: 'map',
                            pattern: {0: "待引进", 1: "引进中", 2: "过渡检准备", 3: "运行", 4: "退出","":""}
                        },
                        'revst': {
                            formatter: "select",
                            editoptions: {
                                value: {"A": "已创建", "B": "待校核","C": "待审批", "D": "待批准","E": "已批准", "F": "已开工","G": "已完成", "H": "已删除"}
                            },
                            formatType: 'map',
                            pattern:{"A": "已创建", "B": "待校核","C": "待审批", "D": "待批准","E": "已批准", "F": "已开工","G": "已完成", "H": "已删除","":""}
                        },
                        'zxbm': {
                            formatter: "select",
                            editoptions: {
                                value: {"A": "航线", "B": "定检"}
                            },
                            formatType: 'map',
                            pattern: {"A": "航线", "B": "定检","":""}
                        },
                        revno: {
                            formatter: function (cellValue, options, rowObj) {
                                var ele = '<span id="rowData_' + rowObj.pkid + '" class="html_view_a" title="' + cellValue + '">' + cellValue + '</span>';
                                $('#rowData_' + rowObj.pkid).live('click', function () {
                                    fixed_edit(rowObj);
                                });
                                return ele;
                            }

                        },
                        planEndDate: {
                            index: 'planend,planent',// 排序字段
                            formatter: function (cellValue, options, rowObj) {
                                return initInspecDate(rowObj.planend, rowObj.planent);
                            }
                        },
                        planStartDate: {
                            index: 'planstd,planstt',// 排序字段
                            name: 'planStartDate',
                            formatter: function (cellValue, options, rowObj) {
                                return initInspecDate(rowObj.planstd, rowObj.planstt);
                            }
                        },
                        actualStartDate: {
                            index: 'actustd,actustt',// 排序字段
                            name: 'actualStartDate',
                            formatter: function (cellValue, options, rowObj) {
                                return initInspecDate(rowObj.actustd, rowObj.actustt);
                            }
                        },
                        actualEndDate: {
                            index: 'actuend,actuent',// 排序字段
                            name: 'actualEndDate',
                            formatter: function (cellValue, options, rowObj) {
                                return initInspecDate(rowObj.actuend, rowObj.actuent);
                            }
                        },
                        checkLevel: {sortable: false}, checkActualLevel: {sortable: false}
                    }
                }
            };

            $(document).sfaQuery(options);

            function nrc_delete(obj) {
                params.success(obj);
                close_window();
            }

            /**
             * 关闭当前窗口
             * @return {void}
             */
            function close_window() {
                window.opener = null;
                window.open('', '_self');
                window.close();
            }

            // 增加按钮
            $("#add_btn").click(function () {

                //     var curWidth = ($(window).width() * 0.6).toString();   //测试定检弹窗
                //     var curheight = $(window).height().toString();
                //     ShowWindowIframe({
                //         width: curWidth,
                //         height: curheight,
                //         title: "",
                //         param: {},
                //         url: "/views/fixed/fixed_inspection.shtml"
                //     });
            });
        });

        function fixed_edit(rowObj) {
            if (!rowObj.workId || !rowObj.revno) {
                window.alert("定检不存在，数据有误");
                return;
            }
            var curWidth = ($(window).width() * 0.6).toString();
            var curheight = $(window).height().toString();
            ShowWindowIframe({
                width: curWidth,
                height: curheight,
                title: "",
                param: {
                    packageNumber: rowObj.revno,
                    revtp: rowObj.revtp,
                    workId:rowObj.workId
                },
                url: "/views/fixed/fixed_inspection.shtml"
            });
        }

        function initInspecDate(date, time) {

            var str = DateUtils.formatDate(date, 'yyyy-MM-dd');
            if (date) {
                if (!time) {
                    time = '000000';
                }
                return str + ' ' + to_time_string(time);
            }
            return str;
        }

        function to_time_string(str) {
            if (!str) {
                return '';
            }
            if (str.length < 5 || str.length > 6) {
                // 无法识别的时间长度  hhmmss
                return '';
            }

            if (str.length < 6) {
                // 无法识别的时间长度  hhmmss
                str = '0' + str;
            }
            let hh = str.substring(0, 2);
            let mm = str.substring(2, 4);
            let ss = str.substring(4, 6);

            return hh + ':' + mm + ':' + ss;

        }
        function Refresh() {
            $(".qc_btn_srh").click();
        }
    </script>

</div>
</body>
</html>