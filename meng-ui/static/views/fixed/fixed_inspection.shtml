<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <meta charset="UTF-8">
    <title></title>
    <link href="/css/nrc/nrc_add.css" rel="stylesheet">
    <style type="text/css">
        .div_ifname_butt {
            width: 100%;
            height: 40px;
            margin-top: 3px;
            background-color: #F5F5F6;
            border-top: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
        }

        .div_ifname_butt div {
            float: left;
            padding: 5px 15px;
            border: 1px solid #ccc;
            border-radius: 5px 5px 0 0;
            margin-top: 10px;
            color: #000;
            margin-right: 2px;
            font-size: 14px;
            cursor: pointer;
        }

        .div_ifname_butt .Selection {
            background-color: #fff;
            border-bottom: 1px solid #fff;
        }

        .div_ifname {
            padding: 10px;
            height: calc(100% - 340px);
        }

        .div_ifname iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }

        td {
            height: 30px !important;
        }

        .span_tit {
            margin-left: 30px;
            display: none;
        }
        .calendar-day{
            height: 20px !important;
        }
        .zhezhu{
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0px;
            display: none;
            z-index: 99999;
        }
    </style>
    <script type="text/javascript" src="/js/common.js"></script>
</head>
<body style="height: 100%;background-color: #fff">
<div id="zhezhao" class="zhezhu"></div>
<div style="width: 100%;height: auto;position: relative;">
    <div id="zhezhaoto" class="zhezhu"></div>
    <div id="data_status" style="display: none;"></div>
    <div id="complete_status" style="display: none;"></div>
<table class="addnrc_table" style="height: auto;">
    <tr>
        <td class="key">工作包类型</td>
        <td class="key">工作包号</td>
        <td class="key">分包号</td>
        <td class="key">飞机号</td>
    </tr>
    <tr>
        <td><span id="revtp"></span><span id="pkid" style="display: none"></span></td>
        <td><span id="revno"></span><span id="revnr" style="display: none"></span></td>
        <td><span id="fbno"></span><span id="workId" style="display: none"></span></td>
        <td><span id="msgrp"></span></td>
    </tr>
    <tr>
        <td class="key">计划开始时间</td>
        <td class="key">计划完工时间</td>
        <td class="key" id="aBeginTime">实际开始时间</td>
        <td class="key" id="aEndTime">实际完工时间</td>
    </tr>
    <tr>
        <td><span id="planStartDate">2019-04-04</span></td>
        <td><span id="planEndDate">2019-04-04</span></td>
        <td style="position: relative;" id="actualStartDate_value">
            <div class="zhezhu" id="datezhe"></div>
            <input class="easyui-datetimebox" id="actualStartDate" style="width: 85%" type="text"></td>
        </td>
        <td id="actualEndDate_value"><input class="easyui-datetimebox" id="actualEndDate" style="width: 85%" type="text"></td>
        </td>
    </tr>
    <tr class ="fixed_inspection_info">
        <td class="key">项目经理工号<span>*</span></td>
        <td class="key">项目经理姓名</td>
        <td class="key">控制员工号<span>*</span></td>
        <td class="key">控制员姓名</td>
    </tr>
    <tr class="fixed_inspection_info_value">
        <td><input class="easyui-textbox easyui-validatebox" data-options="validType:['maxLength[20]'] "
                   id="managerSn" style=" width:85%;"/></td>
        <td class="managerSn">
            <input
                    class="easyui-textbox name_in" disabled="disabled" id="managerName" name="managerName"
                    style="width: 85%"
                    type="text">
        </td>
        <td><input class="easyui-textbox easyui-validatebox" data-options="validType:['maxLength[20]'] "
                   id="controlSn" style=" width:85%;"/></td>
        <td class="controlSn">
            <input
                    class="easyui-textbox name_in" disabled="disabled" id="controlName" name="controlName"
                    style="width: 85%"
                    type="text">
        </td>
    </tr>
    <tr class="fixed_inspection_info">
        <td class="key">定检级别</td>
        <td class="key">实际级别</td>
    </tr>
    <tr class="fixed_inspection_info_value">
        <td><span id="checkLevel">C1</span></td>
        <td><span id="checkActualLevel">C1</span></td>
    </tr>
    <tr>
        <td class="key">工包标题</td>
        <td colspan="3"><span id="title"></span></td>
    </tr>
    <tr id="fixed_inspe_flightId">
        <td class="key">航班<img alt="" class="fangdajin" id="acBtn" onClick="Original_Card()" src="/img/search.png"
                               style="top: 7px;"/></td>
        <td colspan="3"><span class="span_tit">航站：</span><span id="TO_STATION"></span> <span
                class="span_tit">航班号：</span><span id="FLIGHT_NO"></span><span class="span_tit">日期：</span><span
                id="FLIGHT_DATE"></span>
        <span id="FLIGHT_ID" style="display: none"></span>
        </td>
    </tr>
</table>
</div>
<div class="button_a" style="margin-top: 3px">
    <a onclick="cancel_socket_list()" style="padding: 2px 20px;" id="cancel_socket_list">退库申请</a>
    <a onclick="download_package()" style="padding: 2px 20px;display: none" id="packagePrint" auth="TD_Cover_Printing">出场文件打印</a>
    <a onclick="fixed_submint()" style="padding: 2px 20px;" id="tijiao_d" auth="TD_Submission">提交</a>
    <a onclick="additional_task()" style="padding: 2px 20px;" auth="TD_Additional_tasks" id="fixed_additionale_task">附加任务</a>
    <a onclick="closeWorkPacage()" style="padding: 2px 20px;display:none"  id="fixed_close_worker_package">工作包关闭</a>
</div>
<div class="easyui-dialog" id="dd" style="width:300px;height:200px;padding:10px;display: none" title="Select Check Types">
    <div class="title" style="font-size: 14px">Check Type:</div>
    <div class="type_box" id="type_input" style="margin: 20px 0;text-align: center">
        <input id="a4" style="display: none" class="ogRadio" type="radio" name="checkType" value="O/G"><label style="display: none" class="ogRadio" for="a4">O/G</label>
        <input id="a5" style="display: none" class="poRadio" type="radio" name="checkType" value="Po/F"><label style="display: none" class="poRadio" for="a5">Po/F</label>
    </div>
    <div class="boumnn">
        <a onclick="openFlightList()">确定</a>
        <a onclick="close_dialog()" style="background-color: #ce3c3c">关闭</a>
    </div>
</div>
<div class="div_ifname_butt">
    <div class="Selection hide_ind" id="ac_information">飞机信息</div>
    <div id="project_task" class="hide_ind">例行任务</div>
    <!--<div id="wrong_project_task">例行任务</div>-->
    <div id="wrong_routine_task" class="hide_ind">非例行任务</div>
    <div id="ad_cad" class="hide_ind">AD/CAD</div>
    <div id="regional_release" class="hide_ind" style="display: none">区域放行</div>
    <div id="complete_machine" class="hide_ind">整机放行</div>
</div>
<div class="div_ifname">
    <iframe id="iframe_src" src=""></iframe>
</div>


</body>

<!--<script type="text/javascript" src="/js/am_auth.js"></script> -->

<script type="text/javascript" src="/js/plugins/easyui/jquery.easyui.custom.min.js"></script>
<script type="text/javascript" src="/js/plugins/easyui/locale/easyui-lang-zh_CN.js"></script>

<script src="/js/plugins/ajaxfileupload/ajaxfileupload.js" type="text/javascript"></script>
<script src="../../../js/datagrid_utils.js" type="text/javascript"></script>
<script src="/js/nrc/assembly.js" type="text/javascript"></script>
<script type="text/javascript">
    //定义全局变量(packageNumber对应工包号）
    var packageNumber;
    $(function () {
        $('#dd').dialog('close');
        packageNumber = getParentParam_().packageNumber;
        revtp=getParentParam_().revtp;

        // 飞机基础信息url
        let loginInfo = getLoginInfo();
        window.document['_LOGIN_USER'] = loginInfo;
        window.VALID_AUTH = getParentParam_().PWindow.VALID_AUTH;
        window.AM_AUTH_ = getParentParam_().PWindow.AM_AUTH_;
        window.IS_AUTH = getParentParam_().PWindow.IS_AUTH;
        window = getParentParam_().PWindow;
        var ac_info_url = 'ac_information.shtml';
        var data_nrc = {};
        $.ajax({
            type: "GET",
            url: "/api/v1/periodic/base/query_package_by_package_number?packageNumber=" + packageNumber,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.code == 200) {
                    data_nrc = data.data;
                    if(getParentParam_().hasOwnProperty('isLook')){
                        $("#zhezhaoto").show();
                        $(".button_a").hide();
                        $(".Selection").removeClass("Selection");
                        $(".hide_ind").hide();
                        $("#project_task").addClass("Selection");
                        $("#project_task").show();
                        data_nrc.isLook=true
                    }
                    if(data.data.revtp=="D"){
                        $("#packagePrint").show();
                        if(data.data.zchktp=="C"){
                               $("#regional_release").show();
                        }
                    }else {
                        if (data.data.revtp == "F") {
                            $("#wrong_routine_task").hide();
                        }
                        $("#regional_release").hide();
                        $("#complete_machine").hide();
                        if (data.data.revtp == "K"){
                            $("#ac_information").hide();
                            $("#fixed_inspe_flightId").hide();
                            $("#packagePrint").hide();
                            $("#fixed_additionale_task").hide();
                            $("#aBeginTime").hide();
                            $("#aEndTime").hide();
                            $(".fixed_inspection_info").hide();
                            $(".fixed_inspection_info_value").hide();
                            $("#actualStartDate_value").hide();
                            $("#actualEndDate_value").hide();
                            $("#fixed_close_worker_package").show();
                        }
                    }
                    $('#data_status').removeClass('readOnly');
                    if(!!data.data && !!data.data.status){
                        $('#complete_status').val(data.data.status||"");
                    };
                    if(data.data.status!="UNRELEASED"){

                        $('#data_status').addClass('readOnly');
                        //$("#zhezhao").show();
                        readOnly();
                    }
                    if(data.data.status =="CANCELED"){
                        readOnlyByStatue();
                    }
                    if(data.data.revst=="F"){
                         $("#datezhe").show();
                    }

                    //如果工单ID不存在就提示:注意用val下游取不到值
                    if (data.data.workId) {
                        $("#workId").text(data.data.workId);
                    } else {
                        alert("工包下不存在工单，数据有误");
                        return;
                    }
                    $("#revtp").text(string_(data.data.revtp));
                    $("#revno").text(null_(data.data.revno));
                    $("#revnr").val(null_(data.data.revnr));
                    $("#fbno").text(null_(data.data.fbno));
                    $("#msgrp").text(null_(data.data.msgrp));
                    $("#planStartDate").text(null_(data.data.planStartDate));
                    $("#planEndDate").text(null_(data.data.planEndDate));
                    $("#checkLevel").text(null_(data.data.checkLevel));
                    $("#checkActualLevel").text(null_(data.data.checkActualLevel));
                    $("#title").text(null_(data.data.title));
                    $("#actualStartDate").textbox("setValue", data.data.actualStartDate);
                    $("#actualEndDate").textbox("setValue", data.data.actualEndDate);
                    $("#pkid").val(data.data.pkid);
                    $("#managerSn").textbox("setValue", data.data.xmjlgh);
                    $("#managerName").textbox("setValue", data.data.xmjlxm);
                    $("#controlSn").textbox("setValue", data.data.kzygh);
                    $("#controlName").textbox("setValue", data.data.kzyxm);
                    if(getParentParam_().hasOwnProperty('deferTaskId')){
                        $("#zhezhaoto").show();
                        $(".button_a").hide();
                        $(".Selection").removeClass("Selection");
                        $(".hide_ind").hide();
                        $("#project_task").addClass("Selection");
                        $("#project_task").show();
                        ac_info_url = "project_task.shtml?view=V_PCHECK_SCHEDULED_TASK&deferTaskId="+getParentParam_().deferTaskId+"&qvalue=ROUTINE_TASK&obj=" + JSON.stringify(data_nrc);
                        $('#iframe_src').attr('src', ac_info_url);
                    }else {
                        if(data.data.revtp == "K"){
                            $("#project_task").click();
                            $(".div_ifname").css({"height":"calc(100% - 250px)"});
                        }else{
                            data_nrc.userName_mr=getLoginInfo().userName;
                            data_nrc.accountNumber_mr=getLoginInfo().accountNumber;
                            ac_info_url += '?woNo=' + packageNumber + '&acNo=' + data.data.msgrp + '&acModel=' + data.data.model + '&obj=' + JSON.stringify(data.data.pcheckTailBaseVO) +
                                '&stort=' + data.data.stort + '&bz=' + data.data.bz;
                            $('#iframe_src').attr('src', ac_info_url);
                        }
                    }

                    if (data.data.isModifyFlight == "n") {
                        $("#acBtn").hide();
                    }
                    if (data.data.status == "RELEASED") {
                        $(".button_a").show();
                        $("#tijiao_d").hide();
                        if (data.data.revtp !== "K"){
                            $("#packagePrint").show();
                        }
                    }

                    $(".span_tit").show();

                    $("#TO_STATION").text(null_(data.data.station));
                    $("#FLIGHT_NO").text(null_(data.data.flightNo));
                    $("#FLIGHT_DATE").text(null_(data.data.jobDate));
                    $("#FLIGHT_ID").text(null_(data.data.flightId));

                } else if (data.msg && data.msgData[0]) {
                    alert(data.msgData[0]);
                } else {
                    alert(data.msg);
                }
            },
            error: function () {
                window.alert("失败！");
            }
        });

        $(".div_ifname_butt div").click(function () {
            $(".Selection").removeClass("Selection");
            $(this).addClass("Selection");
            if (this.id == "ac_information") {
                document.getElementById('iframe_src').src = ac_info_url;
            }
            if (this.id == "project_task") {
                document.getElementById('iframe_src').src = "project_task.shtml?view=V_PCHECK_SCHEDULED_TASK&qvalue=ROUTINE_TASK&obj=" + JSON.stringify(data_nrc); //例行任务
                // document.getElementById('iframe_src').src = "/views/nrc/soft_time_list.shtml?method=view";
            }
            if (this.id == "wrong_project_task") {
                document.getElementById('iframe_src').src = "wrong_project_task.shtml";
            }
            if (this.id == "wrong_routine_task") {
                if("K"==revtp){
                    document.getElementById('iframe_src').src = "project_task.shtml?view=V_PCHECK_UNSCHEDULED_TASK&qvalue=NON_ROUTINE_TASK&obj=" + JSON.stringify(data_nrc);//客改
                }else{
                    document.getElementById('iframe_src').src = "project_task.shtml?view=V_PCHECK_UNSCHEDULED_TASK&qvalue=NON_ROUTINE_TASK,DEFECT_TASK&obj=" + JSON.stringify(data_nrc);//非例行任务
                }
            }
            if (this.id == "ad_cad") {
                document.getElementById('iframe_src').src = "ad_cad.shtml";
            }
            if (this.id == "regional_release") {
                document.getElementById('iframe_src').src = "regional_release.shtml";
            }
            if (this.id == "complete_machine") {
                document.getElementById('iframe_src').src = "complete_machine.shtml";
            }

            window.setTimeout(function () {
                readOnly();
                if($('#complete_status').val()=="CANCELED"){
                    readOnlyByStatue();
                }
            }, 500)

        });
        var result = VALID_AUTH("TD_Submission");
        console.log(result);
    });

    function close_dialog() {
        $('#dd').dialog('close');
    }
    function openFlightList() {
        var checkType = $('input[name = "checkType"]:checked').val();
        if(!checkType){
            alert("请先选择航线任务类型");
            return;
        }

        let title_ = "附加任务";
        let currentWidth = $(window).width().toString();
        let currentHeight = $(window).height().toString();
        var obj  ={};
        for(let i = 0 ; i < extraArray.length ; i++){
            if(extraArray[i].workType == checkType){
                obj = extraArray[i];
                break;
            }

        }
        ShowWindowIframe({
            width: currentWidth,
            height: currentHeight,
            title: title_,
            url: "/views/tbm/flb/flb_station_task_detail.shtml?operation="+ checkType + "&orderId=" + obj.id +
            "&acReg=" + obj.acReg + "&flightNo=" + obj.flightNo + "&jobDate=" + obj.jobDate + "&flightId=" + obj.flightId +
            "&departure=" + obj.fromStation + "&arrival=" + obj.toStation + "&isReleased=" + obj.status
        });
    }
    function readOnly() {
        if ($('#data_status').attr('class') && $('#data_status').attr('class').indexOf('readOnly') != -1) {
            $('.textbox-addon-right').remove();
            // $(".button_a").hide();
            $(':text,textarea').attr('readOnly', true);
            $('#iframe_src').contents().find('.right_button,.com_button,.button,.icon-edit').remove();
            $('#iframe_src').contents().find(':text,textarea').attr('readOnly', true);
        }
    }

    function readOnlyByStatue() {
        $('#iframe_src').contents().find('.right_button,.right_button_export,.com_button,.button,.icon-edit').remove();
    }

    function string_(data){
        if(data=="L"){
          return "零散";
        }else if(data=="Z"){
            return "专项";
        }else if(data=="D"){
            return "定检";
        }else if(data=="F"){
            return "封存";
        }else if(data == "K"){
            return "客改";
        }else {
            return "";
        }
    }
    function string_to(data){
        if(data=="零散"){
            return "L";
        }else if(data=="专项"){
            return "Z";
        }else if(data=="定检"){
            return "D";
        }else if(data=="封存"){
            return "F";
        }else {
            return "";
        }
    }

    fengzhuang("managerSn");
    fengzhuang("controlSn");
    var queryFltno_data = {};

    function null_(data) {
        if (data == null) {
            return "";
        }
        return data;
    }

    function Original_Card() {
        $.chooseFlight({
            filter: {
                ac: $("#msgrp").text(),
                type: "xiafa",
                initOG:"1"
            },
            success: function (data) {
            console.log(data);
                queryFltno_data = data;
                $(".span_tit").show();
                $("#TO_STATION").text(data.STATION||"");
                $("#FLIGHT_NO").text(data.FLIGHT_NO||"");
                $("#FLIGHT_DATE").text(data.FLIGHT_DATE||"");
                $("#FLIGHT_ID").text(data.FLIGHT_ID||"");
            }
        })

        // var curWidth = ($(window).width() * 0.6).toString();
        // var curheight = ($(window).height() * 0.6).toString();
        // ShowWindowIframe({
        //     width: curWidth,
        //     height: curheight,
        //     title: "",
        //     param: {
        //
        //         acReg: $("#msgrp").text()
        //     },
        //     url: "/views/common/select_fltno_list.shtml"
        // });
    }


    function queryFltno(data) {
        queryFltno_data = data;
        $(".span_tit").show();
        $("#TO_STATION").text(data.STATION);
        $("#FLIGHT_NO").text(data.FLIGHT_NO);
        $("#FLIGHT_DATE").text(data.FLIGHT_DATE);
    }

    function getUesr() {
        const userInfo = getLoginInfo();
        return userInfo;
    }
    function get_Date() {     //获取当前时间年月日
        var date = new Date();
        var seperator1 = "-";
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        var hour = date.getHours();
        var minute = date.getMinutes();
        var second = date.getSeconds();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }

        var currentdate = year + seperator1 + month + seperator1 + strDate +" "+hour+":"+minute+":"+second;
        return currentdate;
    }

    function additional_task() {
        let flightId = $("#FLIGHT_ID").text();
        let acReg = $("#msgrp").text();
        console.log(acReg);
        if (flightId==null || flightId == "" || flightId == undefined || flightId =="null") {
            alert("请先选择航班");
            return;
        }
        if (!acReg) {
            alert("无法获得飞机号，请检查数据");
            return;
        }

        $.ajax({
            url: "/api/v1/periodic/base/query_additional_task_jump_info?flightId=" + flightId + "&acReg=" + acReg,
            dataType: "json",
            contentType: 'application/json;charset=utf-8',
            type: 'GET',
            async: true,
            cache: false,
            success: function (obj, textStatus) {
                if (obj.code === 200) {
                    $("#dd").dialog({
                        resizable: false,
                        modal: true,
                        top: '110px'
                    });
                    extraArray = obj.data;
                    for(let i = 0 ; i < extraArray.length ; i++){
                        if(extraArray[i].workType == 'O/G'){
                            $(".ogRadio").css('display','inline')
                        }
                        if(extraArray[i].workType == "Po/F"){
                            $(".poRadio").css('display','inline')
                        }
                    }

                } else if (obj.msgData[0]) {
                    alert(obj.msgData[0]);
                } else {
                    alert(obj.msg);
                }
            },
            error: function () {
                alert("获得附加任务失败");
            }
        });

    }

    function fixed_submint() {
        if($("#revtp").text() !== "客改"){
            if ($("#actualStartDate").datebox("getValue") == "") {
                alert("实际开始时间不能为空！");
                return
            } else {
                if (Date.parse(new Date($("#actualStartDate").datebox("getValue"))) > Date.parse(get_Date())) {
                    alert("实际开始时间不能大于当前时间");
                    return
                }
            }
            if ($("#actualEndDate").datebox("getValue") == "") {
                // alert("实际完工时间不能为空！");
                // return
            } else {
                if (Date.parse(new Date($("#actualEndDate").datebox("getValue"))) > Date.parse(get_Date())) {
                    alert("实际完工时间不能大于当前时间");
                    return
                }
                if (Date.parse(new Date($("#actualEndDate").datebox("getValue"))) < Date.parse(new Date($("#actualStartDate").datebox("getValue")))) {
                    alert("实际完工时间不能小于实际开始时间");
                    return
                }
            }
            if ($("#managerSn").textbox("getValue") == "") {
                alert("项目经理不能为空！");
                return
            }
            if ($("#controlSn").textbox("getValue") == "") {
                alert("控制员不能为空！");
                return
            }
        }

        let data = {
            revtp: $("#revtp").text(),
            revno: $("#revno").text(),
            revnr: $("#revnr").val(),
            workId: $("#workId").text(),
            fbno: $("#fbno").text(),
            msgrp: $("#msgrp").text(),
            planStartDate: $("#planStartDate").text(),
            planEndDate: $("#planEndDate").text(),
            checkLevel: $("#checkLevel").text(),
            checkActualLevel: $("#checkActualLevel").text(),
            title: $("#title").text(),
            actualStartDate: $("#actualStartDate").textbox("getValue"),
            actualEndDate: $("#actualEndDate").textbox("getValue"),
            xmjlgh: $("#managerSn").textbox("getValue"),
            xmjlxm: $("#managerName").textbox("getValue"),
            kzygh: $("#controlSn").textbox("getValue"),
            kzyxm: $("#controlName").textbox("getValue"),
            pkid: string_to($("#pkid").val()),
            station: queryFltno_data.STATION,
            flightId: queryFltno_data.FLIGHT_ID,
            flightNo: queryFltno_data.FLIGHT_NO,
            jobDate: queryFltno_data.FLIGHT_DATE,

        };
        $.ajax({
            type: "POST",
            url: "/api/v1/periodic/base/save_package",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(data),
            dataType: "json",
            success: function (data) {
                if (data.code === 200) {
                    window.alert("保存成功！");
                    getParentParam_().OWindow.Refresh();
                    location.reload();
                } else if (data.msgData && data.msgData[0]) {
                    window.alert(data.msgData[0]);
                } else {
                    window.alert(data.data);
                }
            },
            error: function () {
                window.alert("失败！");
            }
        });
    }

    function download_package() {
        let url = "/api/v1/periodic/base/export_pdf";
        let con = "<form id='_f0_rm' method='GET' action='" + url + "'>" +
            "<input class=\"beiliao\" value=\"" + packageNumber + "\"  type=\"text\" name=\"packageNumber\" >" +
            "</form>";
        $("#_f0_rm").remove();
        $("body").append(con);

        $("#_f0_rm").submit();
    }

    //cancel_socket_list弹窗
    function cancel_socket_list() {
        debugger;
        var curWidth = ($(window).width() * 0.8).toString();
        var curheight = $(window).height().toString();
        ShowWindowIframe({
            width: curWidth,
            height: curheight,
            title: 'cancel_socket_list',
            param: {
                workorderId: $("#workId").text(),
                fromStation:  $("#TO_STATION").text(),
                flightNo: $("#FLIGHT_NO").text(),
                flightId: $("#FLIGHT_ID").text()
            },
            url: "/views/cs/cancel_socket_list.shtml"
        });
    }

    function closeWorkPacage() {
        //先校验例行任务中的NRC是否已被关闭，再调用整机放行方法
        let workId = getParentParam_().workId;
        $.ajax({
            type: "GET",
            url: "/api/v1/periodic/delivery/list_un_close_nrc_by_work_id_and_type?workId=" + workId + "&type=ROUTINE_TASK",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.code === 200) {
                    if (data.data && "" !== data.data) {
                        //确认框
                        if (!confirm("编号为" + data.data + "的NRC未关闭，请确认是否继续放行？")) {
                            //取消时走这里
                            return;
                        }
                    }
                    let releaseData = {
                        flightId: $("#flightId").val(),
                        workOrderId: workId,
                        releasePersonalInfo: {
//                            releaseDate: $("#releaseDate2").textbox("getValue"),
//                            signature: $("#releasename").textbox("getValue"),
//                            licenseNo: $("#licenseNo2").val(),
//                            staffNo: $("#signature2").textbox("getValue"),
                        }
                    };
                    $.ajax({
                        type: "POST",
                        url: "/api/v1/tbm/detail/release_package",
                        contentType: "application/json;charset=utf-8",
                        data: JSON.stringify(releaseData),
                        dataType: "json",
                        success: function (data) {
                            if (data.code === 200) {
                                window.alert("放行成功！");
                            } else if (data.msgData && data.msgData[0]) {
                                window.alert("放行失败！失败原因：" + data.msgData[0]);
                            } else {
                                window.alert(data.msg);
                            }
                        },
                        error: function () {
                            window.alert("放行失败！");
                        }
                    });
                } else if (data.msgData && data.msgData[0]) {
                    alert(data.msgData[0]);
                } else {
                    alert(data.msg);
                }
            },
            error: function () {
                window.alert("获得NRC关闭信息失败！");
            }
        });
    }
</script>

</html>