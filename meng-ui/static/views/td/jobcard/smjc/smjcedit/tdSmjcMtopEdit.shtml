<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>定检工卡MTOP拆分详情</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
</head>
<body>
<div id="tt" style="width:100%; height: 100%">
    <table class="table table-bordered table-info">
        <tr>
            <td>请按照MTOP拆分项编卡</td>
        </tr>
    </table>
    <table id="dg"></table>
</div>
<script type="text/javascript">
    var param;
    var PAGE_DATA = {};
    var cmpNo;
    var pkid;
    var from;

    function i18nCallBack() {
        param = getParentParam_();
        cmpNo = param.cmpNo;
        pkid = param.pkid;
        from = param.from;

        InitFuncCodeRequest_({
            data: {
                domainCode: "DA_FLEET,TD_JC_SMJC_COLSER",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                PAGE_DATA['fleetCmp'] = DomainCodeToMap_(jdata.data["DA_FLEET"]);
                PAGE_DATA['closeMan'] = DomainCodeToMap_(jdata.data["TD_JC_SMJC_COLSER"]);
                InitDataGrid();
            }
        });
    }

    function InitDataGrid() {
        $("#dg").MyDataGrid({
            identity: 'dg',
            sortable: true,
            singleSelect: true,
            pagination: false,
            queryParams: {cmpNo: cmpNo},
            columns: {
                param: {FunctionCode: 'TD_JC_MTOP_LIST'},
                alter: {
                    CREATED_DATE: {
                        type: 'date'
                    },
                    UPDATED_DATE: {
                        type: 'date'
                    }
                }
            },
            validAuth: function (row, items) {
                if (row.IF_CLOSED == 'Y') {
                    items['编卡'].enable = false;
                }
                return items;
            },
            contextMenus: [
                {
                    id: "m-edit",
                    i18nText: "编卡",
                    auth: "TD_JC_SMJC_EDIT",
                    onclick: function () {
                        var rowData = getDG('dg').datagrid('getSelected');
                        if (!rowData.PKID) {
                            MsgAlert({content: "请选择数据！", type: 'error'});
                            return;
                        }
                        openEdit(rowData.ITEM_NO);
                    }
                }
            ]
        });
    }

    //打开工卡详情页
    function openEdit(mtopNo) {
        var title_ = $.i18n.t('定检工卡详情');
        ShowWindowIframe({
            width: "850",
            height: "650",
            title: title_,
            param: {pkid: pkid, type: "cmpadd", from: from, mtopNo: mtopNo},
            url: "/views/td/jobcard/smjc/smjcedit/tdSmjcEditDetail.shtml"
        });
    }

    //查询
    function searchData_() {
        $("#dg").datagrid("load", {cmpNo: cmpNo});
        if (param.OWindow.onSearch_) {
            param.OWindow.onSearch_('dg1', '#ffSearch1');
            param.OWindow.onSearch_('dg2', '#ffSearch2');
        }
    }
</script>
</body>
</html>