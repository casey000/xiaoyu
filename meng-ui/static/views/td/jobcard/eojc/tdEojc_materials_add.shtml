<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <!--#include virtual="/views/items/resource_.shtml"-->
</head>
<body class="ibody">
<table cellspacing="0" cellpadding="2" style="margin-top:5px;">
    <td colspan="2">
        <a href="javascript:void(0)" class="btn btn-primary" data-options="" onclick="add()">添加</a>
        <a href="javascript:void(0)" class="btn btn-primary" data-options="" onclick="closeAdd()">关闭</a>
    </td>
    </tr>
</table>
<table id="dg"></table>
</body>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript" src="/js/plugins/ajaxfileupload/ajaxfileupload.js"></script>
<script type="text/javascript">

    var param = {};
    var eoPkid = '';
    var segPkid = '';
    var jcPkid = '';

    function i18nCallBack() {
        param = getParentParam_();
        if (param.segPkid) {
            segPkid = param.segPkid;
        } else {
            segPkid = "-1";
        }
        jcPkid = param.jcPkid;
        InitDataGrid();
    }

    /**
     * eo分段航材列表
     */
    function InitDataGrid() {
        var identity = 'dg';
        $("#dg").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: false,
            queryParams: {pkid: segPkid},//通过param传递参数
            columns: {
                param: {
                    FunctionCode: 'EM_EO_SEG_MATERIALS_LIST'//EM_EO_MATERIALS_LIST
                }
            },
            resize: function () {
                return {width: "100%", height: 300};
            }
        });
    }

    /**
     * 添加分段航材
     * @returns {boolean}
     */
    function add() {
        var rows = $('#dg').datagrid('getChecked');
        if (rows.length == 0) {
            MsgAlert({content: '请至少选择一行数据', type: 'error'});
            return false;
        }
        var rows = JSON.stringify(toCamelCaseArray(rows));
        InitFuncCodeRequest_({
            data: {rows: rows, jcPkid: jcPkid, segPkid: segPkid, FunctionCode: "TD_JC_ALL_EOJC_MATER_IMPORT"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    param.OWindow.reload_("dg");
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    CloseWindowIframe();
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }

    /**
     * 关闭
     */
    function closeAdd() {
        $.messager.confirm('', '是否关闭', function (r) {
            if (r) {
                CloseWindowIframe();
                param.OWindow.reload_("dg");
            }
        });
    }

</script>
</html>