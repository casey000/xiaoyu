<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="ws_work_flow">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <script src="/js/workflow/activiti_workflow.js" type="text/javascript"></script>
    <script src="/js/workflow/formtemplet.js" type="text/javascript"></script>
    <script src="/js/datagrid_utils.js" type="text/javascript"></script>
    <script type="text/javascript" src="/js/em/common_em.js"></script>
    <title></title>
    <script type="text/javascript">
        /**
         *
         * @param resource  业务数据
         * @param execution 流程实例数据
         * @param node 节点配置数据
         * @constructor
         */
        var pkid = -1;
        var jcPkid;
        var selectRow;
        var fleet;

        function InitLoadResource(resource, execution, node) {
            //ParseFormField_(resource, null, Constant.CAMEL_CASE);
            pkid = resource.pkid;
            fleet = resource.fleet;
            InitFuncCodeRequest_({
                data: {
                    domainCode: "DA_FLEET,TD_LMJC_TYPE,TD_LMJC_FLEET_GROUP",
                    FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
                },
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        /*  PAGE_DATA['acno'] = DomainCodeToMap_(jdata.data.DA_ACNO);*/
                        $('#fleet').combobox({
                            panelHeight: '60px',
                            data: jdata.data.DA_FLEET,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });
                        $('#lmjcType').combobox({
                            panelHeight: '60px',
                            data: jdata.data.TD_LMJC_TYPE,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });

                        //下一级办理人
                        $("#authId").MyComboGrid({
                            idField: 'ACCOUNT_ID',  //实际选择值
                            textField: 'USER_NAME', //文本显示值
                            panelHeight: '180px',
                            required: true,
                            width: 140,
                            params: {FunctionCode: 'FLOW_WORK_ACCOUNT'},
                            columns: [[
                                {field: 'ACCOUNT_NUMBER', title: '工号', width: 50},
                                {field: 'USER_NAME', title: '审核人', width: 50}
                            ]],
                            onHidePanel: function () {
                                var t = $(this).combogrid('getValue');
                                if (t != null && t != '' & t != undefined) {
                                    if (selectRow == null || t != selectRow.ACCOUNT_ID) {//没有选择或者选项不相等时清除内容
                                        alert('请选择，不要直接输入！');
                                        $(this).combogrid({value: ''});
                                    }
                                }
                            },
                            onSelect: function (index, row) {
                                selectRow = row;
                                if ('task1535352357153' == node.taskPropId) {//任务退回
                                    $("#reviewedBy").val(row.ACCOUNT_ID);
                                } else if ('task1535352298859' == node.taskPropId) {//工卡审核
                                    $("#approvedBy").val(row.ACCOUNT_ID); //批准人
                                } else if ('task1535352302651' == node.taskPropId) {//工卡批准

                                }
                            }
                        });
                        if ('task1535352298859' == node.taskPropId) {     //第一个节点
                            $("#isFirstNode").val('Y');
                        } else if ('task1535352357153' == node.taskPropId) {   // 任务退回节点只能提交
                            $("#canReturn").hide();
                            $("#isFirstNode").val('N');
                        } else {
                            $("#isFirstNode").val('N');
                        }
                        if ('task1535352302651' == node.taskPropId) {//工卡批准
                            $(".xmclass").hide();
                            $("#authId").combogrid({required: false});
                        }

                        ParseFormField_(resource, null, null);
                    }
                }
            });
        }

        function previewPDF() {
            InitFuncCodeRequest_({
                data: {pkid: pkid, FunctionCode: "TD_JC_PREVIEW"},
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        if (jdata.data.length > 0) {
                            var url = jdata.data;
                            var title_ = $.i18n.t('航线工卡预览');
                            ShowWindowIframe({
                                width: "850",
                                height: "650",
                                title: title_,
                                param: {url: url},
                                url: "/views/td/jobcard/smjc/smjcedit/jobcardPreview.shtml"
                            });
                        }
                    } else {
                        MsgAlert({content: jdata.msg, type: 'error'});
                    }
                }
            });
        }

    </script>
    <script id="tempCombobox" type="text/html">
        <tr>
            <th class="tdl">{{d.titleName }} ：</th>
            <td class="tdr">
                <select name="{{d.fieldName}}" class="easyui-combobox"
                        data-options="required:true, editable: false" panelHeight="120" style="width:180px">
                    {{#
                    for(var i = 0; i < d.options.length; i++){
                    }}
                    <option value="{{d.options[i]['value']}}">{{d.options[i]['text']}}</option>
                    {{# } }}
                </select>
            </td>
        </tr>
    </script>
    <script id="tempTextbox" type="text/html">
        <tr>
            <th class="tdl">{{d.titleName }} ：</th>
            <td class="tdr">
                <input name="{{d.fieldName}}" class="easyui-textbox"
                       data-options="required:true, editable: true" style="width:180px"/>
            </td>
        </tr>
    </script>
</head>
<body class="ibody">

<div id="tabs" style="width: 100%; height: 100%;">
    <div id="tab01" title="业务表单数据" style="">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <form class="form-horizontal m-t" id="mform" style="margin-top: 0px;">
                    <!-- 业务数据展示1 start-->
                    <h5 style="margin-bottom: 4px;">任务数据详情：</h5>
                    <input type="hidden" id="pkid" name="pkid"/>
                    <input type="hidden" id="jcNo" name="jcNo"/>
                    <input type="hidden" id="reviewedBy" name="reviewedBy"/>
                    <input type="hidden" id="approvedBy" name="approvedBy"/>
                    <!--zhangxun-->
                    <input type="hidden" id="isFirstNode" name="isFirstNode">
                    <!--zhangxun-->

                    <table class="table table-bordered table-info">
                        <tr>
                            <td colspan="6" align="right" style="padding: 0;">
                                <input class="btn btn-primary" type="button" id="pdfCheck" onclick="previewPDF()"
                                       value="PDF预览" style="margin-left:3px;"/>
                            </td>
                        </tr>
                        <tr>
                            <th class="th" align="right" style="width: 100px;">机队：</th>
                            <td class="tdr">
                                <input class="easyui-combobox" id="fleet" name="fleet"
                                       data-options="editable:false,onlyview:true" style="width: 200px;"/>
                            </td>
                            <th class="th" align="right" style="width: 80px;">工卡类型：</th>
                            <td class="tdr">
                                <input class="easyui-combobox" id="lmjcType" name="lmjcType"
                                       data-options="editable:false,onlyview:true" style="width: 200px;"/>
                            </td>
                            <th class="th" align="right" style="width: 80px;">工时(MH)：</th>
                            <td class="tdr">
                                <input class="easyui-numberbox" id="planHours" name="planHours"
                                       data-options="editable:false,onlyview:true" style="width: 200px;"/>
                            </td>
                        </tr>
                        <tr>
                            <th class="th" align="right">中文标题：</th>
                            <td class="tdr" colspan="5">
                                <input class="easyui-textbox" id="subjectCn" name="subjectCn"
                                       data-options="editable:false,onlyview:true" style="width: 975px;"/>
                            </td>
                        </tr>
                        <tr>
                            <th class="th" align="right">英文标题：</th>
                            <td class="tdr" colspan="5">
                                <input class="easyui-textbox" id="subjectEn" name="subjectEn"
                                       data-options="editable:false,onlyview:true" style="width: 975px;"/>
                            </td>
                        </tr>
                        <tr>
                            <th class="th" align="right">改版原因：</th>
                            <td class="tdr" colspan="5">
                                <input class="easyui-textbox" id="revReason" name="revReason"
                                       data-options="editable:false,onlyview:true" style="width: 975px;"/>
                            </td>
                        </tr>
                        <tr>
                            <th class="th" align="right">备注：</th>
                            <td class="tdr" colspan="5">
                                <input class="easyui-textbox" id="memo" name="memo"
                                       data-options="editable:false,onlyview:true" style="width: 975px;"/>
                            </td>
                        </tr>
                    </table>
                    <!-- 业务数据展示end-->

                    <h5 style="margin-bottom: 4px;">流程处理：</h5>
                    <input name="taskId" type="hidden"/>
                    <table class="table table-bordered table-info">
                        <tbody id="custom_options"></tbody>
                    </table>
                    <table class="table table-bordered table-info" id="mtable">
                        <tr>
                            <th class="tdl" style="width: 100px;">处理意见：</th>
                            <td class="tdr">
                                <input id="notes" name="notes" class="easyui-textbox easyui-validatebox"
                                       data-options="multiline:true,validType:['maxLength[200]']"
                                       style="height:55px; width: 100%;"/>
                            </td>
                            <th class="tdl xmclass" style="width: 100px">下一级办理人：</th>
                            <td class="tdr xmclass">
                                <input id="authId" class="easyui-textbox easyui-validatebox"
                                       data-options="validType:['maxLength[20]'] " style="height:25px; width:150px;"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6" align="center">
                                <input id="canSubmit" class="btn" disabled="disabled" type="button"
                                       onclick="doSubmit();" value="提交"/>
                                <input id="canTrunTo" class="btn" disabled="disabled" type="button"
                                       onclick="doTurnTo();" value="转办"/>
                                <input id="canReturn" class="btn" disabled="disabled" type="button"
                                       onclick="doReturn();" value="退回"/>
                                <!--<input id="canReturnStart" class="btn" type="button" onclick="javascript: doReturnToStart();"value="退回到办理人"/>-->
                                <!--<input id="canTerminate" class="btn" disabled="disabled" type="button" onclick="javascript: ;"value="终止"/>
                                <input id="canHangUp" class="btn" disabled="disabled" type="button" onclick="javascript: ;"value="挂起"/>-->
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
    <div title="流程信息" style="">
        <table class="table table-bordered table-info" id="processInfo">
            <tr>
                <th class="tdl" style="width: 145px;">流程业务Key ：</th>
                <td class="tdr">
                    <input class="easyui-textbox easyui-validatebox" name="businessKey"
                           data-options="multiline:true, onlyview: true " style="height:25px; width: 60%;"/>
                </td>
                <th class="tdl" style="width: 145px;">流程业务名称 ：</th>
                <td class="tdr">
                    <input class="easyui-textbox easyui-validatebox" name="executionName"
                           data-options="multiline:true, onlyview: true " style="height:25px; width: 60%;"/>
                </td>
            </tr>
            <tr>
                <th class="tdl" style="width: 145px;">流程创建时间 ：</th>
                <td class="tdr">
                    <input class="easyui-textbox easyui-validatebox" name="createTime"
                           data-options="multiline:true, onlyview: true " style="height:25px; width: 60%;"/>
                </td>
                <th class="tdl" style="width: 145px;">流程创建人 ：</th>
                <td class="tdr">
                    <input class="easyui-textbox easyui-validatebox" name="userName"
                           data-options="multiline:true, onlyview: true " style="height:25px; width: 60%;"/>
                </td>
            </tr>
            <tr>
                <th class="tdl" style="width: 145px;">流程任务名称 ：</th>
                <td class="tdr">
                    <input class="easyui-textbox easyui-validatebox" name="nodeName"
                           data-options="multiline:true, onlyview: true " style="height:25px; width: 60%;"/>
                </td>
                <th class="tdl" style="width: 145px;">是否会签任务 ：</th>
                <td class="tdr">
                    <input class="easyui-textbox easyui-validatebox" name="isJoint"
                           data-options="multiline:true, onlyview: true " style="height:25px; width: 60%;"/>
                </td>
            </tr>
            <tr>
                <th class="tdl" style="width: 145px;">流程任务-配置 ：</th>
                <td class="tdr" colspan="3" style="vertical-align: middle;">
                    <input type="checkbox" name="canReturn" value="" disabled/> 可退回
                    <input type="checkbox" name="canTrunTo" value="" disabled/> 可转办
                    <input type="checkbox" name="canTerminate" value="" disabled/> 可终止
                    <input type="checkbox" name="canHangUp" value="" disabled/> 可挂起
                </td>
            </tr>
        </table>
        <div id="workflow" style="overflow-x: scroll;"></div>
    </div>
    <div id="tab02" title="历史任务信息" style="">
        <table id="historyDg"></table>
    </div>
</div>
</body>
</html>