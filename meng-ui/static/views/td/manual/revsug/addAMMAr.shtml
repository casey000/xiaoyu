<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="">增加AR</title>
</head>
<body>

<div>
    <div class="ibox float-e-margins">
        <div class="ibox-content">
        <form id="mform" class="form-horizontal">
            <input type="hidden" class="easyui-textbox" id="pkid" name="pkid"/>
            <table class="table table-bordered table-info">
                <tr>
                    <td align="right" colspan="4">
                        <input id="saveBtn" class="btn btn-primary" type="button" onclick="save()" value="保存"
                               style="width: 50px;margin:10px;"/>
                        <input class="btn btn-primary" type="button" id="closeBtn" onclick="CloseWindowIframe();"
                               value="关闭"
                               style="width: 50px;margin:10px;"/>
                    </td>
                </tr>
                <tr>
                    <th class="th" style="width:80px;" align="left">TASKCODE：</th>
                    <td class="td5">
                        <input class="easyui-textbox" id="taskCode" style="width: 350px;" name="taskCode"
                               data-options="editable:false,required:true,onlyview:true"/>
                        <input id="chooseBtn" class="btn btn-primary" type="button" onclick="choose()" value="选取"
                               style="width: 50px;margin:10px;"/>
                    </td>
                </tr>
                <tr>
                    <th class="th" style="width:80px;" align="right">段落：</th>
                    <td class="td5" colspan="3">
                        <input class="easyui-textbox" id="paragraph" name="paragraph"
                               data-options="editable:true,multiline:true"
                               style="width:98%;height:80px"/>
                    </td>
                </tr>
                <tr>
                    <th class="th" style="width:80px;" align="right">修订类别：</th>
                    <td class="td5" colspan="3">
                        <input class="easyui-combobox" id="revisedCategories" name="revisedCategories"
                               data-options="onChange:changeRevisedCategories"
                               style="height:30px"/>
                    </td>
                </tr>
                <tr>
                    <th class="th" style="width:80px;" align="right">原手册内容：</th>
                    <td class="td5" colspan="3">
                        <input class="easyui-textbox" id="beforeChange" name="beforeChange"
                               data-options="editable:true,multiline:true"
                               style="width:98%;height:80px"/>
                    </td>
                </tr>
                <tr>
                    <th class="th" style="width:80px;" align="right">修改后手册内容：</th>
                    <td class="td5" colspan="3">
                        <input class="easyui-textbox" id="afterChange" name="afterChange"
                               data-options="editable:true,multiline:true"
                               style="width:98%;height:80px"/>
                    </td>
                </tr>

            </table>
        </form>
        </div>
    </div>
</div>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var PAGE_DATA = {};
    var companyCode;
    var param;
    var fleet;
    var dataType;
    var flag;
    var typeFlag;
    var operation;
    var isStructure;
    var mpkid;
    function i18nCallBack() {
        param = getParentParam_();
        dataType = param.dataType;
        fleet = param.fleet;
        companyCode = param.companyCode;
        pkid = param.pkid;
        flag = param.flag;
        typeFlag = param.typeFlag;
        operation = param.operation;
        isStructure=param.isStructure;
        mpkid=param.mpkid;
        //绑定回车查询事件
        bindFormonSearch_('#ffSearch', function () {
            searchData()
        });

        InitFuncCodeRequest_({
            data: {
                domainCode: "TD_REVISED_CATEGORIES,BOE_TYPE,SUPP_TYPE,DA_FLEET,TD_SUPPLEMENT_CHECK_OUT,TD_SUPPLEMENT_STATUS",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if (typeFlag == "BOEING") {
                        $('#dataType').combobox({
                            panelHeight: '110px',
                            data: jdata.data.BOE_TYPE,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });

                        PAGE_DATA['dataType'] = DomainCodeToMap_(jdata.data["BOE_TYPE"]);
                    } else if (typeFlag == "SUPPLEMENT") {
                        $('#dataType').combobox({
                            panelHeight: '110px',
                            data: jdata.data.SUPP_TYPE,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });

                        PAGE_DATA['dataType'] = DomainCodeToMap_(jdata.data["SUPP_TYPE"]);
                    }
                    $('#revisedCategories').combobox({
                        panelHeight: '110px',
                        data: jdata.data.TD_REVISED_CATEGORIES,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //获取CompanyCode
                    InitFuncCodeRequest_({
                        data: {FunctionCode: "COMMON_COMPANY_CODE"},
                        successCallBack: function (jdata) {
                            if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                companyCode = jdata.data;
                            }
                        }
                    });
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
                if (operation == "view") {
                    $("#saveBtn").hide();
                    $("#chooseBtn").hide();
                }
                if (operation == "edit") {
                    $("#chooseBtn").hide();
                }
                if (isStructure=="N"){
                    $("#chooseBtn").hide();
                    $("#taskCode").textbox({editable:true,onlyview:false});

                }
                if (pkid) {
                    InitDataForm(pkid);
                }
            }
        });

    }
    function changeRevisedCategories() {
        var revisedCategories = $('#revisedCategories').combobox('getValue');
        if (revisedCategories=="N"){
            $("#beforeChange").textbox('setValue','');
            $("#beforeChange").textbox({editable:false,onlyview:true,required:false});
            $("#afterChange").textbox({editable:true,onlyview:false,required:true});
        }
        if (revisedCategories=="R"){
            $("#beforeChange").textbox({editable:true,onlyview:false,required:true});
            $("#afterChange").textbox({editable:true,onlyview:false,required:true});
        }
        if (revisedCategories=="D"){
            $("#afterChange").textbox('setValue','');
            $("#beforeChange").textbox({editable:true,onlyview:false,required:true});
            $("#afterChange").textbox({editable:false,onlyview:true,required:false});
        }

    }
    function save() {
        var isValidate = $("#mform").form('validate');
        if (!isValidate)
            return;
        var $form = $("#mform");
        var datas = $form.serializeObject();
        datas = $.extend({mpkid: mpkid}, datas, {FunctionCode: 'TD_REVSUG_AR_ADD'});
        InitFuncCodeRequest_({
            data: datas,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if (typeof(isFlow) == "undefined" || isFlow == null || isFlow == "") {
                        $("#pkid").textbox('setValue', jdata.data.pkid);
                        pkid = jdata.data.pkid;
                        MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        param.OWindow.reloadAr();
                        CloseWindowIframe();
                    }
                } else {
                    MsgAlert({content: jdata.msg ? jdata.msg : jdata.data, type: 'error'});
                }
            }
        });
    }

    function choose() {
        var title_ = $.i18n.t('选取手册');
        if (!dataType) {
            alert("请先在父页面选择参考资料类型");
            return;
        }
        ShowWindowIframe({
            width: 954,
            height: 346,
            title: title_,
            param: {
                manualType: dataType,
                fleet: fleet,
                companyCode: companyCode,
                flag: flag,
                typeFlag: typeFlag
            },
            url: "/views/td/manual/revsug/manualList.shtml"
        });
    }


    function InitDataForm(pkid) {
        InitFuncCodeRequest_({
            data: {pkid: pkid, FunctionCode: "TD_REVSUG_AR_BY_PKID"}, async: false, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ParseFormField_(jdata.data, $("#mform"), Constant.CAMEL_CASE);

                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }


</script>
</body>
</html>