<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="">修改建议单编辑</title>
</head>
<body class="ibody">

<!--<div id="tt" class="easyui-tabs" style="width:100%; height: 102%">-->
<!--    <fieldset class="fieldset_eui">-->
        <form id="mform" class="form-horizontal">
            <input type="hidden"  id="subPkid" name="subPkid"/>
            <input type="hidden"  id="pkid" name="pkid"/>
            <input type="hidden" id="companyCode" name="companyCode"/>
            <input type="hidden"  id="ver" name="ver"/>
<!--            <div id="searchBar">-->
                <table class="table table-bordered table-info">
                    <tr>
                        <td colspan="6" align="right">
                            <input id="noneDeal" class="btn btn-primary" type="button" onclick="noDeal();"
                                   value="无需处理" style="width: 60px;margin:5px;"/>
                            <input id="revision" class="btn btn-primary" type="button" onclick="revisionSub();" value="改版"
                                   style="width: 50px;margin:10px;"/>
                            <input class="btn btn-primary" type="button" id="closeBtn" onclick="CloseWindowIframe();"
                                   value="关闭"
                                   style="width: 50px;margin:10px;"/>
                        </td>
                    </tr>
                    <tr>

                        <th class="th" align="right">备注：</th>
                        <td class="tdr" colspan="5">
                                <textarea class="easyui-textbox " id="memo2" name="memo2"
                                          multiline="true" data-options="editable:true"
                                          style="height:50px;width: 94%;"
                                ></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">手册修订类别：</th>
                        <td class="td5">
                            <input class="easyui-combobox" id="isStructure" name="isStructure"
                                   data-options="required:true,onChange:isStructureChange"/>
                        </td>
                        <th class="th" style="width:80px;" align="right" id="dataNoTh">手册编号：</th>
                        <td class="td5" id="dataNoTd">
                            <input class="easyui-textbox" id="dataNo" name="dataNo"
                                   data-options=""/>
                        </td>
                        <th class="th" style="width:80px;" align="right">建议单类型：</th>
                        <td class="td5">
                            <input class="easyui-combobox" id="revsugType" name="revsugType"
                                   data-options="required:true"/>
                        </td>

                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">建议单号：</th>
                        <td class="td5">
                            <input class="easyui-textbox" id="revsugNo" name="revsugNo"
                                   data-options="required:true,onlyview:true,editable:false"/>
                        </td>
                        <th class="th" style="width:80px;" align="right">手册类型：</th>
                        <td class="td5">
                            <input class="easyui-combobox" id="manualType" name="manualType"
                                   data-options="editable:true,required:true"/>
                        </td>
                        <th class="th" style="width:100px;" align="right">参考资料类型：</th>
                        <td class="td5">
                            <input class="easyui-combobox" id="dataType" name="dataType"
                                   data-options="editable:true,required:true,onChange:dataTypeChange"/>
                        </td>

                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">机型：</th>
                        <td class="td5">
                            <input class="easyui-combobox" id="fleet" name="fleet"
                                   data-options="editable:true,required:true,onChange:changeFleet"/>
                        </td>
                        <th class="th" style="width:80px;" align="right">处理期限：</th>
                        <td class="td5">
                            <input class="easyui-datebox" id="deadline" name="deadline"
                                   data-options="editable:true,required:true"/>
                        </td>
                        <th class="th" style="width:80px;" align="right">章节：</th>
                        <td class="td5">
                            <input class="easyui-combobox" id="ata" name="ata"
                                   data-options="editable:true,required:true"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">重评日期：</th>
                        <td class="td5">
                            <input class="easyui-datebox" id="revDate" name="revDate"
                                   data-options="editable:true"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">专业：</th>
                        <td class="tdr" style="width: 80px;">
                            <input class="easyui-combobox" id="specialize" name="specialize"
                                   data-options="required:true,editable:true"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">适用性：</th>
                        <td class="td5" colspan="5">
                            <input class="easyui-combobox" id="apply" name="apply" style="width: 80%;"
                                   data-options="editable:false,required:true,onlyview:true"/>
                            <input id="chooseBtn" class="btn btn-primary" type="button" onclick="chooseApply()"
                                   value="选取"
                                   style="width: 50px;margin:10px;"/>
                        </td>
                    </tr>
                    <tr id="old">
                        <th class="th" style="width:80px;" align="right">改版记录：</th>
                        <td class="td5" colspan="5">
                            <input class="easyui-textbox" id="revRecord" data-options="editable:false,multiline:true"
                                   style="width:100%;height:80px" name="revRecord"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">修改原因：</th>
                        <td class="td5" colspan="5">
                            <input class="easyui-textbox" id="revmnReason" data-options="editable:true,multiline:true"
                                   style="width:100%;height:80px" name="revmnReason"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="th" style="width:80px;" align="right">备注/说明：</th>
                        <td class="td5" colspan="5">
                            <input class="easyui-textbox" id="memo" name="memo"
                                   data-options="editable:true,multiline:true"
                                   style="width:100%;height:80px"/>
                        </td>
                    </tr>

                </table>
<!--            </div>-->
        </form>
<!--    </fieldset>-->
<!--</div>-->
<script type="text/javascript" src="/js/plugins/ajaxfileupload/ajaxfileupload.js"></script>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var PAGE_DATA = {};
    var COMBOBOX_DATA = {};
    var param;
    var operation;
    var pkid = "";
    var ver = "";
    var isFlow = "";
    var taskcode = "";
    var partAttr = {};
    var BOE_TYPE = {};
    var SUPP_TYPE = {};
    var flag;
    var typeFlag = "";
    var fleetNum = "";
    var mpkid = "";
    var func="TD_MANUAL_REVSUG_AR_LIST";
    function i18nCallBack() {
        //绑定回车查询事件
        param = getParentParam_();
        operation = param.operation;
        pkid = param.pkid;
        mpkid = param.mpkid;
        isFlow = param.isFlow;

        InitFuncCodeRequest_({
            data: {
                domainCode: "TD_REVISED_CATEGORIES,REVSUG_IS_STRUCTURE,YESORNO,REVSUG_FLEET,REVSUG_DATA_TYPE,BOE_TYPE,SUPP_TYPE,REVSUG_DEAL_OPTION,REVSUG_STATUS,DM_ATA,REVSUG_APPLY,EM_FILE_SPEC",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $('#specialize').combobox({
                        panelHeight: '70',
                        data: jdata.data.EM_FILE_SPEC,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });

                    $('#ata').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_ATA,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    // $('#apply').combobox({
                    //     panelHeight: '135px',
                    //     data: jdata.data.REVSUG_APPLY,
                    //     multiple: true,
                    //     valueField: 'VALUE',
                    //     textField: 'TEXT'
                    // });
                    $('#isStructure').combobox({
                        panelHeight: '135px',
                        data: jdata.data.REVSUG_IS_STRUCTURE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $("#dataNoTh").hide();
                    $("#dataNoTd").hide();
                    $('#fleet').combobox({
                        panelHeight: '110px',
                        data: jdata.data.REVSUG_FLEET,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onSelect: function (data) {
                            fleetNum = $("#fleet").textbox('getValue');
                        }
                    });
                    $('#revsugType').combobox({
                        panelHeight: '110px',
                        data: jdata.data.REVSUG_DEAL_OPTION,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onSelect: function (data) {
                            var dealOption = $("#revsugType").combobox('getValue');
                            ComOrPerChange(dealOption);
                        }
                    });
                    $('#manualType').combobox({
                        panelHeight: '110px',
                        data: jdata.data.REVSUG_DATA_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onSelect: function (data) {
                            var dealOption = $("#manualType").combobox('getValue');
                            changeType(dealOption);
                        }
                    });
                    //手册标准
                    PAGE_DATA['fleet'] = DomainCodeToMap_(jdata.data["REVSUG_FLEET"]);
                    PAGE_DATA['revsugType'] = DomainCodeToMap_(jdata.data["REVSUG_DEAL_OPTION"]);
                    PAGE_DATA['manualType'] = DomainCodeToMap_(jdata.data["REVSUG_DATA_TYPE"]);
                    PAGE_DATA['boeType'] = DomainCodeToMap_(jdata.data["BOE_TYPE"]);
                    PAGE_DATA['suppType'] = DomainCodeToMap_(jdata.data["SUPP_TYPE"]);
                    PAGE_DATA['revisedCategories'] = DomainCodeToMap_(jdata.data["TD_REVISED_CATEGORIES"]);
                    //
                    InitFuncCodeRequest_({
                        data: {
                            // applyModel: applyModel,
                            // companyCode: param.companyCode,
                            FunctionCode: "TD_REVSUG_FLEET_LIST2"
                        },
                        successCallBack: function (jdata) {
                            if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                $('#apply').combobox({
                                    panelHeight: '135px',
                                    data: jdata.data,
                                    multiple: true,
                                    // editable: false,
                                    // onlyview: true,
                                    valueField: 'VALUE',
                                    textField: 'TEXT'
                                });
                                if (pkid) {
                                    InitDataForm(pkid);
                                }
                            } else {
                                MsgAlert({content: jdata.msg, type: 'error'});
                            }
                        }
                    });
                    //
                    if (operation == "edit") {
                        $("#revsugType").combobox({onlyview: true, editable: false});
                        $("#manualType").combobox({onlyview: true, editable: false});
                        $("#fleet").combobox({onlyview: true, editable: false});
                        $("#dataType").combobox({onlyview: true, editable: false});
                    }



                    BOE_TYPE = jdata.data.BOE_TYPE;
                    SUPP_TYPE = jdata.data.SUPP_TYPE;
                    if (typeFlag == "BOEING") {
                        $('#dataType').combobox({
                            panelHeight: '110px',
                            data: BOE_TYPE,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });

                        PAGE_DATA['dataType'] = DomainCodeToMap_(jdata.data["BOE_TYPE"]);
                    } else if (typeFlag == "SUPPLEMENT") {
                        $('#dataType').combobox({
                            panelHeight: '110px',
                            data: SUPP_TYPE,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });

                        PAGE_DATA['dataType'] = DomainCodeToMap_(jdata.data["SUPP_TYPE"]);
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

    }

    function changeFleet() {
        var fleet = $("#fleet").combobox('getValue');
        // InitFuncCodeRequest_({
        //     data: {fleet: fleet, FunctionCode: 'REVSUG_APPLY'},
        //     successCallBack: function (jdata) {
        //         if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
        //             $('#apply').combobox({
        //                 panelHeight: '135px',
        //                 data: jdata.data,
        //                 multiple: true,
        //                 valueField: 'VALUE',
        //                 textField: 'TEXT'
        //             });
        //         } else {
        //             MsgAlert({content: jdata.msg, type: 'error'});
        //         }
        //     }
        // });
    }
    function isStructureChange() {
        var isStructure = $('#isStructure').combobox('getValue');
        if (isStructure=="N"){
            $("#dataNo").textbox({required: true});
            $("#dataNoTh").show();
            $("#dataNoTd").show();
        }else {
            $("#dataNo").textbox({required: false});
            $("#dataNoTh").hide();
            $("#dataNoTd").hide();
        }
    }
    function changeType(deal) {
        if (deal == "BOEING") {
            typeFlag = "BOEING";
            // $("#revsugType").combobox({onlyview: true, editable: false});
            // $("#revsugType").textbox('setValue', 'AR');
            $('#dataType').combobox({
                panelHeight: '110px',
                data: BOE_TYPE,
                valueField: 'VALUE',
                textField: 'TEXT'
            });

            // InitDataGridAR(pkid);
        } else {
            typeFlag = "SUPPLEMENT";
            $('#dataType').combobox({
                panelHeight: '110px',
                data: SUPP_TYPE,
                valueField: 'VALUE',
                textField: 'TEXT'
            });
            // $("#revsugType").combobox({onlyview: true, editable: false});

            // InitDataGridDS(pkid);
        }
        ComOrPerChange($("#revsugType").combobox('getValue'));
    }
    function dataTypeChange() {
        var dataType=$("#dataType").combobox('getValue');
        if (dataType=="AMM"||dataType=="SAMM"){
            func="TD_MANUAL_REVSUG_AR_AMM_LIST";
        }else if(dataType=="IPC"||dataType=="SIPC"){
            func="TD_MANUAL_REVSUG_AR_IPC_LIST";
        }else if(dataType=="WDM"||dataType=="SSM"){
            func="TD_MANUAL_REVSUG_AR_WDM_LIST";
        }else{
            func="TD_MANUAL_REVSUG_AR_LIST";
        }
        var revSug = $("#revsugType").combobox('getValue');
        if (revSug == "DS") {
            // InitDataGridDS(pkid);
        }
        if (revSug == "AR") {
            // InitDataGridAR(pkid);
        }

    }
    function ComOrPerChange(revSug) {
        flag = revSug;
        $("#upload").hide();
        if (revSug == "DS") {
            InitDataGridDS(pkid);
            $("#upload").show();
            $("#viewAttachBtn").show();
            $("#file").show();
            $("#delete").show();
            $("#addDs").show();
            $("#addAr").hide();
        }
        if (revSug == "AR") {
            // InitDataGridAR(pkid);
            $("#upload").show();
            $("#viewAttachBtn").show();
            $("#file").hide();
            $("#delete").hide();
            $("#addDs").hide();
            $("#addAr").show();

        }

        if (operation == "view") {
            $("#upload").hide();
            $("#saveBtn").hide();
            $("#closeBtn").hide();
            $("#subBtn").hide();
            $("#delete").hide();
            $("#addDs").hide();
            $("#addAr").hide();
            // $("#viewAttachBtn").hide();
        }
    }

    function noDeal() {
        var memo=$("#memo2").textbox("getValue");
        if (memo==""){
            MsgAlert({content:'请填写备注', type: 'error'});
            return;
        }
        var pkid =$("#subPkid").val();
        InitFuncCodeRequest_({
            data: {pkid: pkid,memo:memo, FunctionCode: "TD_REVSUG_SUB_NONE_DEAL"}, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    param.OWindow.reloadTodo();
                    CloseWindowIframe();
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

    }
    function revisionSub() {
        var pkid =$("#subPkid").val();
        var revRecord = $('#revRecord').textbox('getValue');
        InitFuncCodeRequest_({
            data: {pkid: mpkid, FunctionCode: "TD_REVSUG_LAST"}, async:false, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if(jdata.data){
                        var status = jdata.data.STATUS;
                        if(status != 'ISSUED' && status != 'EDIT' && status != 'TURNBACK'){
                            MsgAlert({content: "该手册修改建议单的最高版非发布/编写/驳回状态，不允许发起改版，请先生效或退回编写中在发起改版。", type: 'error'});

                        }else{
                            InitFuncCodeRequest_({
                                data: {pkid: pkid,status:status,revRecord:revRecord, FunctionCode: "TD_REVSUG_SUB_REVISION"}, async:false,successCallBack: function (jdata) {
                                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                        MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                                        param.OWindow.reloadTodo();
                                        CloseWindowIframe();
                                    } else {
                                        if (jdata.msg.indexOf("selectOne()") != -1) {
                                            MsgAlert({content: "该手册建议单已被改版!", type: 'error'});
                                        } else {
                                            MsgAlert({content: jdata.msg ? jdata.msg : jdata.data, type: 'error'});
                                        }

                                    }
                                }
                            });
                        }
                    }
                } else {
                    MsgAlert({content: "获取最高版建议单失败!", type: 'error'});
                }
            }
        });
    }
    function InitDataForm(pkid) {

        InitFuncCodeRequest_({
            data: {pkid: pkid, FunctionCode: "TD_REVSUG_SUB_BY_PKID"}, async: false, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $("#subPkid").val(pkid);

                    mpkid = jdata.data.TPKID;
                    InitFuncCodeRequest_({
                        data: {pkid: jdata.data.TPKID, FunctionCode: "TD_REVSUG_BY_PKID"}, async: false, successCallBack: function (jdata) {
                            if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                ParseFormField_(jdata.data, $("#mform"), Constant.CAMEL_CASE);
                                $('#fleet').combobox({value: jdata.data.FLEET});
                                $('#dataType').combobox({value: jdata.data.DATA_TYPE});
                                $("#apply").combobox({value: jdata.data.APPLY});
                                // $("#apply").combobox("setValue", jdata.data.APPLY);
//                    $('#ata').textbox({value: jdata.data.ATA});
                                ComOrPerChange(jdata.data.REVSUG_TYPE);
                                changeType(jdata.data.MANUAL_TYPE);
                                dataTypeChange();
                                ver = $("#ver").val();
                                if (ver == 0) {
                                    $("#old").hide();
                                }
                            } else {
                                MsgAlert({content: jdata.msg, type: 'error'});
                            }
                        }
                    });


                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });




    }

    //刷新
    function reload_() {
        // $("#dg").datagrid("reload");
        ComOrPerChange($("#revsugType").combobox('getValue'));
    }
    //刷新
    function reloadAr() {
        dataTypeChange();
    }


    function deleteFile() {
        if (!confirm("是否刪除"))
            return;
        InitFuncCodeRequest_({
            data: {pkid: pkid, FunctionCode: 'REVSUG_ATTACHMENT_DEL'},
            successCallBack: function (jdata) {
                if (jdata.code == 200) {
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    $("#filename").textbox('setValue', '');
                }
            }
        });
    }
    function checkDeadline() {
        var deadline = $('#deadline').datebox('getValue');
        var deadlineDate = new Date(deadline);
        var current= new Date().Format("yyyy-MM-dd");
        var currentDate = new Date(current);

        // var currentDate = new Date();
        var total = (deadlineDate.getTime() - currentDate.getTime())/1000;
        var day = parseInt(total / (24*60*60));//计算整数天数
        if (day>=0){
            return true;
        }
        return false;
    }



    function upper() {
        var title = $(this).val();
        title = title.toUpperCase();
        $("#dataTitle").textbox('setValue', title);
    }



    function chooseApply() {
        //获取机型 fleet
        var fleet = $("#fleet").combobox('getValue');
        if (!fleet) {
            MsgAlert({content: "请先选择机型.", type: 'error'});
            return;
        }

        var title_ = $.i18n.t('选取适用性');
        var acIds = $("#apply").combobox("getValues");
        var acId;
        if (Array.isArray(acIds)) {
            acId = acIds.join(',');
        } else {
            acId = acIds;
        }
        ShowWindowIframe({
            width: 644,
            height: 506,
            title: title_,
            param: {
                // applyModel: applyModel,
                // companyCode: companyCode,
                fleet: fleet,
                acId: acId
                // pkid: pkid,
                // spkid: spkid
            },
            url: "/views/td/manual/revsug/fleetList.shtml"
        });
    }
    function addAR() {
        if (isEmpty(pkid)) {
            alert("请先保存主表数据！");
            return;
        }
        //获取手册类型
        var dataType = $('#dataType').combobox('getValue');
        if(isEmpty(dataType)){
            MsgAlert({content: "请保存数据后提交.", type: 'error'});
            return;
        }
        var url="/views/td/manual/revsug/addOtherAr.shtml";
        if (dataType=="AMM"||dataType=="SAMM"){
            url="/views/td/manual/revsug/addAMMAr.shtml";
        }else if(dataType=="IPC"||dataType=="SIPC"){
            url="/views/td/manual/revsug/addIPCAr.shtml";
        }else if(dataType=="WDM"||dataType=="SSM"){
            url="/views/td/manual/revsug/addWDMAr.shtml";
        }else{
            url="/views/td/manual/revsug/addOtherAr.shtml";
        }
        var isStructure = $('#isStructure').combobox('getValue');
        var title_ = $.i18n.t('增加AR');
        ShowWindowIframe({
            width: 1050,
            height: 470,
            title: title_,
            param: {
                dataType: $("#dataType").combobox('getValue'),
                fleet: $("#fleet").combobox('getValue'),
                companyCode: $("#companyCode").val(),
                mpkid: pkid,
                flag: flag,
                typeFlag: typeFlag,
                isStructure:isStructure
            },
            url: url
        });
    }

    function randomNumber() {
        var ata = $("#ata").combobox('getValues');
        if (Array.isArray(ata)) {
            ata = ata.join(',');
        }
        var num = 1;
        if (ata.indexOf(",") != -1) {
            ata = "MULT";
        }
        var todayDate = new Date();
        var year = todayDate.getFullYear();
        var serialNo = fleetNum + "-" + ata + "-" + year;
        InitFuncCodeRequest_({
            data: {serialNo: serialNo, FunctionCode: "TD_REVSUG_BY_NO"},
            async: false,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if (jdata.data != null) {
                        if (jdata.data.OLDNUM) {
                            num = parseInt(jdata.data.OLDNUM, 10) + 1;
                        }
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

        num = pad(num, 4);
        serialNo = serialNo + num;
        return serialNo;
    }

    var pad = function () {
        var tbl = [];
        return function (num, n) {
            var len = n - num.toString().length;
            if (len <= 0) return num;
            if (!tbl[len]) tbl[len] = (new Array(len + 1)).join('0');
            return tbl[len] + num;
        }
    }();

    function choose(da, index) {
        var title_ = $.i18n.t('选取手册');
        ShowWindowIframe({
            width: 954,
            height: 346,
            title: title_,
            param: {
                index: index,
                manualType: da,
                fleet: $("#fleet").combobox('getValue'),
                companyCode: $("#companyCode").val(),
                flag: flag,
                typeFlag: typeFlag
            },
            url: "/views/td/manual/revsug/manualList.shtml"
        });
    }


    //刷新
    function reload_par() {
        getParentParam_().OWindow.reload_();
        window.close();
    }


    function openDetaiDs(operation, pkid) {
        var isStructure = $('#isStructure').combobox('getValue');
        var title_ = $.i18n.t('DS编辑页面');
        ShowWindowIframe({
            width: "690",
            height: "290",
            title: title_,
            param: {
                dataType: $("#dataType").combobox('getValue'),
                fleet: $("#fleet").combobox('getValue'),
                companyCode: $("#companyCode").val(),
                pkid: pkid,
                flag: flag,
                typeFlag: typeFlag,
                operation: operation,
                isStructure:isStructure
            },
            url: "/views/td/manual/revsug/addDs.shtml"
        });
    }

    function openDetaiAr(operation, pkid) {

        //获取手册类型
        var dataType = $('#dataType').combobox('getValue');
        var url="/views/td/manual/revsug/addOtherAr.shtml";
        if (dataType=="AMM"||dataType=="SAMM"){
            url="/views/td/manual/revsug/addAMMAr.shtml";
        }else if(dataType=="IPC"||dataType=="SIPC"){
            url="/views/td/manual/revsug/addIPCAr.shtml";
        }else if(dataType=="WDM"||dataType=="SSM"){
            url="/views/td/manual/revsug/addWDMAr.shtml";
        }else{
            url="/views/td/manual/revsug/addOtherAr.shtml";
        }
        var isStructure = $('#isStructure').combobox('getValue');
        var title_ = $.i18n.t('AR编辑页面');
        ShowWindowIframe({
            width:1050,
            height: 470,
            title: title_,
            param: {
                dataType: $("#dataType").combobox('getValue'),
                fleet: $("#fleet").combobox('getValue'),
                companyCode: $("#companyCode").val(),
                pkid: pkid,
                flag: flag,
                typeFlag: typeFlag,
                operation: operation,
                isStructure:isStructure
            },
            url: url
        });
    }


</script>
</body>
</html>