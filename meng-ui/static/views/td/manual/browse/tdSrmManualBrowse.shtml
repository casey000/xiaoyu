<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="">手册浏览</title>
</head>
<body class="ibody">
<div id="mlayout" class="easyui-layout" style="height: 100%;">
    <div id="lay_left" data-options="region:'west',split:true,collapsible:true" title="The SP Manual Tree." style="width: 23%;">
        <ul id="locTree" class="easyui-tree"></ul>
    </div>
    <div id="lay_right" data-options="region:'center'" style="-webkit-overflow-scrolling:touch"  >
        <span></span>
        <div id="tt2" class="easyui-tabs" fit="true">
        </div>
    </div>
</div>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var sql="";
    var param;
    var treeStatus = "default";// default:默认方式   jump:其他地方跳转过来
    var jumpTaskCode = "";
    var companyCode = "";//运营人
    var fleet = "";//机队
    var manualType = "";//手册类型
    var dealOption = "";//编写方式
    var data;
    var fileId;
    function i18nCallBack() {
       debugger;
        param = getParentParam_();

        treeStatus = param.treeStatus;
        jumpTaskCode = param.jumpTaskCode;
        companyCode = param.companyCode;
        fleet = param.fleet;
        manualType = param.manualType;
        dealOption = param.dealOption;

      if (dealOption == "unstructured") {
            InitFuncCodeRequest_({
                data: {
                    FunctionCode: "TD_MANUAL_TREE_NODE_ID",
                    fleet: fleet,
                    dataType: manualType,
                    companyCode: companyCode,
                    subtask: jumpTaskCode
                },
                async: false,
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        if (jdata.data != null) {
                            fileId = jdata.data.ID;
                        } else {
                            MsgAlert({
                                content: "文件数据异常，请检查链接或联系业务员！",
                                type: "error"
                            })
                        }
                    } else {
                        MsgAlert({
                            content: jdata.msg,
                            type: "error"
                        })
                    }
                }
            });
        }

        getTree();
    }

    function getTree() {
        //初始化树
        // ajaxLoading();
        $("#locTree").tree({
            url: "/api/v1/plugins/TD_MANUAL_LIST_SRM_TREE",
            lines: true,
            animate: true,
            formatter: function (tdata_) {
                var ns = tdata_.nameString;
                var ds = ns == "Y" ? "<button>DS</button>" : "";
                var ps = (ns != "Y" && !! ns) ? ("&nbsp;" + ns) : "";
                return ds + tdata_.name + ps;
            },
            loadFilter: function (jdata) {
                ajaxLoadEnd();
                var treeData = HandleTreeData_(jdata.data, 'pid');
                var tdata_ = WarpTreeGridData_(treeData, "000", ['id', 'pid']);
                return tdata_;
            },
            onSelect: function (node) {
                $("#dataGridType").val("0");
                var type = node.type;
               if (type == "unstructured") { //非机构化方式
                    addTab(node.name, '/views/pdfMobile/web/viewer.html?url=' + node.url);
                }
            }
        }).css({padding: '5px'});
    }

    function getTreeData(){
        //验证网关查询接口
        InitGatewayRequest_({
            type: "post",
            async: false,
            path: "/online-manual/supplement/selectSrmManualTree",
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    debugger;
                    data = jdata.obj;
                } else {
                    MsgAlert({content: jdata.errorMessage, type: 'error'});
                }
            }
        });
    }
    function addTab(title, url) {
        $('#tt2').tabs('close', 1);
        var content = '<iframe scrolling="auto" frameborder="0" src="' + url + '" style="width:100%;height:100%;"></iframe>';
        $('#tt2').tabs('add', {
            title: title,
            content: content,
            closable: true
        });
    }
</script>
</body>
</html>