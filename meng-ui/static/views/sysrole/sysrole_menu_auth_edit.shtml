<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <link rel="stylesheet" href="/css/table.css">
    <title>角色菜单设置</title>
    <script type="text/javascript">
        var param = {};
        $(function () {
            param = getParentParam_();
            if (!param || !param.PKID) {
                layerErrorPage($.i18n.t('msg_err:ERRMSG.COMMON.REQ_PARAM_ERROR'), "500");
                return;
            }
            layerStandardAjaxCall_({
                url: "/api/v1/sysrole/menuAuth",
                data: {pkid: param.PKID},
                success: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        var tdata_ = _WarpTreeMenuData(jdata.data, "0", ["id", "pid"]);
                        if (!tdata_) {
                            return;
                        }
                        $("#menuTree").tree({
                            data: tdata_, lines: true,
                            animate: true, checkbox: true,
                            formatter: function (node) {
                                return node.text;//@todo node.attributes.i18nText ? $.i18n.t('common:'+node.attributes.i18nText) : node.text;
                            }
                        }).css({padding: '5px'});
                    } else {
                        MsgAlert({content: jdata.msg, type: 'error'});
                    }
                }
            });

        });

    </script>
</head>
<body>

<div style="">
    <ul id="menuTree" class="easyui-tree"></ul>
    <div align="center">
        <input onclick="doSubmit_()" class="btn btn-primary" type="button" value="确定"/>
    </div>
</div>

<script type="text/javascript">
    function doSubmit_() {
        var nodes = $('#menuTree').tree('getChecked', ['checked', 'indeterminate']);
        var ids = ArrayCollect_(nodes, "id");
        layerStandardAjaxCall_({
            url: "/api/v1/sysrole/menuAuth/update",
            data: {pkid: param.PKID, menuIds: ids},
            success: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_err:ERRMSG.COMMON.COMMON.OPT_SUCCESS')});
                    CloseWindowIframe();
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        })
    }
</script>
</body>
</html>