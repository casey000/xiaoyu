<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>飞机主数据详情</title>
    <style>
        .datagrid-wrap {
            height: 280px !important;
            width: 93.8% !important;
        }
    </style>
</head>

<body class="ibody">
<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">

            <form class="form-horizontal m-t" id="mform">
                <input type="hidden" id="pkid" name="acid"/>
                <input type="hidden" id="status" name="status">
                <input type="hidden" id="wfStatus" name="wfStatus">
                <input type="hidden" id="createBy" name="createBy">
                <input type="hidden" id="createDate" name="createDate">
                <input type="hidden" id="modifyBy" name="modifyBy">
                <input type="hidden" id="modifyDate" name="modifyDate">
                <table class="table table-bordered table-info">
                    <table class="table table-bordered table-info">
                        <tr>
                            <td colspan="9" align="right">
                                <input class="btn btn-primary" type="button" id="saveBtn" onclick="save()" value="保存"/>
                                <input class="btn btn-primary" type="button" id="submitBtn" onclick="submitFlow()" value="提交"/>
                                <input class="btn btn-primary" type="button" id="closeBtn" onclick="closeW();" value="关闭"
                                       style="margin-left:3px;margin-right: 18px;"/>
                                <br/>
                            </td>
                        </tr>
                        <tr id="copyTr">
                            <th class="th" align="right" style="width: 80px ;">数据拷贝 ：</th>
                            <td style="width: 80px; padding: 3px" colspan="5">
                                <input class="easyui-combobox" style="width: 400px;" id="copyFrom"/>
                                <input class="btn btn-primary" type="button" id="copyBtn" onclick="copy()" value="拷贝"/>
                            </td>

                        </tr>
                    </table>
                    <fieldset class="fieldset_eui">
                        <legend data-i18n="">飞机基本信息</legend>
                        <table class="table table-bordered table-info">
                            <tr>
                                <th class="th" align="right" style="width: 80px;">生产厂家：</th>
                                <td style="width: 80px;  padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="manufacture" name="manufacture"
                                           data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">出厂日期 ：</th>
                                <td style="width: 80px;  padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="factoryDate" name="factoryDate"
                                           data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">交付日期：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="deliverDate" name="deliverDate"
                                           data-options="required:true"/>
                                </td>
                            </tr>

                            <tr>
                                <th class="th" align="right" style="width: 80px;">飞机注册号：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input id="acno" name="acno" class="easyui-textbox easyui-validatebox"
                                           data-options="validType:['maxLength[20]'],required:true"
                                           style="width:200px;"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">飞机注册号(上一次)：</th>
                                <td style="width: 80px;  padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="oldAcno" name="oldAcno"
                                           data-options=""/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">维修方案机型 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="mpActype"
                                           name="mpActype" data-options="required:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">机型系列 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="modelSeries"
                                           name="modelSeries" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">MODEL ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="model"
                                           name="model" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">飞机类别 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="airCategory"
                                           name="airCategory" data-options="required:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">MSN ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="msn"
                                           name="msn" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">生产线号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="lineNo"
                                           name="lineNo" data-options="required:true,validType:['isNumber']"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">工程可变号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="engVariableNumber"
                                           name="engVariableNumber" data-options="required:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">经营状态 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="holdWay"
                                           name="holdWay" data-options="required:false"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">飞机拥有人 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="owner"
                                           name="owner" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">高寿命状态 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="highLifeStatus"
                                           name="highLifeStatus" data-options=""/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">AMM手册有效性号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="ammCec"
                                           name="ammCec" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">IPC手册有效性号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="ipcCec"
                                           name="ipcCec" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">TC手册有效性号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="tcCec"
                                           name="tcCec" data-options="required:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">发动机型号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="engModel"
                                           name="engModel" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">发动机子型号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="engSubModel"
                                           name="engSubModel" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">APU的型号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="apuModel"
                                           name="apuModel" data-options="required:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">是否新机型 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="ifNewFleet"
                                           name="ifNewFleet" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">是否全新飞机 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="ifNew"
                                           name="ifNew" data-options="required:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">上营运人手册有效号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="opManualValidNo"
                                           name="opManualValidNo" data-options="required:false"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">最大着陆重量（LB） ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="mlw"
                                           name="mlw" data-options="validType:['number'],required:true"/>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                    <fieldset class="fieldset_eui" style="width:99%;margin-right:5px">
                        <legend data-i18n="">产权相关信息</legend>
                        <table class="table table-bordered table-info">

                            <tr>
                                <th class="th" align="right" style="width: 80px;">产权交付日期 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="propetyDeliverDate"
                                           name="propetyDeliverDate"
                                           data-options="required:false,editable:false,onlyview:true"/>
                                </td>
                        <th class="th" align="right" style="width: 80px;">产权交付飞机总小时 ：</th>
                        <td style="width: 80px; padding: 3px">
                            <!--<input class="easyui-textbox" style="width: 200px;" id="propetyDeliverHours"-->
                            <!--name="propetyDeliverHours"-->
                            <!--data-options="validType:['positive'],required:false,editable:false,onlyview:true"/>-->
                            <input class="easyui-textbox" id="propetyDeliverHours" name="propetyDeliverHours"
                                   style="width: 60px;float: left"
                                   data-options="validType:['checkHour'],required:false,editable:false,onlyview:true"/>:
                            <input class="easyui-textbox" id="propetyDeliverHoursMin" name="propetyDeliverHoursMin"
                                   style="width: 45px"
                                   data-options="validType:['checkMin'],required:false,editable:false,onlyview:true"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">产权交付飞机总循环 ：</th>
                        <td style="width: 80px; padding: 3px">
                            <input class="easyui-textbox" style="width: 200px;" id="propetyDeliverLoop"
                                   name="propetyDeliverLoop"
                                   data-options="validType:['positive'],required:false,editable:false,onlyview:true"/>
                        </td>


                    </tr>
                    <tr>
                        <th class="th" align="right" style="width: 80px;">产权交付飞机正常起落总循环 ：</th>
                        <td style="width: 80px; padding: 3px">
                            <input class="easyui-textbox" style="width: 200px;" id="propetyNorTotalLoop"
                                   name="propetyNorTotalLoop"
                                   data-options="validType:['positive'],required:false,editable:false,onlyview:true"/>
                        </td>
                        <th class="th" align="right" style="width: 80px;">产权交付飞机 touch and go 总循环 ：</th>
                        <td style="width: 80px; padding: 3px">
                            <input class="easyui-textbox" style="width: 200px;" id="propetyTotalLoop"
                                   name="propetyTotalLoop"
                                   data-options="validType:['positive'],editable:false,onlyview:true"/>
                        </td>
                    </tr>
                        </table>
                    </fieldset>
                    <fieldset class="fieldset_eui" style="width:99%;margin-right:5px">
                        <legend data-i18n="" id="intervalDgText">PTF相关信息</legend>
                        <table class="table table-bordered table-info">
                            <tr>
                                <th class="th" align="right" style="width: 80px;">PTF方案厂商 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="mpManufacturer"
                                           name="mpManufacturer" data-options="required:false,editable:false,onlyview:true"/>
                                </td>

                                <th class="th" align="right" style="width: 80px;">PTF执行MRO ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-combobox" style="width: 200px;" id="ptfMro"
                                           name="ptfMro" data-options="required:false,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">PTF开始日期 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="ptfStartDate"
                                           name="ptfStartDate" data-options="required:false,editable:false,onlyview:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">PTF开始飞机总的飞行小时 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <!--<input class="easyui-textbox" style="width: 200px;" id="ptfTotalHours"-->
                                    <!--name="ptfTotalHours"-->
                                    <!--data-options="required:false,editable:false,onlyview:true"/>-->
                                    <input class="easyui-textbox" id="ptfTotalHours" name="ptfTotalHours"
                                           style="width: 60px;float: left"
                                           data-options="validType:['checkHour'],required:false,editable:false,onlyview:true"/>:
                                    <input class="easyui-textbox" id="ptfTotalHoursMin" name="ptfTotalHoursMin"
                                           style="width: 45px"
                                           data-options="validType:['checkMin'],required:false,editable:false,onlyview:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">PTF开始飞机总的飞行循环 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="ptfTotalLoop"
                                           name="ptfTotalLoop"
                                           data-options="validType:['positive'],required:false,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">PTF结束日期 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="ptfEndDate"
                                           name="ptfEndDate" data-options="required:false,editable:false,onlyview:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">PTF手册有效号 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="ptfManualValidNo"
                                           name="ptfManualValidNo"
                                           data-options="required:false,editable:false,onlyview:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">引进检开始日期 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="gdfac"
                                           name="gdfac" data-options="required:false,editable:false,onlyview:true"/>
                                </td>

                            </tr>
                            <tr>
                                <th class="th" align="right" style="width: 80px;">引进检结束日期 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-datebox" style="width: 200px;" id="impCheckEndDate"
                                           name="impCheckEndDate"
                                           data-options="required:false,editable:false,onlyview:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">引进检完成飞机总的飞行小时 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <!--<input class="easyui-textbox" style="width: 200px;" id="totalFh"-->
                                    <!--name="totalFh"-->
                                    <!--data-options="validType:['positive'],required:false,editable:false,onlyview:true"/>-->
                                    <input class="easyui-textbox" id="totalFh" name="totalFh"
                                           style="width: 60px;float: left"
                                           data-options="validType:['checkHour'],required:false,editable:false,onlyview:true"/>:
                                    <input class="easyui-textbox" id="totalFhMin" name="totalFhMin" style="width: 45px"
                                           data-options="validType:['checkMin'],required:false,editable:false,onlyview:true"/>
                                </td>
                                <th class="th" align="right" style="width: 80px;">引进检完成飞机总的飞行循环 ：</th>
                                <td style="width: 80px; padding: 3px">
                                    <input class="easyui-textbox" style="width: 200px;" id="totalFc"
                                           name="totalFc"
                                           data-options="validType:['positive'],required:false,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                    <fieldset class="fieldset_eui" style="width:99%;margin-right:5px">

                        <table class="table table-bordered table-info">
                            <tr>
                                <th class="th" align="right" style="width: 80px;">备注 ：</th>
                                <td colspan="5">
                                    <input class="easyui-textbox" name="memo" id="memo"
                                           data-options="multiline:true "
                                           style="width: 1030px;height:80px"/>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </table>
            </form>
            <table id="dg"></table>
        </div>
    </div>
</div>
</body>
<!--<script type="text/javascript" src="/views/pm/mc/js/datagrid_utils.js"></script>-->
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var param;
    var operation;
    var PAGE_DATA = {};
    var pkid = null;//主表PKID
    var airCategory;
    function i18nCallBack() {
        param = getParentParam_();
        operation = param.operation;
        pkid = param.pkid;
        airCategory = param.airCategory;
        $("#pkid").val(pkid);
        InitFuncCodeRequest_({
            data: {
                domainCode:
                "YESORNO,DA_ACREG_DATA,DA_FLEET,DA_ACREG_AIR_CATEGORY,DA_ACREG_STATUS,DM_ATA,DM_REC_PRIVIDOR," +
                "DA_ACREG_MP_ACTYPE,DA_ACREG_MODEL_SERIES,DA_ACREG_MODEL,DA_ACREG_HOLD_WAY," +
                "DA_ACREG_ENG_MODEL,DA_ACREG_APU_MODEL,DA_ACREG_MP_MANUFACTURER,DA_ACREG_PTF_MRO," +
                "DA_ACREG_ENG_SUB_MODEL,DA_ACREG_OWNER",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    //型号
                    PAGE_DATA['acengModel'] = DomainCodeToMap_(jdata.data["DA_FLEET"]);
                    $('#ifNewFleet').combobox({
                        panelHeight: '135px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifNewFleet').combobox('setValue', 'N');
                    $('#owner').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_OWNER,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#airCategory').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_AIR_CATEGORY,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    // $('#status').combobox({
                    //     panelHeight: '135px',
                    //     data: jdata.data.DA_ACREG_STATUS,
                    //     valueField: 'VALUE',
                    //     textField: 'TEXT'
                    // });
                    $('#copyFrom').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_DATA,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //生产厂家
                    $('#manufacture').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_REC_PRIVIDOR,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //维修方案机型
                    $('#mpActype').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_MP_ACTYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //机型系列
                    $('#modelSeries').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_MODEL_SERIES,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //MODEL
                    $('#model').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_MODEL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //经营状态
                    $('#holdWay').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_HOLD_WAY,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //发动机型号
                    $('#engModel').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_ENG_MODEL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });

                    //发动机子型号
                    $('#engSubModel').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_ENG_SUB_MODEL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //APU的型号
                    $('#apuModel').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_APU_MODEL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });

                    //PTF执行MRO
                    $('#ptfMro').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DA_ACREG_PTF_MRO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifNew').combobox({
                        panelHeight: '135px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    if (operation == 'edit') {
                        $("#copyTr").hide();
                    }
                    if (operation == 'view') {
                        $("#copyTr").hide();
                        $("#saveBtn").hide();
                        $("#submitBtn").hide();
                    }
                    if (operation == 'flowView') {
                        $("#copyTr").hide();
                        $("#saveBtn").hide();
                        $("#submitBtn").hide();
                        $("#closeBtn").hide();
                    }
                    if (operation == 'flowEdit') {
                        $("#copyTr").hide();
                        $("#submitBtn").hide();
                        $("#closeBtn").hide();
                    }
                    // if (operation == 'add') {
                    //     $("#status").val('5');
                    // }
                    //编辑产权交付信息
                    if (operation == 'supplement') {
                        //PTF方案厂商
                        $('#mpManufacturer').combobox({
                            panelHeight: '135px',
                            data: jdata.data.DA_ACREG_MP_MANUFACTURER,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });
                        $("#propetyDeliverDate").datebox({editable:true,onlyview:false,required:true});
                        $("#propetyDeliverHours").textbox({editable:true,onlyview:false,required:true});
                        $("#propetyDeliverHoursMin").textbox({editable: true, onlyview: false, required: true});
                        $("#propetyDeliverLoop").textbox({editable:true,onlyview:false,required:true});
                        $("#propetyNorTotalLoop").textbox({editable:true,onlyview:false,required:true});
                        $("#propetyTotalLoop").textbox({editable:true,onlyview:false,required:true});

                        //禁用基本信息控件
                        $("#manufacture").combobox({editable: false, onlyview: true, required: false});
                        $("#factoryDate").datebox({editable: false, onlyview: true, required: false});
                        $("#deliverDate").datebox({editable: false, onlyview: true, required: false});
                        $("#acno").textbox({editable: false, onlyview: true, required: false});
                        $("#oldAcno").textbox({editable: false, onlyview: true, required: false});
                        $("#mpActype").combobox({editable: false, onlyview: true, required: false});
                        $("#modelSeries").combobox({editable: false, onlyview: true, required: false});
                        $("#model").combobox({editable: false, onlyview: true, required: false});
                        $("#airCategory").combobox({editable: false, onlyview: true, required: false});
                        $("#msn").textbox({editable: false, onlyview: true, required: false});
                        $("#lineNo").textbox({editable: false, onlyview: true, required: false});
                        $("#engVariableNumber").textbox({editable: false, onlyview: true, required: false});
                        $("#holdWay").combobox({editable: false, onlyview: true, required: false});
                        $("#owner").combobox({editable: false, onlyview: true, required: false});
                        $("#highLifeStatus").textbox({editable: false, onlyview: true, required: false});
                        $("#ammCec").textbox({editable: false, onlyview: true, required: false});
                        $("#ipcCec").textbox({editable: false, onlyview: true, required: false});
                        $("#tcCec").textbox({editable: false, onlyview: true, required: false});
                        $("#engModel").combobox({editable: false, onlyview: true, required: false});
                        $("#engSubModel").combobox({editable: false, onlyview: true, required: false});
                        $("#apuModel").combobox({editable: false, onlyview: true, required: false});
                        $("#ifNewFleet").combobox({editable: false, onlyview: true, required: false});
                        $("#ifNew").combobox({editable: false, onlyview: true, required: false});
                        $("#opManualValidNo").textbox({editable: false, onlyview: true, required: false});
                        $("#mlw").textbox({editable: false, onlyview: true, required: false});

                    }
                    //编辑PTF信息
                    if (operation == 'supplementPtf') {
                        //业务希望仅当飞机主数据‘飞机类别’值为‘客改货’时，‘PTF’相关信息为必填，否则非必填
                        // var airCategory=$('#airCategory').combobox("getValue");
                        $('#mpManufacturer').combobox({
                            panelHeight: '135px',
                            data: jdata.data.DA_ACREG_PTF_MRO,
                            valueField: 'VALUE',
                            textField: 'TEXT'
                        });
                        if (airCategory == "SF") {
                            $("#mpManufacturer").combobox({editable: true, onlyview: false, required: true});
                            $("#ptfMro").combobox({editable: true, onlyview: false, required: true});
                            $("#ptfStartDate").datebox({editable: true, onlyview: false, required: true});
                            $("#ptfTotalHours").textbox({editable: true, onlyview: false, required: true});
                            $("#ptfTotalHoursMin").textbox({editable: true, onlyview: false, required: true});
                            $("#ptfTotalLoop").textbox({editable: true, onlyview: false, required: true});
                            $("#ptfEndDate").datebox({editable: true, onlyview: false, required: true});
                            $("#ptfManualValidNo").textbox({editable: true, onlyview: false, required: true});
                            $("#gdfac").datebox({editable: true, onlyview: false, required: true});
                            $("#impCheckEndDate").datebox({editable: true, onlyview: false, required: true});
                            $("#totalFh").textbox({editable: true, onlyview: false, required: true});
                            $("#totalFhMin").textbox({editable: true, onlyview: false, required: true});
                            $("#totalFc").textbox({editable: true, onlyview: false, required: true});
                        } else {
                            $("#mpManufacturer").combobox({editable: true, onlyview: false, required: false});
                            $("#ptfMro").combobox({editable: true, onlyview: false, required: false});
                            $("#ptfStartDate").datebox({editable: true, onlyview: false, required: false});
                            $("#ptfTotalHours").textbox({editable: true, onlyview: false, required: false});
                            $("#ptfTotalHoursMin").textbox({editable: true, onlyview: false, required: false});
                            $("#ptfTotalLoop").textbox({editable: true, onlyview: false, required: false});
                            $("#ptfEndDate").datebox({editable: true, onlyview: false, required: false});
                            $("#ptfManualValidNo").textbox({editable: true, onlyview: false, required: false});
                            $("#gdfac").datebox({editable: true, onlyview: false, required: false});
                            $("#impCheckEndDate").datebox({editable: true, onlyview: false, required: false});
                            $("#totalFh").textbox({editable: true, onlyview: false, required: false});
                            $("#totalFhMin").textbox({editable: true, onlyview: false, required: false});
                            $("#totalFc").textbox({editable: true, onlyview: false, required: false});
                        }



                        //禁用基本信息控件
                        $("#manufacture").combobox({editable: false, onlyview: true, required: false});
                        $("#factoryDate").datebox({editable: false, onlyview: true, required: false});
                        $("#deliverDate").datebox({editable: false, onlyview: true, required: false});
                        $("#acno").textbox({editable: false, onlyview: true, required: false});
                        $("#oldAcno").textbox({editable: false, onlyview: true, required: false});
                        $("#mpActype").combobox({editable: false, onlyview: true, required: false});
                        $("#modelSeries").combobox({editable: false, onlyview: true, required: false});
                        $("#model").combobox({editable: false, onlyview: true, required: false});
                        $("#airCategory").combobox({editable: false, onlyview: true, required: false});
                        $("#msn").textbox({editable: false, onlyview: true, required: false});
                        $("#lineNo").textbox({editable: false, onlyview: true, required: false});
                        $("#engVariableNumber").textbox({editable: false, onlyview: true, required: false});
                        $("#holdWay").combobox({editable: false, onlyview: true, required: false});
                        $("#owner").combobox({editable: false, onlyview: true, required: false});
                        $("#highLifeStatus").textbox({editable: false, onlyview: true, required: false});
                        $("#ammCec").textbox({editable: false, onlyview: true, required: false});
                        $("#ipcCec").textbox({editable: false, onlyview: true, required: false});
                        $("#tcCec").textbox({editable: false, onlyview: true, required: false});
                        $("#engModel").combobox({editable: false, onlyview: true, required: false});
                        $("#engSubModel").combobox({editable: false, onlyview: true, required: false});
                        $("#apuModel").combobox({editable: false, onlyview: true, required: false});
                        $("#ifNewFleet").combobox({editable: false, onlyview: true, required: false});
                        $("#ifNew").combobox({editable: false, onlyview: true, required: false});
                        $("#opManualValidNo").textbox({editable: false, onlyview: true, required: false});
                        $("#mlw").textbox({editable: false, onlyview: true, required: false});
                    }
                    if (operation == 'view') {
                        $("#saveBtn").hide();
                        $("#copyTr").hide();
                    }
                    pkid = $("#pkid").val();
                    if (pkid) {
                        InitDataForm(pkid);

                    }
                    InitDataGrid(pkid);
                }
            }
        })
    }

    //回填
    function InitDataForm(pkid) {
        InitFuncCodeRequest_({
            data: {pkid: pkid, FunctionCode: "DA_ACREG_PKID"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ParseFormField_(jdata.data, $("#mform"), Constant.CAMEL_CASE);
                    var propetyDeliverHours = jdata.data.PROPETY_DELIVER_HOURS;

                    // $('#engineer').combogrid('setValue', jdata.data.ENGINEER);
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }

    function InitDataGrid(pkid) {
        $("#dg").MyDataGrid({
            identity: 'dg',
            sortable: true,
            singleSelect: true,
            pageSize: 5,
            fitColumn: true,
            // enableLineEdit: true,
            // enableCellEdit: true,
            queryParams: {pkid: pkid},
            columns: {
                param: {FunctionCode: 'DA_ACREG_HISTORY_HOLDER_LIST'},
                alter: {
                    COMPANY_CODE: {
                        editor: {
                            type: 'textbox',
                        }
                    },
                    INTRODUCTION_DATE: {
                        editor: {
                            type: 'datebox',
                        }
                    },
                    INTRODUCTION_HOURS: {
                        editor: {
                            type: 'textbox',
                        }
                    },
                    INTRODUCTION_LOOP: {
                        editor: {
                            type: 'textbox',
                        }
                    },
                    EXIT_DATE: {
                        editor: {
                            type: 'datebox',
                        }
                    },
                    EXIT_HOURS: {
                        editor: {
                            type: 'textbox',
                        }
                    },
                    EXIT_LOOP: {
                        editor: {
                            type: 'textbox',
                        }
                    },
                }
            },
            onLoadSuccess: function (index, row) {

            },
            onBeforeLoad: function (data) {

            },
            contextMenus: [
                {
                    id: "m-edit",
                    i18nText: "编辑",
                    onclick: function () {
                        var rowData = getDG('dg').datagrid('getSelected');
                        if (!rowData.PKID) {
                            MsgAlert({content: "请选择数据！", type: 'error'});
                            return;
                        }
                        openDetai('edit', rowData.PKID);
                    }
                },
                {
                    id: "m-delete", i18nText: "删除", auth: "",
                    onclick: function () {
                        if (!confirm("确认删除该记录？")) {
                            return;
                        }
                        var row = $('#dg').datagrid('getSelected');
                        var rowIndex = $('#dg').datagrid('getRowIndex', row);
                        if (!row.PKID) {
                            //如果没有保存，直接在datagrid移除该行
                            $('#dg').datagrid('deleteRow', rowIndex);
                        } else {
                            InitFuncCodeRequest_({
                                data: {pkid: row.PKID, FunctionCode: 'DA_ACREG_DETAIL_DEL'},
                                successCallBack: function (jdata) {
                                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                        $('#dg').datagrid('deleteRow', rowIndex);
                                        MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                                        // reload_();
                                        // i18nCallBack();
                                    } else {
                                        MsgAlert({content: jdata.msg, type: 'error'});
                                    }
                                }
                            });
                        }
                    }
                }

            ],
            toolbar: [{
                id: 'btnAdd',
                text: $.i18n.t('增加'),
                iconCls: 'icon-add',
                handler: function () {
                    openDetai("add", "");//打开新增页面
                }
            }],
            validAuth: function (row, items) {
                if (operation == 'view' || operation == 'flowView') {
                    items['删除'].enable = false;
                    items['编辑'].enable = false;
                }
                return items;
            },
            onBeforeLoad: function (data) {
                if (operation == "view" || operation == "flowView") {
                    $("div.datagrid-toolbar [id ='btnAdd']").eq(0).hide();

                }
            },
            onEndEdit: function (index, row, changes) {
                // editDate(index, row, changes);
            },
            onBeginEdit: function (index, row) {
            }
        });
    }

    //刷新
    function reload_(pkid) {
        InitDataGrid(pkid)
        // $("#dg").datagrid("reload");
    }

    //打开详细页面
    function openDetai(operation, pkid) {
        var acid = $("#pkid").val();
        var title_ = $.i18n.t('历史运营人维护');
        ShowWindowIframe({
            width: "1000",
            height: "500",
            title: title_,
            param: {operation: operation, pkid: pkid, acid: acid},
            url: "/views/main_data_manager/fleet_main_data/daAcregHistoryHolder.shtml"
        });
    }
    // 保存
    function save() {
        //序列化列表数据
        // var rows = $('#dg').datagrid('getRows');
        // for (i = 0; i < rows.length; i++) {
        //     rows[i] = toCamelCase(rows[i]);
        // }
        // var detailData = JSON.stringify(rows);

        var isValidate = $("#mform").form('validate');
        if (!isValidate)
            return;
        var $form = $("#mform");
        var mainData = JSON.stringify($('#mform').serializeObject());
        // datas = $.extend(datas, {FunctionCode: 'DA_ACREG_ADD', type: operation});
        InitFuncCodeRequest_({
            data: {mainData: mainData, FunctionCode: "DA_ACREG_ADD"},
            successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        param.OWindow.reload_();
                        MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        ParseFormField_(jdata.data, $("#mform"), null);
                        // reload_();
                        // CloseWindowIframe();
                    } else {
                        // alert("已经进入错误1")
                        // MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:error')});
                        if (jdata.msg.indexOf("ACNO") != -1) {
                            MsgAlert({content: "请检查飞机注册号是否重复.", type: 'error'});
                        }
                        else if (jdata.msg.indexOf("MSN") != -1) {
                            MsgAlert({content: "请检查MSN是否重复.", type: 'error'});

                        }
                        else if (jdata.msg.indexOf("LINE_NO") != -1) {
                            MsgAlert({content: "请检查生产线号是否重复.", type: 'error'});
                        }
                        else if (jdata.msg.indexOf("ENG_VARIABLE_NUMBER") != -1) {
                            MsgAlert({content: "请检查工程可变号是否重复.", type: 'error'});
                        } else {
                            MsgAlert({content: jdata.msg, type: 'error'});
                        }
                    }
                }
            });
    }

    //新增
    function addDatagridRow() {
        $('#dg').datagrid('appendRow', {TD_PKID: param.pkid,});
    }

    function copy() {
        var daAcregId = $("#copyFrom").combobox('getValue');
        if (!daAcregId) {
            MsgAlert({content: '请先选择数据！', type: 'error'});
            return;
        }
        //获取该条数据
        InitFuncCodeRequest_({
            data: {pkid: daAcregId, FunctionCode: "DA_ACREG_PKID"}, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ParseFormField_(jdata.data, $("#mform"), Constant.CAMEL_CASE);
                    //清空pkid
                    $("#pkid").val("");
                    //不拷贝产权和客改货信息
                    $("#propetyDeliverDate").datebox('setValue', '');
                    $("#propetyDeliverHours").textbox('setValue', '');
                    $("#propetyDeliverLoop").textbox('setValue', '');
                    $("#propetyTotalLoop").textbox('setValue', '');
                    $("#mpManufacturer").combobox('setValue', '');
                    $("#ptfMro").combobox('setValue', '');
                    $("#ptfStartDate").datebox('setValue', '');
                    $("#ptfTotalHours").textbox('setValue', '');
                    $("#ptfTotalLoop").textbox('setValue', '');
                    $("#ptfEndDate").datebox('setValue', '');
                    $("#ptfManualValidNo").textbox('setValue', '');
                    $("#gdfac").datebox('setValue', '');
                    $("#impCheckEndDate").datebox('setValue', '');
                    $("#totalFh").textbox('setValue', '');
                    $("#totalFc").textbox('setValue', '');
                    // $("#status").val('5');
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

    }
    function closeW() {
        CloseWindowIframe();
    }

    function submitFlow() {
        pkid = $("#pkid").val();
        if (!pkid) {
            MsgAlert({content: "请先保存数据！", type: 'error'});
            return;
        }
        //是否新飞机为否，则上营运人手册有效号必填 历史营运人必填
        var ifNew = $("#ifNew").combobox("getValue");
        if (ifNew == "N") {
            var opManualValidNo = $("#opManualValidNo").textbox("getValue");
            if (!opManualValidNo) {
                MsgAlert({content: "上营运人手册有效号不能为空！", type: 'error'});
                return;
            }
            var rows = $('#dg').datagrid('getRows');
            if (rows.length == 0) {
                MsgAlert({content: "历史运营人不能为空！", type: 'error'});
                return;
            }
        }
        //当飞机类别为客改货时，PTF相关信息必填
        var airCategory = $("#airCategory").combobox("getValue");
        // if (airCategory == "SF") {
        //     var mpManufacturer = $("#mpManufacturer").combobox("getValue");
        //     if (!mpManufacturer) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfMro = $("#ptfMro").combobox("getValue");
        //     if (!ptfMro) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfStartDate = $("#ptfStartDate").datebox("getValue");
        //     if (!ptfStartDate) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfTotalHours = $("#ptfTotalHours").textbox("getValue");
        //     if (!ptfTotalHours) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfTotalHoursMin = $("#ptfTotalHoursMin").textbox("getValue");
        //     if (!ptfTotalHoursMin) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfTotalLoop = $("#ptfTotalLoop").textbox("getValue");
        //     if (!ptfTotalLoop) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfEndDate = $("#ptfEndDate").datebox("getValue");
        //     if (!ptfEndDate) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var ptfManualValidNo = $("#ptfManualValidNo").textbox("getValue");
        //     if (!ptfManualValidNo) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var gdfac = $("#gdfac").datebox("getValue");
        //     if (!gdfac) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var impCheckEndDate = $("#impCheckEndDate").datebox("getValue");
        //     if (!impCheckEndDate) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var totalFh = $("#totalFh").textbox("getValue");
        //     if (!totalFh) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var totalFhMin = $("#totalFhMin").textbox("getValue");
        //     if (!totalFhMin) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        //     var totalFc = $("#totalFc").textbox("getValue");
        //     if (!totalFc) {
        //         MsgAlert({content: "PTF信息不能为空！", type: 'error'});
        //         return;
        //     }
        // }

        if (!confirm("确认提交该记录？")) {
            return;
        }
        datas = $.extend({}, {}, {FunctionCode: 'DA_ACREG_STATUS', pkid: pkid});
        InitFuncCodeRequest_({
            data: datas, successCallBack: function (jdata) {
                if (jdata.data != null) {
                    common_add_edit_({
                        identity: '', isEdit: '', width: 520, height: 300, title: $.i18n.t('选择审批人'),
                        param: {
                            roleId: '',
                            otherParam: pkid,
                            FunctionCode_: 'DA_ACREG_SUMBIT',
                            successCallback: closeW
                        },
                        url: "/views/flow/work_flow_account_select.shtml"
                    });
                } else {
                    MsgAlert({content: "该数据已被提交过了。", type: 'error'});
                }
            }
        });
    }
    function closeW() {
        //刷新父页面
        param.OWindow.reload_();
        CloseWindowIframe();
    }
    //改变状态重新给datebox，combobox控件赋值
    function reGetValue() {

    }

    $.extend($.fn.validatebox.defaults.rules, {
        checkHour: {
            //正数且保留两位小数
            validator: function (value, param) {
                if (/^[+]{0,1}(\d+)$/.test(value)) {
                    return true;
                } else {
                    return false;
                }
                // return value.length >= param[0];
            },
            message: '小时为正整数，请重新输入！'
        }
    });
    $.extend($.fn.validatebox.defaults.rules, {
        checkMin: {
            //正数且保留两位小数
            validator: function (value, param) {
                if (/([0-5]\d)$/.test(value)) {
                    return true;
                } else {
                    return false;
                }
                // return value.length >= param[0];
            },
            message: '分钟为01-60正整数，请重新输入！'
        }
    });
    $.extend($.fn.validatebox.defaults.rules, {
        positive: {
            //正数且保留两位小数
            validator: function (value, param) {
                if (/^(?!0+(?:\.0+)?$)(?:[1-9]\d*|0)(?:\.\d{1,2})?$/.test(value)) {
                    return true;
                } else {
                    if (value == 0) {
                        return true;
                    } else {
                        return false;
                    }

                }
                // return value.length >= param[0];
            },
            message: '请输入正数'
        },
        isNumber: {
            //正数且保留两位小数
            validator: function (value, param) {
                if (isNaN(Number(value))) {
                    return false;
                } else {
                    return true;
                }
            },
            message: '请输入数字'
        }
    });

</script>

</html>