<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <title>修改装机验证类的TO</title>

    <!-- load css -->
    <link href="/css/mccdoc/to_commons.css" rel="stylesheet" type="text/css"/>

    <!-- load js -->
    <script src="/js/global_var.js" type="text/javascript"></script>
    <script src="/js/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>
    <script src="/js/sfa-query-1.0.js" type="text/JavaScript"></script>
    <script src="/js/common_query_dialog.js" type="text/JavaScript"></script>
    <script src="/js/mccdoc/common/to_common.js" type="text/javascript"></script>
    <!--    <script src="/js/mccdoc/edit/edit_fault_isolate_to.js" type="text/javascript"></script>-->
</head>
<body>
<form action="" id="add_form" method="post">
    <table border="1" cellpadding="0" cellspacing="0" class="table-zi" style="padding-top:10px" width="100%">
        <tr>
            <td class="td-line30-with-bg" width="20%">Type:</td>
            <td width="30%">
                装机验证
                <input id="dmType" name="toBaseInfo.dmType" tails="" type="hidden" value=""/>
                <input id="toBaseInfoId" name="toBaseInfo.id" type="hidden" value=""/>
                <input id="toBaseInfoType" name="toBaseInfo.type" type="hidden" value=""/>
                <input id="delTOMaterialToolsId" name="toBaseInfo.delTOMaterialToolsId" type="hidden" value=""/>
            </td>
            <td class="td-line30-with-bg" width="20%">Rev#:</td>
            <td width="30%">R0
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">DM:</td>
            <td id="dm_type_id">
                <input type="radio" id="dm-yes" name="dm" ><label for="dm-yes">Yes</label>
                <input type="radio" id="dm-no" name="dm" ><label for="dm-no">NO</label>
            </td>
            <td class="td-line30-with-bg">章节号:</td>
            <td>
                <input id="ata" name="toBaseInfo.ata"
                       style="width: 53%;background-color: #f0f0f0; cursor: default;" type="text" value=""/>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">
                装机验证申请单
            </td>
            <td>
                <input id="grabNo" name="toBaseInfo.grabNo" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
            <td class="td-line30-with-bg">恢复目标类型 :</td>
            <td>
                <input id="caijian" name="toBaseInfo.grabSource" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
        </tr>
        <tr class="feiji">
            <td class="td-line30-with-bg">机型 :</td>
            <td>
                <input id="model" name="toBaseInfo.model" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
            <td class="td-line30-with-bg">飞机号 :</td>
            <td>
                <input id="acReg" name="toBaseInfo.acReg" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
        </tr>
        <tr class="beijian">
            <td class="td-line30-with-bg">恢复件号 :</td>
            <td>
                <input id="grabPn" name="toBaseInfo.grabPn" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
            <td class="td-line30-with-bg">恢复序号 :</td>
            <td>
                <input id="grabSn" name="toBaseInfo.grabSn" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">反馈要求 :</td>
            <td>
                <input id="yes" name="toBaseInfo.feedbackRequests" type="radio" value="y"/>
                YES&nbsp;&nbsp;
                <input id="no" name="toBaseInfo.feedbackRequests" type="radio" value="n"/>
                NO&nbsp;
                <span class="td-font-red">*</span>
                <div class="errorMessage"></div>

            </td>
            <td class="td-line30-with-bg"><span class="td-line30-with-bg-center"
                                                style="border-top: none;">Source Type:</span></td>
            <td >
                <input type="radio" id="sourceType_mcc" name="toBaseInfo.sourceType" value="0" checked="checked"
                       readonly="readonly">MCC</label>
                <input type="radio" id="sourceType_ppc" name="toBaseInfo.sourceType" value="1"
                       disabled="disabled">PPC</label>
                <input type="radio" id="sourceType_ts" name="toBaseInfo.sourceType" value="2"
                       disabled="disabled">TS</label>
                <span class="td-font-red">*</span>
                <div class="errorMessage"></div>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">标题:</td>
            <td colspan="3">
                <textarea id="subject" maxlength="3000" name="toBaseInfo.subject" readonly="readonly"
                          style="width:97%;height:80px"></textarea>
                <span class="td-font-red">*</span>
                <div class="errorMessage"></div>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">描述:</td>
            <td colspan="3">
                <textarea id="description" maxlength="3000" name="toBaseInfo.description" readonly="readonly"
                          style="width:97%;height:80px"></textarea>
                <span class="td-font-red">*</span>
                <div class="errorMessage"></div>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">备注:</td>
            <td colspan="3">
                <textarea id="grabRemark" maxlength="3000" name="toBaseInfo.grabRemark"
                          style="width:97%;height:80px"></textarea>
                <span class="td-font-red">*</span>
                <div class="errorMessage"></div>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg" colspan="4">待验证部件清单</td>
        </tr>
        <tr>
            <td colspan="4">
                <!--Trouble-shooting begin -->
                <table border="1" cellpadding="0" cellspacing="0" class="table-zi" id="trouble_shooting_table"
                       style="border-top: none;" width="100%">
                    <tr>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >件号名称</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >P/N</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >S/N</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >位置</td>
                    </tr>

                </table>
                <!--Trouble-shooting end -->
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">附件:</td>
            <td colspan="3">
                <!--文件名...-->
            </td>
        </tr>
    </table>
</form>
<script type="text/javascript">
    var obj={};
    sub_win.button(
        {
            name: 'Submit',
            callback: function () {
                doSubmit();
                return false;
            }
        },
        /* {
             name: 'Save',
             callback: function () {
                 saveForm();
                 return false;
             }
         },*/
        {
            name: 'Cancel'
        }
    );

    console.log(s_params);
    $(function () {
        $.ajax({
            type: "GET",
            url: "/api/v1/mccdoc/to_base_info/editOrView?id=" + s_params.id,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                obj=data.data;
                console.log(obj);
                $("#grabNo").val(obj.toBaseInfoVO.grabNo);
                $("#ata").val(obj.toBaseInfoVO.ata);
                $("#caijian").val(obj.toBaseInfoVO.grabSource=='AIRCRAFT'? "飞机":"备件");
                if(obj.toBaseInfoVO.grabSource=='AIRCRAFT'){
                    $(".beijian").hide();
                }else  if(obj.toBaseInfoVO.grabSource=='REPLACEMENT'){
                    $(".feiji").hide();
                }
                $("#model").val(obj.toBaseInfoVO.model);
                $("#acReg").val(obj.toBaseInfoVO.acReg);
                $("#grabPn").val(obj.toBaseInfoVO.grabPn);
                $("#grabSn").val(obj.toBaseInfoVO.grabSn);
                $("#grabRemark").val(obj.toBaseInfoVO.grabRemark);
                $("#description").val(obj.toBaseInfoVO.description);
                $("#subject").val(obj.toBaseInfoVO.subject);
                for(var i in obj.toGrabs){
                    let file = " <tr >\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"name" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"pn" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"sn" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"position" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                    </tr>";
                    let html_row = $(file);
                    $("#trouble_shooting_table").append(html_row);
                    $("#name"+obj.toGrabs[i].id).text(obj.toGrabs[i].name);
                    $("#pn"+obj.toGrabs[i].id).text(obj.toGrabs[i].pn);
                    $("#sn"+obj.toGrabs[i].id).text(obj.toGrabs[i].sn);
                    $("#position"+obj.toGrabs[i].id).text(obj.toGrabs[i].position);

                }
            },
            error: function (obj) {
                alert("失败！");
            }
        });
    });

    function qiangjian_data() {

    }


    /**
     * 验证Form表单
     */
    function validForm() {

        var isValid = false;
        $("#add_form .error").remove();
        var errMsg = '<span class="error">This field is required.</span>';
        var errMsg1 = '<span class="error">The length is greater than 3000 bytes.</span>';
        var numberErrMsg = '<span class="error">Please enter only digits.</span>';


        if (!$("[name='toBaseInfo.acId']").val()) {
            $("[name='toBaseInfo.acId']").nextAll("div.errorMessage").append(errMsg);
        }

        if ($("input:radio[name='toBaseInfo.feedbackRequests']:checked").val() == null) {
            $("[name='toBaseInfo.feedbackRequests']").nextAll("div.errorMessage").append(errMsg);
        }

        if ($("input:radio[name='toBaseInfo.sourceType']:checked").val() == null) {
            $("[name='toBaseInfo.sourceType']").nextAll("div.errorMessage").append(errMsg);
        }

        if (!$("[name='toBaseInfo.subject']").val()) {
            $("[name='toBaseInfo.subject']").nextAll("div.errorMessage").append(errMsg);
        }

        var description = $("[name='toBaseInfo.description']").val();
        if (!description) {
            $("[name='toBaseInfo.description']").nextAll("div.errorMessage").append(errMsg);
        }

        //验证是否超过3000字节
        if (description.replace(/[^\u0000-\u00ff]/g, "aaa").length > 3000) {
            $("[name='toBaseInfo.description']").nextAll("div.errorMessage").append(errMsg1);
        }

        //获取Required Material/Special Tools下面的工具航材
        var materialToolSelect = $("#material_tool_select_table").find("tr:gt(1)");
        //如果存在必须要填写
        if (materialToolSelect) {
            $.each(materialToolSelect, function (index, value) {

                if (!$.trim($(value).find("td:eq(1)").find(":input").val())) {
                    $(value).find("td:eq(1)").find(":input").nextAll("div.errorMessage").append(errMsg);
                    isValid = true;
                }

                if (!$.trim($(value).find("td:eq(2)").find(":input").val())) {
                    $(value).find("td:eq(2)").find(":input").nextAll("div.errorMessage").append(errMsg);
                    isValid = true;
                }

                if (!$.trim($(value).find("td:eq(4)").find(":input").val())) {
                    $(value).find("td:eq(4)").find(":input").nextAll("div.errorMessage").append(errMsg);
                    isValid = true;
                }

                if ((!$.trim($(value).find("td:eq(5)").find("div[class!='hidden'][class!='errorMessage']").children("select").val()))) {
                    $(value).find("td:eq(5)").find("div[class!='hidden'][class!='errorMessage']").children("div.errorMessage").append(errMsg);
                    isValid = true;
                }

                if (isNaN($.trim($(value).find("td:eq(4)").find(":input").val()))) {
                    $(value).find("td:eq(4)").find(":input").nextAll("div.errorMessage").append(numberErrMsg);
                    isValid = true;
                }
            });
        }
        checkDMfn && checkDMfn.call();
        if ($("#add_form .errorMessage").text()) {
            isValid = true;
        }
        return isValid;
    }


    /**
     * 提交
     * @returns {Boolean}
     */
    function doSubmit() {
        if ($("#add_form .errorMessage").text()) {
            return false;
        }
        if (validForm()) {
            return false;
        }
        var actionUrl = basePath + "/api/v1/mccdoc/to_base_info/update";
        var params = $("#add_form").serialize();
        sub_win.button({name: 'Submit', disabled: true});
        sub_win.button({name: 'Cancel', disabled: true});
        $.ajax({
            url: actionUrl,
            type: "post",
            data: params,
            dataType: "json",
            cache: false,
            success: function (data) {
                if (data.code == 200) {
                    P.$.dialog.alert('succ.');
                    sub_win.data['reload'] = '1';
                    sub_win.close();
                } else {
                    // sub_win.button({name: 'Save', disabled: false});
                    sub_win.button({name: 'Submit', disabled: false});
                    sub_win.button({name: 'Cancel', disabled: false});
                    if (data.msg) {
                        P.$.dialog.alert(data.msg);
                    } else {
                        P.$.dialog.alert('Submit failed, please contact the administrator.');
                    }
                }
            }
        });

        return false;
    }

</script>
</body>
</html>