<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <title>基础信息管理</title>
    <!-- mcc模块的公用css -->
    <link href="/css/mccdoc/mcc_doc_commons.css" rel="stylesheet" type="text/css"/>

    <!-- load js -->
    <script src="/js/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="/js/global_var.js" type="text/JavaScript"></script>
    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>

    <!-- TE View专用js -->
    <script src="/js/mccdoc/view/view_te.js" type="text/javascript"></script>

</head>
<body>
<div align="right" class="ui_buttons">
    <div align="right" style="padding-right: 6px;padding-bottom: 4px">
        <c:if test="${revisionable}">
            <shiro:hasPermission name="te:revision"><input id="new_reversion_btn" type="button" value="New Reversion"/>
            </shiro:hasPermission>
        </c:if>
    </div>
</div>
<form id="addForm">
    <input disabled="disabled" name="teBaseInfo.id" readonly="readonly" type="hidden" value="${teBaseInfo.id}"/>
    <table border="1" cellpadding="0" cellspacing="0" class="table-zi" style="padding-top:10px" width="100%">
        <tr>
            <td class="tab_title_background" width="20%">TE NO:</td>
            <td width="20%">${teBaseInfo.number}&nbsp;</td>
            <td class="tab_title_background" width="15%">Rev.:</td>
            <td width="15%">
                <c:if test="${not empty teBaseInfo.revNo}">R${teBaseInfo.revNo}</c:if>
                <c:if test="${empty teBaseInfo.revNo}">R0</c:if>
            </td>
            <td class="tab_title_background" width="15%">&nbsp;</td>
            <td width="15%">&nbsp;</td>
        </tr>
        <tr>
            <td class="tab_title_background" width="15%">Model:</td>
            <td>
                ${teBaseInfo.model}
            </td>
            <td class="tab_title_background">
                <s:text name="base.aircraft.tail"/>
                :
            </td>
            <td>
                <input name="teBaseInfo.acId" readonly="readonly" type="hidden" value="${teBaseInfo.acId}"/>
                ${teBaseInfo.acNo}
            </td>
            <td class="tab_title_background">ATA:</td>
            <td>${teBaseInfo.ata}
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">Evaluation Type：</td>
            <td colspan="5">&nbsp;
                <input id="evaluationTypes" type="hidden" value="${teBaseInfo.evaluationType}"/>
                <input disabled="disabled" name="teBaseInfo.evaluationType" type="checkbox" value="1"/>&nbsp;<span
                        style="vertical-align: middle;">飞机放行 A/C Release</span>&nbsp;&nbsp;
                <input disabled="disabled" name="teBaseInfo.evaluationType" type="checkbox" value="2"/>&nbsp;<span
                        style="vertical-align: middle;">航材验证 Material</span>&nbsp;&nbsp;
                <input disabled="disabled" name="teBaseInfo.evaluationType" type="checkbox" value="3"/>&nbsp;<span
                        style="vertical-align: middle;">维修提示 Main.Tip</span>&nbsp;&nbsp;
                <input disabled="disabled" name="teBaseInfo.evaluationType" type="checkbox" value="4"/>&nbsp;<span
                        style="vertical-align: middle;">其他 Other</span>&nbsp;&nbsp;
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">Description：</td>
            <td colspan="5">
                <textarea disabled="disabled" name="teBaseInfo.description" style="width:97%;height:60px">${teBaseInfo.description}</textarea>
            </td>
        </tr>
        <tr id="attachmentTrId">
            <td class="tab_title_background" width="20%">Attachments:</td>
            <td colspan="5">
                <table border="1" cellpadding="0" cellspacing="0" class="table-zi" id="qc_table_detail"
                       style="padding-top:10px" width="100%">
                    <tr id="td_files">
                        <td class="td-line30-with-bg-center">Doc Name</td>
                        <td class="td-line30-with-bg-center">Doc Type</td>
                        <td class="td-line30-with-bg-center">Uploader</td>
                        <td class="td-line30-with-bg-center">Upload Date</td>
                        <td class="td-line30-with-bg-center">Operate</td>
                    </tr>
                </table>
                <div class="errorMessage"></div>
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">Ref.Document:</td>
            <td colspan="5">
                <textarea disabled="disabled" name="teBaseInfo.refDocument" style="width:97%;height:60px">${teBaseInfo.refDocument}</textarea>
            </td>
        </tr>
        <tr style="height: 80px">
            <td class="tab_title_background" rowspan="2">MCC技术支援席意见<br/>MCC Technical Support Advice:</td>
            <td colspan="5">
                <textarea disabled="disabled" name="teBaseInfo.technicalSupportAdvice" style="width:97%;height:80px;">${teBaseInfo.technicalSupportAdvice}</textarea>
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">Name:</td>
            <td colspan="2">${teBaseInfo.technicalSupportEngineerName}</td>
            <td class="tab_title_background">Date:</td>
            <td>
                <fmt:formatDate pattern="yyyy-MM-dd" value="${teBaseInfo.technicalSupportDate}"/>
            </td>
        </tr>
        <tr style="height: 80px;">
            <td class="tab_title_background" rowspan="2">MCC值班经理意见<br/>MCC Duty Manager Advice:</td>
            <td colspan="5">
                <textarea disabled="disabled" name="teBaseInfo.dutyManagerAdvice" style="width:97%;height:80px;">${teBaseInfo.dutyManagerAdvice}</textarea>
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">Name:</td>
            <td colspan="2">${teBaseInfo.dutyManagerName}</td>
            <td class="tab_title_background">Date:</td>
            <td>
                <fmt:formatDate pattern="yyyy-MM-dd" value="${teBaseInfo.dutyManagerDate}"/>
            </td>
        </tr>
        <tr style="height: 80px;">
            <td class="tab_title_background" rowspan="2">部门值班经理/系统工程师意见<br/>M&E Department Duty Manager/System Engineer
                Advice:
            </td>
            <td colspan="5">
                <textarea disabled="disabled" name="teBaseInfo.departmentDutyManagerAdvice"
                          style="width:97%;height:80px;">${teBaseInfo.departmentDutyManagerAdvice}</textarea>
            </td>
        </tr>
        <tr>
            <td class="tab_title_background">Name:</td>
            <td colspan="2">${teBaseInfo.departmentDutyManagerName}</td>
            <td class="tab_title_background">Date:</td>
            <td>
                <fmt:formatDate pattern="yyyy-MM-dd" value="${teBaseInfo.departmentDutyManagerDate}"/>
            </td>
        </tr>
    </table>
</form>
<script type="text/javascript">
    var entityId = '${teBaseInfo.id}';
    var status = '${teBaseInfo.editStatus}';
    var moduleForDb = '${attachmentPath}';
    var fileDelAble = false;

    var api = frameElement.api, P = api.opener;
    var s_params = api.data;

    var buttonBool = '${param.taskOwnerId}' == '${userId}' && '${userId}' != 'null';
    var buttonJson = {};
    if (status == 2 && buttonBool) {
        api.button(
            {
                name: 'Check',
                callback: function () {
                    check();
                    return false;
                }
            },
            {
                name: 'Process Logs',
                callback: function () {
                    logs();
                    return false;
                }
            },
        < shiro;
    :
        hasPermission;
        name = "te:pdf" >
            {
                name: 'View PDF',
                callback: function () {
                    api.button({name: 'View PDF', disabled: true});
                    window.location.href = basePath + "/mccdoc/te_management_createPdf.action?teBaseInfo.id=" + $("input[name='teBaseInfo.id']").val();
                    setTimeout(function () {
                        api.button({name: 'View PDF', disabled: false});
                    }, 2000);
                    return false;
                }
            },;
    <
        /shiro:hasPermission>;
        {
            'Cancel',
                callback;
        :

            function () {
                return true;
            }
        }

    )
    } else if (status == 3 && buttonBool) {
        api.button(
            {
                name: 'Approve',
                callback: function () {
                    check();
                    return false;
                }
            },
            {
                name: 'Process Logs',
                callback: function () {
                    logs();
                    return false;
                }
            },
        < shiro;
    :
        hasPermission;
        name = "te:pdf" >
            {
                name: 'View PDF',
                callback: function () {
                    api.button({name: 'View PDF', disabled: true});
                    window.location.href = basePath + "/mccdoc/te_management_createPdf.action?teBaseInfo.id=" + $("input[name='teBaseInfo.id']").val();
                    setTimeout(function () {
                        api.button({name: 'View PDF', disabled: false});
                    }, 2000);
                    return false;
                }
            },;
    <
        /shiro:hasPermission>;
        {
            'Cancel',
                callback;
        :

            function () {
                return true;
            }
        }

    )
    } else {
        api.button(
            {
                name: 'Process Logs',
                callback: function () {
                    logs();
                    return false;
                }
            },
        < shiro;
    :
        hasPermission;
        name = "te:pdf" >
            {
                name: 'View PDF',
                callback: function () {
                    api.button({name: 'View PDF', disabled: true});
                    window.location.href = basePath + "/mccdoc/te_management_createPdf.action?teBaseInfo.id=" + $("input[name='teBaseInfo.id']").val();
                    setTimeout(function () {
                        api.button({name: 'View PDF', disabled: false});
                    }, 2000);
                    return false;
                }
            },;
    <
        /shiro:hasPermission>;
        {
            'Cancel',
                callback;
        :

            function () {
                return true;
            }
        }

    )
    }


    function check() {
        var actionUrl = "/mccdoc/form/check_te.jsp?id=${teBaseInfo.id}&status=${teBaseInfo.editStatus}";
        var procType = status == 2 ? 'Checking' : 'Approving';
        if (!'${teBaseInfo.number}') {
            actionUrl += '&title=TE task ' + procType + ' [Tail: ${teBaseInfo.acNo}]'
        } else {
            actionUrl += '&title=TE task ' + procType + ' [TE NO: ${teBaseInfo.number}] R${teBaseInfo.revNo}'
        }
        P.$.dialog({
            id: "checkTeDialog",
            title: "TE " + procType,
            width: "750px",
            height: "500px",
            data: {},
            parent: this,
            lock: true,
            close: function () {
                api.close();
            },
            content: 'url:' + basePath + actionUrl
        });
    }

    function logs() {
        var _id = ${teBaseInfo.flowInstanceId};
        var url = 'mccdoc/logs.jsp?id=' + _id;
        P.$.dialog({
            title: 'Process Logs',
            width: '650px',
            height: '300px',
            top: '20%',
            esc: true,
            cache: false,
            max: false,
            min: false,
            parent: this,
            content: 'url:' + url
        });
    }

    $(function () {

        var actionSelectUrl = basePath + "/er/fileUploadAuxiliary_getAllFile.action";

        var params = {

            "entityId": entityId,

            "reliabilityTaskId": '',

            "moduleForPath": moduleForDb,

            "moduleForDb": moduleForDb,

            'licenType': 'select'
        };
        if (typeof (params.entityId) == "undefined" || (params.entityId + "") == "null" || params.entityId == "") {
            return;
        }

        $.ajax({

            url: actionSelectUrl,

            async: false,

            data: params,

            cache: false,

            type: "post",

            success: function (obj, textStatus) {

                if (obj) {

                    var data = JSON.parse(obj);

                    buildAttachment(data.filesObejct, "fileList", $("#td_files"), fileDelAble);

                    //buildAttachment(data.reliabilityFilesObejct,"reliabilityFileList",$("#reliability_committee_td_files"),false);
                }
            }
        });
    });

    function buildAttachment(_dataObj, divId, appendObj, isDel) {
        var _str = "";
        if (!!_dataObj) {
            $.each(_dataObj, function (i, _value) {
                if (_value && _value.name && _value.type && _value.uploadByName && _value.createDate && _value.id) {
                    _str += '<tr name="' + divId + '">';
                    _str += '  <td  class="td-line30-center">' + _value.name + '</td>';
                    _str += '  <td  class="td-line30-center">' + (_value.type && _value.type.toLowerCase()) + '</td>';
                    _str += '  <td  class="td-line30-center">' + _value.uploadByName + '</td>';
                    _str += '  <td  class="td-line30-center">' + _value.createDate + '</td>';
                    _str += '  <td  class="td-line30-center">';
                    _str += '    <div align="center" class="ui_buttons_upload" style="vertical-align: middle;">';
                    if (!isDel) {
                        _str += '        <input type="button" onclick="download(' + _value.id + ')" value="Download" style="cursor: pointer;" />';
                    }
                    if (isDel) {
                        _str += '    <input type="button" onclick="deleteAttachmentById(' + _value.id + ')" value="Delete" style="cursor: pointer;" />';
                    }
                    _str += '    </div>';
                    _str += '  </td>';
                    _str += '</tr>';
                }
            });
        }
        appendObj.nextAll().remove();
        appendObj.after(_str);
    }

    function download(id) {
        window.location.href = basePath + "/ee/attachment_downloadAndMsg.action?fileId=" + id;
    }
</script>
</body>
</html>