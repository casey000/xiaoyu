<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <title>修改借件归还类的TO</title>

    <!-- load css -->
    <link href="/css/mccdoc/to_commons.css" rel="stylesheet" type="text/css"/>

    <!-- load js -->
    <!--#include virtual="/views/items/resource_.shtml"-->
    <script src="/js/global_var.js" type="text/javascript"></script>
    <script src="/js/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>
    <script src="/js/sfa-query-1.0.js" type="text/JavaScript"></script>
    <script src="/js/common_query_dialog.js" type="text/JavaScript"></script>
    <script src="/js/sfa_utils.js" type="text/javascript"></script>
    <!--<script src="/js/mccdoc/common/to_common.js" type="text/javascript"></script>-->
    <!--<script src="/js/jquery.form.js" type="text/javascript"></script>-->
    <!--<script src="/js/jquery.validate.js" type="text/javascript"></script>-->
<!--    <script src="/js/mccdoc/edit/edit_fault_isolate_to.js" type="text/javascript"></script>-->
</head>
<body>
<form action="" id="add_form" method="post">
    <table border="1" cellpadding="0" cellspacing="0" class="table-zi" style="padding-top:10px" width="100%">
        <tr>
            <td class="td-line30-with-bg" width="20%">Type:</td>
            <td width="30%">
                借件归还
                <input id="dmType" name="toBaseInfo.dmType" tails="" type="hidden" value=""/>
                <input id="toBaseInfoId" name="toBaseInfo.id" type="hidden" value=""/>
                <input id="toBaseInfoType" name="toBaseInfo.type" type="hidden" value=""/>
                <input id="delTOMaterialToolsId" name="toBaseInfo.delTOMaterialToolsId" type="hidden" value=""/>
            </td>
            <td class="td-line30-with-bg" width="20%">Rev#:</td>
            <td width="30%">R0
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">DM:</td>
            <td id="dm_type_id" >
               <input type="radio" id="dm-yes" name="dm" ><label for="dm-yes">Yes</label>
                <input type="radio" id="dm-no" name="dm" ><label for="dm-no">NO</label>
            </td>
            <td class="td-line30-with-bg">章节号:</td>
            <td>
                <input id="ata" name="toBaseInfo.ata" readonly="readonly"
                       style="width: 53%;background-color: #f0f0f0; cursor: default;" type="text" value=""/>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">
                借件归还申请单
            </td>
            <td>
                <input id="grabNo" name="toBaseInfo.grabNo" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
            <td class="td-line30-with-bg">恢复目标类型</td>
            <td>
                <input id="grabSource" name="toBaseInfo.grabSource" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
        </tr>
        <tr class="feiji">
            <td class="td-line30-with-bg">机型 :</td>
            <td>
                <input id="model" name="toBaseInfo.model" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
            <td class="td-line30-with-bg">飞机号 :</td>
            <td>
                <input id="acReg" name="toBaseInfo.acReg" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
        </tr>
        <tr class="beijian">
            <td class="td-line30-with-bg">归还件号</td>
            <td>
                <input id="grabPn" name="toBaseInfo.grabPn" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
            <td class="td-line30-with-bg">归还序号</td>
            <td>
                <input id="grabSn" name="toBaseInfo.grabSn" readonly="readonly" style="background-color: #f0f0f0;width: 53%"
                       type="text" value=""/>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">反馈要求</td>
            <td>
                <input id="yes" name="toBaseInfo.feedbackRequests" type="radio" value="1"/>
                YES&nbsp;&nbsp;
                <input id="no" name="toBaseInfo.feedbackRequests" type="radio" value="0"/>
                NO&nbsp;
                <span class="td-font-red">*</span>
                <div class="errorMessage"></div>

            </td>
            <td class="td-line30-with-bg"><span class="td-line30-with-bg-center"
                                                style="border-top: none;">Source Type:</span></td>
            <td >
                <input type="radio" id="sourceType_mcc" name="toBaseInfo.sourceType" value="0" checked="checked"
                       readonly="readonly">MCC</label>
                <input type="radio" id="sourceType_ppc" name="toBaseInfo.sourceType" value="1"
                       disabled="disabled">PPC</label>
                <input type="radio" id="sourceType_ts" name="toBaseInfo.sourceType" value="2"
                       disabled="disabled">TS</label>
                <span class="td-font-red">*</span>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">标题</td>
            <td colspan="3">
                <textarea id="subject" maxlength="3000" name="toBaseInfo.subject" readonly="readonly"
                          style="width:97%;height:80px"></textarea>
                <span class="td-font-red">*</span>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">描述</td>
            <td colspan="3">
                <textarea id="miaoshu" maxlength="3000" name="toBaseInfo.description"  readonly="readonly"
                          style="width:97%;height:80px"></textarea>
                <span class="td-font-red">*</span>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg">备注</td>
            <td colspan="3">
                <textarea id="grabRemark" maxlength="3000" name="toBaseInfo.grabRemark"  readonly="readonly"
                          style="width:97%;height:80px"></textarea>
                <span class="td-font-red">*</span>
            </td>
        </tr>
        <tr>
            <td class="td-line30-with-bg" colspan="4">归还部件清单</td>
        </tr>
        <tr>
            <td colspan="4">
                <!--Trouble-shooting begin -->
                <table border="1" cellpadding="0" cellspacing="0" class="table-zi" id="trouble_shooting_table"
                       style="border-top: none;" width="100%">
                    <tr id="toGrabsHtml">
                        <td class="td-line30-with-bg-center" style="border-top: none;" >件号名称</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >P/N</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >S/N</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >位置</td>
                    </tr>

                </table>
                <!--Trouble-shooting end -->
            </td>
        </tr>

        <tr>
            <td class="td-line30-with-bg" colspan="4">航材需求</td>
        </tr>
        <tr>
            <td colspan="4">
                <!--Trouble-shooting begin -->
                <table border="1" cellpadding="0" cellspacing="0" class="table-zi" id="material_tool_table"
                       style="border-top: none;" width="100%">
                    <tr id="materialTtoolHtml">
                        <td class="td-line30-with-bg-center" style="border-top: none;" >件号名称</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >P/N</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >S/N</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >数量</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;" >单位</td>
                    </tr>

                </table>
                <!--Trouble-shooting end -->
            </td>
        </tr>

        <tr>
            <td class="td-line30-with-bg" width="20%">任务附件</td>
            <td id="attachmentHtml" width="30%">
            </td>
        </tr>

        <tr>
            <td class="td-line30-with-bg" colspan="4">部件拆换信息:</td>
        </tr>

        <tr>
            <td colspan="4">
                <!--Trouble-shooting begin -->
                <table border="1" cellpadding="0" cellspacing="0" class="table-zi" id="cc_list_table"
                       style="border-top: none;" width="100%">
                    <tr id="ccListHtml">
                        <td class="td-line30-with-bg-center" style="border-top: none;">Type</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">Name Off</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">P/N Off</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">S/N Off</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">Position Off</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">Name On</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">P/N On</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">S/N On</td>
                        <td class="td-line30-with-bg-center" style="border-top: none;">Position On</td>
                    </tr>

                </table>
                <!--Trouble-shooting end -->
            </td>
        </tr>

        <tr>
            <td class="td-line30-with-bg" width="20%">反馈信息</td>
            <td colspan="3">
            <textarea id="actionAndFeedback" readonly="readonly" rows="4"
                      style="width: 99.5%;background-color: #f0f0f0"></textarea>
            </td>
        </tr>

        <tr>
            <td class="tab_title_background">任务反馈附件</td>
            <td colspan="3">
                <table border="1" bordercolor="#B2C9E0" cellpadding="0" cellspacing="0" class="table-zi"
                       id="qc_table_detail" style="padding-top:10px" width="100%">
                    <tr>
                        <td class="td-line30-with-bg-center" width="25%;">Doc Name</td>
                        <td class="td-line30-with-bg-center" width="25%;">Doc Type</td>
                        <td class="td-line30-with-bg-center" width="25%;">Uploader</td>
                        <td class="td-line30-with-bg-center" width="25%;">Upload Date</td>
                    </tr>
                    <tr id="appendTr"></tr>
                </table>
            </td>
        </tr>

    </table>
</form>
<script type="text/javascript">
    var sub_win, P, s_params = {};
    if (frameElement && frameElement.api) {
        sub_win = frameElement.api;
        P = sub_win.opener;
        s_params = sub_win.data;
        sub_win.button(
            {
                name: 'Cancel'
            }
        );
    } else {
        s_params = getParentParam2_()
    }
    var obj={};
    console.log(s_params);
    var feedBackAttachment;
    $(function () {
        debugger;
        $(':radio').attr('disabled', true);
        $.ajax({
            type: "GET",
            url: "/api/v1/mccdoc/to_base_info/editOrView?id=" + s_params.id,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                obj=data.data;
                console.log(obj);
                $("#grabNo").val(obj.toBaseInfoVO.grabNo);
                $("#grabSource").val(obj.toBaseInfoVO.grabSource=='AIRCRAFT'? "飞机":"备件");
                if(obj.toBaseInfoVO.grabSource=='AIRCRAFT'){
                    $(".beijian").hide();
                }else  if(obj.toBaseInfoVO.grabSource=='REPLACEMENT'){
                    $(".feiji").hide();
                }

                if (obj.toBaseInfoVO.dmType == 'DM') {
                    $('#dm-yes').attr('checked', true);
                } else if (obj.toBaseInfoVO.dmType == 'n') {
                    $('#dm-no').attr('checked', true);
                }
                if (obj.toBaseInfoVO.feedbackRequests == '1') {
                    $('#yes').attr('checked', true);
                } else if (obj.toBaseInfoVO.feedbackRequests == '0') {
                    $('#no').attr('checked', true);
                }

                $("#model").val(obj.toBaseInfoVO.model);
                $("#ac-no").val(obj.toBaseInfoVO.acReg);
                $("#grabPn").val(obj.toBaseInfoVO.grabPn);
                $("#grabSn").val(obj.toBaseInfoVO.grabSn);
                $("#grabRemark").val(obj.toBaseInfoVO.grabRemark);
                $("#description").val(obj.toBaseInfoVO.description);
                $("#subject").val(obj.toBaseInfoVO.subject);
                $("#actionAndFeedback").val(obj.toBaseInfoVO.actionAndFeedback);
                for(var i in obj.toGrabs){
                    let file = " <tr >\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"name" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"pn" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"sn" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"position" + obj.toGrabs[i].id + "\"></span></td>\n" +
                        "                    </tr>";
                    let html_row = $(file);
                    $("#trouble_shooting_table").append(html_row);
                    $("#name"+obj.toGrabs[i].id).text(obj.toGrabs[i].name);
                    $("#pn"+obj.toGrabs[i].id).text(obj.toGrabs[i].pn);
                    $("#sn"+obj.toGrabs[i].id).text(obj.toGrabs[i].sn);
                    $("#position"+obj.toGrabs[i].id).text(obj.toGrabs[i].position);
                }
                for(var i in obj.toMaterialToolss){
                    let file = " <tr >\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"name" + obj.toMaterialToolss[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"pn" + obj.toMaterialToolss[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"sn" + obj.toMaterialToolss[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"qty" + obj.toMaterialToolss[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"unit" + obj.toMaterialToolss[i].id + "\"></span></td>\n" +
                        "                    </tr>";
                    let html_row = $(file);
                    $("#material_tool_table").append(html_row);
                    $("#name"+obj.toMaterialToolss[i].id).text(obj.toMaterialToolss[i].name);
                    $("#pn"+obj.toMaterialToolss[i].id).text(obj.toMaterialToolss[i].pn);
                    $("#sn"+obj.toMaterialToolss[i].id).text(obj.toMaterialToolss[i].sn);
                    $("#qty"+obj.toMaterialToolss[i].id).text(obj.toMaterialToolss[i].qty);
                    $("#unit"+obj.toMaterialToolss[i].id).text(obj.toMaterialToolss[i].unit);
                }

                feedBackAttachment = data.data.feedBackAttachment;
                viewAttachmentsOther();
                searchAttachment();

            },
            error: function (obj) {
                alert("失败！");
            }
        });
    });


    $(function () {

        $(':radio').attr('disabled', true);
        $.ajax({
            type: "GET",
            url: "/api/v1/compCc/selectByDocTypeAndDocNo/" +7+"/"+ s_params.id,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                obj = data.data;
                console.log(obj);
                for (var i in obj) {
                    let file = " <tr >\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"ccType" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"offName" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"offPn" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"offSn" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"offPosition" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"onName" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"onPn" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"onSn" + obj[i].id + "\"></span></td>\n" +
                        "                        <td class=\"td-line30-center\"><span id=\"onPosition" + obj[i].id + "\"></span></td>\n" +
                        "                    </tr>";
                    let html_row = $(file);
                    $("#cc_list_table").append(html_row);
                    $("#ccType" + obj[i].id).text(obj[i].ccType);
                    $("#offName" + obj[i].id).text(obj[i].offName);
                    $("#offPn" + obj[i].id).text(obj[i].offPn);
                    $("#offSn" + obj[i].id).text(obj[i].offSn);
                    $("#offPosition" + obj[i].id).text(obj[i].offPosition);
                    $("#onName" + obj[i].id).text(obj[i].onName);
                    $("#onPn" + obj[i].id).text(obj[i].onPn);
                    $("#onSn" + obj[i].id).text(obj[i].onSn);
                    $("#onPosition" + obj[i].id).text(obj[i].onPosition);
                };
            },
            error: function (obj) {
                alert("失败！");
            }
        });
    });

    function getFileCategory() {
        let fileCategory = "toProductionModule";
        if (s_params.toType == '1') {
            fileCategory = "toTroubleshootingModule";
        } else if (s_params.toType == '2') {
            fileCategory = "toSurveyModule";
        } else if (s_params.toType == '3') {
            fileCategory = "toMaintenanceModule";
        }
        return fileCategory;
    }

    function viewAttachmentsOther() {
        if (feedBackAttachment) {
            let content = '';
            $.each(feedBackAttachment, function (i, v) {
                let down = basePath + "/api/v1/mccdoc/to_base_info/downloadAttachment?pkid=" + v.pkid + "&down=true";
                var pageType = $("#pageType").val();
                content += "<tr id='appendTr'>";
                content += "<td ><div align='center'><a href=" + down + ">" + v.orgName + "</a></div></td>";
                content += "<td ><div align='center'>" + v.fileContentType + "</div></td>";
                content += "<td ><div align='center'>" + v.ernam + "</div></td>";
                content += "<td ><div align='center'>" + v.erdat + "</div></td>";
                //查看页面不需要删除功能
                if (pageType) {
                    content += "</tr>";
                }
            });
            $("#qc_table_detail").append(content);
        }
    }

    //查询现有的附件信息
    function searchAttachment() {
        var params = {
            "sourceId":s_params.id,
            "fileCategory": getFileCategory()
        };
        var actionUrl = basePath + '/api/v1/mccdoc/to_base_info/searchAttachment';
        $.ajax({
            url: actionUrl,
            type: "get",
            cache: false,
            dataType: "json",
            data: params,
            async: false,
            success: function (data) {
                var html = "";
                if (data.code == 200) {
                    $.each(data.data, function (i, v) {
                        let down = basePath + "/api/v1/mccdoc/to_base_info/downloadAttachment?pkid=" + v.pkid + "&down=true";
                        html += '<a href="' + down + '" style="color: blue;">' + v.orgName + '</a><br/>';
                    });
                }
                $("#attachmentHtml").append(html);

            }
        });
    }

    function qiangjian_data() {

    }


</script>
</body>
</html>