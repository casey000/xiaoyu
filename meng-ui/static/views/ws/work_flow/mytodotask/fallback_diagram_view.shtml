<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head id="i18n_" module="">
    <title></title>
    <!--#include virtual="/views/items/resource_.shtml"-->
    <script src="/js/workflow/activiti_workflow.js" type="text/javascript"></script>
    <script type="text/javascript">
        var param = {};

        function i18nCallBack() {
            param = getParentParam_();
            $("#workflow").DiagramWorkFlow({
                imageUrl: "/api/activiti/diagram/image?procDefId=" + param.PROC_DEF_ID,   //流程图url processId="+param.processId+
                traceUrl: '',
                actInfos: param.ACT_INFOS || [],
                clickCallBack: doTurnback,
                isRevert: true,//是否还原展示流程图，{还原Activiti裁剪后的流程图，即将偏移量x=x+minX,y=y+minY}
                offsetX: 0,  //偏移量X
                offsetY: 0 + $("#area").height()   //偏移量Y
            });
        }

        function doTurnback(actInfo) {
            var notes = $("#notes").textbox('getValue');
            if ($.trim(notes) == '') {
                MsgAlert({content: '请输入您的退回意见', type: 'error'});
                return;
            }
            var data = {
                FunctionCode: 'WS_FLOW_TURNBACK',
                taskId: param.TASK_ID, procDefId: param.PROC_DEF_ID,
                activityId: actInfo.actId, notes: notes
            };
            MaskUtil.mask("请求处理中...");
            InitFuncCodeRequest_({
                data: data,
                successCallBack: function (jdata) {
                    MaskUtil.unmask();
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        param.OWindow.alertParent({content: jdata.msg ? jdata.msg : $.i18n.t('msg_err:ERRMSG.COMMON.SUCCESS_CODE')});
                        param.OWindow.reloadParentDG();
                        CloseWindowIframe();
                        param.OWindow.CloseWindowIframe();
                    } else {
                        MsgAlert({content: jdata.msg, type: 'error'});
                    }
                }
            });
        }
    </script>
</head>
<body style="overflow: scroll">
<div id="area">
    <div><span style="color: red; background-color: red;">&nbsp;&nbsp;&nbsp;&nbsp;</span>: 当前节点
        <span style="color: green; background-color: green;">&nbsp;&nbsp;&nbsp;&nbsp;</span>:可退回的节点
    </div>
    <table cellspacing="0" cellpadding="2" class="table table-bordered table-info" id="mtable">
        <tr>
            <th class="tdl">退回意见：</th>
            <td class="tdr">
                <input id="notes" class="easyui-textbox easyui-validatebox" name="notes"
                       data-options="multiline:true, validType:['maxLength[200]'] " style="height:65px; width: 90%;"/>
            </td>
        </tr>
    </table>
</div>
<div id="workflow"></div>
</body>
</html>