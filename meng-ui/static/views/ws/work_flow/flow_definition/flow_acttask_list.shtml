<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>流程任务管理</title>
</head>
<body class="ibody">
<table id="dg"></table>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var param = {};
    var TASK_STATE_MAP = {
        "N": "未执行",
        'F': '已完成',
        'T': '已终止',
        'R': '已退回',
        'J': '已跳转',
        'H': '已转办'
    };

    function i18nCallBack() {
        param = getParentParam_();
        InitDataGrid();
    }

    function InitDataGrid() {
        var identity = 'dg';
        $("#dg").MyDataGrid({
            identity: identity,
            pagination: false,
            title: $.i18n.t('流程任务历史列表'),
            rowStyler: function (row) {
                if ((row.ID + '').indexOf('SUGGEST') != 0) {
                    if (!row.END_TIME) {
                        return 'color: #000;font-weight:bold;';
                    }
                }
            }, queryParams: {procInstId: param.PROC_INST_ID},
            columns: {
                param: {FunctionCode: 'WS_FLOW_HIS_TASK_LIST'},
                alter: {
                    END_TIME: {
                        formatter: function (value, row, index) {
                            return value;
                        }
                    },
                    ACT_STATE: {
                        formatter: function (value, row, index) {
                            var v = [TASK_STATE_MAP[row.ACT_STATE]];
                            if (row.RECORD_STATE && row.RECORD_STATE != 'N' && row.RECORD_STATE != 'F') {
                                v.push(TASK_STATE_MAP[row.RECORD_STATE])
                            }
                            return v.join(",")
                        }
                    },
                    DURATION: {
                        formatter: function (value, row, index) {
                            return toMsTimeString(row.DURATION || row.DURATION_0);
                        }
                    },
                    OPERATOR_UNAME: {
                        formatter: function (value, row, index) {
                            if (!value) {
                                return "";
                            }
                            return value;
                        }
                    }
                }
            },
            contextMenus: [],
            toolbar: [
                {
                    key: "COMMON_RELOAD", text: $.i18n.t('common:COMMON_OPERATION.RELOAD'),
                    handler: function () {
                        common_reload_({identity: identity});
                    }
                }
            ]
        });
    }

    /** 刷新列表数据 */
    function reload_() {
        $("#dg").datagrid("reload");
    }

</script>
</body>
</html>