<!DOCTYPE html>
<html>
<head>
    <title>TDMS 机务维修平台</title>
    <!--#include virtual="/views/items/resource_.shtml"-->
</head>
<body>
<table border="1" style="border-collapse: collapse;" width="100%">
    <tr>
        <td>KEY</td>
        <td>SESSION</td>
        <td>START_TIME</td>
        <td>NAME</td>
        <td>URI</td>
        <td>REQ_RUN_STATUS</td>
        <td>操作</td>
    </tr>
    <tbody id="con">

    </tbody>
</table>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
</body>
<script>
    $(function () {
        init();
    });

    function init() {
        InitFuncCodeRequest_({
            url: Constant.API_V1_URL + "IC_TRANS_LOG_LIST",
            successCallBack: function (jdata) {
                var con = "";
                for (var i = 0; i < jdata.data.length; i++) {
                    con += "<tr>" +
                        "        <td>" + jdata.data[i]['KEY'] + "</td>" +
                        "        <td>" + jdata.data[i]['SESSION'] + "</td>" +
                        "        <td>" + jdata.data[i]['START_TIME'] + "</td>" +
                        "        <td>" + jdata.data[i]['NAME'] + "</td>" +
                        "        <td>" + jdata.data[i]['URI'] + "</td>" +
                        "        <td>" + jdata.data[i]['REQ_RUN_STATUS'] + "</td>" +
                        "<td>";
                    if (jdata.data[i]['REQ_RUN_STATUS'] == "RUN_OVER") {
                        con += "<a href='javascript:void(0);' style='color: red;' onclick=\"doback('" + jdata.data[i]['KEY'] + "');\">回滚</a>";
                    }
                    con += "</td></tr>";
                }
                $("#con").html(con);
            }

        });
    }

    function doback(key) {
        if (confirm("确定？")) {
            InitFuncCodeRequest_({
                url: Constant.API_V1_URL + "IC_TRANS_LOG_REMOVE",
                data: {
                    key: key
                },
                successCallBack: function (jdata) {
                    init();
                }
            });
        }
    }

</script>
</html>