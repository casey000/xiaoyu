<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <meta charset="UTF-8">
    <title>附件上传</title>
    <style type="text/css">
        .size_color {
            color: red;
            margin-top: 15px;
            margin-left: 10px;
            font-size: 13px;
        }

        .upload_anttu {
            float: right;
            background-color: #2465a8;
            color: #fff;
            text-align: center;
            padding: 5px 20px;
            margin-right: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .caozuo {
            margin-top: 20px;
            margin-left: 10px;
        }

        .file_content {
            margin-top: 20px;
            margin-left: 10px;
            width: calc(100% - 20px);
            height: 280px;
            border: 1px solid #ccc;
        }

        .button_a {
            display: inline-block;
            cursor: pointer;
            background: #2465a8;
            color: #fff;
            border-radius: 4px;
            padding: 5px 20px;
            border: none;
            font-size: 14px;
            margin-right: 12px;
        }

        .button_div {
            text-align: center;
            margin-top: 10px;
        }

        .jianhao {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-right: 10px;
            float: right;
        }

        .file_tr {
            height: 25px;
            width: 98%;
            margin: 0 auto;
            border-bottom: 1px solid #ccc;
            padding-top: 5px;
        }

        .file_tr:hover {
            background-color: #cccccc87;
        }

        .file_tr span {
            font-size: 14px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
<div class="size_color">上传文件支持类型：</div>
<div class="size_color">XLSX|XLS</div>
<div class="caozuo">
    <!--<input class="textbox easyui-validatebox" data-options="required:true"  name="file"-->
    <!--onchange="atta_input_flie('file_input')" size="300" style="display:none;" type="file"/>-->
    <input  accept=".xlsx,.xls" id="file_input"  name="file"  type="file" />
    <a class="upload_anttu" onclick="file_downLoad_div()" >下载模板</a>

</div>

<div class="button_div" style="margin-top: 20%">
    <a class="button_a" onclick="file_sure()">确定</a>
    <a class="button_a" onclick="cancel()">取消</a>
</div>
</body>
<script src="/js/plugins/ajaxfileupload/ajaxfileupload.js" type="text/javascript"></script>
<script src="../../js/datagrid_utils.js" type="text/javascript"></script>

<script>

    function file_upload_div() {
        $("#file_input").trigger("click");
    }
    function file_downLoad_div(){
        console.log("点击了下载");
        var con = "<form id='_f0_rm' method='post' action='/api/v1/plugins/DOWNLOAD_JC_EXECUTIVE_LOG_TEMPLATE'></form>";
        $("#_f0_rm").remove();
        $("body").append(con);
        $("#_f0_rm").submit();
    }
    var params = getParentParam_();
    var file_obj = [];
    var fileid_obj = [];


    function file_sure() {
        //判断是否选择了文件
        var fileInputObj = $("#file_input");
        var fileName = fileInputObj.val();
        if (!$.trim(fileName)){
            MsgAlert({content: '请选择文件', type: 'error'});
            return;
        }

        var files = document.getElementById("file_input").files[0];
        var formData = new FormData();
        formData.append("file",files);
        var param = getParentParam_();
            $.ajaxFileUpload({
                url: "/api/v1/plugins/JC_EXECUTIVE_LOG_IMPORT",
                secureuri: false,
                fileElementId: "file_input", //file控件id
                dataType: 'json',
                type:'post',
        //        data:formData,
                success: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        CloseWindowIframe();
                        param.OWindow.reload_();
                        param.OWindow.MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    } else {
                        MsgAlert({content: jdata.msgData[0] ? jdata.msgData[0] : jdata.msg, type: 'error'});
                    }

                }

            });
        }

       // window.close();


    function cancel()
    {
        window.close();
    }

</script>
</html>