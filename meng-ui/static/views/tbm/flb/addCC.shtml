<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <!--#include virtual="/views/items/resource_.shtml"-->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <!-- <script type="text/javascript" src="http://10.88.15.51:8080/js/jquery/lhgdialog/lhgdialog.js"></script> -->
    <style type="text/css">
        .table-cell {
            text-align: center;
            padding: 0;
            margin: 0;
        }
        .cell-normal {
            height: 40px;
        }
        .cell-textarea {
            height: 80px;
        }

        td {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        input[type="text"] {
            width: 100px;
            margin: 0 5px 0 5px;
        }

        input[type="remove"] {
            width: 140px;
        }

        .foot-btns {
            bottom: 0;
            float: right;
            margin: 10px 20px 0 0;
        }
    </style>
</head>
<body>
<form class="form-horizontal" id="addCCform">
    <table class="table table-bordered table-info" id="pdList" style="padding-top:10px" width="100%">
        <tr>
            <th class="table-cell cell-normal" colspan="2">CC TYPE</th>
            <td class="table-cell cell-normal" colspan="4" style="width: 40%">
                <form id="ccType" name="ccType" style="color: black">
                    <input id="remove" name="ccType" onchange="cc_type_change(1)" type="radio" value="1"><label
                        for="remove">Remove</label>
                    <input id="install" name="ccType" onchange="cc_type_change(2)" style="margin-left: 15px"
                           type="radio" value="2"><label for="install">Install</label>
                    <input id="replace" name="ccType" onchange="cc_type_change(3)" style="margin-left: 15px"
                           type="radio" value="3"><label for="replace">Replace</label>
                    <input id="swap" name="ccType" onchange="cc_type_change(4)" style="margin-left: 15px" type="radio"
                           value="4"><label for="swap">Swap</label>
                </form>
            </td>
            <td class="table-cell cell-normal"></td>
            <th class="table-cell cell-normal" colspan="2"></th>
            <td class="table-cell cell-normal" colspan="2"></td>
        </tr>
        <tr id="off1">
            <th class="table-cell cell-normal" style="width: 8%">OFF</th>
            <th class="table-cell cell-normal" style="width: 8%">A/C</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="offAc" name="offAc" type="text"/></td>
            <th class="table-cell cell-normal" style="width: 8%">Name</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="offName" name="offName" type="text"/></td>
            <th class="table-cell cell-normal" style="width: 8%">P/N</th>
            <td class="table-cell cell-normal required" style="width: 10%"><input id="offPn" name="offPn" type="text"/>
            </td>
            <th class="table-cell cell-normal" style="width: 8%">S/N</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="offSn" name="offSn" type="text"/></td>
            <th class="table-cell cell-normal" style="width: 8%">Position</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="offPosition" name="offPosition"
                                                                         type="text"/></td>
        </tr>
        <tr id="on1">
            <th class="table-cell cell-normal" style="width: 8%">ON</th>
            <th class="table-cell cell-normal" style="width: 8%">A/C</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="onAc1" name="onAc1" type="text"></td>
            <th class="table-cell cell-normal" style="width: 8%">Name</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="onName1" name="onName1" type="text"/></td>
            <th class="table-cell cell-normal" style="width: 8%">P/N</th>
            <td class="table-cell cell-normal required" style="width: 10%"><input id="onPn1" name="onPn1" type="text"/>
            </td>
            <th class="table-cell cell-normal" style="width: 8%">S/N</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="onSn1" name="onSn1" type="text"/></td>
            <th class="table-cell cell-normal" style="width: 8%">Position</th>
            <td class="table-cell cell-normal" style="width: 10%"><input id="onPosition1" name="onPosition1"
                                                                         type="text"/></td>
        </tr>
        <tr id="on2">
            <th class="table-cell cell-normal">ON</th>
            <td class="table-cell cell-normal" colspan="4"></td>
            <th class="table-cell cell-normal">P/N</th>
            <td class="table-cell cell-normal required"><input id="onPn2" name="onPn2" type="text"/></td>
            <th class="table-cell cell-normal">S/N</th>
            <td class="table-cell cell-normal"><input id="onSn2" name="onSn2" type="text"/></td>
            <th class="table-cell cell-normal">Position</th>
            <td class="table-cell cell-normal"><input id="onPosition2" name="onPosition2" type="text"/></td>
        </tr>
        <tr>
            <th class="table-cell cell-normal required" colspan="3">Complete Date</th>
            <td class="table-cell cell-normal" colspan="2"><input id="completeDate" name="completeDate" type="long">
            </td>
            <th class="table-cell cell-normal required" colspan="2">Flight No.</th>
            <td class="table-cell cell-normal" colspan="2"><input id="flightNo" name="flightNo" type="long"></td>
            <td class="table-cell cell-normal" colspan="2"></td>
        </tr>
        <tr class="aerial_material">
            <th class="table-cell cell-normal required" colspan="2">航材状态</th>
            <td class="table-cell cell-normal"><input id="airMaterial" name="airMaterialState" type="text"></td>
            <td class="table-cell cell-normal" colspan="8"></td>
        </tr>
        <tr>
            <th class="table-cell cell-normal required" colspan="3">Reason<span style="color: red">*</span></th>
            <td class="table-cell cell-textarea" colspan="8">
                <textarea id="reason" maxlength="1000" name="reason"
                          style="height: 100%;width: 100%;resize: none;"></textarea>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal required" colspan="3">TAKEN ACTION<span style="color: red">*</span></th>
            <td class="table-cell cell-textarea" colspan="8">
                <textarea id="takenAction" maxlength="1000" name="takenAction"
                          style="height: 100%;width: 100%;resize: none;"></textarea>
            </td>
        </tr>
        <table class="table table-bordered table-info" id="tableRemove">
            <tr>
                <th class="table-cell cell-normal" colspan="10">该部件存在以下下级部件请核实是否一起拆下</th>
            </tr>
            <tr>
                <th class="table-cell cell-normal" style="width: 20%">Name</th>
                <th class="table-cell cell-normal required" style="width: 20%">P/N</th>
                <th class="table-cell cell-normal required" style="width: 20%">S/N</th>
                <th class="table-cell cell-normal required" style="width: 20%">Position</th>
                <th class="table-cell cell-normal required" style="width: 20%">是否随上层母件一起拆下？</th>
            </tr>
            <!-- <tr>
                <td class="table-cell cell-normal"><input type="long" name="remove_name" id="remove_name"></td>
                <td class="table-cell cell-normal"><input type="long" name="remove_pn" id="remove_pn"></td>
                <td class="table-cell cell-normal"><input type="long" name="remove_sn" id="remove_sn"></td>
                <td class="table-cell cell-normal"><input type="long" name="remove_position" id="remove_position"></td>
                <td class="table-cell cell-normal">yes</td>
            </tr> -->
        </table>
        <table class="table table-bordered table-info" id="tableReplace">
            <tr>
                <th class="table-cell cell-normal" colspan="10">该部件存在以下下级部件请核实是否一起拆换</th>
            </tr>
            <tr>
                <th class="table-cell cell-normal" style="width: 14%">Name</th>
                <th class="table-cell cell-normal required" style="width: 14%">P/N(OFF)</th>
                <th class="table-cell cell-normal required" style="width: 14%">S/N(OFF)</th>
                <th class="table-cell cell-normal required" style="width: 14%">Position</th>
                <th class="table-cell cell-normal required" style="width: 16%">是否随上层母件一起拆换？</th>
                <th class="table-cell cell-normal" style="width: 14%">P/N(ON)</th>
                <th class="table-cell cell-normal" style="width: 14%">S/N(ON)</th>
            </tr>
        </table>
        <!-- <table id="tableSwap"></table> -->
        <table class="table table-bordered table-info">
            <tr>
                <th class="table-cell cell-normal" style="width: 20%">Remark</th>
                <td class="table-cell cell-textarea">
                    <textarea id="remark" maxlength="1000" name="remark"
                              style="height: 100%;width: 100%;resize: none;"></textarea>
                </td>
            </tr>
        </table>
    </table>
</form>
<div class="foot-btns">
    <a class="searchBtn" data-options="iconCls:'icon-clear'" onclick="save()" style="margin-right: 10px;" type="button">
        <span data-i18n="common:COMMON_OPERATION.SAVE"></span>
    </a>
    <!-- <a class="searchBtn" data-options="iconCls:'icon-clear'" onclick="submitFlow()" style="margin-right: 10px;"
       type="button">
        <span data-i18n="common:COMMON_OPERATION.SUBMIT"></span>
    </a> -->
    <a class="ridoBtn" data-options="iconCls:'icon-clear'" onclick="close_window()" type="button">
        <span data-i18n="common:COMMON_OPERATION.CANCEL"></span>
    </a>
</div>
<!-- ac选择弹窗, copy from flb_station_task_list.shtml -->
<div class="easyui-window" data-options="" id="ACQueryWindow" style="width:70%;height:50%;padding:5px 5px 5px 5px;"
     title="A/C Query">
    <table id="ACDg" pagination="true"></table>
</div>

<script type="text/javascript">
    const params = getParentParam_();
    var global_data = {
        sublength: 0,
        flightId: params.defect_info.flightId
    };

    const air_material_state_list = [
        {
            label: "可用件",
            value: "USED"
        },
        {
            label: "不可用件",
            value: "UNUSED"
        },
        {
            label: "待观察件",
            value: "WDISPOSE"
        }
    ];

    function get_data() {
        if (params.operation == "add") {
            let chnReason = params.defect_info.reasonChn;
            let enReason = params.defect_info.reasonEn;
            let actionChn = params.defect_info.actionChn;
            let actionEn = params.defect_info.reasonEn;
            $('#reason').val(chnReason);
            $('#takenAction').val(actionChn);
            return;
        }
        let url = "/api/v1/cc/view";
        let form = new FormData();
        form.append('id', params.id);
        axios.post(url, form).then(response => {
            if(response.data.msg.toUpperCase().indexOf("SUCCESS") != -1;
    )
        {
                if (!!response.data.data) {
                    init_data(response.data.data)
                }
            } else {
                throw new Error(response.data.msgData[0])
            }
        }).catch(err => {
            MsgAlert({type: "error", content: "获取cc信息失败: " + err})
        })
    }


    /**
     * 给remove的下级件列表加一行
     * @param {object} row_data 该行对应的数据
     * @param {number} index 该行对应的行号
     */
    function add_table_remove(row_data, index) {
        if (!!$(`#remove_tr${index}`)) {
            $(`#remove_tr${index}`).empty();
            $(`#remove_tr${index}`).remove();
        }
        let html = `<tr id="remove_tr${index}" name="remove_tr">
                    <td class="table-cell cell-normal"><input type="long" name="remove_name${index}" id="remove_name${index}"></td>
                    <td class="table-cell cell-normal"><input type="long" name="remove_pn${index}" id="remove_pn${index}"></td>
                    <td class="table-cell cell-normal"><input type="long" name="remove_sn${index}" id="remove_sn${index}"></td>
                    <td class="table-cell cell-normal"><input type="long" name="remove_position${index}" id="remove_position${index}"></td>
                    <td class="table-cell cell-normal">
                        <form style="color: black">
                            <input type="radio" name="remove_status${index}" id="remove_status_yes${index}" value="y">是
                            <input type="radio" name="remove_status${index}" id="remove_status_no${index}" style="margin-left: 15px" value="n" disabled="true">否
                        </form>
                        <input style="visibility: hidden; position: absolute" name="remove_id${index}" id="remove_id${index}" value="${row_data.id}">
                    </td>
                </tr>`;
        let node = $(html);
        $("#tableRemove").append(html);
        $(`#remove_name${index}`).textbox({value: row_data.name});
        $(`#remove_pn${index}`).textbox({
            value: row_data.offPn,
            editable: false,
            icons: [{
                iconCls: 'icon-search',
                handler: function (e) {
                    $.pnSelect({
                        success: data => {
                            $(`#remove_pn${index}`).textbox("setValue", data.partno)
                        }
                    })
                }
            }]
        });
        $(`#remove_sn${index}`).textbox({value: row_data.offSn});
        $(`#remove_position${index}`).textbox({value: row_data.offPosition});
        if (row_data.flag == "y") {
            $(`#remove_status_yes${index}`).attr("checked", "checked");
        } else if (row_data.flag == "n") {
            $(`#remove_status_no${index}`).attr("checked", "checked");
        }
    }

    /**
     * 给replace的下级件列表加一行
     * @param {object} row_data 改行对应的数据
     * @param {number} index 该行对应的行号
     */
    function add_table_replace(row_data, index) {
        if (!!$(`#replace_tr${index}`)) {
            $(`#replace_tr${index}`).empty();
            $(`#replace_tr${index}`).remove();
        }
        let html = `<tr id="replace_tr${index}" name="replace_tr">
                    <td class="table-cell cell-normal"><input type="remove" name="replace_name${index}" id="replace_name${index}"></td>
                    <td class="table-cell cell-normal"><input type="remove" name="replace_offPn${index}" id="replace_offPn${index}"></td>
                    <td class="table-cell cell-normal"><input type="remove" name="replace_offSn${index}" id="replace_offSn${index}"></td>
                    <td class="table-cell cell-normal"><input type="remove" name="replace_position${index}" id="replace_position${index}"></td>
                    <td class="table-cell cell-normal">
                        <form style="color: black"  id="replace_status${index}" name="replace_status${index}">
                            <input type="radio" name="replace_status${index}" id="replace_status_yes${index}" value="y">是
                            <input type="radio" name="replace_status${index}" id="replace_status_no${index}" style="margin-left: 15px" value="n">否
                        </form>
                        <input style="visibility: hidden; position: absolute" name="replace_id${index}" id="replace_id${index}" value="${row_data.id}">
                    </td>
                    <td class="table-cell cell-normal"><input type="remove" name="replace_onPn${index}" id="replace_onPn${index}"></td>
                    <td class="table-cell cell-normal"><input type="remove" name="replace_onSn${index}" id="replace_onSn${index}"></td>
                </tr>`;
        let node = $(html);
        $("#tableReplace").append(html);
        $(`#replace_name${index}`).textbox({value: row_data.name});
        $(`#replace_offPn${index}`).textbox({
            value: row_data.offPn,
            editable: false,
            icons: [{
                iconCls: 'icon-search',
                handler: function (e) {
                    $.pnSelect({
                        success: data => {
                            $(`#replace_offPn${index}`).textbox("setValue", data.partno)
                        }
                    })
                }
            }]
        });
        $(`#replace_onPn${index}`).textbox({
            value: row_data.onPn,
            editable: false,
            icons: [{
                iconCls: 'icon-search',
                handler: function (e) {
                    $.pnSelect({
                        success: data => {
                            $(`#replace_onPn${index}`).textbox("setValue", data.partno)
                        }
                    })
                }
            }]
        });
        $(`#replace_offSn${index}`).textbox({value: row_data.offSn});
        $(`#replace_onSn${index}`).textbox({value: row_data.onSn});
        $(`#replace_position${index}`).textbox({value: row_data.offPosition});
        if (row_data.flag == "y") {
            $(`#replace_status_yes${index}`).attr("checked", "checked");
        } else if (row_data.flag == "n") {
            $(`#replace_status_no${index}`).attr("checked", "checked");
        }
    }

    function get_component_list() {
        let url = "/api/v1/cc/initSubComponentList";
        let post_data = {
            offAc: $("#offAc").textbox("getValue"),
            offPn: $("#offPn").textbox("getValue"),
            offSn: $("#offSn").textbox("getValue"),
            offAcId: "",
            onPn: "",
            onSn: "",
            ccType: $("input[name='ccType']:checked").val()
        };
        axios.post(url, post_data).then(response => {
            let ccType = $("input[name='ccType']:checked").val();
            if (response.data.msg.toUpperCase().indexOf("SUCCESS") != -1) {
                if (!!response.data.data && Array.isArray(response.data.data.subComponentList)) {
                    if (ccType == 1) {
                        response.data.data.subComponentList.forEach(add_table_remove)
                    } else if (ccType == 3) {
                        response.data.data.subComponentList.forEach(add_table_replace)
                    }
                    global_data.sublength = response.data.data.subComponentList.length;
                }
            } else {
                throw new Error(response.data.msgData[0])
            }
        }).catch(err => {
            MsgAlert({type: "error", content: err.message})
        })
    }

    // function bclick(){
    //     let data = $("#addCCform").serializeObject();
    //     console.log(data);
    //     add_table_replace({}, 1);
    //     add_table_remove({}, 1)
    // }

    function save() {

        //废弃页面
        window.alert("失败！废弃页面,请联系运维工程师.");
        return false;
        let post_data = get_post_data();
        if (!check_required(post_data)) {
            return
        }
        let url = "";
        if (params.operation == "add") {
            url = "/api/v1/flb/feedBack/saveCC";
        } else if (params.operation == "edit" && params.id) {
            url = "/api/v1/cc/update";
        }
        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(
                post_data
            ),
            dataType: "json",
            success: function (data) {
                if (data.code == 200) {
                    if (typeof params.OWindow.queryCCTable == "function") params.OWindow.queryCCTable(data);
                    close_window()
                }
            },
            error: function () {
                window.alert("失败！");
            }
        });
        // axios.post(url, post_data).then(response=>{
        //     if(response.data.msg.toUpperCase().indexOf("SUCCESS") != -1){
        //         // // MsgAlert({type: "success", content: "保存成功"})
        //         // if (typeof params.successCallback == "function") params.successCallback();
        //         // if (typeof params.OWindow.queryCCTable == "function") params.OWindow.queryCCTable();
        //         // close_window()
        //     }else{
        //         throw new Error(response.data.msgData[0])
        //     }
        // }).catch(err=>{
        //     MsgAlert({type: "error", content: "保存失败: " + err})
        // })
    }

    function init_data(page_data) {
        if (!page_data) {
            return
        }
        //先执行cc_type_change处理上部表格,cc_type_change会清空上部数据,执行之后再赋值
        if (page_data.tlbCompCC.ccType == 1) {
            //remove
            $("#remove").attr("checked", "checked");
            cc_type_change(1);
            if (Array.isArray(page_data.tlbCompCCSubs)) {
                page_data.tlbCompCCSubs.forEach(add_table_remove)
            }
        } else if (page_data.tlbCompCC.ccType == 2) {
            //install
            $("#install").attr("checked", "checked");
            cc_type_change(2);
            $("#onAc1").textbox("setValue", page_data.tlbCompCC.onAc);
            $("#onName1").textbox("setValue", page_data.tlbCompCC.onName);
            $("#onPn1").textbox("setValue", page_data.tlbCompCC.onPn);
            $("#onSn1").textbox("setValue", page_data.tlbCompCC.onSn);
            $("#onPosition1").textbox("setValue", page_data.tlbCompCC.onPosition)
        } else if (page_data.tlbCompCC.ccType == 3) {
            //replace
            $("#replace").attr("checked", "checked");
            cc_type_change(3);
            if (Array.isArray(page_data.tlbCompCCSubs)) {
                page_data.tlbCompCCSubs.forEach(add_table_replace)
            }
            $("#onPn2").textbox("setValue", page_data.tlbCompCC.onPn);
            $("#onSn2").textbox("setValue", page_data.tlbCompCC.onSn);
            $("#onPosition2").textbox("setValue", page_data.tlbCompCC.onPosition)
        } else if (page_data.tlbCompCC.ccType == 4) {
            //swap
            $("#swap").attr("checked", "checked");
            cc_type_change(4);
            $("#onAc1").textbox("setValue", page_data.tlbCompCC.onAc);
            $("#onName1").textbox("setValue", page_data.tlbCompCC.onName);
            $("#onPn1").textbox("setValue", page_data.tlbCompCC.onPn);
            $("#onSn1").textbox("setValue", page_data.tlbCompCC.onSn);
            $("#onPosition1").textbox("setValue", page_data.tlbCompCC.onPosition)
        }
        global_data.sublength = (page_data.tlbCompCCSubs || []).length;
        global_data.ccType = page_data.tlbCompCC.ccType;


        $("#offPosition").textbox("setValue", page_data.tlbCompCC.offPosition);
        $("#offName").textbox("setValue", page_data.tlbCompCC.offName);
        $("#offSn").textbox("setValue", page_data.tlbCompCC.offSn);
        // $("#offSn").next("span").children().first().blur(get_component_list);
        $("#reason").val(page_data.tlbCompCC.reason);
        $("#takenAction").val(page_data.tlbCompCC.takenAction);
        $("#remark").val(page_data.tlbCompCC.remark);
        $("#flightNo").textbox("setValue", page_data.tlbCompCC.flightNo);
        // $("#onAc1").textbox();
        // $("#onPosition1").textbox();
        // $("#onName1").textbox();
        // $("#onSn1").textbox();
        // $("#onAc2").textbox();
        // $("#onPosition2").textbox();
        // $("#onName2").textbox();
        // $("#onSn2").textbox();
        $("#offPn").textbox("setValue", page_data.tlbCompCC.offPn);
        $('#airMaterial').combobox("setValue", page_data.tlbCompCC.airMaterialState);
        // $("#onPn1").textbox();
        // $("#onPn2").textbox();
        $("#completeDate").datetimebox("setValue", formatterDate(new Date(page_data.tlbCompCC.completeDate)));

        // $("#remove").attr("checked", "checked");
        // cc_type_change(1)
    }

    function get_post_data() {
        let data = $("#addCCform").serializeObject();
        let ccType = $("input[name='ccType']:checked").val();
        if(!data.completeDate){
            MsgAlert({type: "error", content: "请填写完成时间"});
            return;
        }
        let post_data = {
            completeDate: new Date(data.completeDate),
            ccType: data.ccType,
            flightNo: data.flightNo,
            offAc: data.offAc,
            offAcId: global_data.offAcId || "",
            offName: data.offName,
            offPn: data.offPn,
            offPosition: data.offPosition,
            offSn: data.offSn,
            offAcType: 1,
            reason: data.reason,
            remark: data.remark,
            takenAction: data.takenAction,
            onAc: data.onAc1 ? data.onAc1 : "",
            onAcId: global_data.onAcId || "",
            onAcType: 1,
            onName: data.onName1 ? data.onName1 : "",
            onPn: data.onPn1 ? data.onPn1 : data.onPn2,
            onSn: data.onSn1 ? data.onSn1 : data.onSn2,
            onPosition: data.onPosition1 ? data.onPosition1 : data.onPosition2,
            componentCCSubSet: [],
            airMaterialState: data.airMaterialState,
            defectId: params.defect_info.defectId,
            docNo: params.docNo || "",
            docType: params.docType || "",
            flightId: global_data.flightId || ""
        };
        if (params.operation == "edit") {
            post_data.ccType = global_data.ccType
        }
        if (!!params.id) {
            post_data.id = params.id
        }
        let temp = {};
        if (ccType == 1) {
            for (let i = 0; i < global_data.sublength; i++) {
                temp = {
                    name: data["remove_name" + i],
                    offPn: data["remove_pn" + i],
                    offSn: data["remove_sn" + i],
                    offPosition: data["remove_position" + i],
                    flag: $(`input[name='remove_status${i}']:checked`).val(),
                    id: ""
                };
                if (!!data["remove_id" + i] && data["remove_id" + i] != "undefined") {
                    temp.id = data["remove_id" + i]
                }
                post_data.componentCCSubSet.push(temp);
                temp = {}
            }
        } else if (ccType == 3) {
            for (let i = 0; i < global_data.sublength; i++) {
                temp = {
                    name: data["replace_name" + i],
                    onPn: data["replace_onPn" + i],
                    offPn: data["replace_offPn" + i],
                    offSn: data["replace_offSn" + i],
                    onSn: data["replace_onSn" + i],
                    offPosition: data["replace_position" + i],
                    flag: $(`input[name='replace_status${i}']:checked`).val(),
                    id: ""
                };
                if (!!data["replace_id" + i] && data["replace_id" + i] != "undefined") {
                    temp.id = data["replace_id" + i]
                }
                post_data.componentCCSubSet.push(temp);
                temp = {}
            }
        }
        // console.log(post_data);
        return post_data
    }

    function check_required(data) {
        let result = true;
        if (data.ccType == 1) {
            if (!data.offAc || !data.offPn || !data.offPosition || !data.offSn) {
                result = false;
            }
            if (!data.airMaterialState) {
                result = false;
            }
        } else if (data.ccType == 2) {
            if (!data.onAc || !data.onPn || !data.onPosition || !data.onSn) {
                result = false;
            }
        } else if (data.ccType == 3) {
            if (!data.offAc || !data.offPn || !data.offPosition || !data.offSn || !data.onPn || !data.onPosition || !data.onSn) {
                result = false;
            }
            if (!data.airMaterialState) {
                result = false;
            }
        } else if (data.ccType == 4) {
            if (!data.offAc || !data.offPn || !data.offPosition || !data.offSn || !data.onAc || !data.onPn || !data.onPosition || !data.onSn) {
                result = false;
            }
        }
        if (!data.completeDate) {
            result = false;
        }
        if (!data.reason) {
            MsgAlert({type: "error", content: "Reason不能为空！"});
            return false;
        }
        if (!data.takenAction) {
            MsgAlert({type: "error", content: "TAKEN ACTION不能为空！"});
            return false;
        }
        if (!result) {
            MsgAlert({type: "error", content: "请填写必填项"});
        }
        return result
    }

    function cc_type_change(data) {
        clear_cc_row();
        switch (data) {
            case 1:
                $("#off1").show();
                $("#on1").hide();
                $("#on2").hide();
                $("tr[name='replace_tr']").empty();
                $("tr[name='replace_tr']").remove();
                $("#tableReplace").hide();
                $("#tableRemove").show();
                $(".aerial_material").show();
                global_data.offAcId = params.defect_info.acId;
                break;
            case 2:
                $("#onAc1").textbox("setValue", params.defect_info.ac);
                $("#onAc1").textbox({
                    editable: false
                });
                $("#on1").show();
                $("#off1").hide();
                $("#on2").hide();
                $("tr[name='replace_tr']").empty();
                $("tr[name='replace_tr']").remove();
                $("tr[name='remove_tr']").empty();
                $("tr[name='remove_tr']").remove();
                $("#tableReplace").hide();
                $("#tableRemove").hide();
                $(".aerial_material").hide();
                global_data.onAcId = params.defect_info.acId;
                break;
            case 3:
                $("#off1").show();
                $("#on1").hide();
                $("#on2").show();
                $("tr[name='remove_tr']").empty();
                $("tr[name='remove_tr']").remove();
                $("#tableRemove").hide();
                $("#tableReplace").show();
                $(".aerial_material").show();
                global_data.offAcId = params.defect_info.acId;
                break;
            case 4:
                $("#off1").show();
                $("#on1").show();
                $("#onAc1").textbox({
                    editable: true
                });
                $("#on2").hide();
                $("#tableReplace").hide();
                $("#tableRemove").hide();
                $("tr[name='replace_tr']").empty();
                $("tr[name='replace_tr']").remove();
                $("tr[name='remove_tr']").empty();
                $("tr[name='remove_tr']").remove();
                $(".aerial_material").hide();
                break;
        }
    }

    function clear_cc_row() {
        let id = ["offPn", "offSn", "offPosition", "onAc1", "onPn1", "onSn1", "onPosition1", "onPn2", "onSn2", "onPosition2"];
        id.forEach(key => {
            $("#" +key;
    ).
        textbox("clear")
        })
    }

    /**
     * 初始化easyUI组件
     */
    function init_page() {
        $("#offAc").textbox({
            editable: false,
            value: params.defect_info.ac
        });
        $("#reason").val(params.descChn);
        $("#offPosition").textbox({
            required: true,
        });
        $("#onAc1").textbox({
            required: true,
            icons: [{
                iconCls:'icon-search',
                handler: function(e){
                    acQuery()
                }
            }]
        });
        $('#ACQueryWindow').window('close');
        $("#offName").textbox();
        $("#onName1").textbox();
        $("#offSn").textbox({
            required: true,
        });
        $("#offSn").next("span").children().first().blur(get_component_list);
        $("#onAc1").textbox({
            required: true,
        });
        $("#onPosition1").textbox({
            required: true,
        });

        $("#onSn1").textbox({
            required: true,
        });
        // $("#onAc2").textbox();
        $("#onPosition2").textbox({
            required: true,
        });
        // $("#onName2").textbox();
        $("#onSn2").textbox({
            required: true,
        });
        $("#offPn").textbox({
            required: true,
            editable: false,
            icons: [{
                iconCls: 'icon-search',
                handler: function (e) {
                    $.pnSelect({
                        success: data => {
                        // console.log(data);
                            $("#offPn").textbox("setValue", data.partno);
                            get_component_list()
                        }
                    })
                }
            }]
        });
        $('#airMaterial').combobox({
            required: true,
            editable: false,
            data: air_material_state_list,
            valueField: 'value',
            textField: 'label',
            panelHeight: '70px',
        });
        $("#onPn1").textbox({
            required: true,
            editable: false,
            icons: [{
                iconCls: 'icon-search',
                handler: function (e) {
                    $.pnSelect({
                        success: data => {
                            $("#onPn1").textbox("setValue", data.partno);
                            get_component_list()
                        }
                    })
                }
            }]
        });
        $("#onPn2").textbox({
            required: true,
            editable: false,
            icons: [{
                iconCls: 'icon-search',
                handler: function (e) {
                    $.pnSelect({
                        success: data => {
                            $("#onPn2").textbox("setValue", data.partno);
                            get_component_list()
                        }
                    })
                }
            }]
        });
        $("#completeDate").datetimebox({
            required: true,
            value: params.defect_info.completeDate,
            editable: false,
            showSecond: true
        });
        $("#flightNo").textbox({
            editable: false,
            value: params.defect_info.flightNo
        });
        $("#remove").attr("checked", "checked");
        cc_type_change(1);
        if (params.operation == "edit") {
            $("input[name='ccType']").attr("disabled", "disabled");
        }
    }
    //查询A/C的点击事件
    function acQuery() {
        $('#ACQueryWindow').window('open');
        InitACDataGrid();
    }

    function InitACDataGrid() {
        $("#ACDg").MyDataGrid({
            identity: 'ACDg',
            sortable: true,
            singleSelect: true,
            pagination: true,     //开启分页
            fitColumns: true,
            striped: false,
            showHeader: false,
            columns: {
                param: {FunctionCode: 'FLB_AC_LIST'},
                alter: {}
            },
            onLoadSuccess: function () {
            },
            // 固定表格所占整个表格高度
            resize: function () {
                return {width: "100%", height: "100%"}
                // return tabs_standard_resize($('#tt'), 0.45, 0.54, 140, -6);
            },
            contextMenus: [],
            toolbar: [],
            onClickRow: function (rowIndex, rowData) {
            },
            onDblClickRow: function () {
                var row = $('#ACDg').datagrid('getSelected'); //获取所选行的数据
                $("#onAc1").textbox("setValue", row.tail); //给station控件赋值
                global_data.onAcId = row.acId;
                $('#ACQueryWindow').window('close'); //关闭弹窗
            }
        });
    }
    /**
     * 关闭当前addCC窗口
     * @return {void}
     */
    function close_window() {
        window.opener = null;
        window.open('', '_self');
        window.close();
    }

    $(function () {
        init_page();
        get_data()
    })

</script>
</body>
</html>