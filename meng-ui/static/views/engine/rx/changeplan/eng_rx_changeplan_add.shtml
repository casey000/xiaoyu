<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>换发计划明细</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
    <style type="text/css">
        td {
            padding: 2px;
        }

        button {
            width: 45px;
            height: 20px;
            margin-left: 3px;
            vertical-align: middle;
            border: 1px solid #cfcfcf;
            -moz-border-radius: 5px;
            border-radius: 5px;
            backgroud: #d5d5d5;
        }

        .addBtn {
            padding: 1px 10px;
        }
    </style>
</head>
<body>
<div style="width:95%;margin:0 auto;">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="mform">
                <div id="p0" class="easyui-panel" title="换发计划新增" style="width: 100%"></div>
                <input type="hidden" id="pkid" name="pkid"/>
                <input type="hidden" id="billNo" name="billNo" value="MT"/>
                <input type="hidden" id="modifyUser" name="modifyUser"/>
                <input type="hidden" id="modifyName" name="modifyName"/>
                <input type="hidden" id="modifyDate" name="modifyDate"/>

                <table class="table table-bordered table-info" style="width: 100%">
                    <tr>
                        <td colspan="8" align="right" style="padding: 0;">
                            <input class="btn btn-primary" type="button" id="saveBtn" onclick="save()" value="保存"/>
                            <input class="btn btn-primary" type="button" onclick="CloseWindowIframe();" value="关闭"
                                   style="margin-left:3px;margin-right: 20px;"/>
                        </td>
                    </tr>
                    <tr>
                        <th style="width: 120px;">发动机型号：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="epn" name="epn"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                        <th style="width: 120px;">发动机序号：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="esn" name="esn"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                        <th style="width: 120px;">营运人：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="companyCode" name="companyCode"
                                   data-options="editable:false" style="width: 160px;" value="SFN"/>
                        </td>
                    </tr>
                    <tr>
                        <th>机号：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="acReg" name="acReg"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>装机位：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="curPos" name="curPos"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>引进方式：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="introduceType" name="introduceType"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                    </tr>
                    <tr>
                        <th>TSN：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="tsn" name="tsn"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>TSO：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="tso" name="tso"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>TSR：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="tsr" name="tsr"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                    </tr>
                    <tr>
                        <th>CSN：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="csn" name="csn"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>CSO：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="cso" name="cso"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>CSR：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="csr" name="csr"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                    </tr>
                    <tr>

                        <th>拆下发动机处置方式：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="removeDeal" name="removeDeal"
                                   data-options="required:true,editable:false" style="width: 160px;"/>
                        </td>
                        <th>计划下发日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="planRemoveDate" name="planRemoveDate"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                        <th>计划下发原因：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="planRemoveReason" name="planRemoveReason"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                    </tr>
                    <tr>
                        <th>EGTM剩余循环：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="egtmResidualFc" name="egtmResidualFc"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                        <th>延寿后LLP剩余循环：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="llpResidualFc" name="llpResidualFc"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                        <th>其他商务因素剩余循环：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="comTotalFc" name="comTotalFc"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                    </tr>
                    <tr>
                        <th>孔探报告剩余循环：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="bsiTotalValue" name="bsiTotalValue"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                        <th>磁堵报告剩余循环：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="mcdTotalFc" name="mcdTotalFc"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                        <th>TargetLife延寿后剩余循环：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="targetLifeFc" name="targetLifeFc"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                    </tr>
                    <!--<tr>
                        <th>预测备发数量：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="emergencyQty" name="emergencyQty"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>预测下发日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="forecastRemoveDate" name="forecastRemoveDate"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                        <th>预测下发原因：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="forecastRemoveReason" name="forecastRemoveReason"
                                   data-options="editable:true" style="width: 160px;"/>
                        </td>
                    </tr>-->
                    <!--<tr>
                        <th>相关EA编号：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="eoNo" name="eoNo"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                        <th>计划下发日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="planRemoveDate" name="planRemoveDate"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                        <th>计划下发原因：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="planRemoveReason" name="planRemoveReason"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                    </tr>
                    <tr>
                        <th>计划装机序号：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="installEsn" name="installEsn"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                        <th>计划装机日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="installDate" name="installDate"
                                   data-options="required:true,editable:true" style="width: 160px;"/>
                        </td>
                        <th>拆下发动机处置方式：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="removeDeal" name="removeDeal"
                                   data-options="onlyview:true,editable:false" style="width: 160px;"/>
                        </td>
                    </tr>-->
                </table>
            </form>
        </div>
    </div>
</div>
<script>
    var param = {};
    var user;
    var rowData;

    function i18nCallBack() {
        param = getParentParam_();
        user = getLoginInfo();
        rowData = param.rowData;

        InitFuncCodeRequest_({
            data: {
                domainCode: "ENG_ZZFROM,ENG_POS,ENG_RX_REMOVE_DEAL",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            }, async: false,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {

                    $('#introduceType').combobox({
                        panelHeight: '80px',
                        data: jdata.data.ENG_ZZFROM,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#curPos').combobox({
                        panelHeight: '80px',
                        data: jdata.data.ENG_POS,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#removeDeal').combobox({
                        panelHeight: '120px',
                        data: jdata.data.ENG_RX_REMOVE_DEAL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

        InitGatewayRequest_({
            type: "get",
            async: false,
            path: "/meng-engine/baseOwn/getEngTypeNew",
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    $('#epn').combobox({
                        data: jdata.obj,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        panelHeight: '150px',
                        onSelect: function (item) {
                            InitGatewayRequest_({
                                async: false,
                                data: {matnr: item.VALUE},
                                path: "/meng-engine/baseOwn/getEngByTypeNew",
                                successCallBack: function (jdata) {
                                    if (jdata.success == true) {
                                        $('#esn').combobox({
                                            data: jdata.obj,
                                            valueField: 'VALUE',
                                            textField: 'TEXT',
                                            panelHeight: '150px',
                                        });
                                    } else {
                                        MsgAlert({content: '获取发动机序号列表失败', type: 'error'});
                                    }
                                }
                            });
                        }
                    });
                } else {
                    MsgAlert({content: '获取发动机型号列表失败', type: 'error'});
                }
            }
        });

        $('#acReg').combobox({
            panelHeight: '100px',
            queryParams: {acType: ''},
            url: Constant.API_URL + 'DA_ACTYPE_GET_ACNOS',
            valueField: 'VALUE',
            textField: 'TEXT',
            loadFilter: function (jdata) {
                return jdata.data;
            }
        });

        if (rowData) {
            InitDataForm(rowData);
        }

        $("#modifyUser").val(user.accountId);
        $("#modifyName").val(user.userName);
        $("#modifyDate").val(new Date().Format("yyyy-MM-dd"));
    }

    //保存
    function save() {
        var isValidate = $("#mform").form('validate');
        if (!isValidate) {
            return;
        }
        saveOrUpdateData();
    }

    function saveOrUpdateData() {
        var $form = $("#mform");
        var datas = $form.serializeObject();

        var condition = {
            "pkid": datas.pkid,
            "billNo": datas.billNo,
            "executeFlag": "N",
            "planFlag": "Y",
            "epn": datas.epn,
            "esn": datas.esn,
            "companyCode": "SFN",
            "introduceType": datas.introduceType,
            "acReg": datas.acReg,
            "curPos": datas.curPos,
            "tsn": datas.tsn,
            "csn": datas.csn,
            "tso": datas.tso,
            "cso": datas.cso,
            "tsr": datas.tsr,
            "csr": datas.csr,
            "planRemoveDate": datas.planRemoveDate,
            "planRemoveReason": datas.planRemoveReason,
            "modifyUser": datas.modifyUser,
            "modifyName": datas.modifyName,
            "modifyDate": datas.modifyDate,
            "removeDeal": datas.removeDeal
        };

        if (!datas.pkid) {
        InitGatewayRequest_({
            async: false,
            path: "/meng-engine/rxChangePlan/savePlan",
            data: condition,
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    param.OWindow.MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    param.OWindow.searchData('dg1');
                    CloseWindowIframe();
                } else {
                    MsgAlert({content: jdata.errorMessage, type: 'error'});
                }
            }
        });
        } else {
            InitGatewayRequest_({
                async: false,
                path: "/meng-engine/rxChangePlan/updatePlan",
                data: condition,
                successCallBack: function (jdata) {
                    if (jdata.success == true) {
                        param.OWindow.MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        param.OWindow.searchData('dg1');
                        CloseWindowIframe();
                    } else {
                        MsgAlert({content: '操作失败', type: 'error'});
                    }
                }
            });
        }
    }

    //回显
    function InitDataForm(rowData) {
        ParseFormField_(rowData, $("#mform"));
    }

</script>
</body>
</html>