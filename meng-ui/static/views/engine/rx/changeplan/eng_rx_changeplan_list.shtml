<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>送修参数</title>
    <script type="text/javascript" src="/js/engine/rx/arg/eng_rx_arg_list.js"></script>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
    <style type="text/css">
        .tdl {
            padding: 5px;
        }

        .tdr {
            padding: 5px;
        }
    </style>
</head>
<body class="ibody">
<div id="tt" class="easyui-tabs" style="width: 100%;height: 100%">
    <div title="未执行">
        <form id="ffSearch1" method="post">
            <div id="searchBar">
                <table cellspacing="0" cellpadding="0" class="table table-bordered table-info">
                    <tr>
                        <th class="tdl" style="width: 80px">发动机型号：</th>
                        <td class="tdr" width="100">
                            <input class="easyui-combobox" name="epn" id="epn1" style=" width:100px;"/>
                        </td>
                        <th class="tdl" style="width: 80px">发动机序号：</th>
                        <td class="tdr" width="100">
                            <input class="easyui-combobox" name="esn" id="esn1" style=" width:100px;"/>
                        </td>

                        <th class="tdl" style="width: 96px">计划拆换日期：</th>
                        <td class="tdr" width="100">
                            <input class="easyui-datebox" name="planRemoveDateBegin" id="planRemoveDateBegin1"
                                   style=" width:100px;"/>
                        </td>

                        <th class="tdl" style="width: 20px">至：</th>
                        <td class="tdr" width="100">
                            <input class="easyui-datebox" name="planRemoveDateEnd" id="planRemoveDateEnd1"
                                   style=" width:100px;"/>
                        </td>

                        <th class="th" style="width:80px;" align="right">位置：</th>
                        <td style="width: 100px" class="td5">
                            <input class="easyui-combobox" name="curPos" id="curPos1" style="width:100px;"/>
                        </td>

                        <td align="left" style="padding: 3px;">
                            <a href="javascript:void(0)" class="searchBtn" data-options="iconCls:'icon-search'"
                               onclick="searchData('dg1','#ffSearch1')">
                                <span data-i18n="common:COMMON_OPERATION.QUERY">查询</span></a>
                            <a class="clearBtn" href="javascript:void(0)" onclick="doClear_('#ffSearch1')"
                               data-options="iconCls:'icon-clear'">
                                <span data-i18n="common:COMMON_OPERATION.RESET">重置</span></a>
                            <a class="searchBtn" onclick="editChangePlanData()" data-options="iconCls:'icon-clear'"
                               auth="ENG_RX_CHANGE_PLAN1">
                                <span data-i18n="">增加</span></a>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl" style="width: 40px">机型：</th>
                        <td class="tdr" width="100">
                            <input class="easyui-combobox" name="acType" id="acType1" style=" width:100px;"/>
                        </td>

                        <th class="tdl" style="width: 40px">机号：</th>
                        <td class="tdr" width="100">
                            <input class="easyui-combobox" name="acReg" id="acReg1" style=" width:100px;"/>
                        </td>

                        <th class="tdl" style="width: 40px"></th>
                        <th class="tdl" width="100"></th>
                        <th class="tdl" style="width: 40px"></th>
                        <th class="tdl" width="100"></th>
                        <th class="tdl" style="width: 40px"></th>
                        <th class="tdl" width="100"></th>
                    </tr>
                </table>
            </div>
        </form>
        <span style='color: Red'>注：蓝色背景标识为飞高高原的飞机及发动机，详细工作要求参照TB-71-0023。</span>
        <table id="dg1"></table>
    </div>

    <div title="已执行">
        <form id="ffSearch3" method="post">
            <table class="table table-bordered table-info">
                <tr>
                    <th class="tdl" style="width: 80px">发动机型号：</th>
                    <td class="tdr" width="100">
                        <input class="easyui-combobox" name="epn" id="epn3" style=" width:100px;"/>
                    </td>
                    <th class="tdl" style="width: 80px">发动机序号：</th>
                    <td class="tdr" width="100">
                        <input class="easyui-combobox" name="esn" id="esn3" style=" width:100px;"/>
                    </td>

                    <th class="tdl" style="width: 96px">计划拆换日期：</th>
                    <td class="tdr" width="100">
                        <input class="easyui-datebox" name="planRemoveDateBegin" id="planRemoveDateBegin3"
                               style=" width:100px;"/>
                    </td>

                    <th class="tdl" style="width: 20px">至：</th>
                    <td class="tdr" width="100">
                        <input class="easyui-datebox" name="planRemoveDateEnd" id="planRemoveDateEnd3"
                               style=" width:100px;"/>
                    </td>

                    <th class="th" style="width:80px;" align="right">位置：</th>
                    <td style="width: 100px" class="td5">
                        <input class="easyui-combobox" name="curPos" id="curPos3" style="width:100px;"/>
                    </td>

                    <td align="left">
                        <a href="javascript:void(0)" class="searchBtn" data-options="iconCls:'icon-search'"
                           onclick="searchData('dg3','#ffSearch3')">
                            <span data-i18n="common:COMMON_OPERATION.QUERY">查询</span></a>
                        <a class="clearBtn" href="javascript:void(0)" onclick="doClear_('#ffSearch3')"
                           data-options="iconCls:'icon-clear'">
                            <span data-i18n="common:COMMON_OPERATION.RESET">重置</span></a>
                    </td>
                </tr>
                <tr>
                    <th class="tdl" style="width: 40px">机型：</th>
                    <td class="tdr" width="100">
                        <input class="easyui-combobox" name="acType" id="acType3" style=" width:100px;"/>
                    </td>
                    <th class="tdl" style="width: 40px">机号：</th>
                    <td class="tdr" width="100">
                        <input class="easyui-combobox" name="acReg" id="acReg3" style=" width:100px;"/>
                    </td>

                    <th class="tdl" style="width: 40px"></th>
                    <th class="tdl" width="100"></th>
                    <th class="tdl" style="width: 40px"></th>
                    <th class="tdl" width="100"></th>
                    <th class="tdl" style="width: 40px"></th>
                    <th class="tdl" width="100"></th>


                </tr>
            </table>
        </form>
        <table id="dg3"></table>
    </div>
</div>
<script>
    var PAGE_DATA = {};
    function i18nCallBack() {

        InitGatewayRequest_({
            type: "get",
            async: false,
            path: "/meng-engine/baseOwn/getEngTypeNew",
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    $('#epn1').combobox({
                        data: jdata.obj,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        panelHeight: '150px',
                        onSelect: function (item) {
                            InitGatewayRequest_({
                                async: false,
                                data: {matnr: item.VALUE},
                                path: "/meng-engine/baseOwn/getEngByTypeNew",
                                successCallBack: function (jdata) {
                                    if (jdata.success == true) {
                                        $('#esn1').combobox({
                                            data: jdata.obj,
                                            valueField: 'VALUE',
                                            textField: 'TEXT',
                                            panelHeight: '150px',
                                        });
                                    } else {
                                        MsgAlert({content: '获取发动机序号列表失败', type: 'error'});
                                    }
                                }
                            });
                        }
                    });

                    $('#epn3').combobox({
                        data: jdata.obj,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        panelHeight: '150px',
                        onSelect: function (item) {
                            InitGatewayRequest_({
                                async: false,
                                data: {matnr: item.VALUE},
                                path: "/meng-engine/baseOwn/getEngByTypeNew",
                                successCallBack: function (jdata) {
                                    if (jdata.success == true) {
                                        $('#esn3').combobox({
                                            data: jdata.obj,
                                            valueField: 'VALUE',
                                            textField: 'TEXT',
                                            panelHeight: '150px',
                                        });
                                    } else {
                                        MsgAlert({content: '获取发动机序号列表失败', type: 'error'});
                                    }
                                }
                            });
                        }
                    });
                } else {
                    MsgAlert({content: '获取发动机型号列表失败', type: 'error'});
                }
            }
        });

        InitGatewayRequest_({
            async: false,
            path: "/meng-engine/engBsiReport/getMpActypes",
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    $('#acType1').combobox({
                        data: jdata.obj,
                        valueField: 'value',
                        textField: 'text',
                        panelHeight: '150px',
                    });
                    $('#acType3').combobox({
                        data: jdata.obj,
                        valueField: 'value',
                        textField: 'text',
                        panelHeight: '150px',
                    });
                } else {
                    MsgAlert({content: '获取机型列表失败', type: 'error'});
                }
            }
        });

        InitGatewayRequest_({
            async: false,
            data: {matnr: ''},
            path: "/meng-engine/baseOwn/getEngByTypeNew",
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    $('#esn1').combobox({
                        data: jdata.obj,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        panelHeight: '150px',
                    });
                    $('#esn3').combobox({
                        data: jdata.obj,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        panelHeight: '150px',
                    });
                } else {
                    MsgAlert({content: '获取发动机序号列表失败', type: 'error'});
                }
            }
        });

        $('#acReg1').combobox({
            panelHeight: '100px',
            queryParams: {acType: ''},
            url: Constant.API_URL + 'DA_ACTYPE_GET_ACNOS',
            valueField: 'VALUE',
            textField: 'TEXT',
            loadFilter: function (jdata) {
                return jdata.data;
            }
        });

        $('#acReg3').combobox({
            panelHeight: '100px',
            queryParams: {acType: ''},
            url: Constant.API_URL + 'DA_ACTYPE_GET_ACNOS',
            valueField: 'VALUE',
            textField: 'TEXT',
            loadFilter: function (jdata) {
                return jdata.data;
            }
        });

        InitFuncCodeRequest_({
            data: {
                domainCode: "ENG_ZZFROM,ENG_POS,ENG_RX_REMOVE_DEAL",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            }, async: false,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {

                    PAGE_DATA['engZzfrom'] = DomainCodeToMap_(jdata.data["ENG_ZZFROM"]);
                    PAGE_DATA['engPos'] = DomainCodeToMap_(jdata.data["ENG_POS"]);
                    PAGE_DATA['removeDeal'] = DomainCodeToMap_(jdata.data["ENG_RX_REMOVE_DEAL"]);

                    $('#curPos1').combobox({
                        panelHeight: '100px',
                        data: jdata.data.ENG_POS,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });

                    $('#curPos3').combobox({
                        panelHeight: '100px',
                        data: jdata.data.ENG_POS,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

        InitDataGrid1();
        InitDataGrid3();
    }

    //查询
    function searchData(grid, search) {
        if (grid == 'dg1') {
            InitDataGrid1();
        } else if (grid == 'dg3') {
            InitDataGrid3();
        }
    }

    //刷新
    function reload_(grid) {
        if (grid == 'dg1') {
            InitDataGrid1();
        } else if (grid == 'dg3') {
            InitDataGrid3();
        }
    }

    //重置
    function doClear_(search, grid) {
        $(search).form('clear');
    }

    function InitDataGrid1() {
        var queryParams = $("#ffSearch1").serializeObject();
        $("#dg1").GatewayDataGrid({
            identity: 'dg1',
            idField: "pkid",
            queryParams: queryParams,
            pagination: true,
            path: "/meng-engine/rxChangePlan/listByPageEx",
            columns: {
                param: {FunctionCode: 'ENG_RX_CHANGE_PLAN'},
                alter: {
                    /*forecastRemoveDate: {
                     type: 'date'
                     },*/
                    planRemoveDate: {
                        type: 'date'
                    },
                    removeDate: {
                        type: 'date'
                    },
                    installDate: {
                        type: 'date'
                    },
                    modifyDate: {
                        type: 'date'
                    },
                    planRepairDate: {
                        type: 'date'
                    },
                    introduceType: {
                        formatter: function (value, row, index) {
                            return PAGE_DATA['engZzfrom'] [value];
                        }
                    },
                    removeDeal: {
                        formatter: function (value, row, index) {
                            return PAGE_DATA['removeDeal'] [value];
                        }
                    },
                    curPos: {
                        formatter: function (value) {
                            if (value =='U' || value == 'L')
                                return "APU";
                            else
                                return value;
                        }
                    },
                    acReg:{
                        formatter: function (value, row, index) {
                            var ifGgy = row.ifGgy;
                            if (ifGgy =='Y') {
                                var blueHtml = "<span style='background-color: Cyan'>" + value + "</span>";
                                return blueHtml;
                            }
                            return value;
                        }
                    },
                    esn:{
                        formatter: function (value, row, index) {
                            var ifGgy = row.ifGgy;
                            if (ifGgy =='Y') {
                                var blueHtml = "<span style='background-color: Cyan'>" + value + "</span>";
                                return blueHtml;
                            }
                            return value;
                        }
                    }
                }
            },
            contextMenus: [
                {
                    id: "m-edit",
                    i18nText: "编辑",
                    auth: "ENG_RX_CHANGE_PLAN1",
                    onclick: function () {
                        var rowData = getDG('dg1').datagrid('getSelected');

                        /*if (!rowData.pkid) {
                         MsgAlert({content: "请选择数据！", type: 'error'});
                         return;
                         }*/
                        editChangePlanData(rowData);
                    }
                },
                {
                    id: "m-edit",
                    i18nText: "删除",
                    auth: "ENG_RX_CHANGE_PLAN1",
                    onclick: function () {
                        var rowData = getDG('dg1').datagrid('getSelected');

                        if (!rowData.pkid) {
                            MsgAlert({content: "请选择数据！", type: 'error'});
                            return;
                        }

                        if (!confirm("确认删除该记录？")) {
                            return;
                        }
                        InitGatewayRequest_({
                            async: false,
                            data: {"pkid": rowData.pkid},
                            path: "/meng-engine/rxChangePlan/deletePlan",
                            successCallBack: function (jdata) {
                                if (jdata.success == true) {
                                    reload_("dg1");
                                    MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                                } else {
                                    MsgAlert({content: '操作失败', type: 'error'});
                                }
                            }
                        });

                    }
                },
                {
                    id: "m-edit",
                    i18nText: "配发",
                    auth: "ENG_RX_CHANGE_PLAN2",
                    onclick: function () {
                        var rowData = getDG('dg1').datagrid('getSelected');
                        editChangePlanPf('edit', rowData);

                    }
                },
                {
                    id: "m-edit",
                    i18nText: "下发EA",
                    auth: "ENG_RX_CHANGE_PLAN3",
                    onclick: function () {
                        var rowData = getDG('dg1').datagrid('getSelected');

                        if (!rowData.pkid) {
                            MsgAlert({content: "请先配发再进行此操作！", type: 'error'});
                            return;
                        }
                        openEASendPage(rowData);

                    }
                },
                {
                    id: "m-edit",
                    i18nText: "查看",
                    onclick: function () {
                        var rowData = getDG('dg1').datagrid('getSelected');
                        editChangePlanPf("view", rowData);

                    }
                }
            ],
            onClickRow: function (rowIndex, rowData) {
            },
            onDblClickRow: function (index, field, value) {
                editChangePlanPf("view", value);
            },
            resize: function () {
                return tabs_standard_resize($('#tt'), 30)
            },
            validAuth: function (row, items) {
                if (!isEmpty(row.eoNo) && !isEmpty(row.installEono)) {
                    items['编辑'].enable = false;
                    items['删除'].enable = false;
                   // items['配发'].enable = false;
                    items['下发EA'].enable = false;
                }
                if (row.billNo != 'MT') {
                    items['编辑'].enable = false;
                    items['删除'].enable = false;
                }
                return items;
            }
        });
    }

    function editChangePlanData(rowData) {
        var title_ = $.i18n.t('换发计划明细');
        ShowWindowIframe({
            width: "1000",
            height: "470",
            title: title_,
            param: {rowData: rowData},
            url: "/views/engine/rx/changeplan/eng_rx_changeplan_add.shtml"
        });
    }

    function editChangePlanPf(operation, rowData) {
        var title_ = $.i18n.t('换发计划明细');
        ShowWindowIframe({
            width: "1000",
            height: "470",
            title: title_,
            param: {rowData: rowData, operation: operation},
            url: "/views/engine/rx/changeplan/eng_rx_changeplan_edit.shtml"
        });
    }

    function openEASendPage(rowData) {
        var title_ = $.i18n.t('下发EA');
        ShowWindowIframe({
            width: "690",
            height: "370",
            title: title_,
            param: {rowData: rowData},
            url: "/views/engine/rx/changeplan/eng_rx_changeplan_ea.shtml"
        });
    }

    function InitDataGrid3() {
        var queryParams = $("#ffSearch3").serializeObject();
        $("#dg3").GatewayDataGrid({
            identity: 'dg3',
            idField: "pkid",
            queryParams: queryParams,
            pagination: true,
            path: "/meng-engine/rxChangePlan/listByPageNoEx",
            columns: {
                param: {FunctionCode: 'ENG_RX_CHANGE_PLAN'},
                alter: {
                    planRemoveDate: {
                        type: 'date'
                    },
                    removeDate: {
                        type: 'date'
                    },
                    installDate: {
                        type: 'date'
                    },
                    modifyDate: {
                        type: 'date'
                    },
                    planRepairDate: {
                        type: 'date'
                    },
                    introduceType: {
                        formatter: function (value, row, index) {
                            return PAGE_DATA['engZzfrom'] [value];
                        }
                    },
                    removeDeal: {
                        formatter: function (value, row, index) {
                            return PAGE_DATA['removeDeal'] [value];
                        }
                    },
                    curPos: {
                        formatter: function (value, row, index) {
                            return PAGE_DATA['engPos'] [value];
                        }
                    }
                }
            },
            contextMenus: [
                {
                    id: "m-edit",
                    i18nText: "编辑",
                    onclick: function () {
                        var rowData = getDG('dg3').datagrid('getSelected');

                        if (!rowData.pkid) {
                            MsgAlert({content: "请选择数据！", type: 'error'});
                            return;
                        }
                        editChangePlanData('editEx', rowData);

                    }
                },
                {
                    id: "m-edit",
                    i18nText: "配发",
                    auth: "ENG_RX_CHANGE_PLAN2",
                    onclick: function () {
                        var rowData = getDG('dg3').datagrid('getSelected');
                        editChangePlanPf('edit', rowData);

                    }
                },
                /*{
                    id: "m-edit",
                    i18nText: "下发EA",
                    auth: "ENG_RX_CHANGE_PLAN3",
                    onclick: function () {
                        var rowData = getDG('dg3').datagrid('getSelected');
                        openEASendPage(rowData);

                    }
                },*/
                {
                    id: "m-edit",
                    i18nText: "查看",
                    onclick: function () {
                        var rowData = getDG('dg3').datagrid('getSelected');
                        editChangePlanPf('view', rowData);

                    }
                }
            ],
            onClickRow: function (rowIndex, rowData) {
            },
            onDblClickRow: function (index, field, value) {
                editChangePlanPf("view", value);
            },
            resize: function () {
                return tabs_standard_resize($('#tt'), 30)
            },
            validAuth: function (row, items) {
                if (!isEmpty(row.eoNo) && !isEmpty(row.installEono)) {
                    items['编辑'].enable = false;
                   // items['下发EA'].enable = false;
                }
                if (row.billNo != 'MT') {
                    items['编辑'].enable = false;
                }
                return items;
            }
        });
    }

    function isEmpty(obj) {
        if (typeof obj == "undefined" || obj == null || obj == "") {
            return true;
        } else {
            return false;
        }
    }
</script>
</body>
</html>