<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="ws_infra_struct">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>单元体维护</title>
    <script type="text/javascript">
        var param = {};
        var operation;
        var pkid;
        function i18nCallBack() {
            var userLogin = getLoginInfo();
            $("#modifyName").textbox('setValue', userLogin.userName);
            $("#modifyUser").val(userLogin.accountId);
            var currentDate = new Date();
            var year = currentDate.getFullYear().toString();
            var month = (currentDate.getMonth() + 1).toString();
            var day = currentDate.getDate().toString();
            $("#modifyDate").datebox('setValue', year + "-" + month + "-" + day);
            param = getParentParam_();
            operation = param.operation;
            pkid = param.pkid;
            InitGatewayRequest_({
                type: "get",
                async: false,
                path: "/meng-engine/baseOwn/getEngType",
                successCallBack: function (jdata) {
                    if (jdata.success == true) {
                        $('#modName').combobox({
                            data: jdata.obj,
                            valueField: 'VALUE',
                            textField: 'TEXT',
                            panelHeight: '100px'
                        });
                    } else {
                        MsgAlert({content: '获取发动机型号列表失败', type: 'error'});
                    }
                }
            });
            if (pkid) {
                InitDataForm(pkid);
            }
        }
        //保存
        function save() {
            var isValidate = $("#mform").form('validate');
            if (!isValidate) {
                return;
            }
            saveOrEdit(operation);
        }

        function saveOrEdit(operation) {
            var $form = $("#mform");
            var datas = $form.serializeObject();
            datas['operation'] = $.trim(datas['operation']);
            datas['operation'] = operation;
            InitGatewayRequest_({
                async: false,
                path: "/meng-engine/EngUnitsManage/addOrEditParentMenus",
                data:datas,
                successCallBack: function (jdata) {
                    if (jdata.success == true) {
                        param.OWindow.MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        param.OWindow.reload_();
                        CloseWindowIframe();
                    } else {
                        MsgAlert({content: jdata.errorMessage, type: 'error'});
                    }
                }
            });
        }

        function InitDataForm(pkid) {
            $('#pkid').val(pkid);
            InitGatewayRequest_({
                type: "get",
                async: false,
                path: "/meng-engine/EngUnitsManage/getEngBaseModuleInfo/"+ pkid,
                successCallBack: function (jdata) {
                    if (jdata.success == true) {
                        $("#modName").combobox('setValue', jdata.obj.modName);
                    } else {
                        MsgAlert({content: "提取数据失败!", type: 'error'});
                    }
                }
            });
        }
    </script>
</head>
<body>

<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="mform">
                <input type="hidden" id="pkid" name="pkid" value=""/>
                <input type="hidden" id="modifyUser" name="modifyUser" value=""/>
                <table cellspacing="0" cellpadding="2" class="table table-bordered table-info">
                    <div>
                        <input class="btn btn-primary" type="button" id="closeBtn" onclick="CloseWindowIframe();"
                               value="关闭" style="float: right;margin-right: 10px;"/>
                        <input class="btn btn-primary" type="button" id="saveBtn" onclick="save()" value="保存"
                               style="float: right;margin-right:10px;"/>
                    </div>
                    <tr>
                        <th class="tdl">发动机型号：</th>
                        <td class="tdr">
                            <input class="easyui-combobox" id="modName" name="modName" data-options="required:true,editable:false"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl">维护人：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="modifyName" name="modifyName"
                                   data-options="editable:false,onlyview:true"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl">维护日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="modifyDate" name="modifyDate"
                                   data-options="editable:false,onlyview:true"/>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>

</body>
</html>