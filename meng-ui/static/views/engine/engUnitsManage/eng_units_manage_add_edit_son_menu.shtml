<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="ws_infra_struct">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>单元体维护</title>
    <script type="text/javascript">
        var isEdit_;
        var param = {};
        var pkid;
        var operation;
        function i18nCallBack() {
            var userLogin = getLoginInfo();
            $("#modifyName").textbox('setValue', userLogin.userName);
            var currentDate = new Date();
            var year = currentDate.getFullYear().toString();
            var month = (currentDate.getMonth() + 1).toString();
            var day = currentDate.getDate().toString();
            $("#modifyDate").datebox('setValue', year + "-" + month + "-" + day);
            $("#modifyUser").val(userLogin.accountId);
            param = getParentParam_();
            pkid = param.pkid;//父菜单ID
            modName = param.modName;//父菜单名称
            operation = param.operation;//操作类型(新添或编辑)
            $("#modNameParent").textbox('setValue', modName);
            if (operation == 'edit') {
                InitDataForm(pkid);
            }
        }
        function InitDataForm(pkid) {
            $("#pkid").val(pkid);
            InitGatewayRequest_({
                type: "get",
                async: false,
                path: "/meng-engine/EngUnitsManage/getSonBasModuleInfoById/" + pkid,
                successCallBack: function (jdata) {
                    if (jdata.success == true) {
                        $("#parentId").val(jdata.obj.parentMenuId);
                        $("#modNameParent").textbox('setValue', jdata.obj.parentModName);
                        $("#keyName").textbox('setValue', jdata.obj.sonKeyName);
                        $("#modName").textbox('setValue', jdata.obj.sonModName);
                    } else {
                        MsgAlert({content: jdata.errorMessage, type: 'error'});
                    }
                }
            });
        }
        //保存
        function save() {
            var isValidate = $("#mform").form('validate');
            if (!isValidate) {
                return;
            }
            saveOrEdit(operation);
        }

        function saveOrEdit(operation) {
            var $form = $("#mform");
            var datas = $form.serializeObject();
            datas['operation'] = operation;
            datas['parentPkid'] = pkid; //避免新增获取不到父ID
            InitGatewayRequest_({
                type: "post",
                async: false,
                path: "/meng-engine/EngUnitsManage/addOrEditSonMenus",
                data: datas,
                successCallBack: function (jdata) {
                    if (jdata.success == true) {
                        param.OWindow.MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        param.OWindow.reload_();
                        CloseWindowIframe();
                    } else {
                        MsgAlert({content: jdata.errorMessage, type: 'error'});
                    }
                }
            });
        }
    </script>
</head>
<body>

<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="mform">
                <input type="hidden" id="pkid" name="pkid"/>
                <input type="hidden" id="parentId" name="parentId"/>
                <input type="hidden" id="modifyUser" name="modifyUser"/>
                <table cellspacing="0" cellpadding="2" class="table table-bordered table-info">
                    <div>
                        <input class="btn btn-primary" type="button" id="closeBtn" onclick="CloseWindowIframe();"
                               value="关闭" style="float: right;margin-right: 10px;"/>
                        <input class="btn btn-primary" type="button" id="saveBtn" onclick="save()" value="保存"
                               style="float: right;margin-right:10px;"/>
                    </div>
                    <tr>
                        <th class="tdl">父项名称：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="modNameParent" name="modNameParent"
                                   data-options="editable:false,onlyview:true"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl">子项关键字：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="keyName" name="keyName"
                                   data-options="required:true,validType:['maxLength[100]']"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl">子项名称：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="modName" name="modName"
                                   data-options="required:true,validType:['maxLength[100]']"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl">维护人：</th>
                        <td class="tdr">
                            <input class="easyui-textbox" id="modifyName" name="modifyName" value=""
                                   data-options="editable:false,onlyview:true"/>
                        </td>
                    </tr>
                    <tr>
                        <th class="tdl">维护日期：</th>
                        <td class="tdr">
                            <input class="easyui-datebox" id="modifyDate" name="modifyDate" value=""
                                   data-options="editable:false,onlyview:true"/>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>

</body>
</html>