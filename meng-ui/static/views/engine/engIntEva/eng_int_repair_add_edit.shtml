<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>发动机引进评估--修理记录</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
    <style type="text/css">
        td {
            padding: 2px;
        }

        button {
            width: 45px;
            height: 20px;
            margin-left: 3px;
            vertical-align: middle;
            border: 1px solid #cfcfcf;
            -moz-border-radius: 5px;
            border-radius: 5px;
            backgroud: #d5d5d5;
        }

        .addBtn {
            padding: 1px 10px;
        }
    </style>
</head>
<body>
<div id="tt"  style="width:800px;height:650px;text-align: center;">
    <form class="form-horizontal m-t" id="mform4">
        <input name="pkid" id="pkid4" type="hidden">
        <input name="evaId" id="evaId" type="hidden">
        <table class="table table-bordered table-info" style="width: 98%">
            <tr class ="btnTr">
                <td colspan="4" align="right" >
                    <fieldset class="fieldset_eui">
                        <input class="btn btn-primary" type="button" id="default4" onclick="defau('4')" style="margin: 5px;margin-left:400px" value="批量默认"/>
                        <input class="btn btn-primary" type="button" id="unitRepire4" onclick="unitRepair()" style="margin: 5px;" value="单元体修理记录"/>
                        <input class="btn btn-primary" type="button" id="saveBtn4" onclick="save('4')" style="margin: 5px;" value="保存"/>
                        <input class="btn btn-primary" type="button" id="cloBtn4" onclick="CloseWindowIframe()" style="margin: 5px;" value="关闭"/>
                    </fieldset>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Date：</th>
                <td class="tdr">
                    <input class="easyui-datebox" id="repairDate" name="repairDate" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">ENGINE TYPE：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="engType" name="engType" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Facility：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="mro" name="mro" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 100px;">Removal reason：</th>
                <td class="tdr" colspan="3">
                                <textarea class="easyui-textbox " id="removalReason" name="removalReason" multiline="true"
                                          style="height:100px;width: 620px;border: 1px solid #ddd;border-radius: 5px;"
                                          data-options="required: true"></textarea>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">TSN：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="tsn4" name="tsn" data-options="" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">CSN：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="csn4" name="csn" data-options="" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">HPT BLADE：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="hptBlade" name="hptBlade" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">HPT NGV：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="hptNgv" name="hptNgv" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Thrust Rating1：</th>
                <td class="tdr">
                    <input class="easyui-combobox llpType" id="llpType14" name="llpType1" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Remain Cycle：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="llpValue14" name="llpValue1" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Thrust Rating2：</th>
                <td class="tdr">
                    <input class="easyui-combobox llpType" id="llpType24" name="llpType2" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Remain Cycle：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="llpValue24" name="llpValue2" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Cell Test N1 Vib：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="ctN1vib" name="ctN1vib" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Cell Test N2 Vib：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="ctN2vib" name="ctN2vib" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Cell Test N3 Vib：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="ctN3vib" name="ctN3vib" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Peak EGT-STARTING：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="startingEgt" name="startingEgt" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Fan N1 Vibe：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="fanN1vib" name="fanN1vib" data-options="" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Fan N2 Vibe：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="fanN2vib" name="fanN2vib" data-options="" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">TRF N1 Vibe：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="trfN1vib" name="trfN1vib" data-options="" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">TRF N2 Vibe：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="trfN2vib" name="trfN2vib" data-options="" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Time To Minimum Idle：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="ttmi" name="ttmi" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Acceleration Time：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="acceTime5" name="acceTime" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Cell Test Take-off EGTM：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="cttEgtm" name="cttEgtm" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Cell Test Max Continue EGTM：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="ctmcEgtm" name="ctmcEgtm" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">Oil Pressure：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="oilPress4" name="oilPress" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Cell Test Oil Consumption：</th>
                <td  class="tdr">
                    <input class="easyui-textbox" id="ctoc" name="ctoc" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 200px;">PMA/DER：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="pmaDer" name="pmaDer" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 200px;">Maintenance Level：</th>
                <td  class="tdr">
                    <input class="easyui-combobox" id="repairLevel" name="repairLevel" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 100px;">Workscope：</th>
                <td colspan="3">
                                <textarea class="easyui-textbox " id="workscope" name="workscope" multiline="true"
                                          style="height:100px;width: 99%;border: 1px solid #ddd;border-radius: 5px;"
                                          data-options="required: true"></textarea>
                </td>
            </tr>
            <tr>
                <th style="width: 100px;">Evaluation：</th>
                <td class="tdr" colspan="3">
                                <textarea class="easyui-textbox " id="conclusion4" name="repairEva" multiline="true"
                                          style="height:200px;width: 99%;border: 1px solid #ddd;border-radius: 5px;"
                                          data-options="required: true"></textarea>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">维护人：</th>
                <td class="tdr">
                    <input class="easyui-textbox modifyName" id="modifyName4" name="modifyName" style="width: 200px;" data-options="onlyview:true,editable:false"/>
                </td>
                <th style="width: 165px;">维护日期：</th>
                <td class="tdr">
                    <input class="easyui-datebox modifyDate" id="modifyDate4" name="modifyDate" style="width: 200px;" data-options="onlyview:true,editable:false"/>
                </td>
            </tr>
            <tr style="height: 90px">
                <td colspan="4"></td>
            </tr>
        </table>
    </form>
</div>
<script>
    var param = {};
    var operation;
    var pkid;
    var evaId;
    var epn;
    var userLogin = getLoginInfo();
    var userId = userLogin.accountId;
    var userName = userLogin.userName;
    function i18nCallBack() {
        param = getParentParam_();
        pkid = param.pkid;
        evaId = param.evaId;
        operation = param.operation;
        epn = param.epn;
        $('#evaId').val(evaId);
        InitFuncCodeRequest_({
            data: {
                domainCode: "ENG_ZZFROM,ENG_INT_THRUST,ENG_INT_MOD_LEVEL,YESORNO",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },async:false,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    InitGatewayRequest_({
                        type: "get",
                        async: false,
                        path: "/meng-engine/baseOwn/getEngTypeNewRepair",
                        successCallBack: function (jdata) {
                            if (jdata.success == true) {
                                $('#engType').combobox({
                                    data: jdata.obj,
                                    valueField: 'VALUE',
                                    textField: 'TEXT',
                                    panelHeight: '150px',
                                });
                            } else {
                                MsgAlert({content: '获取发动机型号列表失败', type: 'error'});
                            }
                        }
                    });
                    $('#repairLevel').combobox({
                        panelHeight: '150px',
                        data: jdata.data.ENG_INT_MOD_LEVEL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('.llpType').combobox({
                        panelHeight: '150px',
                        data: jdata.data.ENG_INT_THRUST,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    if(operation == "view"){
                        $(".easyui-textbox").textbox({required:false,editable:false,onlyview:true});
                        $(".easyui-combobox").combobox({required:false,editable:false,onlyview:true});
                        $(".easyui-datebox").datebox({required:false,editable:false,onlyview:true});
                        $("#closeReason").textbox({required:false});
                        $('#default4').hide();
                        $('#saveBtn4').hide();
                    }else{
                        $(".modifyName").textbox('setValue',userName);
                        $(".modifyDate").datebox('setValue',new Date().Format('yyyy-MM-dd'));
                    }

                    if(pkid){
                        InitDataForm('4',pkid);
                        InitDataGrid('4',pkid, 'engIntRepair');
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

    }


    //回显
    function InitDataForm(num,pkid) {
        var intpath = '';
        intpath = "/meng-engine/engIntRepair/selectById" + "/" + pkid;
        InitGatewayRequest_({
            type: "get",
            async: false,
            path: intpath,
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    var tempData = jdata.obj;
                    ParseFormField_(tempData, $("#mform"+num));
                } else {
                    MsgAlert({content: '操作失败', type: 'error'});
                }
            }
        });
    }

    //保存
    function save(num) {
        var intform= "#mform"+num;
        var isValidate = $(intform).form('validate');
        if (!isValidate) {
            return;
        }
        var $form = $(intform);
        var datas = $form.serializeObject();
        intpath = '/meng-engine/engIntRepair/addOrEditIntRepair';
        InitGatewayRequest_({
            async: false,
            path: intpath,
            data: datas,
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    var data = jdata.obj;
                    if (data != null) {
                        pkid= data.pkid;
                        operation = 'edit';
                        $('#pkid4').val(pkid);
                        MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        param.OWindow.reload_("#l_dg5");
                    }
                } else {
                    MsgAlert({content: "保存失败!", type: 'error'});
                }
            }
        });
    }

    //上传附件
    function uploadInt(num) {
        var category = 'engIntRepair';
        var dg = 'dg'+num;
        common_uploadFile2({
            identity: dg,
            param: {
                cat: category,
                sourceId: pkid,
                successCellBack: function () {
                    reloadAtt(num,pkid, category);
                },
                fialCellBack: ""
            }
        });
    }

    //初始化附件列表
    function InitDataGrid(num,pkid, category) {
        InitFuncCodeRequest_({
            data: {
                SOURCE_ID: pkid,
                CATEGORY: category,
                FunctionCode: 'ATTACHMENT_RSPL_GET'
            },
            successCallBack: function (jdata) {
                var trHTML = '';
                var dg = "#dg"+num;
                var temp = "dg"+num;
                var attr = '';
                if(window.document.getElementById(temp) != null){
                    attr = window.document.getElementById(temp).innerHTML;
                }
                if(attr){
                    window.document.getElementById(temp).innerHTML = '';
                }
                if (operation == "view") {
                    for (var i = 0; i < jdata.data.length; i++) {
                        trHTML = '<tr align="left"><td class="td5" align="left" style="text-align:left;"><a target="_blank" onclick="downFile(' + jdata.data[i].PKID + ',' + jdata.data[i].PKID + ')">' + jdata.data[i].ORG_NAME + '</a></td></tr>';
                        $(dg).append(trHTML);//在table最后面添加一行
                    }
                } else {
                    for (var i = 0; i < jdata.data.length; i++) {
                        trHTML = '<tr align="left"><td class="td5" align="left" style="text-align:left;"><a target="_blank" onclick="downFile(' + jdata.data[i].PKID + ',' + jdata.data[i].PKID + ')">'
                            + jdata.data[i].ORG_NAME + '</a></td><td class="td5" align="left" style="text-align:left;"><input class="btn btn-primary" type="button"  value="删除" style="width: 50px;margin:5px;" ' +
                            'onclick="deleteFile('+ jdata.data[i].PKID+ ','+ num+ ',\''+ pkid+ '\',\''+ category +'\''+ ');return false;"/></td></tr>';
                        $(dg).append(trHTML);//在table最后面添加一行
                    }
                }
            }
        });
    }


    //删除附件
    function deleteFile(attPkid,num,pkid, category) {
        if (!confirm("是否刪除"))
            return;
        InitFuncCodeRequest_({
            data: {pkid: attPkid, FunctionCode: 'ATTACHMENT_DEL'}, async: false,
            successCallBack: function (jdata) {
                if (jdata.code == 200) {
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reloadAtt(num,pkid, category);
                }
            }
        });
    }

    function reloadAtt(num,pkid, category){
        InitDataGrid(num,pkid, category);
    }

    //批量默认
    function defau(num){
        if (!confirm("确认批量默认？")){
            return;
        }
        var intform= "#mform"+num;
        var tsn = '';
        var csn = '';
        var tso = '';
        var cso = '';
        var conclusion = '';
        if(num == '4' || num == '5' || num == '6' || num == '7' || num == '8'){
            if(num == '4'){
                tsn = $(intform+" #tsn"+num).textbox('getValue');
                csn = $(intform+" #csn"+num).textbox('getValue');
            }else if(num == '7'){
                tsn = $(intform+" #tsn"+num).textbox('getValue');
                csn = $(intform+" #csn"+num).textbox('getValue');
                tso = $(intform+" #tso"+num).textbox('getValue');
                cso = $(intform+" #cso"+num).textbox('getValue');
            }
            conclusion = $(intform+" #conclusion"+num).textbox('getValue');
        }
        $(intform+" .easyui-textbox").textbox('setValue','Not provided');
        $(intform+" .easyui-combobox").textbox('setValue','Not provided');
        if(num == '4' || num == '5' || num == '6' || num == '7' || num == '8'){
            if(num == '4'){
                $(intform+" #tsn"+num).textbox('setValue',tsn);
                $(intform+" #csn"+num).textbox('setValue',csn);
            }else if(num == '7'){
                $(intform+" #tsn"+num).textbox('setValue',tsn);
                $(intform+" #csn"+num).textbox('setValue',csn);
                $(intform+" #tso"+num).textbox('setValue',tso);
                $(intform+" #cso"+num).textbox('setValue',cso);
            }
            $(intform+" #conclusion"+num).textbox('setValue',conclusion);
        }
        if(operation != "view"){
            $('.modifyName').textbox('setValue',userName);
        }
    }

    function unitRepair(){
        var repairId = $('#pkid4').val();
        if(!repairId){
            MsgAlert({content: "请先保存表单数据！", type: 'error'});
            return;
        }
        var title_ = $.i18n.t('维护单元体修理级别');
        ShowWindowIframe({
            width: "800",
            height: "650",
            title: title_,
            param: {repairId: repairId,evaId:evaId,operation:operation,epn:epn,flag:'eva'},
            url: "/views/engine/engIntPreEva/eng_int_repair_units.shtml"
        });
    }


</script>
</body>
</html>