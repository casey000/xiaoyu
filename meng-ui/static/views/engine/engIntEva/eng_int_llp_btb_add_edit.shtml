<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>发动机引进评估--LLP BTB记录</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
    <style type="text/css">
        td {
            padding: 2px;
        }

        button {
            width: 45px;
            height: 20px;
            margin-left: 3px;
            vertical-align: middle;
            border: 1px solid #cfcfcf;
            -moz-border-radius: 5px;
            border-radius: 5px;
            backgroud: #d5d5d5;
        }

        .addBtn {
            padding: 1px 10px;
        }
    </style>
</head>
<body>
<div id="tt"  style="width:800px;height:650px;text-align: center;">
    <form class="form-horizontal m-t" id="mform1">
        <input name="pkid" id="pkid" type="hidden">
        <input name="evaId" id="evaId" type="hidden">
        <table class="table table-bordered table-info" style="width: 98%">
            <tr class ="btnTr">
                <td colspan="4" align="right" >
                    <fieldset class="fieldset_eui">
                        <input class="btn btn-primary" type="button" id="saveBtn1" onclick="save('1')" style="margin: 5px;" value="保存"/>
                        <input class="btn btn-primary" type="button" id="cloBtn1" onclick="CloseWindowIframe()" style="margin: 5px;" value="关闭"/>
                    </fieldset>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">P/N：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="pn" name="pn" data-options="required: true" style="width: 200px;"/>
                </td>
                <th style="width: 165px;">S/N：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="sn" name="sn" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">Description：</th>
                <td colspan="3" class="tdr">
                    <input class="easyui-textbox" id="pnDesc" name="pnDesc" data-options="required: true" style="width: 98%;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">Thrust Rating1：</th>
                <td class="tdr">
                    <input class="easyui-combobox llpType" id="llpType1" name="llpType1" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 165px;">Remain Cycle：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="llpValue1" name="llpValue1" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">Thrust Rating2：</th>
                <td class="tdr">
                    <input class="easyui-combobox llpType" id="llpType2" name="llpType2" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 165px;">Remain Cycle：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="llpValue2" name="llpValue2" data-options="required: true" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 100px;">Question about BTB：</th>
                <td colspan="3">
                                <textarea class="easyui-textbox " id="ques" name="ques" multiline="true"
                                          style="height:100px;width: 98%;border: 1px solid #ddd;border-radius: 5px;"
                                          data-options="required: true"></textarea>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">是否原装机：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="ifOrg" name="ifOrg" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <td class="tdr" colspan="4">
                        <fieldset id="che1" class="fieldset_eui" style="border-width: 1px; border-color: #008000;">
                            <legend data-i18n="">LLP为引进发动机原始装机件：</legend>

                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma1" name="orgCheck" value="1" onclick=""/>是否有Engine Data Submittal
                            </div>
                            <div style="float:left;margin:10px;margin-left: 210px">
                                <input type="checkbox" id="ma2" name="orgCheck" value="2" onclick="" />引进发动机历史上所有修理报告是否完整
                            </div>
                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma3" name="orgCheck" value="3" onclick=""/>引进发动机历史上修理放行适航批准挂签是否完整
                            </div>
                            <div style="float:left;margin:10px;margin-left: 110px">
                                <input type="checkbox" id="ma4" name="orgCheck" value="4" onclick=""/>引进发动机历史上修理LLP清单是否完整
                                
                            </div>
                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma5" name="orgCheck" value="5"  onclick="" />引进发动机完整的装上/拆下历史是否完整
                            </div>
                            <div style="float:left;margin:10px;margin-left: 153px">
                                <input type="checkbox" id="ma6" name="orgCheck" value="6" onclick=""/>最近一个发动机营运人的LLP清单使用数据是否正确
                            </div>
                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma7" name="orgCheck" value="7" onclick=""/>最近一个发动机营运人是否提供Non Incident/Accident Statement
                            </div>
                        </fieldset>
                </td>
            </tr>
            <tr>
                <td class="tdr" colspan="4" >
                        <fieldset id="che2" class="fieldset_eui" style="border-width: 1px; border-color: #008000;">
                            <legend data-i18n="">LLP为非引进发动机原始装机件：</legend>

                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma21" name="nonOrgCheck" value="21" onclick=""/>是否有Birth Cert
                            </div>
                            <div style="float:left;margin:10px;margin-left: 282px">
                                <input type="checkbox" id="ma22" name="nonOrgCheck" value="22" onclick="" />是否有Initial Installation Record
                            </div>
                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma23" name="nonOrgCheck" value="23"  onclick=""/>LLP由New up to Now的ON-OFF LOG是否完整
                            </div>
                            <div style="float:left;margin:10px;margin-left: 115px">
                                <input type="checkbox" id="ma24" name="nonOrgCheck" value="24" onclick=""/>该LLP装上引进发动机时刻是否具备适航批准挂<br>&nbsp;&nbsp;&nbsp;&nbsp;签或修理工卡DFP
                            </div>
                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma25" name="nonOrgCheck"  value="25" onclick="" />引进发动机在装上该LLP时的发动机LLP清单使用数据是否正确
                            </div>
                            <div style="float:left;margin:10px;margin-left: 45px">
                                <input type="checkbox" id="ma26" name="nonOrgCheck" value="26"  onclick=""/>引进发动机在装上该LLP时的发动机放行适航批<br>&nbsp;&nbsp;&nbsp;&nbsp;准挂签是否提供
                            </div>
                            <div style="float:left;margin:10px;margin-left: 20px">
                                <input type="checkbox" id="ma27" name="nonOrgCheck"  value="27" onclick=""/>该LLP由新件状态至装机至所引进发动机前的完整使用履历，<br>&nbsp;&nbsp;&nbsp;&nbsp;可追溯该LLP的初始状态（新件证书或EDS）以及历次进场修理<br>&nbsp;&nbsp;&nbsp;&nbsp;或运行中断时的LLP清单
                            </div>
                            <div style="float:left;margin:10px;margin-left: 45px">
                                <input type="checkbox" id="ma28" name="nonOrgCheck"  value="28" onclick=""/>最近一个发动机营运人是否提供<br>&nbsp;&nbsp;&nbsp;&nbsp;Non Incident/Accident Statement
                            </div>
                        </fieldset>
                </td>
            </tr>
            <tr>
                <th style="width: 250px;">If the LLP used data are correct：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="ifCorrect" name="ifCorrect" data-options="editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 165px;">If the LLP is affected by SB 72-1405：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="ifAh2" name="ifAh2" data-options="editable:false" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 250px;">If the LLP part number is changed：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="ifMod" name="ifMod" data-options="editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 250px;">Remark：</th>
                <td class="tdr">
                    <input class="easyui-textbox" id="changeMemo" name="changeMemo" data-options="" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 220px;">If the LLP is affected by SB 72-AH972：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="ifAh" name="ifAh" data-options="editable:false" style="width: 200px;"/>
                </td>
                <th style="width: 220px;">BTB Pass：</th>
                <td class="tdr">
                    <input class="easyui-combobox" id="ifPass" name="ifPass" data-options="required: true,editable:false" style="width: 200px;"/>
                </td>
            </tr>
            <tr>
                <th style="width: 100px;">BTB Remark：</th>
                <td colspan="3" class="tdr">
                                <textarea class="easyui-textbox " id="btbRemark" name="btbRemark" multiline="true"
                                          style="height:200px;width: 99%;border: 1px solid #ddd;border-radius: 5px;"
                                          data-options="required: true"></textarea>
                </td>
            </tr>
            <tr>
                <th style="width: 165px;">维护人：</th>
                <td class="tdr">
                    <input class="easyui-textbox modifyName" id="modifyName1" name="modifyName" style="width: 200px;" data-options="onlyview:true,editable:false"/>
                </td>
                <th style="width: 165px;">维护日期：</th>
                <td class="tdr">
                    <input class="easyui-datebox modifyDate" id="modifyDate1" name="modifyDate" style="width: 200px;" data-options="onlyview:true,editable:false"/>
                </td>
            </tr>
            <tr>
                <td class="tdr" colspan="4" >
                    <fieldset id="att1" class="fieldset_eui" style="border-width: 1px; border-color: #008000;">
                        <legend data-i18n="">附件：</legend>
                        <input class="btn btn-primary btnTr" type="button" id="uploadBtn1" onclick="uploadInt('1')" style="margin: 10px;margin-left:700px" value="上传"/>
                        <table id='dg1'>
                        </table>
                    </fieldset>
                </td>
            </tr>
            <tr style="height: 90px">
                <td colspan="4"></td>
            </tr>
        </table>
    </form>
</div>
<script>
    var param = {};
    var operation;
    var pkid;
    var evaId;
    var userLogin = getLoginInfo();
    var userId = userLogin.accountId;
    var userName = userLogin.userName;
    function i18nCallBack() {
        param = getParentParam_();
        pkid = param.pkid;
        evaId = param.evaId;
        operation = param.operation;
        $('#evaId').val(evaId);
        InitFuncCodeRequest_({
            data: {
                domainCode: "ENG_ZZFROM,ENG_INT_THRUST,ENG_INT_MOD_LEVEL,YESORNO,YESORNO_C",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },async:false,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $('#ifOrg').combobox({
                        panelHeight: '150px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onSelect: function (data) {
                            changeOrg(data.VALUE);
                        }
                    });
                    $('#ifCorrect').combobox({
                        panelHeight: '150px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifMod').combobox({
                        panelHeight: '150px',
                        data: jdata.data.YESORNO_C,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onSelect: function (data) {
                            changeSb(data.VALUE);
                        }
                    });
                    $('#ifAh').combobox({
                        panelHeight: '150px',
                        data: jdata.data.YESORNO_C,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifAh2').combobox({
                        panelHeight: '150px',
                        data: jdata.data.YESORNO_C,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifPass').combobox({
                        panelHeight: '150px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('.llpType').combobox({
                        panelHeight: '150px',
                        data: jdata.data.ENG_INT_THRUST,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    if(operation == "view"){
                        $(".easyui-textbox").textbox({required:false,editable:false,onlyview:true});
                        $(".easyui-combobox").combobox({required:false,editable:false,onlyview:true});
                        $(".easyui-datebox").datebox({required:false,editable:false,onlyview:true});
                        $("#closeReason").textbox({required:false});
                        $('.btnTr').hide();
                    }else{
                        $(".modifyName").textbox('setValue',userName);
                        $(".modifyDate").datebox('setValue',new Date().Format('yyyy-MM-dd'));
                    }

                    if(pkid){
                        InitDataForm('1',pkid);
                        InitDataGrid('1',pkid, 'engIntLlpBtb');
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

    }


    //回显
    function InitDataForm(num,pkid) {
        var intpath = '';
        intpath = "/meng-engine/engIntLlpBtb/selectById" + "/" + pkid;
        InitGatewayRequest_({
            type: "get",
            async: false,
            path: intpath,
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    var tempData = jdata.obj;
                    ParseFormField_(tempData, $("#mform"+num));
                    if(jdata.obj != null){
                        changeOrg(jdata.obj.ifOrg);
                        if(operation == 'view'){
                            for(var i = 1;i<=8;i++){
                                $('#ma2'+i).prop('disabled', true);
                                if(i<=7){
                                    $('#ma'+i).prop('disabled', true);
                                }
                            }
                        }

                        $(":checkbox").each(function () {
                            if($(this).attr('name') == 'orgCheck'){
                                var str = jdata.obj.orgCheck;
                                if(str){
                                    $(str.split(",")).each(function (i,dom){
                                        $(":checkbox[value='"+dom+"']").prop("checked",true);
                                    });
                                }
                            }
                            if($(this).attr('name') == 'nonOrgCheck'){
                                var str = jdata.obj.nonOrgCheck;
                                if(str){
                                    $(str.split(",")).each(function (i,dom){
                                        $(":checkbox[value='"+dom+"']").prop("checked",true);
                                    });
                                }
                            }
                        });
                    }
                } else {
                    MsgAlert({content: '操作失败', type: 'error'});
                }
            }
        });
    }

    //保存
    function save(num) {
        var intform= "#mform"+num;
        var isValidate = $(intform).form('validate');
        if (!isValidate) {
            return;
        }
        var $form = $(intform);
        var datas = $form.serializeObject();
        if(Array.isArray(datas.orgCheck)){
            datas.orgCheck = datas.orgCheck.join();
        }
        if(Array.isArray(datas.nonOrgCheck)){
            datas.nonOrgCheck = datas.nonOrgCheck.join();
        }
        intpath = '/meng-engine/engIntLlpBtb/addOrEditIntLlpBtb';
        InitGatewayRequest_({
            async: false,
            path: intpath,
            data: datas,
            successCallBack: function (jdata) {
                if (jdata.success == true) {
                    var data = jdata.obj;
                    if (data != null) {
                        pkid= data.pkid;
                        $('#pkid').val(pkid);
                        operation = 'edit';
                        MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        param.OWindow.reload_("#l_dg4");
                    }
                } else {
                    MsgAlert({content: "保存失败!", type: 'error'});
                }
            }
        });
    }


    //上传附件
    function uploadInt(num) {
        var category = 'engIntLlpBtb';
        var dg = 'dg'+num;
        common_uploadFile2({
            identity: dg,
            param: {
                cat: category,
                sourceId: pkid,
                successCellBack: function () {
                    reloadAtt(num,pkid, category);
                },
                fialCellBack: ""
            }
        });
    }

    //初始化附件列表
    function InitDataGrid(num,pkid, category) {
        InitFuncCodeRequest_({
            data: {
                SOURCE_ID: pkid,
                CATEGORY: category,
                FunctionCode: 'ATTACHMENT_RSPL_GET'
            },
            successCallBack: function (jdata) {
                var trHTML = '';
                var dg = "#dg"+num;
                var temp = "dg"+num;
                var attr = '';
                if(window.document.getElementById(temp) != null){
                    attr = window.document.getElementById(temp).innerHTML;
                }
                if(attr){
                    window.document.getElementById(temp).innerHTML = '';
                }
                if (operation == "view") {
                    for (var i = 0; i < jdata.data.length; i++) {
                        trHTML = '<tr align="left"><td class="td5" align="left" style="text-align:left;"><a target="_blank" onclick="downFile(' + jdata.data[i].PKID + ',' + jdata.data[i].PKID + ')">' + jdata.data[i].ORG_NAME + '</a></td></tr>';
                        $(dg).append(trHTML);//在table最后面添加一行
                    }
                } else {
                    for (var i = 0; i < jdata.data.length; i++) {
                        trHTML = '<tr align="left"><td class="td5" align="left" style="text-align:left;"><a target="_blank" onclick="downFile(' + jdata.data[i].PKID + ',' + jdata.data[i].PKID + ')">'
                            + jdata.data[i].ORG_NAME + '</a></td><td class="td5" align="left" style="text-align:left;"><input class="btn btn-primary" type="button"  value="删除" style="width: 50px;margin:5px;" ' +
                            'onclick="deleteFile('+ jdata.data[i].PKID+ ','+ num+ ',\''+ pkid+ '\',\''+ category +'\''+ ');return false;"/></td></tr>';
                        $(dg).append(trHTML);//在table最后面添加一行
                    }
                }
            }
        });
    }


    //删除附件
    function deleteFile(attPkid,num,pkid, category) {
        if (!confirm("是否刪除"))
            return;
        InitFuncCodeRequest_({
            data: {pkid: attPkid, FunctionCode: 'ATTACHMENT_DEL'}, async: false,
            successCallBack: function (jdata) {
                if (jdata.code == 200) {
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reloadAtt(num,pkid, category);
                }
            }
        });
    }

    function reloadAtt(num,pkid, category){
        InitDataGrid(num,pkid, category);
    }

    function changeOrg(ifOrg){
        if(ifOrg == 'Y'){
            for(var i = 1;i<=8;i++){
                $('#ma2'+i).prop('checked', false);
                $('#ma2'+i).prop('disabled', true);
                if(i<=7){
                    $('#ma'+i).prop('disabled', false);
                }
            }
        }else if(ifOrg == 'N'){
            for(var i = 1;i<=8;i++){
                if(i<=7){
                    $('#ma'+i).prop('checked', false);
                    $('#ma'+i).prop('disabled', true);
                }
                $('#ma2'+i).prop('disabled', false);
            }
        }
    }

    function changeSb(ifOrg){
        if(ifOrg == 'Y'){
            $("#changeMemo").textbox({required:true});
        }else{
            $("#changeMemo").textbox({required:false});
        }
    }

</script>
</body>
</html>