<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="emmpdeval">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="">MPD评估</title>
    <style>
        a {
            color: #0000cc;
            font-weight: bold;
        }
        .datagrid-toolbar table {
            float: right;
        }
        span1{
            color:red;

        }
    </style>

</head>
<body class="ibody">
<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="mform">
                <input type="hidden" id="checker" name="checker">
                <input type="hidden" id="count" name="count">
                <input type="hidden" id="ifPse" name="ifPse">
                <input type="hidden" id="docType" name="docType">
                <input type="hidden" id="docSource" name="docSource">
                <input type="hidden" id="pkid" name="pkid">
                <!--<input type="hidden" id="fleet" name="fleet">-->
                <input type="hidden" id="itemPkid" name="itemPkid">
                <input type="hidden" id="docVer" name="docVer">
                <input type="hidden" id="ata" name="ata">
                <input type="hidden" id="evalNo" name="evalNo">
                <input type="hidden" id="evalBy" name="evalBy">
                <input type="hidden" id="evalState" name="evalState">
                <input type="hidden" id="itemNumber" name="itemNumber">
                <input type="hidden" id="ifLatest" name="ifLatest">
                <input type="hidden" id="createDate" name="createDate">
                <input type="hidden" id="mpdNo" name="mpdNo">
                <table class="table table-bordered table-info">
                    <table class="table table-bordered table-info">
                        <tr>

                            <th class="td1" style="width:80px">修订标识：</th>
                            <td class="tdr">
                                <input class="easyui-textbox" id="revCode1" name="revCode1"
                                       style="width:100px"
                                       data-options="required:true,editable:false,onlyview:false"/>
                                <input class="easyui-textbox" id="revCode" name="revCode"
                                       style="width:100px"/>
                                <span id="preview"></span>
                                <span style="color:red">点击项目号，可查看与前版具体差异</span>
                            </td>
                            <td class="tdr">
                            </td>
                            <!--<td id="baocun" align="right" style="width:20% ">-->
                            <!--<input class="btn btn-primary" type="button" id="submit" onclick="save()" value="保存"/>-->
                            <!--<input class="btn btn-primary" type="button" id="submitFlow" onclick="checkIfAppl()"-->
                            <!--value="提交校对"/>-->
                            <!--<input class="btn btn-primary" type="button" id="close" onclick=" CloseWindowIframe()"-->
                            <!--value="关闭"/>-->
                            <!--</td>-->
                        </tr>
                    </table>
                    <div id="div1">
                        <fieldset class="fieldset_eui" style="width:99%;margin-right:5px">
                            <legend data-i18n="">评估小结</legend>
                            <table class="table table-bordered table-info">
                                <tr>
                                    <th class="tdl" style="width:150px">是否适用：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="ifAppl" name="ifAppl"
                                               style="width:130px"
                                               data-options="required:true,onChange:changeIfAppl"/>
                                    </td>
                                    <th class="tdl" style="width:100px">是否修订MP：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="ifRevCmp" name="ifRevCmp"
                                               style="width:160px"
                                               data-options="required:true,onChange:changeIfRevCmp"/>
                                    </td>
                                    <th class="tdl" style="width:100px">MP编号：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="cmpNo" name="cmpNo"
                                               style="width:180px"
                                               data-options=""/>
                                    </td>
                                    <th class="tdl" style="width:100px">顺丰原编号：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="sfnItemNumber" name="sfnItemNumber"
                                               style="width:129px"
                                               data-options="required:false,editable: false,onlyview:true"/>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:150px">是否合并：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="ifMerge" name="ifMerge"
                                               style="width:130px"
                                               data-options=""/>
                                    </td>
                                    <th class="tdl" style="width:100px">合并到MP编号：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="mergeTo" name="mergeTo"
                                               style="width:180px"
                                               data-options="onChange:changeIfRevCmp"/>
                                        <a href="javascript:" id="openCmpNoList" onclick="openCmpNoList();"
                                           class="easyui-linkbutton"
                                           iconCls="icon-search"></a>
                                    </td>
                                    <th class="tdl" style="width:150px">机队：</th>
                                    <td class="tdr" colspan="3">
                                        <input class="easyui-textbox" id="fleet" name="fleet"
                                               data-options="editable: false,onlyview:true "
                                               style="width:180px"/>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:150px">评估意见：</th>
                                    <td class="tdr" colspan="3">
                                        <input class="easyui-textbox" id="evalNote" name="evalNote"
                                               data-options="required:true,multiline:true "
                                               style="height:60px;width:550px;"/>
                                    </td>
                                    <th class="tdl" style="width:100px">评估小结：</th>
                                    <td class="tdr" colspan="3">
                                        <input class="easyui-textbox" id="evalSummary" name="evalSummary"
                                               data-options="multiline:true,editable:false,onlyview:true "
                                               style="height:60px;  width:435px;"/>
                                    </td>

                                </tr>
                                <tr>
                                    <th id="againEva" class="tdl" align="right">设定重评：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="ifAgainEva" data-options="editable:false,onlyview:true"
                                               name="ifAgainEva"
                                               style="width:130px;"/>
                                    </td>
                                    <th id="again1" class="tdl" align="right">重评时间：</th>
                                    <td id="again2" class="tdr">
                                        <input class="easyui-datebox" style="width:163px;" id="againEvaDate" name="againEvaDate"
                                               data-options="editable:false,onlyview:true"/>
                                    </td>
                                    <th id="again3" class="tdl" align="right">重评间隔：</th>
                                    <td id="again4" class="tdr" colspan="3">
                                        <input class="easyui-textbox" id="againEvaInterval"
                                               name="againEvaInterval" data-options="editable:false,onlyview:true"/>天
                                    </td>
                                </tr>
                                <tr id="again5">
                                    <th class="tdl">设定重评原因：</th>
                                    <td class="tdr" colspan="7">
                                    <textarea class="easyui-textbox" id="againEvaReason" name="againEvaReason"
                                              data-options="multiline:true,editable:false,onlyview:true"
                                              style="height:60px;width: 1160px;border: 1px solid #ddd;border-radius: 5px;"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:150px">修订说明：</th>
                                    <td class="tdr" colspan="7">
                                        <input class="easyui-textbox" name="revCnDesc" id="revCnDesc"
                                               data-options="required:true,multiline:true "
                                               style="height:60px; width:1165px;"/>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:150px">HIGHTLIGHT：</th>
                                    <td class="tdr" colspan="7">
                                        <input class="easyui-textbox" name="hightlight" id="hightlight"
                                               data-options="required:true,multiline:true "
                                               style="height:60px; width:1160px;"/>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </div>
                    <div id="div2">
                        <fieldset class="fieldset_eui" style="width:99%;margin-right:5px">
                            <legend data-i18n="">MP信息</legend>
                            <table class="table table-bordered table-info">
                                <tr>
                                    <th class="tdl" style="width:100px">项目分类：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="itemType" name="itemType"
                                               style="width:100px"
                                               data-options="required:true,stopFirstChangeEvent:true,onChange:changeItemType"/>
                                    </td>
                                    <th class="tdl" style="width:100px">适用性类型：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="applType" name="applType"
                                               style="width:120px"
                                               data-options="required:true,stopFirstChangeEvent:true,onChange:changeApplType"/>
                                    </td>
                                    <th class="tdl" id="ctlTypeTh" style="width:100px">控制类型：</th>
                                    <td class="tdr" id="ctlTypeTd">
                                        <input class="easyui-combobox" id="ctlType" name="ctlType"
                                               style="width:120px"
                                               data-options="required:true,onChange:changeCtlType"/>
                                    </td>

                                    <th class="tdl" id="ctlTypeMonitorTh" style="width:100px">机会类型：</th>
                                    <td class="tdr" id="ctlTypeMonitorTd">
                                        <input class="easyui-combobox" id="ctlTypeMonitor" name="ctlTypeMonitor"
                                               style="width:100px"
                                               data-options="required:true"/>
                                    </td>
                                    <th class="tdl" id="limitTypeTh" style="width:100px">时限类型：</th>
                                    <td class="tdr" id="limitTypeTd">
                                        <input class="easyui-combobox" id="limitType" name="limitType"
                                               style="width:120px"
                                               data-options="required:true,onChange:changeLimitType"/>
                                    </td>

                                    <th class="tdl" id="ratioTh" style="width:150px">Engine LLP Ratio：</th>
                                    <td class="tdr" id="goCycleTd">
                                        <input class="easyui-textbox" id="goCycle" name="goCycle"
                                               style="width:80px"
                                               data-options="required:true"/>:
                                        <input class="easyui-textbox" id="normalCycle" name="normalCycle"
                                               style="width:50px"
                                               data-options="required:true"/>
                                    </td>
                                </tr>
                                <tr>
                                    <!--<th class="tdl" id="ammRefTh" style="width:100px">参考手册：</th>
                                    <td class="tdr" id="ammRefTd">
                                        <input class="easyui-textbox" id="ammRef" name="ammRef"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>-->
                                    <!--<th class="tdl" id="engLocationTh" style="width:100px">发动机位置：</th>
                                    <td class="tdr" id="engLocationTd">
                                        <input class="easyui-combobox" id="engLocation"
                                               name="engLocation"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>-->
                                    <th id="standardMhth" class="tdl" style="width:100px">CAT：</th>
                                    <td id="standardMhtd" class="tdr">
                                        <input class="easyui-textbox" id="cat" name="cat"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>

                                    <th class="tdl" id="zoneTh" style="width:100px">ZONE：</th>
                                    <td class="tdr" id="zoneTd">
                                        <input class="easyui-textbox" id="zone" name="zone"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>
                                    <div id="zoneStr">
                                        <!--                                        <th class="tdl" id="subTypeTh" style="width:100px">子机型信息：</th>
                                                                                <td class="tdr" id="subTypeTd">
                                                                                    <input class="easyui-combobox subType-info" style="width:120px"
                                                                                           id="subTypeId" name="subTypeInfo" data-options="editable:false"/>
                                                                                </td>-->
                                        <th class="tdl" id="zoneBindTh" style="width:100px">ZONE：</th>
                                        <td class="tdr" id="zoneBindTd">
                                            <input id="zoneBind" class="easyui-combotree" style="width:120px"
                                                   data-options="multiple:true">
                                        </td>
                                    </div>
                                    <th class="tdl" id="monitorStatusTh" style="width:100px"> 监控状态：</th>
                                    <td class="tdr" id="monitorStatusTd">
                                        <input class="easyui-combobox" id="monitorStatus"
                                               name="monitorStatus"
                                               style="width:120px"
                                               data-options="required:true"/>
                                    </td>
                                    <th class="tdl" id="repairLevalTh" style="width:100px"> 修理级别：</th>
                                    <td class="tdr" id="repairLevalTd">
                                        <input class="easyui-combobox" id="repairLeval"
                                               name="repairLeval"
                                               style="width:120px"
                                               data-options="required:true"/>
                                    </td>

                                </tr>
                                <tr>
                                    <th class="tdl" style="width:90px">PGM：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="pgm" name="pgm"
                                               data-options=""
                                               style="width:120px"/>
                                    </td>
                                    <!--<th class="tdl" style="width:90px">接近盖板：</th>-->
                                    <!--<td class="tdr">-->
                                    <!--<input class="easyui-textbox" id="accesses" name="accesses"-->
                                    <!--data-options=""-->
                                    <!--style="width:120px"/>-->
                                    <!--</td>-->
                                    <th class="tdl" style="width:90px">理论工时：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="manHours" name="manHours"
                                               data-options=""
                                               style="width:120px"/>
                                    </td>
                                    <th class="tdl" style="width:90px">工作类型：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="taskCode" name="taskCode"
                                               data-options=""
                                               style="width:120px"/>
                                    </td>
                                    <th class="tdl" id="executeRequireTh" style="width:100px"> 执行要求：</th>
                                    <td class="tdr" id="executeRequireTd">
                                        <input class="easyui-combobox" id="executeRequire"
                                               name="executeRequire"
                                               style="width:120px"
                                               data-options="required:true,editable: false"/>
                                    </td>
                                    <td colspan="2"></td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:90px">SOURCE：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" id="sources" name="sources"
                                               data-options="editable:false,onlyview:true"
                                               style="height:30px;width:1165px;"/>
                                        <!--<a id="sourceSelect" href="javascript:void(0)" class="easyui-linkbutton"-->
                                        <!--data-options="iconCls:'icon-add'"-->
                                        <!--onclick="addSource()"><span>选择</span>-->
                                        <!--</a>-->
                                    </td>
                                </tr>

                                <tr>
                                    <th class="tdl" style="width:90px">英文描述：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" id="enTaskDesc" name="enTaskDesc"
                                               data-options="required:true,multiline:true "
                                               style="height:60px; width:1165px;"/>
                                    </td>
                                </tr>


                                <tr>
                                    <th class="tdl" style="width:100px">中文描述：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" name="chTaskDesc" id="chTaskDesc"
                                               data-options="required:true,multiline:true "
                                               style="height:60px; width:1165px;"/>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:76px">是否过渡：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="ifTmp" name="ifTmp"
                                               style="width:60px"
                                               data-options="onChange:changeFormatForGuodu,stopFirstChangeEvent:true,editable: false"/>
                                    </td>
                                </tr>
                                <tr id="guodu1">

                                    <th class="tdl" style="width:80px">过渡FH：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="tmpFh" name="tmpFh"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>
                                    <th class="tdl" style="width:80px">过渡FC：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="tmpFc" name="tmpFc"
                                               style="width:120px"
                                               data-options="validType:['positive']"/>
                                    </td>

                                    <th class="tdl" style="width:80px">过渡日历日：</th>
                                    <td class="tdr">
                                        <input class="easyui-textbox" id="tmpCal" name="tmpCal"
                                               style="width:80px"
                                               data-options="validType:['positive']"/>

                                        <input class="easyui-combobox" id="tmpCalUnit"
                                               name="tmpCalUnit"
                                               style="width:60px"
                                               data-options="editable: false"/>
                                    </td>
                                    <th class="tdl" style="width:100px">过渡监控方法：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="tmpIntervalRule"
                                               name="tmpIntervalRule" style="width:80px"
                                               data-options="editable: false"/>
                                    </td>
                                </tr>
                                <tr id="guodu3">

                                    <th class="tdl" style="width:80px">过渡级别(仅部件)：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="tempLevel" name="tempLevel"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>
                                    <th class="tdl" style="width:80px">过渡截止日期：</th>
                                    <td class="tdr">
                                        <input class="easyui-datebox" id="tempLimitDate" name="tempLimitDate"
                                               style="width:120px"
                                               data-options=""/>
                                    </td>
                                </tr>
                                <tr id="guodu2">
                                    <th class="tdl" style="width:100px">过渡要求：</th>
                                    <td class="tdr" colspan="3">
                                        <input class="easyui-textbox" name="tmpRequire" id="tmpRequire"
                                               data-options="multiline:true "
                                               style="height:60px; width:480px;"/>
                                    </td>
                                    <th class="tdl" style="width:100px">过渡对象：</th>
                                    <td class="tdr" colspan="5">
                                        <input class="easyui-textbox" name="tmpFleets" id="tmpFleets"
                                               data-options="multiline:true,editable:false,onlyview:true "
                                               style="height:60px; width:450px;"/>
                                    </td>
                                </tr>

                                <tr>
                                    <th class="tdl" style="width:90px">MARK信息：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" id="attachOption" name="attachOption"
                                               data-options="multiline:true,editable:false,onlyview:true"
                                               style="height:30px;width:1165px;"/>
                                        <!--<a id="xz" href="javascript:void(0)" class="easyui-linkbutton"-->
                                        <!--data-options="iconCls:'icon-add'"-->
                                        <!--onclick="addAttachOption()"><span>选择</span></a>-->
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:100px">备注：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" name="memo" id="memo"
                                               data-options="required:false,multiline:true "
                                               style="height:60px;width:1165px;"/>
                                    </td>
                                </tr>
                            </table>
                            <div id="zoneInfo">
                                <table id='zoneList' style="width:100%;height:200px">
                                </table>
                            </div>
                            <table id="dg"></table>

                        </fieldset>
                    </div>
                    <div id="div4">
                        <fieldset class="fieldset_eui" style="float:left;width:90%;height:230px; margin-right:5px">
                            <legend data-i18n="" id="intervalDgText">维修间隔--机身</legend>
                            <table cellspacing="0" cellpadding="2">
                            </table>
                            <table id="intervalDg"></table>
                        </fieldset>
                    </div>
                    <div id="div6">
                        <fieldset class="fieldset_eui" style="float:left;width:100%;height:230px; margin-right:5px">
                            <legend data-i18n="" id="applicabilityDgText">适用性--机身 <span1 color='red'>（多组适用性取合集）</span1></legend>
                            <table cellspacing="0" cellpadding="2">
                            </table>
                            <table id="applicabilityDg"></table>
                        </fieldset>
                    </div>
                    <div id="div7">
                        <fieldset class="fieldset_eui" style="float:left;width:100%;height:230px; margin-right:5px">
                            <legend data-i18n="">工卡关联关系</legend>
                            <table cellspacing="0" cellpadding="2">
                            </table>
                            <table id="jobCardDg"></table>
                        </fieldset>
                    </div>
                    <div id="tt" class="easyui-tabs" style="float:left;width:100%;height:300px;margin-right:5px">
                        <div title="替代项目" style="display:none;">
                            <table id="replaceItemDg"></table>
                        </div>
                        <div title="历史评估记录" style="display:none;">
                            <table class="table table-bordered table-info">

                            </table>
                            <table id="lspg"></table>
                        </div>
                    </div>
                </table>
                <table id="wholeTable"></table>
            </form>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<!--<script type="text/javascript" src="/js/common.js"></script>-->
<script type="text/javascript">
    var PAGE_DATA = {};
    var param;
    var isUdf, isEdit;
    var evalNo;
    var intervalDgFunctionCode;
    var applicabilityDgFunctionCode;
    var fleet;
    var revCode;
    var type;
    var isItemType;
    var isApplType = false;
    var modelType;//子机型
    var asmsPro;

    function i18nCallBack() {
        param = getParentParam_();
        evalNo = param.evalNo;
        type = param.type;
        $("#revCode").next().hide();
        InitFuncCodeRequest_({
            data: {
                domainCode: "EM_MPD_PGM,EM_MPD_REV_CODE,EM_MPD_EXECUTE_REQUIRE,EM_APL_INTERVAL_TYPE,EM_IF_APPL,EM_IF_REV_CMP,EM_APPL_TYPE,EM_MPD_ITEM_TYPE,EM_ENG_LOCATION,EM_MPD_CTL_TYPE,EM_MPD_IF_TMP,EM_MP_CALENDAR_UNIT,EM_INTERVAL_RULE," +
                "EM_MPD_CTL_TYPE_MONITOR,EM_CTL_TYPE_MONITOR,EM_RANGE_TYPE,EM_LIMIT_TYPE,EM_MPD_REPAIR_LEVAL,YESORNO,EM_MONITOR_STATUS",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $('#ifAgainEva').combobox({
                        panelHeight: '50px',
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        data: jdata.data.YESORNO
                    });
                    //执行要求
                    $('#executeRequire').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_MPD_EXECUTE_REQUIRE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //型号
                    // PAGE_DATA['acengModel'] = DomainCodeToMap_(jdata.data["DA_FLEET"]);
                    $('#repairLeval').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_MPD_REPAIR_LEVAL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //间隔类型
                    $('#monitorStatus').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_MONITOR_STATUS,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#limitType').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_LIMIT_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifAppl').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_IF_APPL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifRevCmp').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_IF_REV_CMP,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#applType').combobox({
                        panelHeight: '120px',
                        width: 120,
                        data: jdata.data.EM_APPL_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#itemType').combobox({
                        panelHeight: '120px',
                        width: 120,
                        data: jdata.data.EM_MPD_ITEM_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    // if (isEmpty(isEdit)) {
                    //     $('#applType').combobox("setValue", "APL");
                    // }
                    // $('#engLocation').combobox({
                    //     panelHeight: '100px',
                    //     data: jdata.data.EM_ENG_LOCATION,
                    //     valueField: 'VALUE',
                    //     textField: 'TEXT'
                    // });
                    $('#ctlType').combobox({
                        panelHeight: '100px',
                        data: jdata.data.EM_MPD_CTL_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ctlTypeMonitor').combobox({
                        panelHeight: '100px',
                        panelWidth: '120px',
                        data: jdata.data.EM_CTL_TYPE_MONITOR,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#ifTmp').combobox({
                        panelHeight: '100px',
                        data: jdata.data.EM_MPD_IF_TMP,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#tmpCalUnit').combobox({
                        panelHeight: '100px',
                        data: jdata.data.EM_MP_CALENDAR_UNIT,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#tmpIntervalRule').combobox({
                        panelHeight: '100px',
                        data: jdata.data.EM_INTERVAL_RULE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });

                    $('#ifMerge').combobox({
                        panelHeight: '100px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#tempLevel').combobox({
                        panelHeight: '100px',
                        data: jdata.data.EM_MPD_REPAIR_LEVAL,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#pgm').combobox({
                        panelHeight: '100px',
                        data: jdata.data.EM_MPD_PGM,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    //当状态为流程编辑时，隐藏提交流程和关闭按钮
                    if (type == "flowEdit") {
                        $("#submitFlow").hide();
                        $("#close").hide();
                    }
                    PAGE_DATA['intervalType'] = DomainCodeToMap_(jdata.data["EM_APL_INTERVAL_TYPE"]);
                    PAGE_DATA['rangeType'] = DomainCodeToMap_(jdata.data["EM_RANGE_TYPE"]);
                    PAGE_DATA['yesorno'] = DomainCodeToMap_(jdata.data["YESORNO"]);
                    PAGE_DATA['emMpdRevCode'] = DomainCodeToMap_(jdata.data["EM_MPD_REV_CODE"]);
                    $("#evalNo").val(evalNo);
                    // 初始化隐藏控件
                    $("#ctlTypeMonitorTh").hide();
                    $("#ctlTypeMonitorTd").hide();
                    $("#ctlTypeMonitor").combobox({required: false});
                    $("#limitTypeTh").hide();
                    $("#limitTypeTd").hide();
                    $("#limitType").combobox({required: false});
                    $("#ratioTh").hide();
                    $("#goCycleTd").hide();
                    $("#goCycle").textbox({required: false});
                    $("#normalCycle").textbox({required: false});
                    //隐藏修理级别
                    $("#repairLevalTh").hide();
                    $("#repairLevalTd").hide();
                    $("#repairLeval").combobox({required: false});
                    //隐藏执行要求
                    $("#executeRequireTh").hide();
                    $("#executeRequireTd").hide();
                    $("#executeRequire").combobox({required: false});
                    //隐藏间隔类型
                    $("#monitorStatusTh").hide();
                    $("#monitorStatusTd").hide();
                    $("#monitorStatus").combobox({required: false});
                    //设置需要过渡为否，并且禁用相关控件
                    // $('#ifTmp').combobox('setValue', 'N');
                    //changeFormatForGuodu();
                    InitDataForm();
                    //维修间隔表格初始化
                    intervalDgFunctionCode = "EM_MPD_EVAL_INTERVAL_APL_LIST";
                    InitIntervalDgGrid();
                    //适用性表格初始化
                    applicabilityDgFunctionCode = "EM_MPD_EVAL_APPLIC_APL_LIST";
                    InitApplicabilityDgGrid();
                    //关联关系表格初始化
                    InitJobCardDgGrid();
                    //初始化评估历史
                    InitDataGrid5();
                    //项目差异超链接
                    listPreview();

                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
        queryAsmsConfigUrl(); //查询ASMS地址
        initZoneList(); //区域信息
        getSelectZoneList(evalNo, "MP");
        changeZone();

    }

    function listPreview() {
        InitFuncCodeRequest_({
            data: {evalNo: evalNo, FunctionCode: "EM_MPD_PREVIEW_SOURCE"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    var html = "";
                    for (var i = 0; i < jdata.data.length; i++) {
                        html += '<a href="javascript:void(0)" onclick="chakan(\''+jdata.data[i].TYPE+"\','" + jdata.data[i].SOURCE_NO + '\')" style="width:100px"> ' + jdata.data[i].SOURCE_NO + '</a>';
                    }
                    document.getElementById("preview").innerHTML = html;
                }
            }
        });
    }
    function changeLimitType() {
        var applType = $('#applType').combobox('getValue');
        var limitType = $('#limitType').combobox('getValue');
        if (applType == "PART" && limitType == "LLP") {
            $("#ratioTh").show();
            $("#goCycleTd").show();
        } else {
            $("#ratioTh").hide();
            $("#goCycleTd").hide();
            // $("#goCycle").textbox("setValue", '');
            // $("#normalCycle").textbox("setValue", '');
        }
    }

    //维修间隔
    function InitIntervalDgGrid() {
        $("#intervalDg").MyDataGrid({
            identity: 'intervalDg',
            sortable: true,
            singleSelect: true,
            pageSize: 15,
            queryParams: {evalNo: evalNo},
            pagination: false,
            resize: function () {
                return tabs_standard_resize($('#tt'), 0.10, 0.01, 10, -6);
            },
            columns: {
                param: {FunctionCode: "EM_MPD_EVAL_INTERVAL_APL_LIST"},
                alter: {
                    INTERVAL_TYPE: {
                        formatter: function (value) {
                            return PAGE_DATA['intervalType'][value];
                        }
                    }
                }
            },
            onLoadSuccess: function () {

            },
            // validAuth: function (row, items) {
            //     items['编辑'].enable = true;
            //     items['删除'].enable = true;
            //     return items;
            // },
            contextMenus: [
                // {
                //     id: "m-edit",
                //     i18nText: "编辑",
                //     onclick: function () {
                //         var rowData = getDG('intervalDg').datagrid('getSelected');
                //         if (!rowData.PKID) {
                //             MsgAlert({content: "请选择数据！", type: 'error'});
                //             return;
                //         }
                //         addInteval('edit', rowData.PKID);
                //     }
                // },
                // {
                //     id: "",
                //     i18nText: "删除",
                //     onclick: function () {
                //         var rowData = getDG('intervalDg').datagrid('getSelected');
                //         if (!rowData.PKID) {
                //             MsgAlert({content: "请选择数据！", type: 'error'});
                //             return;
                //         }
                //         if (confirm("是否确认删除？")) {
                //             InitFuncCodeRequest_({
                //                 data: {FunctionCode: 'EM_MPD_INTERVAL_DELETE', pkid: rowData.PKID},
                //                 successCallBack: function (jdata) {
                //                     if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                //                         MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                //                         reloadg2_();
                //                     }
                //                 }
                //             });
                //         }
                //     }
                // }
            ],
            // toolbar: [{
            //     id: 'btnAdd',
            //     text: $.i18n.t('增加'),
            //     iconCls: 'icon-add',
            //     handler: function () {
            //         addInteval('add', '');
            //     }
            // }],
            onClickRow: function (rowIndex, rowData) {
            },
            onDblClickRow: function (index, field, value) {
                addInteval('view', value.PKID);
            }
        });
    }

    //适用性
    function InitApplicabilityDgGrid() {
        $("#applicabilityDg").MyDataGrid({
            identity: 'applicabilityDg',
            sortable: true,
            singleSelect: true,
            pagination: false,
            resize: function () {
                return tabs_standard_resize($('#tt'), 0.10, 0.01, 10, -6);
            },
            queryParams: {evalNo: evalNo},
            pageSize: 15,
            columns: {
                param: {FunctionCode: "EM_MPD_EVAL_APPLIC_APL_LIST"},
                alter: {
                    RANGE_TYPE: {
                        formatter: function (value) {
                            return PAGE_DATA['rangeType'][value];
                        }
                    }
                }
            },
            onLoadSuccess: function () {
            },
            validAuth: function (row, items) {
            },
            contextMenus: [
                // {
                //     id: "m-edit",
                //     i18nText: "编辑",
                //     onclick: function () {
                //         var rowData = getDG('applicabilityDg').datagrid('getSelected');
                //         if (!rowData.PKID) {
                //             MsgAlert({content: "请选择数据！", type: 'error'});
                //             return;
                //         }
                //         editApplic('edit', rowData.RANGE_TYPE, rowData.PKID);
                //     }
                // },
                // {
                //     id: "",
                //     i18nText: "删除",
                //     onclick: function () {
                //         var rowData = getDG('applicabilityDg').datagrid('getSelected');
                //         if (!rowData.PKID) {
                //             MsgAlert({content: "请选择数据！", type: 'error'});
                //             return;
                //         }
                //         if (confirm("是否确认删除？")) {
                //             InitFuncCodeRequest_({
                //                 data: {FunctionCode: 'EM_MPD_EVAL_APPLIC_DEL', pkid: rowData.PKID},
                //                 successCallBack: function (jdata) {
                //                     if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                //                         MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                //                         reloadg3();
                //                     }
                //                 }
                //             });
                //         }
                //     }
                // }
            ],
            toolbar: [
                //     {
                //     id: 'btnAdd',
                //     text: $.i18n.t('增加'),
                //     iconCls: 'icon-add',
                //     handler: function () {
                //         addApplic('add', '');
                //     }
                // },
                {
                    id: 'btnView',
                    text: $.i18n.t('适用性预计算'),
                    iconCls: 'icon-edit',
                    handler: function () {
                        viewAppl();
                    }
                },
                {
                    id: 'btnView2',
                    text: $.i18n.t('当前条目适用性查看'),
                    iconCls: 'icon-edit',
                    handler: function () {
                        viewApplCurrent();
                    }
                }
            ],
            onClickRow: function (rowIndex, rowData) {
            },
            onDblClickRow: function (index, field, value) {
                editApplic('view', value.RANGE_TYPE, value.PKID);
            }
        });
    }

    var isDisable = true;
    //工卡关联关系
    function InitJobCardDgGrid() {
        $("#jobCardDg").MyDataGrid({
            identity: 'jobCardDg',
            sortable: true,
            singleSelect: true,
            // enableLineEdit: true,
            // enableCellEdit: true,
            pagination: false,
            resize: function () {
                return tabs_standard_resize($('#tt'), 0.10, 0.01, 10, -6);
            },
            queryParams: {evalNo: evalNo},
            pageSize: 15,
            columns: {
                param: {FunctionCode: 'EM_MPD_JOB_CARD_LIST'},
                alter: {
                    CARD_NO: {
                        editor: {
                            type: 'textbox',
                        }
                    },
                    IF_BX: {
                        formatter: function (value) {
                            return PAGE_DATA['yesorno'][value];
                        }
                    },
                    REV_CODE: {
                        formatter: function (value, row, index) {
                            return PAGE_DATA['emMpdRevCode'][value];
                        }
                    }
                }
            },
            onLoadSuccess: function (data) {
            },
            validAuth: function (row, items) {
                //启用D ->N
                // if (row.REV_CODE == "D") {
                //     items['取消禁用'].enable = true;
                // } else {
                //     items['取消禁用'].enable = false;
                // }
                // if (row.REV_CODE == "U" || row.REV_CODE == undefined) {
                //     items['禁用'].enable = true;
                // } else {
                //     items['禁用'].enable = false;
                // }
                // if (row.REV_CODE == "N") {
                //     items['删除'].enable = true;
                // } else {
                //     items['删除'].enable = false;
                // }
                // return items;
            },
            onBeginEdit: function (index, row) {
                // if (row.REV_CODE != "N" && row.REV_CODE != undefined) {
                //     isDisable = true;
                //     var ed1 = getDG('jobCardDg').datagrid('getEditor', {index: index, field: 'CARD_NO'});
                //     $(ed1.target).textbox({editable: false, onlyview: true, required: false});
                // } else {
                //     isDisable = false;
                // }

            },
            onEndEdit: function (index, row, changes) {
                // if (!isDisable) {
                //     editDate(index, row, changes);
                // }
                // if (row.REV_CODE != "N" && row.REV_CODE != undefined) {
                //     // MsgAlert({content: '', type: 'error'});
                // }else{
                //     editDate(index, row, changes);
                // }

            },
            contextMenus: [
                //     {
                //     id: "m-start", i18nText: "取消禁用", auth: "",
                //     onclick: function () {
                //         var row = $('#jobCardDg').datagrid('getSelected');
                //         var rowIndex = $('#jobCardDg').datagrid('getRowIndex', row);
                //         revCode = "U";
                //         InitFuncCodeRequest_({
                //             data: {
                //                 pkid: row.PKID,
                //                 revCode: revCode,
                //                 FunctionCode: 'EM_MPD_JOB_CARD_REV_CODE'
                //             },
                //             successCallBack: function (jdata) {
                //                 if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                //                     MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                //                     reloadg4();
                //                     // i18nCallBack();
                //                 } else {
                //                     MsgAlert({content: jdata.msg, type: 'error'});
                //                 }
                //             }
                //         });
                //     }
                // }, {
                //     id: "m-delete", i18nText: "禁用", auth: "",
                //     onclick: function () {
                //         var row = $('#jobCardDg').datagrid('getSelected');
                //         var rowIndex = $('#jobCardDg').datagrid('getRowIndex', row);
                //         revCode = "D";
                //         InitFuncCodeRequest_({
                //             data: {
                //                 pkid: row.PKID,
                //                 revCode: revCode,
                //                 FunctionCode: 'EM_MPD_JOB_CARD_REV_CODE'
                //             },
                //             successCallBack: function (jdata) {
                //                 if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                //                     MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                //                     reloadg4();
                //                     // i18nCallBack();
                //                 } else {
                //                     MsgAlert({content: jdata.msg, type: 'error'});
                //                 }
                //             }
                //         });
                //     }
                // }, {
                //     id: "m-delete", i18nText: "删除", auth: "",
                //     onclick: function () {
                //         var row = $('#jobCardDg').datagrid('getSelected');
                //         var rowIndex = $('#jobCardDg').datagrid('getRowIndex', row);
                //         if (!row.PKID) {
                //             //如果没有保存，直接在datagrid移除该行
                //             $('#jobCardDg').datagrid('deleteRow', rowIndex);
                //         } else {
                //             InitFuncCodeRequest_({
                //                 data: {
                //                     pkid: row.PKID,
                //                     FunctionCode: 'EM_MPD_JOB_CARD_DEL'
                //                 },
                //                 successCallBack: function (jdata) {
                //                     if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                //                         $('#jobCardDg').datagrid('deleteRow', rowIndex);
                //                         MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                //                         // reload_();
                //                         // i18nCallBack();
                //                     } else {
                //                         MsgAlert({content: jdata.msg, type: 'error'});
                //                     }
                //                 }
                //             });
                //         }
                //     }
                // }
            ],
            // toolbar: [{
            //     id: 'btnAdd',
            //     text: $.i18n.t('增加'),
            //     iconCls: 'icon-add',
            //     handler: function () {
            //         addDatagridRow('add');
            //     }
            // },],
            onClickRow: function (rowIndex, rowData) {
            },
            onDblClickRow: function (index, field, value) {
                // openDetai("view", value.PKID);
            }
        });
    }

    //行编辑事件
    function editDate(index, row, changes) {
        row = toCamelCase(row);
        if (row.cardNo != "") {
            var url = $.extend({}, {evalNo: evalNo}, row, {FunctionCode: 'EM_MPD_JOB_CARD_SAVE'});
            InitFuncCodeRequest_({
                data: url,
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                        reloadg4();
                    }
                }
            });
        }

    }
    //是否适用  判断修订标识并提示
    function changeIfAppl() {
        //是否适用
        var d1 = $('#ifAppl').combobox('getValue');
        //是否修订MP
        var d2 = $('#ifRevCmp').combobox('getValue');
        if (d1 != "Y") {
            //去掉必填项
            /* $("#div2 [textboxname]").each(function (k, it) {
                 if ($(it).hasClass("combobox-f")) {
                     $(it).combobox({required: false});
                 } else if ($(it).hasClass("textbox-f")) {
                     $(it).textbox({required: false});
                 } else {
                     $(it).datetimebox({required: false});
                 }
             });*/
            //隐藏id为div2 的div
            $("#div2").hide();//CMP信息
            // $("#div3").hide();//部件信息--部件
            $("#div4").hide();//维修间隔--机身
            $("#div6").hide();
            // $("#div7").hide();//工卡关联关系
            //设置是否修订MP为否，并禁用

            // $("#ifRevCmp").combobox({editable: false, onlyview: true});
            // $("#ifRevCmp").combobox("setValue", "N");
            //设置需要过渡为否，并且禁用相关控件
            //$('#ifTmp').combobox('setValue', 'N');
            changeFormatForGuodu();
            // $("#ifMerge").combobox("setValue", "N");
        }
        if (d1 == "Y") {

            $("#ifRevCmp").combobox({editable: true, onlyview: false});
            d2 = $('#ifRevCmp').combobox('getValue');
            if (d2 == "Y") {
                /*$("#div2 [textboxname]").each(function (k, it) {
                    if ($(it).hasClass("combobox-f")) {
                        $(it).combobox({required: true, editable: true, onlyview: false});
                    } else if ($(it).hasClass("textbox-f")) {
                        $(it).textbox({required: true, editable: true, onlyview: false});
                    } else {
                        $(it).datetimebox({required: true, editable: true, onlyview: false});
                    }
                });*/
                //设置需要过渡为否，并且禁用相关控件
                //$('#ifTmp').combobox('setValue', 'N');
                changeFormatForGuodu();
                $('#enTaskDesc').textbox({editable: true, onlyview: false, required: false});
            }
            // $("#ifRevCmp").combobox("setValue","N");
            $("#div2").show();
            $("#div4").show();//维修间隔--机身
            $("#div6").show();
            // $("#div7").show();//工卡关联关系
            // InitIntervalDgGrid();
            //$("#intervalDg").datagrid("reload");
            //$("#applicabilityDg").datagrid("reload");
            // InitApplicabilityDgGrid();
            InitJobCardDgGrid();
        }
        $('#attachOption').textbox({editable: false, onlyview: true, required: false});
        $('#chTaskDesc').textbox({editable: true, onlyview: false, required: false});
        $('#sources').textbox({editable: false, onlyview: true, required: false});
        $('#memo').textbox({required: false});
        //changeFormatForGuodu();//为了触发回填需求过渡条目
    }

    //是否修订MP
    function changeIfRevCmp() {
        //修订mp
        var d1 = $('#ifRevCmp').combobox('getValue');
        //是否适用
        var d2 = $('#ifAppl').combobox('getValue');
        if (d2 == "Y") {
            if (d1 == "N") {
                $("#div2 [textboxname]").each(function (k, it) {
                    /* if ($(it).hasClass("combobox-f")) {
                         $(it).combobox({required: false, editable: false, onlyview: true});
                     } else if ($(it).hasClass("textbox-f")) {
                         $(it).textbox({required: false, editable: false, onlyview: true});
                     }*/
                    // else {
                    //     $(it).datetimebox({required: false, editable: false, onlyview: true});
                    // }
                });

            }
            if (d1 == "Y") {
                $("#div2 [textboxname]").each(function (k, it) {
                    /* if ($(it).hasClass("combobox-f")) {
                         $(it).combobox({required: true, editable: true, onlyview: false});
                     } else if ($(it).hasClass("textbox-f")) {
                         $(it).textbox({required: true, editable: true, onlyview: false});
                     }*/
                    // else {
                    //     $(it).datetimebox({required: true, editable: true, onlyview: false});
                    // }
                });
                //$("#engLocation").combobox({required: false});
                $("#cat").textbox({required: false});
                $("#zone").textbox({required: false});
                $("#pgm").combobox({required: false});
                $("#accesses").textbox({required: false});
                $("#manHours").textbox({required: false});
                $("#taskCode").textbox({required: false});
                $("#goCycle").textbox({required: false});
                $("#normalCycle").textbox({required: false});
                $("#limitType").combobox({required: false});
                $("#repairLeval").combobox({required: false});
                $("#executeRequire").combobox({required: false});
                $("#monitorStatus").combobox({required: false});
                changeZone();
                // $('#enTaskDesc').textbox({editable: true, onlyview: false, required: false});
            }

        } else {
            $("#div2 [textboxname]").each(function (k, it) {
                /*if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: false, editable: false, onlyview: true});
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false, editable: false, onlyview: true});
                }*/
                // else {
                //     $(it).datetimebox({required: false, editable: false, onlyview: true});
                // }
            });

        }
        //设置需要过渡为否，并且禁用相关控件
        //$('#ifTmp').combobox('setValue', 'N');
        changeFormatForGuodu();
        $('#attachOption').textbox({editable: false, onlyview: true, required: false});
        // $('#chTaskDesc').textbox({editable: true, onlyview: false, required: false});
        $('#sources').textbox({editable: false, onlyview: true, required: false});
        $('#memo').textbox({required: false});
        //默认机身
        // if($('#applType').combobox("getValue")==""){
        //     $('#applType').combobox("setValue","APL");
        // }
    }

    var applType = {};

    //项目分类和适用性类型联动
    function changeItemType() {
        var type;
        var itemType = $('#itemType').combobox('getValue');
        // 项目分类为“系统”时，适用性类型只能选择“机身”，“发动机”；  B
        // 项目分类为“结构”、“区域”时，适用性类型只能选择“机身”  A
        // 项目分类为“CPCP”时，适用性类型只能选择“机身”； A
        // 项目分类为“部件”时，适用性类型只能选择“部件” D
        if (itemType == "1") {
            type = "B";
        } else if (itemType == "2" || itemType == "3") {
            type = "A";
        } else if (itemType == "4") {
            type = "A";
        } else if (itemType == "5") {
            type = "D";
        }

        InitFuncCodeRequest_({
            data: {mark: type, FunctionCode: "EM_APPL_DOMAIN_TYPE"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    applType = jdata.data;
                    $('#applType').combobox({
                        panelHeight: '100px',
                        data: applType,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        // onChange:changeApplType
                    });
                    var options = $("#itemType").combobox('options');
                    if (isItemType) {
                        options.stopFirstChangeEvent = false;
                    }
                    if (options.stopFirstChangeEvent) {
                        options.stopFirstChangeEvent = false;
                    } else {
                        if (isApplType) {
                            $("#applType").combobox('setValue', 'APL');
                            isApplType = false;
                        }
                        var appl = $("#applType").combobox('getValue');
                        // if (appl==""){
                        //     $("#applType").combobox('setValue','APL');
                        // }
                        // $("#applType").combobox('clear');
                        $("#applType").combobox('setValue', '');
                    }
                }
            }
        });


    }

    function changeApplType() {
        //处理控件初始化问题
        var options = $(this).combobox('options');
        if (options.stopFirstChangeEvent) {
            options.stopFirstChangeEvent = false;
            // return;
        } else {
            $.messager.confirm('', '切换类型将清空间隔和适用性数据', function (r) {
                if (r) {
                    //删除适用性和间隔数据
                    InitFuncCodeRequest_({
                        data: {evalNo: evalNo, FunctionCode: "EM_MPD_CHANGE_APPLTYPE"},
                        successCallBack: function (jdata) {
                            if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                changeApplType2();
                            }
                        }
                    });
                }
            });
        }

    }


    //适用性类型切换
    function changeApplType2() {

        var d5 = $('#applType').combobox('getValue');
        //部件
        if (d5 == "PART") {
            $("#div6").show();//显示适用性
            $("#intervalDgText").text(" 维修间隔--部件");
            $("#applicabilityDgText").html("适用性--部件 <span1 color='red'>（多组适用性取合集）</span1>");
            //维修间隔表格初始化
            intervalDgFunctionCode = "EM_MPD_EVAL_INTERVAL_PART_LIST";
            InitIntervalDgGrid();
            //$("#intervalDg").datagrid("reload");
            //适用性表格初始化
            InitApplicabilityDgGrid();
            //$("#applicabilityDg").datagrid("reload");
            //隐藏控制类型、监控航线类型
            $("#ctlTypeTh").hide();
            $("#ctlTypeTd").hide();
            $("#ctlType").combobox({required: false});
            $("#ctlTypeMonitorTh").hide();
            $("#ctlTypeMonitorTd").hide();
            $("#ctlTypeMonitor").combobox({required: false});
            //显示时限类型
            $("#limitTypeTh").show();
            $("#limitTypeTd").show();
            $("#limitType").combobox({required: true});
            //隐藏参考手册、发动机位置
            //$("#ammRefTh").hide();
            //$("#ammRefTd").hide();
            //$("#ammRef").textbox({required: false});
            //$("#engLocationTh").hide();
            //$("#engLocationTd").hide();
            //$("#engLocation").combobox({required: false});
            //隐藏过渡信息
            $("#guodu1").hide();
            $("#guodu2").hide();
            $("#guodu3").hide();
            //显示zone
            // $("#zoneTh").show();
            // $("#zoneTd").show();
            //显示修理级别
            $("#repairLevalTh").show();
            $("#repairLevalTd").show();
            $("#repairLeval").combobox({required: true});
            //显示执行要求
            $("#executeRequireTh").show();
            $("#executeRequireTd").show();
            $("#executeRequire").combobox({required: true});
            //显示间隔类型
            $("#monitorStatusTh").show();
            $("#monitorStatusTd").show();
            $("#monitorStatus").combobox({required: true});
            changeZone();
        }
        //发动机
        if (d5 == "ENG") {
            $("#div6").show();//显示适用性
            $("#intervalDgText").text(" 维修间隔--发动机");
            $("#applicabilityDgText").html("适用性--发动机 <span1 color='red'>（多组适用性取合集）</span1>");
            //维修间隔表格初始化
            intervalDgFunctionCode = "EM_MPD_EVAL_INTERVAL_ENG_LIST";
            InitIntervalDgGrid();
            // $("#intervalDg").datagrid("reload");
            //适用性表格初始化
            InitApplicabilityDgGrid();
            // $("#applicabilityDg").datagrid("reload");
            //显示zone
            // $("#zoneTh").show();
            // $("#zoneTd").show();
            //隐藏修理级别
            $("#repairLevalTh").hide();
            $("#repairLevalTd").hide();
            $("#repairLeval").combobox({required: false});
            //隐藏执行要求
            $("#executeRequireTh").hide();
            $("#executeRequireTd").hide();
            $("#executeRequire").combobox({required: false});
            //隐藏间隔类型
            $("#monitorStatusTh").hide();
            $("#monitorStatusTd").hide();
            $("#monitorStatus").combobox({required: false});
            //显示过渡信息
            $("#guodu1").show();
            $("#guodu2").show();
            $("#guodu3").show();
            //显示参考手册、发动机位置
            //$("#ammRefTh").show();
            //$("#ammRefTd").show();
            //$("#engLocationTh").show();
            //$("#engLocationTd").show();
            //隐藏时限类型、Engine LLP Ratio
            $('#limitType').combobox('setValue', '');
            $("#limitTypeTh").hide();
            $("#limitTypeTd").hide();
            $("#limitType").combobox({required: false});
            $("#ratioTh").hide();
            $("#goCycleTd").hide();
            $("#goCycle").textbox({required: false});
            $("#normalCycle").textbox({required: false});
            $("#goCycle").textbox("setValue", '');
            $("#normalCycle").textbox("setValue", '');
            //显示控制类型
            $("#ctlTypeTh").show();
            $("#ctlTypeTd").show();
            $("#ctlType").combobox({required: true});
            changeZone();
        }

        if (d5 == "APL") {
            $("#div6").show();//显示适用性
            $("#intervalDgText").text(" 维修间隔--机身");
            $("#applicabilityDgText").html("适用性--机身 <span1 color='red'>（多组适用性取合集）</span1>");
            //维修间隔表格初始化
            intervalDgFunctionCode = "EM_MPD_EVAL_INTERVAL_APL_LIST";
            InitIntervalDgGrid();
            //适用性表格初始化
            InitApplicabilityDgGrid();
            // $("#intervalDg").datagrid("reload");
            // $("#applicabilityDg").datagrid("reload");
            //显示zone
            // $("#zoneTh").show();
            // $("#zoneTd").show();
            //隐藏修理级别
            $("#repairLevalTh").hide();
            $("#repairLevalTd").hide();
            $("#repairLeval").combobox({required: false});
            //隐藏执行要求
            $("#executeRequireTh").hide();
            $("#executeRequireTd").hide();
            $("#executeRequire").combobox({required: false});
            //隐藏间隔类型
            $("#monitorStatusTh").hide();
            $("#monitorStatusTd").hide();
            $("#monitorStatus").combobox({required: false});
            //显示过渡信息
            $("#guodu1").show();
            $("#guodu2").show();
            $("#guodu3").show();
            //显示参考手册、发动机位置
            //$("#ammRefTh").show();
            //$("#ammRefTd").show();
            ///$("#engLocationTh").show();
            //$("#engLocationTd").show();
            // $("#engLocation").combobox({required:true});
            //隐藏时限类型、Engine LLP Ratio
            $('#limitType').combobox('setValue', '');
            $("#limitTypeTh").hide();
            $("#limitTypeTd").hide();
            $("#limitType").combobox({required: false});
            $("#ratioTh").hide();
            $("#goCycleTd").hide();
            $("#goCycle").textbox({required: false});
            $("#normalCycle").textbox({required: false});
            $("#goCycle").textbox("setValue", '');
            $("#normalCycle").textbox("setValue", '');
            //显示控制类型
            $("#ctlTypeTh").show();
            $("#ctlTypeTd").show();
            $("#ctlType").combobox({required: true});
            //设置监控航线
            $("#ctlTypeMonitor").combobox({required: false});
            changeZone();


        }
    }

    function changeZone() {

        var itemType = $('#itemType').combobox('getValue');
        if (itemType == "2" || itemType == "3" || itemType == "4") {
            $("#zoneTh").hide();
            $("#zoneTd").hide();
            $("#zoneBindTh").show();
            $("#zoneBindTd").show();
            // $("#subTypeTh").show();
            // $("#subTypeTd").show();
            getModel(evalNo);
        } else {
            $("#zoneBindTh").hide();
            $("#zoneBindTd").hide();
            // $("#subTypeTh").hide();
            // $("#subTypeTd").hide();
            $("#zoneTh").show();
            $("#zoneTd").show();
        }
    }

    // 查询ASMS配置地址
    function queryAsmsConfigUrl() {
        $.ajax({
            type: "get",
            url: "/modelProperty/queryAsmsConfigUrl",
            contentType: "application/json;charset=utf-8",
            async: false,
            success: function (rst) {
                if (rst.code === 200) {
                    asmsPro = rst.data;
                } else {
                    MsgAlert({content: result.msg, type: 'error'});
                }
            },
            error: function (result) {
                alert("获取ASMS根路径失败！");
            }
        });
    }

    function getModel(evaNO) {
        $.ajax({
            type: "get",
            url: "/api/v1/em/emMpdEval/queryModelSeriesByModel/" + evaNO,
            contentType: "application/json;charset=utf-8",
            async: false,
            success: function (result) {
                if (!result.data || result.data.length == 0) {
                    return;
                }
                var models = [];
                for (var i in  result.data) {
                    var model = {
                        "id": result.data[i],
                        "text": result.data[i]
                    };
                    models.push(model);
                }
                $('#subTypeId').combobox({
                    panelHeight: '150px',
                    valueField: 'id',
                    textField: 'text',
                    data: models,
                    onSelect: function (data) {
                        modelChange(data.id);
                        modelType = data.id;

                    }
                });
            },
            error: function (data) {
                MsgAlert({content: "字机型信息查询失败！", type: 'error'});
            }
        })
    }

    //查询已选择区域
    function getSelectZoneList(id, type) {
        $.ajax({
            type: "get",
            url: asmsPro + "/relation/zone/selectZoneInfoByBusinessId/" + id + '/' + type,
            contentType: "application/json;charset=utf-8",
            async: false,
            dataType: "json",
            success: function (data) {
                if (data.result.length) {
                    $("#zoneInfo").show();
                    $("#zoneList").datagrid("loadData", {rows: data.result});
                } else {
                    $("#zoneInfo").hide();
                }
            },
            error: function (data) {

            }
        })

    }

    function initZoneList() {
        $("#zoneList").datagrid({
            columns: [[
                {field: 'model', title: '机型', width: "100"},
                {field: 'subType', title: '子机型', width: "130"},
                {field: 'zoneFirst', title: '一级区域', width: "100"},
                {field: 'zoneSecond', title: '二级区域', width: "100"},
                {field: 'zoneThird', title: '三级区域', width: "100"},
                {field: 'remark', title: '备注', width: "150"},
            ]],
            rownumbers: true,
            singleSelect: true,
            // fitColumns:true,
            onLoadSuccess: function (data) {
            },

        })
    }


    //特殊控制要求和航线项目联动
    function changeCtlType() {
        var type;
        var ctlType = $('#ctlType').combobox('getValue');
        if (ctlType == "NONE") {
            //隐藏监控/航线类型
            $("#ctlTypeMonitorTh").hide();
            $("#ctlTypeMonitorTd").hide();
            $("#ctlTypeMonitor").combobox({required: false, multiple: true});
        } else if (ctlType == "MON") {
            $("#ctlTypeMonitorTh").show();
            $("#ctlTypeMonitorTd").show();
            $("#ctlTypeMonitor").combobox({required: true, multiple: true});
            type = "A";
            $("#ctlTypeMonitorTh").text("机会类型")
//     机会检如果控制类型选择为【监控项目】时，需要指定机会检类型。
        } else if (ctlType == "LINE") {
            $("#ctlTypeMonitorTh").show();
            $("#ctlTypeMonitorTd").show();
            $("#ctlTypeMonitor").combobox({required: true, multiple: true});
            // 如果控制类型为【航线项目】时，需要指定【航线类型（航前、航后、短停）】
            type = "B";
            $("#ctlTypeMonitorTh").text("航线类型")
        }
        InitFuncCodeRequest_({
            data: {mark: type, FunctionCode: "EM_CTL_TYPE_MONITOR_DOMAIN"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    applType = jdata.data;
                    $('#ctlTypeMonitor').combobox({
                        panelHeight: '100px',
                        panelWidth: '120px',
                        data: applType,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    // $("#ctlTypeMonitor").combobox('clear');
                }
            }
        });
    }
    //是否需要过渡
    function changeFormatForGuodu() {
        //已取消
        var ifTmp = $('#ifTmp').combobox('getValue');
        if (ifTmp == "Y") {
            $("#guodu1").show();
            $("#guodu2").show();
            $("#guodu3").show();
            $('#tmpCalUnit').combobox({onlyview: false, required: false});
            $('#tmpFh').textbox({editable: true, onlyview: false, required: false});
            $('#tmpFc').textbox({editable: true, onlyview: false, required: false});
            $('#tmpCal').textbox({editable: true, onlyview: false, required: false});
            $('#tmpIntervalRule').combobox({onlyview: false, required: false});
            $('#tmpRequire').textbox({editable: true, onlyview: false, required: false});
            $('#tmpFleets').textbox({editable: false, onlyview: true, required: false});
            $('#tempLevel').combobox({editable: true, onlyview: false, required: false});
            $('#tempLimitDate').datebox({editable: true, onlyview: false, required: false});
        } else {
            $('#tmpCalUnit').combobox({onlyview: true, required: false, value: ''});
            $('#tmpFh').textbox({editable: false, onlyview: true, required: false, value: ''});
            $('#tmpFc').textbox({editable: false, onlyview: true, required: false, value: ''});
            $('#tmpCal').textbox({editable: false, onlyview: true, required: false, value: ''});
            $('#tmpIntervalRule').combobox({editable: false, onlyview: true, required: false, value: ''});
            $('#tmpRequire').textbox({editable: false, onlyview: true, required: false, value: ''});
            $('#tmpFleets').textbox({editable: false, onlyview: true, required: false});
            $('#tempLevel').combobox({editable: false, onlyview: true, required: false});
            $('#tempLimitDate').datebox({editable: false, onlyview: true, required: false});
            $("#guodu1").hide();
            $("#guodu2").hide();
            $("#guodu3").hide();
            $('#tmpFleets').textbox("setValue", "");


        }
    }

    //增加间隔
    function addInteval(type, pkid) {
        //判断是否修订mp
        var ifRevCmp = $('#ifRevCmp').combobox('getValue');
        if (ifRevCmp == "N") {
            return;
        }

        evalNo = $("#evalNo").val();
        fleet = $("#fleet").val();
        var applType = $('#applType').combobox('getValue');
        if (applType == "") {
            MsgAlert({content: '请先选择适用性类型', type: 'error'});
        }

        if (applType == "APL") {
            var ctlType = $('#ctlType').combobox('getValue');
            if (ctlType == "LINE" || ctlType == "NONE") {
                MsgAlert({content: '控制类型为航线和无需控制不可添加间隔信息', type: 'error'});
                return;
            }
            //获取控制类型
            ShowWindowIframe({
                width: 1050,
                height: 730,
                param: {evalNo: evalNo, fleet: fleet, type: type, appltype: applType, Add: "1", pkid: pkid},
                title: "间隔增加",
                url: "/views/em/emmpdeval/interval/addAplInterval.shtml"
            });
        }
        if (applType == "ENG") {
            ShowWindowIframe({
                width: 1050,
                height: 730,
                param: {evalNo: evalNo, fleet: fleet, type: type, appltype: applType, Add: "1", pkid: pkid},
                title: "间隔增加",
                url: "/views/em/emmpdeval/interval/addEngInterval.shtml"
            });
        }
        if (applType == "PART") {
            ShowWindowIframe({
                width: 1050,
                height: 660,
                param: {evalNo: evalNo, fleet: fleet, type: type, appltype: applType, Add: "1", pkid: pkid},
                title: "间隔增加",
                url: "/views/em/emmpdeval/interval/addPartInterval.shtml"
            });
        }
    }

    //增加适用性
    function addApplic(type, editType) {
        //判断是否修订mp
        var ifRevCmp = $('#ifRevCmp').combobox('getValue');
        if (ifRevCmp == "N") {
            return;
        }
        evalNo = $("#evalNo").val();
        fleet = $("#fleet").val();
        var applType = $('#applType').combobox('getValue');

        ShowWindowIframe({
            width: 810,
            height: 670,
            param: {evalNo: evalNo, type: type, applType: applType, fleet: fleet},
            title: "增加适用性",
            url: "/views/em/emmpdeval/applic/addAllApplic.shtml"
        });
    }

    //增加适用性
    function editApplic(type, rangeType, pkid) {
        //判断是否修订mp
        var ifRevCmp = $('#ifRevCmp').combobox('getValue');
        if (ifRevCmp == "N") {
            return;
        }
        evalNo = $("#evalNo").val();
        fleet = $("#fleet").val();
        var applType = $('#applType').combobox('getValue');
        if (rangeType == 'ALL') {
            ShowWindowIframe({
                width: 810,
                height: 670,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addAllApplic.shtml"
            });
        } else if (rangeType == 'DESC') {
            ShowWindowIframe({
                width: 670,
                height: 600,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addDescApplic.shtml"
            });
        } else if (rangeType == 'PRE' || rangeType == 'POST') {
            ShowWindowIframe({
                width: 670,
                height: 600,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addPostApplic.shtml"
            });
        } else if (rangeType == 'PN') {
            ShowWindowIframe({
                width: 880,
                height: 630,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addPnApplic.shtml"
            });
        } else if (rangeType == 'SN') {
            ShowWindowIframe({
                width: 880,
                height: 630,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addSnApplic.shtml"
            });
        } else if (rangeType == 'ENGSERI') {
            ShowWindowIframe({
                width: 880,
                height: 630,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addEngSeriApplic.shtml"
            });
        } else if (rangeType == 'LINENO') {
            ShowWindowIframe({
                width: 670,
                height: 600,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addLineNoApplic.shtml"
            });
        } else if (rangeType == 'SYS') {
            ShowWindowIframe({
                width: 820,
                height: 600,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addConfigApplic.shtml"
            });
        }
        else {
            ShowWindowIframe({
                width: 420,
                height: 600,
                param: {evalNo: evalNo, type: type, pkid: pkid, applType: applType, fleet: fleet},
                title: "增加适用性",
                url: "/views/em/emmpdeval/applic/addFleetApplic.shtml"
            });
        }

    }

    function addAttachOption() {
        var attachOption = $("#attachOption").val();
        ShowWindowIframe({
            width: 500,
            height: 600,
            param: {attachOption: attachOption, evalNo: evalNo},
            title: "MARK信息",
            url: "/views/em/emmpdeval/emMpdAttachOption.shtml"
        });
    }

    function addSource() {
        fleet = $("#fleet").val();
        ShowWindowIframe({
            width: 880,
            height: 600,
            param: {fleet: fleet, evalNo: evalNo},
            title: "Source信息",
            url: "/views/em/emmpdeval/emMpdSource.shtml"
        });
    }

    function refreshAttachOption(attachOptions) {
        $("#attachOption").textbox({value: attachOptions});
    }

    function refreshAcnos(acnos) {
        $("#tmpFleets").textbox({value: acnos});
    }

    function refreshSources(sources) {
        $("#sources").textbox({value: sources});
    }
    //工卡新增
    function addDatagridRow() {
        //判断是否修订mp
        var ifRevCmp = $('#ifRevCmp').combobox('getValue');
        if (ifRevCmp == "N") {
            return;
        }
        $('#jobCardDg').datagrid('appendRow', {REV_CODE: 'N'});
    }

    //保存
    function save() {
        var $form = $("#mform");
        var isValidate = $form.form('validate');
        if (!isValidate) {
            return false;
        }
        var mainData = JSON.stringify($('#mform').serializeObject());
        //校验编号唯一性
        var evalNo = $("#evalNo").val();
        var cmpNo = $("#cmpNo").textbox("getValue");
        InitFuncCodeRequest_({
            data: {
                evalNo: evalNo,
                cmpNo: cmpNo,
                FunctionCode: "EM_MPD_EVAL_CMP_NO_UNIQUE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if (jdata.data.length != 0) {
                        MsgAlert({content: '已存在该mp编号！', type: 'error'});

                    } else {
                        InitFuncCodeRequest_({
                            data: {
                                mainData: mainData,
                                FunctionCode: "EM_MPD_EVAL_SAVE"
                            },
                            successCallBack: function (jdata) {
                                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                                    // InitDataForm();
                                    InitDataGrid5();
                                    param.OWindow.reload_();
                                } else {
                                    MsgAlert({content: jdata.msg, type: 'error'});
                                }
                            }
                        });
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }

    //间隔
    function reloadg2_() {
        $("#intervalDg").datagrid("reload");
    }

    // 适用性
    function reloadg3() {
        $("#applicabilityDg").datagrid("reload");
    }

    // 工卡关联关系
    function reloadg4() {
        $("#jobCardDg").datagrid("reload");
    }

    function reloadFrom() {
        InitDataForm();
    }
    function InitDataForm() {
        InitFuncCodeRequest_({
            data: {evalNo: evalNo, FunctionCode: "EM_MPD_EVAL_PKID"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $("#div1 [textboxname]").each(function (k, it) {
                        if ($(it).hasClass("combobox-f")) {
                            $(it).combobox({required: false, editable: false, onlyview: true});
                        } else if ($(it).hasClass("textbox-f")) {
                            $(it).textbox({required: false, editable: false, onlyview: true});
                        } else {
                            $(it).datetimebox({required: false, editable: false, onlyview: true});
                        }
                    });
                    $("#div2 [textboxname]").each(function (k, it) {
                        if ($(it).hasClass("combobox-f")) {
                            $(it).combobox({required: false, editable: false, onlyview: true});
                        } else if ($(it).hasClass("textbox-f")) {
                            $(it).textbox({required: false, editable: false, onlyview: true});
                        } else {
                            $(it).datetimebox({required: false, editable: false, onlyview: true});
                        }
                    });
                    // $('#attachOption').textbox({editable: false, onlyview: true, required: false});
                    // $('#chTaskDesc').textbox({editable: true, onlyview: false, required: false});
                    if (jdata.data) {

                        ParseFormField_(jdata.data, null, Constant.CAMEL_CASE);
                        if (jdata.data.ITEM_TYPE == undefined) {
                            isItemType = true;
                        }
                        if (jdata.data.APPL_TYPE == undefined) {
                            isApplType = true;
                        }
                        // itemNumber = jdata.data.ITEM_NUMBER;
                        $("#revCode1").textbox('setValue', jdata.data.REV_CODE == "N" ? "新增" : (jdata.data.REV_CODE == 'R' ? "改版" : "失效"));
                        $('#itemNumber2').text(jdata.data.ITEM_NUMBER);
                        //项目分类
                        $('#itemType').combobox({value: jdata.data.ITEM_TYPE});
                        $('#applType').combobox({value: jdata.data.APPL_TYPE});
                        $('#ifAppl').combobox({value: jdata.data.IF_APPL});
                        $('#ifRevCmp').combobox({value: jdata.data.IF_REV_CMP});
                        $('#pgm').combobox({value: jdata.data.PGM});
                        if(null != jdata.data.ZONE  &&  jdata.data.ZONE != "" ){
                            $('#zoneBind').combotree('setValues',jdata.data.ZONE);
                        }                        //监控/航线类型
                        $('#ctlTypeMonitor').combobox({value: jdata.data.CTL_TYPE_MONITOR});
                        changeIfAppl();
                        changeIfRevCmp();
                        changeApplType2();
                        $('#monitorStatus').combobox({value: jdata.data.MONITOR_STATUS});
                        $('#ctlType').combobox({value: jdata.data.CTL_TYPE});
                        //$('#engLocation').combobox({value: jdata.data.ENG_LOCATION});
                        $('#limitType').combobox({value: jdata.data.LIMIT_TYPE});
                        changeLimitType();
                        $('#repairLeval').combobox({value: jdata.data.REPAIR_LEVAL});
                        $('#executeRequire').combobox({value: jdata.data.EXECUTE_REQUIRE});
                        $('#ifTmp').combobox({value: jdata.data.IF_TMP});
                        $('#ifMerge').combobox({value: jdata.data.IF_MERGE});
                        //设置是否需要过渡
                        setTmpData(jdata.data);
                        changeFormatForGuodu();

                        //初始化替代项目
                        InitDataGrid6();
                        var again = $("#ifAgainEva").combobox('getValue');
                        againChange(again);
                    }
                }
            }
        });
    }

    function setTmpData(data) {
        if (data.IF_TMP == "Y") {
            $('#tmpCalUnit').combobox({editable: true, onlyview: false, required: true});
            $('#tmpFh').textbox({editable: true, onlyview: false, required: true});
            $('#tmpFc').textbox({editable: true, onlyview: false, required: true});
            $('#tmpCal').textbox({editable: true, onlyview: false, required: true});
            $('#tmpIntervalRule').combobox({editable: true, onlyview: false, required: true});
            $('#tmpRequire').textbox({editable: true, onlyview: false, required: true});
            $('#tmpFleets').textbox({editable: false, onlyview: true, required: false});

            $('#ifTmp').combobox({value: data.IF_TMP});
            $('#tmpCalUnit').combobox({value: data.TMP_CAL_UNIT});
            $('#tmpFh').textbox({value: data.TMP_FH});
            $('#tmpFc').textbox({value: data.TMP_FC});
            $('#tmpCal').textbox({value: data.TMP_CAL});
            $('#tmpIntervalRule').combobox({value: data.TMP_INTERVAL_RULE});
            $('#tmpRequire').textbox({value: data.TMP_REQUIRE});
            $('#tmpFleets').textbox({value: data.TMP_FLEETS});
            $('#tempLevel').combobox({value: data.TEMP_LEVEL});
            $('#tempLimitDate').datebox({value: data.TEMP_LIMIT_DATE});
        }
    }

    function checkIfAppl() {
        var $form = $("#mform");
        var isValidate = $form.form('validate');
        if (!isValidate) {
            return false;
        }
        //获取是否适用
        var ifAppl = $("#ifAppl").combobox("getValue");
        var fleet = $("#fleet").val();
        var cmpNo = $("#cmpNo").textbox("getValue");
        var mainData = JSON.stringify($('#mform').serializeObject());
        if (ifAppl != "Y") {
            //判断是否有上一版
            InitFuncCodeRequest_({
                data: {
                    cmpNo: cmpNo,
                    fleet: fleet,
                    evalNo: evalNo,
                    FunctionCode: "EM_MPD_EVAL_CHECK_REV_UNIQUE"
                },
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        if (jdata.data.length != 0) {
                            //判断是否有上一版（CMP 机型 并且适用）  提醒所有的工卡标识将改为D
                            $.messager.confirm('', '继续将会修改工卡标识，是否继续？', function (r) {
                                if (r) {
                                    //将工卡标识改为D
                                    datas = $.extend({}, {}, {
                                        FunctionCode: 'EM_MPD_UPDATE_JOB_CARD_REVCODE',
                                        evalNo: evalNo
                                    });
                                    InitFuncCodeRequest_({
                                        data: datas, successCallBack: function (jdata) {
                                            if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                                ifApproval();
                                            } else {
                                                MsgAlert({content: jdata.msg, type: 'error'});
                                            }
                                        }
                                    });
                                }
                            });
                        } else {
                            //如果没有上一版   就直接保存，不提示工卡是否有值 和标识改为D
                            InitFuncCodeRequest_({
                                data: {
                                    mainData: mainData,
                                    FunctionCode: "EM_MPD_EVAL_SAVE"
                                },
                                successCallBack: function (jdata) {
                                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                        //提交流程

                                        //校验是否提交过流程
                                        if (!confirm("确认提交该记录？")) {
                                            return;
                                        }
                                        datas = $.extend({}, {}, {
                                            FunctionCode: 'EM_MPD_EVAL_STATUS',
                                            evalNo: evalNo
                                        });
                                        InitFuncCodeRequest_({
                                            data: datas, successCallBack: function (jdata) {
                                                if (jdata.data != null) {
                                                    ShowWindowIframe({
                                                        width: 600,
                                                        height: 390,
                                                        param: {evalNo: evalNo},
                                                        title: "是否提交可靠委员",
                                                        url: "/views/em/emmpdeval/workflow/ifApproval.shtml"
                                                    });
                                                } else {
                                                    MsgAlert({content: "该数据已被提交过了。", type: 'error'});
                                                }
                                            }
                                        });
                                        //
                                    } else {
                                        MsgAlert({content: jdata.msg, type: 'error'});
                                    }
                                }
                            });
                        }
                    } else {
                        MsgAlert({content: jdata.msg, type: 'error'});
                    }
                }
            });
        } else {
            ifApproval();
        }
    }
    function ifApproval() {

        //保存
        var mainData = JSON.stringify($('#mform').serializeObject());
        //校验编号唯一性
        var evalNo = $("#evalNo").val();
        var cmpNo = $("#cmpNo").textbox("getValue");
        InitFuncCodeRequest_({
            data: {
                evalNo: evalNo,
                cmpNo: cmpNo,
                FunctionCode: "EM_MPD_EVAL_CMP_NO_UNIQUE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if (jdata.data.length != 0) {
                        MsgAlert({content: '已存在该mp编号！', type: 'error'});

                    } else {
                        InitFuncCodeRequest_({
                            data: {
                                mainData: mainData,
                                FunctionCode: "EM_MPD_EVAL_SAVE"
                            },
                            successCallBack: function (jdata) {
                                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                    //提交流程
                                    //校验该评估单是否已有工卡
                                    InitFuncCodeRequest_({
                                        data: {evalNo: evalNo, FunctionCode: "EM_MPD_CHECK_JOBCARD"},
                                        successCallBack: function (jdata) {
                                            if (jdata.code == RESULT_CODE.SUCCESS_CODE) {

                                                if (jdata.data.length == 0) {
                                                    MsgAlert({content: '请先填写工卡关联关系', type: 'error'});

                                                } else {
                                                    //校验是否提交过流程
                                                    if (!confirm("确认提交该记录？")) {
                                                        return;
                                                    }
                                                    datas = $.extend({}, {}, {
                                                        FunctionCode: 'EM_MPD_EVAL_STATUS',
                                                        evalNo: evalNo
                                                    });
                                                    InitFuncCodeRequest_({
                                                        data: datas, successCallBack: function (jdata) {
                                                            if (jdata.data != null) {
                                                                ShowWindowIframe({
                                                                    width: 600,
                                                                    height: 390,
                                                                    param: {evalNo: evalNo},
                                                                    title: "是否提交可靠委员",
                                                                    url: "/views/em/emmpdeval/workflow/ifApproval.shtml"
                                                                });
                                                            } else {
                                                                MsgAlert({content: "该数据已被提交过了。", type: 'error'});
                                                            }
                                                        }
                                                    });
                                                }
                                            } else {
                                                MsgAlert({content: jdata.msg, type: 'error'});
                                            }
                                        }
                                    });
                                    //
                                } else {
                                    MsgAlert({content: jdata.msg, type: 'error'});
                                }
                            }
                        });
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }

    //用于超链接通过判断给用户展示对应的页面
    function chakan(type,value) {
        //暂时取消
        var FLEET = $("#fleet").val();
        var docType = $("#docType").val();
        var itemType = $("#itemType").val();
        var docType = $("#docType").val();
        var awlType = $("#awlType").val();
        var ifPse = $("#ifPse").val();
        var docSource = $("#docSource").val();
        itemNumber = $("#itemNumber").val();
        ShowWindowIframe({
            width: 1300,
            height: 340,
            param: {evalNo: evalNo,type:type, itemNumber: value, fleet: FLEET},
            title: "项目展示",
            url: "/views/em/emmpdeval/emMpdFilesHistory.shtml"
        });
    }

    //预览适用性
    function viewAppl() {
        var appltype = $('#applType').combobox('getValue');
        /*var $identity = '#applicabilityDg';
        var row = $($identity).;
        if(!row){
            alert("请选择间隔数据。");
            return;
        }*/
        // if (appltype != "APL") {
        //     MsgAlert({content: '非机身不能预览适用性', type: 'error'});
        //     return;
        // }
        var url = "/views/em/emmpdeval/em_mpdeval.previewApp.shtml";
        if (appltype == "ENG") {
            url = "/views/em/emmpdeval/em_mpdeval.previewEng.shtml";
        }
        if (appltype == "PART") {
            url = "/views/em/emmpdeval/em_mpdeval.previewPart.shtml";
        }
        fleet = $("#fleet").val();
        ShowWindowIframe({
            width: 530,
            height: 440,
            param: {evalNo: evalNo, appltype: appltype, fleet: fleet},
            url: url
        });
    }

    function viewApplCurrent() {
        var appltype = $('#applType').combobox('getValue');
        var url = "/views/em/emmpdeval/em_mpdeval.previewCurrentApp.shtml";
        if (appltype == "ENG") {
            url = "/views/em/emmpdeval/em_mpdeval.previewCurrentEng.shtml";
        }
        if (appltype == "PART") {
            url = "/views/em/emmpdeval/em_mpdeval.previewCurrentPart.shtml";
        }
        fleet = $("#fleet").val();
        ShowWindowIframe({
            width: 530,
            height: 440,
            param: {evalNo: evalNo, appltype: appltype, fleet: fleet},
            url: url
        });
    }
    //过渡性飞机
    function addTmpFleet() {
        //需要过渡且适用性为机身才可以选择过渡飞机
        var ifTmp = $('#ifTmp').combobox('getValue');
        var appltype = $('#applType').combobox('getValue');
        if (ifTmp != "Y" || appltype != "APL") {
            return;
        }
        var tmpFleets = $('#tmpFleets').textbox('getValue');
        fleet = $("#fleet").val();
        ShowWindowIframe({
            width: 530,
            height: 500,
            param: {evalNo: evalNo, appltype: appltype, fleet: fleet, tmpFleets: tmpFleets},
            url: "/views/em/emmpdeval/emMpdTmpFleet.shtml"
        });
    }

    function closWindow() {
        param.OWindow.reload_();
        CloseWindowIframe();
    }
    //历史评估记录数据展示
    function InitDataGrid5() {
        var identity = 'lspg';
        $("#lspg").MyDataGrid({
            identity: identity,
            resize: function () {
                return tabs_standard_resize($('#tt'), -10, 0, 0.1, 0.1);
            },
            queryParams: {evalNo: evalNo},
            columns: {
                param: {FunctionCode: 'EM_MPD_EVAL_HISTORY_LIST'},
                alter: {}
            },
            contextMenus: []
        });
    }

    //代替数据展示
    function InitDataGrid6() {
        var identity = 'replaceItemDg';
        $("#replaceItemDg").MyDataGrid({
            identity: identity,
            resize: function () {
                return tabs_standard_resize($('#tt'), -10, 0, 0.1, 0.1);
            },
            queryParams: {evalNo: evalNo, fleet: $("#fleet").val()},
            columns: {
                param: {FunctionCode: 'EM_MPD_EVAL_REPLACEITEM_LIST'},
                alter: {}
            },
            contextMenus: []
        });
    }
    //是否合并
    function ifMerge() {
        //当选择为是时，设置合并mp编号为必填
        var ifMerge = $("#ifMerge").combobox("getValue");
        if (ifMerge == "Y") {
            $("#cmpNo").textbox('setValue', '');
            $("#mergeTo").textbox({required: true});
        } else {
            $("#mergeTo").textbox({required: false});
        }
    }

    function openCmpNoList() {
        var fleet = $("#fleet").val();
        var title_ = $.i18n.t('mp编号列表');
        ShowWindowIframe({
            width: "600",
            height: "400",
            title: title_,
            param: {fleet: fleet},
            url: "/views/em/emmpdeval/cmpList.shtml"
        });
    }

    function againChange(dealOption) {
        if (dealOption == "Y") {
            $("#againEvaReason").textbox({editable: true, required: true});
            $("#again1").show();
            $("#again2").show();
            $("#again3").show();
            $("#again4").show();
            $("#again5").show();
        } else {
            $("#againEvaReason").textbox({required: false});

            $('#againEvaDate').textbox('setValue', '');
            $('#againEvaInterval').textbox('setValue', '');
            $('#againEvaReason').textbox('setValue', '');
            $("#again1").hide();
            $("#again2").hide();
            $("#again3").hide();
            $("#again4").hide();
            $("#again5").hide();
        }
    }

</script>
</html>


