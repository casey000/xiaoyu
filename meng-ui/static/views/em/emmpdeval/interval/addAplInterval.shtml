<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html
        xmlns="http://www.w3.org/1999/html">
<head id="i18n_" module="emmpdeval">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title>增加间隔</title>
</head>
<body>
<div style="">
    <div class="ibox float-e-margins" id="div2">
        <form class="form-horizontal m-t" id="mform">
            <input type="hidden" id="pkid" name="pkid">
            <input type="hidden" id="evalNo" name="evalNo">
            <fieldset class="fieldset_eui" style="width:100%;margin-right:5px;">
                <legend data-i18n="">间隔-基本信息</legend>
                <div class="ibox-content">
                    <table class="table table-bordered table-info" style="width:100%;">
                        <tr>
                            <th class="td1" style="width:80px;">间隔类型：</th>
                            <td class="tdr">
                                <input class="easyui-combobox" id="intervalType" name="intervalType"
                                       data-options="required:true,onChange:ifUdf,editable: false"/>
                            </td>
                            <td align="right">
                                <input class="btn btn-primary" id="saveBtn" type="button" value="保存" onclick="save();"
                                       style="margin:5px;"/>
                                <input class="btn btn-primary" value="关闭" type="button" onclick="closeAdd();"
                                       style="margin:5px;"/>
                            </td>
                        </tr>
                    </table>
                </div>

                <fieldset class="fieldset_eui" id="tdiv" style="float:left;width:55%;height:350px">
                    <table style="width:100%;">
                        <legend>首检</legend>
                        <tr>
                            <td align="right" class="td1">
                                监控方法：
                            </td>
                            <td colspan="6" class="tdr">
                                <input class="easyui-combobox" id="tIntervalRule"
                                       name="tIntervalRule"
                                       style="width:100px;height:30px;"
                                       data-options="onChange:tIntervalRuleChange,editable: false"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="td1" align="right" style="width:110px;">首检参数1：</td>
                            <td class="tdr" style="width:100px;">
                                <input class="easyui-textbox" id="tFh" name="tFh"
                                       style="width:100px;height:30px;"
                                       data-options="validType:['positive'],onChange:fhChange"/>
                            </td>
                            <td align="left"> FH</td>
                            <td align="right" style="width:15px;">
                                <input type="checkbox" id="tFhIfPost" class="checkJ" name="tFhIfPost">
                            </td>
                            <td style="width:40px;">
                                <legend>POST</legend>
                            </td>
                            <td id="tFhIfPostTd" class="tdr" style="width:65px;">
                                <input class="easyui-combobox" id="tFhPostType"
                                       name="tFhPostType" style="width:60px"
                                       data-options="onSelect:fhChange,editable: false"/>
                            </td>
                            <td id="tFhPostTypeTd" class="tdr">
                                <input class="easyui-combobox" name="tFhPost" id="tFhPost"
                                       data-options="onSelect:fhChange,editable: true"
                                       style=" width:120px;"/>
                            </td>

                        </tr>
                        <tr>
                            <td class="td1" align="right">首检参数2：</td>
                            <td class="tdr">
                                <input class="easyui-textbox" id="tFc" name="tFc"
                                       style="width:100px;height:30px;"
                                       data-options="validType:['positive'],onChange:fcChange"/>
                            </td>
                            <td style="width:50px;" align="left"> FC</td>
                            <td align="right">
                                <input type="checkbox" id="tFcIfPost" class="checkJ" name="tFcIfPost">
                            </td>
                            <td>
                                <legend>POST</legend>
                            </td>
                            <td id="tFcIfPostTd" class="tdr">
                                <input class="easyui-combobox" id="tFcPostType"
                                       name="tFcPostType" style="width:60px"
                                       data-options="onSelect:fcChange,editable: false"/>
                            </td>
                            <td id="tFcPostTypeTd" class="tdr">
                                <input class="easyui-combobox" name="tFcPost" id="tFcPost"
                                       data-options="onSelect:fcChange,editable: true"
                                       style=" width:120px;"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="td1" align="right">首检参数3：</td>
                            <td class="tdr">
                                <input class="easyui-textbox" id="tCal" name="tCal"
                                       style="width:100px;height:30px"
                                       data-options="validType:['positive'],onChange:tcalChange"/>
                            </td>
                            <td class="tdr">
                                <input class="easyui-combobox" id="tCalUnit" name="tCalUnit"
                                       style="width:60px;height:30px"
                                       data-options="onChange:tcalChange,editable: false"/>
                            </td>
                            <td align="right">
                                <input type="checkbox" id="tCalIfPost" class="checkJ" name="tCalIfPost">
                            </td>
                            <td>
                                <legend>POST</legend>
                            </td>

                            <td id="tCalIfPostTd" class="tdr">
                                <input class="easyui-combobox" id="tCalPostType"
                                       name="tCalPostType" style="width:60px"
                                       data-options="onSelect:tcalChange,editable: false"/>
                            </td>
                            <td id="tCalPostTypeTd" class="tdr">
                                <input class="easyui-combobox" name="tCalPost" id="tCalPost"
                                       style="width:120px"
                                       data-options="onSelect:tcalChange,editable: true"/>
                            </td>
                        </tr>

                        <tr>
                            <td class="td1" align="right">截止日期：</td>
                            <td class="tdr">
                                <input class="easyui-datebox" id="tLimitedDay" name="tLimitedDay"
                                       style="width:100px;height:30px"
                                       data-options="onChange:tLimitedDayChange,editable:false"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="td1" align="right">
                                <input type="checkbox" id="tIfStc" name="tIfStc" value="0" class="checkJ" norwap>涉及结构时限
                            </td>
                        </tr>
                    </table>
                    <table id="rf1">
                        <tr>
                            <td style="width:110px" class="td1" align="right">
                                <input type="checkbox" id="ifFls1" class="checkJ" name="ifFls1">
                            </td>
                            <td class="td1" style="width:110px">
                                FLS1
                            </td>
                            <td style="width:110px" class="td1" align="right">
                                <input type="checkbox" id="ifFls2" class="checkJ" name="ifFls2">
                            </td>
                            <td class="td1">
                                FLS2
                            </td>
                        </tr>
                        <tr>
                            <td style="width:110px" class="td1" align="right">
                                <input type="checkbox" id="dtr" class="checkJ" name="dtr">
                            </td>

                            <td class="td1" style="width:150px;height: 40px" colspan="3">
                                DTR:
                                THRSH= <input class="easyui-combobox" id="fls1Rf"
                                              name="fls1Rf" style="height:30px;width:65px"
                                              data-options="onChange:dtrChange,editable: false"/>
                                &nbsp;&nbsp;Rf=
                                <input class="easyui-textbox" id="fls2Rf"
                                       name="fls2Rf"
                                       style="width:60px;height:30px"
                                       data-options="validType:['positive'],onChange:dtrChange"/>
                            </td>
                        </tr>
                        </tr>
                    </table>
                </fieldset>
                <fieldset class="fieldset_eui" style="float:left;width:30%;height:350px">

                    <table style="width:100%;height:100%">
                        <legend>首检说明 <input type="checkbox" id="tIfNote" name="tIfNote">NOTE</legend>
                        <td>
                            <input class="easyui-textbox easyui-validatebox" id="thresholdDesc"
                                   name="thresholdDesc"
                                   style="width:100%;height:94%;border: 1px solid #ddd;border-radius: 5px;"
                                   data-options="multiline:true,editable:false,onlyview:true"/>
                        </td>
                    </table>
                </fieldset>
                <!--重检-->
                <fieldset class="fieldset_eui" id="ivdiv" style="float:left;width:55%;height:280px">
                    <table style="width:55%;">
                        <legend>重检</legend>
                        <tr>
                            <td align="right" class="td1">
                                监控方法：
                            </td>
                            <td colspan="6" class="tdr">
                                <input class="easyui-combobox easyui-validatebox" id="ivIntervalRule"
                                       name="ivIntervalRule"
                                       style="width:100px;height:30px;"
                                       data-options="onChange:ivIntervalRule,editable: false"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="td1" align="right" style="width:150px;">间隔参数1：</td>
                            <td class="tdr" style="width:100px;">
                                <input class="easyui-textbox easyui-validatebox" id="ivFh" name="ivFh"
                                       style="width:100px;height:30px;"
                                       data-options="validType:['positive'],onChange:ivFhChange"/>
                            </td>
                            <td align="left"> FH</td>
                        </tr>
                        <tr>
                            <td class="td1" align="right">间隔参数2：</td>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="ivFc" name="ivFc"
                                       style="width:100px;height:30px;"
                                       data-options="validType:['positive'],onChange:ivFcChange"/>
                            </td>
                            <td style="width:50px;" align="left"> FC</td>
                        </tr>
                        <tr>
                            <td class="td1" align="right">间隔参数3：</td>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="ivCal" name="ivCal"
                                       style="width:100px;height:30px"
                                       data-options="validType:['positive'],onChange:ivCalChange"/>
                            </td>
                            <td class="tdr">
                                <input class="easyui-combobox easyui-validatebox" id="ivCalUnit" name="ivCalUnit"
                                       style="width:60px;height:30px"
                                       data-options="onChange:ivCalChange,editable: false"/>
                            </td>
                        </tr>
                    </table>
                </fieldset>
                <fieldset class="fieldset_eui" style="float:left;width:30%;height:280px">
                    <table style="width:100%;height:100%">
                        <legend>重检说明 <input type="checkbox" id="ivIfNote" name="ivIfNote">NOTE
                            &nbsp;&nbsp;&nbsp;&nbsp;
                                        <input type="checkbox" id="ifTbd" name="ifTbd">TBD
                        </legend>
                        <td class="tdr">
                            <input class="easyui-textbox easyui-validatebox" id="intervalDesc"
                                   name="intervalDesc"
                                   style="width: 100%;height:95%;border: 1px solid #ddd;border-radius: 5px;"
                                   data-options="multiline:true,editable:false,onlyview:true"/>
                        </td>
                    </table>
                </fieldset>
            </fieldset>

        </form>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var isEdit_;
    var evalNo;
    var type;
    var pkid;
    var Add;
    var timeS;//计算
    var fleet;
    var appltype;
    var op = {};
    var rangeTypeArr = {};
    var intervalType = {};
    var PAGE_DATA = {};
    var ctlType;

    function i18nCallBack() {
        param = getParentParam_();
        // isEdit_ = param.isEdit || $("#pkid").val();//页面存在值的时候再点保存变更新
        evalNo = param.evalNo;
        fleet = param.fleet;
        Add = param.Add;
        pkid = param.pkid;
        if (pkid) {
            $("#pkid").val(pkid);
        }
        type = param.type;
        appltype = param.appltype;
        if (Add == "1") {
            $("#ZJ").attr("disabled", "true");
            $("#YL").attr("disabled", "true");
        }
        if (type == "view") {
            $("#saveBtn").hide();
        }
        //范围类型
        InitFuncCodeRequest_({
            data: {acfleet: fleet, engfleet: fleet, FunctionCode: "EM_MPD_EVAL_RANGE_TYPE"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    rangeTypeArr = jdata.data;
                }
            }
        });
        //首先执行一个方法目的是判断获取对应的数据域
        InitFuncCodeRequest_({
            data: {evalNo: evalNo, pkid: pkid, mark: type, FunctionCode: "EM_MPD_DOMAIN_TYPE"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    intervalType = jdata.data;
                }
            }
        });

        InitFuncCodeRequest_({
            data: {
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE",
                domainCode: "EM_FH_POST_TYPE,EM_MP_CALENDAR_UNIT,EM_IF_APPL,EM_INTERVAL_TYPE,EM_MP_INTERVAL_RULE,EM_APL_INTERVAL_TYPE,EM_MPD_THRSH"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    PAGE_DATA ["op"] = DomainCodeToMap_(jdata.data["EM_OPALL"]);
                    PAGE_DATA ["rangeType"] = DomainCodeToMap_(rangeTypeArr);
                    // $('#intervalType').combobox({
                    //     panelHeight: '120px',
                    //     data: intervalType,
                    //     valueField: 'VALUE',
                    //     textField: 'TEXT',
                    // });
                    // jdata.data.EM_MPD_THRSH.unshift({TEXT: "-select-", VALUE: ""});
                    $('#fls1Rf').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MPD_THRSH,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    // jdata.data.EM_FH_POST_TYPE.unshift({TEXT: "-select-", VALUE: ""});
                    $('#tFhPostType').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_FH_POST_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#tFcPostType').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_FH_POST_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#tCalPostType').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_FH_POST_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    // jdata.data.EM_APL_INTERVAL_TYPE.unshift({TEXT: "-select-", VALUE: ""});
                    $('#intervalType').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_APL_INTERVAL_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $("#intervalType").combobox("setValue", 'NORMAL');
                    jdata.data.EM_MP_INTERVAL_RULE.unshift({TEXT: "-select-", VALUE: ""});
                    $('#tIntervalRule').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_INTERVAL_RULE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#ivIntervalRule').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_INTERVAL_RULE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    jdata.data.EM_MP_CALENDAR_UNIT.unshift({TEXT: "-select-", VALUE: ""});
                    $('#ivCalUnit').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_CALENDAR_UNIT,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    // jdata.data.EM_MP_TICHK_UNIT.unshift({TEXT: "-select-", VALUE: ""});
                    $('#ivCheckUnit').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_TICHK_UNIT,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#tCalUnit').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_CALENDAR_UNIT,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    //隐藏post
                    /* $('#tFhPostType').next().hide();
                     $('#tFhPost').next().hide();
                     $('#tFcPostType').next().hide();
                     $('#tFcPost').next().hide();
                     $('#tCalPostType').next().hide();
                     $('#tCalPost').next().hide();*/
                    $("#evalNo").val(evalNo);
                    //隐藏是否涉及时限
                    $("#rf1").hide();
                    if (pkid != "") {
                        InitDataForm(pkid);
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }

            }
        });


    }

    //是否使用首检说明note
    $("#tIfNote").change(function () {
        tIfStcChange(false);
        var tIfNote = $("#tIfNote").is(":checked");
        if (tIfNote) {
            //允许编辑首检说明
            $("#thresholdDesc").textbox({editable: true, onlyview: false, multiline: true});
            $("#tdiv").find("input").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: false, editable: false, onlyview: true, value: ""});
                    $(it).combobox("setValue", "");
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false, editable: false, onlyview: true, value: ""});
                    $(it).textbox('setValue', '');
                } else if ($(it).hasClass("checkJ")) {
                    $(it).removeAttr("checked");
                    $(it).prop('disabled', true);
                }
            });
            /* $("#tFhPostType").combobox({required: false});
             $("#tCalUnit").combobox({required: false});
             $("#tCalUnit").combobox('setValue', '');
             $("#tCalPostType").combobox({required: false});
             $("#tCalPostType").combobox('setValue', '');
             $("#tFhPostType").combobox('setValue', '');
             $("#tFcPostType").combobox('setValue', '');
             $("#tLimitedDay").datebox({disabled: true});
             $("#tCal").textbox({required: false, editable: false, onlyview: true});
             $("#fls1Rf").combobox({required: false, editable: false, onlyview: true});
             $("#fls1Rf").combobox('setValue', '');
             $("#thresholdDesc").textbox('setValue', '');
             $("#tFhPost").next().show();
             $("#tFcPost").next().show();
             $("#tCalPost").next().show();*/

        } else {
            $("#tdiv").find("input").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: true, onlyview: false});
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false, editable: true, onlyview: false});
                } else if ($(it).hasClass("checkJ")) {
                    $(it).attr("checked", true);
                    $(it).prop('disabled', false);
                }
            });
            $("#thresholdDesc").textbox({editable: false, onlyview: true, multiline: true});
            $("#tIntervalRule").combobox({required: false, onlyview: false});
            $("#tIntervalRule").combobox('setValue', '');
            $("#tFhPostType").combobox('setValue', '');
            $("#tFcPostType").combobox('setValue', '');

            $("#tCalUnit").combobox({required: false, onlyview: false});
            $("#tCalUnit").combobox('setValue', '');
            document.getElementById('tCalIfPost').checked = false;
            $("#tCalPostType").combobox({required: false, onlyview: false});
            $("#tCalPostType").combobox('setValue', '');
            $("#tFcPostType").combobox({required: false, onlyview: false});
            $("#tFcPostType").combobox('setValue', '');
            $("#tFhPostType").combobox({required: false,onlyview: false});
            $("#tFhPostType").combobox('setValue', '');
            $("#tCal").textbox({required: false});
            $("#tFhPost").combobox({required: false, onlyview: false});
            $("#tFhPost").combobox('setValue', '');
            $("#tFcPost").combobox({required: false,onlyview: false});
            $("#tFcPost").combobox('setValue', '');
            $("#tCalPost").combobox({required: false, onlyview: false});
            $("#tCalPost").combobox('setValue', '');
            $("#tLimitedDay").datebox({disabled: false});
            $("#fls1Rf").combobox({required: false, onlyview: false});
            $("#fls1Rf").combobox('setValue', '');
            $("#thresholdDesc").textbox('setValue', '');
        }
        for (var i = 0; i < a.length; i++) {
            a[i] = "";
        }
    });
    //是否使用重检说明note
    $("#ivIfNote").change(function () {
        var ivIfNote = $("#ivIfNote").is(":checked");
        $("#ifTbd").attr("checked", false);
        ivIfNoteChange(ivIfNote);

    });
    //TBD
    $("#ifTbd").change(function () {
        var ifTdb = $("#ifTbd").is(":checked");
        $("#ivIfNote").attr("checked", false);
        ivIfNoteChange(ifTdb);
    });

    function ivIfNoteChange(ivIfNote){
        if (ivIfNote) {
            $("#ivdiv").find("input").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: false, editable: false, onlyview: true});
                    $(it).combobox("setValue", "");
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false, editable: false, onlyview: true});
                    $(it).textbox('setValue', '');
                } else if ($(it).hasClass("checkJ")) {
                    $(it).removeAttr("checked");
                }
                else {
                    $(it).datetimebox({required: false, editable: false, onlyview: true, disabled: true});
                }
            });

            $("#ivIntervalRule").combobox({required: false, editable: false, onlyview: true});
            $("#ivIntervalRule").combobox('setValue', '');
            $("#ivFh").textbox('setValue', '');
            $("#ivFh").textbox({required: false, editable: false, onlyview: true});
            $("#ivFc").textbox('setValue', '');
            $("#ivFc").textbox({required: false, editable: false, onlyview: true});
            $("#ivCal").textbox('setValue', '');
            $("#ivCal").textbox({required: false, editable: false, onlyview: true});
            $("#ivCalUnit").combobox({required: false, editable: false, onlyview: true});
            $("#ivCalUnit").combobox('setValue', '');
            if($("#ivIfNote").is(":checked")){
                $("#intervalDesc").textbox({editable: true, onlyview: false, multiline: true});
                $("#intervalDesc").textbox('setValue', '');
            }
            if($("#ifTbd").is(":checked")){
                $("#intervalDesc").textbox({editable: false, onlyview: true});
                $("#intervalDesc").textbox('setValue', 'TBD');
            }
        } else {
            $("#ivdiv").find("input").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: true, onlyview: false});
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false, editable: true, onlyview: false});
                }
            });
            $("#intervalDesc").textbox({editable: false, onlyview: true, multiline: true});
            $("#intervalDesc").textbox('setValue', '');
            $("#ivIntervalRule").combobox({ onlyview: false, required: false});
            $("#ivIntervalRule").combobox('setValue', '');
            $("#ivFh").textbox({editable: true, onlyview: false});
            $("#ivFc").textbox({editable: true, onlyview: false});
            $("#ivCal").textbox({editable: true, onlyview: false});
            $("#ivCalUnit").textbox({required: false, editable: true, onlyview: false});
            $("#ivCalUnit").combobox('setValue', '');
        }
    }
    //是否涉及结构时限
    $("#tIfStc").change(function () {
        var isStruct = $("#tIfStc").is(":checked");
        tIfStcChange(isStruct);
    });

    function tIfStcChange(isStruct) {
        if (isStruct) {
            $("#rf1").show();
        } else {
            $("#ifFls1").attr("checked", false);
            $("#ifFls2").attr("checked", false);
            $("#dtr").attr("checked", false);
            $("#fls1Rf").combobox({value: ""});
            $("#fls2Rf").textbox({value: ""});
            $("#rf1").hide();
            a[5] = "";
            a[6] = "";
            var v = '';
            $.each(a, function (k, item) {
                if (item == "  ") {
                    v = v;
                } else {
                    v += item ? item + "\r\n" : '';
                }
            });
            $('#thresholdDesc').textbox({value: v});
        }
    }
    //是否选中post
    $("#tFhIfPost").change(function () {
        var tFhIfPost = $("#tFhIfPost").is(":checked");
        var tFh = $("#tFh").textbox("getValue");
        var tFhPostType = $("#tFhPostType").combobox("getValue");
        if (tFhIfPost) {
            if (tFh == "") {
                $("#tFh").textbox({required: true});
            }
            if (tFhPostType == "") {
                $("#tFhPostType").combobox({required: true});
            }
        } else {
            if (tFh == "") {
                $("#tFh").textbox({required: false});
            }
            $("#tFhPostType").combobox({required: false});
            $("#tFhPostType").combobox("setValue", '');
            $("#tFhPost").combobox({required: false});
            $("#tFhPostType").combobox("setValue", '');
            fhChange();
        }
    });
    $("#tFcIfPost").change(function () {
        var tFcIfPost = $("#tFcIfPost").is(":checked");
        var tFc = $("#tFc").textbox("getValue");
        var tFcPostType = $("#tFcPostType").combobox("getValue");
        if (tFcIfPost) {
            if (tFc == "") {
                $("#tFc").textbox({required: true});
            }
            if (tFcPostType == "") {
                $("#tFcPostType").combobox({required: true});
            }
        } else {
            if (tFc == "") {
                $("#tFc").textbox({required: false});
            }
            $("#tFcPostType").combobox({required: false});
            $("#tFcPostType").combobox("setValue", "");
            $("#tFcPost").combobox({required: false});
            $("#tFcPost").combobox("setValue",'');
            fcChange();
        }
    });
    $("#tCalIfPost").change(function () {
        var tCalIfPost = $("#tCalIfPost").is(":checked");
        var tCal = $("#tCal").textbox("getValue");
        var tCalPostType = $("#tCalPostType").combobox("getValue");
        if (tCalIfPost) {
            if (tCal == "") {
                $("#tCal").textbox({required: true});
            }
            if (tCalPostType == "") {
                $("#tCalPostType").combobox({required: true});
            }
        } else {
            if (tCal == "") {
                $("#tCal").textbox({required: false});
            }
            $("#tCalPostType").combobox({required: false});
            $("#tCalPostType").combobox("setValue", '');
            $("#tCalPost").combobox({required: false});
            $("#tCalPost").combobox("setValue",'');
            tcalChange();
        }
    });
    //是否选中ifFls1
    $("#ifFls1").change(function () {
        var ifFls1 = $("#ifFls1").is(":checked");
        if (ifFls1) {
            $("#ifFls2").attr("checked", false);
            //勾上时限结构
            document.getElementById('tIfStc').checked = 'checked';
            // $("#tIfStc").attr("checked", true);
        }
        flsChange();
    });
    $("#ifFls2").change(function () {
        var ifFls2 = $("#ifFls2").is(":checked");
        if (ifFls2) {
            $("#ifFls1").attr("checked", false);
            //勾上时限结构
            document.getElementById('tIfStc').checked = 'checked';
        }
        flsChange();
    });
    //是否选中DTR
    $("#dtr").change(function () {
        var dtr = $("#dtr").is(":checked");
        var fls1Rf = $("#fls1Rf").combobox("getValue");
        var fls2Rf = $("#fls2Rf").textbox("getValue");
        if (dtr) {
            if (fls1Rf == "") {
                $("#fls1Rf").combobox({required: true});
            }
            if (fls2Rf == "") {
                $("#fls2Rf").textbox({required: true});
            }
            dtrChange();
        } else {

            $("#fls1Rf").combobox('setValue', '');
            $("#fls1Rf").combobox({required: false});
            $("#fls2Rf").textbox('setValue', '');
            $("#fls2Rf").textbox({required: false});
            // fls1RfChange();
            dtrChange();
        }
    });
    //用于验证单位必填
    function ivCal(a, b) {
        if (a) {
            $('#ivCalUnit').combobox({required: true});
        } else {
            $('#ivCalUnit').combobox({required: false});
        }

    }

    function tCal(a, b) {
        if (a) {
            $('#tCalUnit').combobox({required: true});
        } else {
            $('#tCalUnit').combobox({required: false});
        }

    }

    function tCheck(a, b) {
        if (a) {
            $('#tCheckUnit').combobox({required: true});
        } else {
            $('#tCheckUnit').combobox({required: false});
        }

    }

    function ivCheck(a, b) {
        if (a) {
            $('#ivCheckUnit').combobox({required: true});
        } else {
            $('#ivCheckUnit').combobox({required: false});
        }

    }


    //用于回填首重检描述的值
    var a = [];//首检说明
    var b = [];//重检说明

    function tIntervalRuleChange() {
        var value = $("#tIntervalRule").combobox("getValue");
        index = 0;
        if (value == '') {
            var v = '';
            $('#thresholdDesc').textbox({value: v});
            a[index] = value;
        }else {
            a[index] = value=="F"?"先到为准":"后到为准";
        }
        var v = '';
        $.each(a, function (k, item) {
            if (item == " ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    function validPostType() {
        var tFhPostType = $("#tFhPostType").combobox("getValue");
        var tFcPostType = $("#tFcPostType").combobox("getValue");
        var tCalPostType = $("#tCalPostType").combobox("getValue");
        var actualPostType = tFhPostType != "" && tFhPostType != "PTF" ? tFhPostType : (tFcPostType != "" && tFcPostType != "PTF"
            ? tFcPostType : (tCalPostType != "" && tCalPostType != "PTF" ? tCalPostType : ""));

        var tFhPost = $("#tFhPost").combobox("getValue");
        var tFcPost = $("#tFcPost").combobox("getValue");
        var tCalPost = $("#tCalPost").combobox("getValue");
        var actualPost = tFhPost != "" ? tFhPost : (tFcPost != "" ? tFcPost : (tCalPost != "" ? tCalPost : ""));

        if ((tFhPostType != "" && tFhPostType != "PTF" && tFhPostType != actualPostType) ||
            (tFcPostType != "" && tFcPostType != "PTF" && tFcPostType != actualPostType) ||
            (tCalPostType != "" && tCalPostType != "PTF" && tCalPostType != actualPostType)) {
            alert("首检POST类型只能选择一种。");
            return "TYPE";
        }
        if ((tFhPost != "" && tFhPost != actualPost) || (tFcPost != "" && tFcPost != actualPost) || (tCalPost != "" && tCalPost != actualPost)) {
            alert("首检POST文件只能选择一种。");
            return "POST";
        }
        return '';
    }
    function fhChange() {
        index = 1;
        //获取FH
        var tFh = $("#tFh").textbox("getValue");
        var tFhPostType = $("#tFhPostType").combobox("getValue");
        var tFhPost = $("#tFhPost").combobox("getValue");
        //当tFhPostType不为空，则勾选上checkbox
        if (tFhPostType != "") {
            //一个条目首检只能支持选择一个SB或STC
            if(tFhPostType != "PTF") {
                var returnVal = validPostType();
                if (returnVal != "") {
                    if (returnVal == "TYPE") {
                        $("#tFhPostType").combobox({value: ''});
                    } else {
                        $("#tFhPost").combobox({value: ''});
                    }
                    return;
                }
                $("#tFhPost").next().show();
                if (tFhPost == "") {
                    $("#tFhPost").combobox({required: true});
                }
                InitFuncCodeRequest_({
                    data: {fleet: fleet, dataType: tFhPostType, FunctionCode: "EM_MPD_POST_TYPE"}, async: false,
                    successCallBack: function (jdata) {
                        if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                            $('#tFhPost').combobox({
                                panelHeight: '100px',
                                panelWidth: '120px',
                                data: jdata.data,
                                valueField: 'VALUE',
                                textField: 'TEXT',
                                filter: function(q, row){
                                    var opts = $(this).combobox('options');
                                    return row[opts.textField].indexOf(q) != -1;
                                }
                            });
                            $("#tFhPost").textbox('setValue',tFhPost);
                        }
                    }
                });
            }
            document.getElementById('tFhIfPost').checked = 'checked';
            if (tFh == "") {
                $("#tFh").textbox({required: true});
            }
        }
        //当tFhPostType为PTF时，隐藏tFhPost
        if (tFhPostType == "PTF") {
            $("#tFhPost").combobox({required: false});
            $("#tFhPost").combobox('setValue', '');
            $("#tFhPost").next().hide();
        }
        tFh = tFh ? tFh + ('FH') : '';
        tFh = tFh + ($("#tFhIfPost").is(":checked") ? " POST " : " ") + tFhPostType + ' ' + tFhPost;
        a[index] = tFh;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});

    }

    function fcChange() {
        index = 2;
        //获取FC
        var tFc = $("#tFc").textbox("getValue");
        var tFcPostType = $("#tFcPostType").combobox("getValue");
        var tFcPost = $("#tFcPost").combobox("getValue");
        //当tFcPostType不为空，则勾选上checkbox
        if (tFcPostType != "") {
            //一个条目首检只能支持选择一个SB或STC
            if(tFcPostType != "PTF") {
                /*var tFhPostType = $("#tFhPostType").combobox("getText");
                var tCalPostType = $("#tCalPostType").combobox("getText");
                if (tFhPostType == "SB" || tFhPostType == "STC" || tCalPostType == "SB" || tCalPostType == "STC") {
                    MsgAlert({content: '首检只能选择一个SB或STC', type: 'error'});
                    $("#tFcPostType").combobox("setValue", '');
                    return;
                }*/
                var returnVal = validPostType();
                if (returnVal != "") {
                    if (returnVal == "TYPE") {
                        $("#tFcPostType").combobox({value: ''});
                    } else {
                        $("#tFcPost").combobox({value: ''});
                    }
                    return;
                }
                $("#tFcPost").next().show();
                if (tFcPost == "") {
                    $("#tFcPost").combobox({required: true});
                }
                InitFuncCodeRequest_({
                    data: {fleet: fleet, dataType: tFcPostType, FunctionCode: "EM_MPD_POST_TYPE"}, async: false,
                    successCallBack: function (jdata) {
                        if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                            $('#tFcPost').combobox({
                                panelHeight: '100px',
                                panelWidth: '120px',
                                data: jdata.data,
                                valueField: 'VALUE',
                                textField: 'TEXT',
                                filter: function(q, row){
                                    var opts = $(this).combobox('options');
                                    return row[opts.textField].indexOf(q) != -1;
                                }
                            });
                            $("#tFcPost").textbox('setValue',tFcPost);
                        }
                    }
                });
            }

            document.getElementById('tFcIfPost').checked = 'checked';
            if (tFc == "") {
                $("#tFc").textbox({required: true});
            }
        }
        //当tFcPostType为PTF时，隐藏tFhPost
        if (tFcPostType == "PTF") {
            $("#tFcPost").combobox({required: false});
            $("#tFcPost").combobox('setValue', '');
            $("#tFcPost").next().hide();
            //校验参数是否为正整数
            // if (tFc != "") {
            //     var regex = /^[0-9]*[1-9][0-9]*$/;
            //     if (!regex.test(tFc)) {
            //         MsgAlert({content: '参数必须为正整数2', type: 'error'});
            //     }
            // }

        }
        tFc = tFc ? tFc + ('FC') : '';
        tFc = tFc + ($("#tFcIfPost").is(":checked") ? " POST " : " ") + tFcPostType + ' ' + tFcPost;
        a[index] = tFc;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    function tcalChange() {
        index = 3;
        //获取tCal
        var tCal = $("#tCal").textbox("getValue");
        var tCalUnit = $("#tCalUnit").combobox("getValue");
        var tCalPost = $("#tCalPost").combobox("getValue");
        //当录入参数3时，需选择对应单位
        if (tCal != "" || tCalUnit != "") {
            $("#tCal").textbox({required: true});
            $("#tCalUnit").combobox({required: true, value: tCalUnit});
        } else {
            $("#tCal").textbox({required: false});
            $("#tCalUnit").combobox({required: false, value: ''});
        }
        var tCalPostType = $("#tCalPostType").combobox("getValue");
        //当tCalPostType不为空，则勾选上checkbox
        if (tCalPostType != "") {
            //一个条目首检只能支持选择一个SB或STC
            if(tCalPostType != "PTF"){
                /*var tFhPostType = $("#tFhPostType").combobox("getText");
                var tFcPostType = $("#tFcPostType").combobox("getText");
                if(tFhPostType =="SB"||tFhPostType =="STC"||tFcPostType=="SB"||tFcPostType=="STC"){
                    MsgAlert({content: '一个条目首检只能支持选择一个SB或STC', type: 'error'});
                    $("#tCalPostType").combobox("setValue",'');
                    return;
                }*/
                var returnVal = validPostType();
                if (returnVal != "") {
                    if (returnVal == "TYPE") {
                        $("#tCalPostType").combobox({value: ''});
                    } else {
                        $("#tCalPost").combobox({value: ''});
                    }
                    return;
                }
                $("#tCalPost").next().show();
                if (tCalPost == "") {
                    $("#tCalPost").combobox({required: true});
                }
                InitFuncCodeRequest_({
                    data: {fleet: fleet, dataType: tCalPostType, FunctionCode: "EM_MPD_POST_TYPE"}, async: false,
                    successCallBack: function (jdata) {
                        if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                            $('#tCalPost').combobox({
                                panelHeight: '100px',
                                panelWidth: '120px',
                                data: jdata.data,
                                valueField: 'VALUE',
                                textField: 'TEXT',
                                filter: function(q, row){
                                    var opts = $(this).combobox('options');
                                    return row[opts.textField].indexOf(q) != -1;
                                }
                            });
                            $("#tCalPost").textbox('setValue',tCalPost);
                        }
                    }
                });
            }
            document.getElementById('tCalIfPost').checked = 'checked';
            if (tCal == "") {
                $("#tCal").textbox({required: true});
            }
        }

        //当tCalPostType为PTF时，隐藏tFhPost
        if (tCalPostType == "PTF") {
            $("#tCalPosts").textbox({required: false});
            $("#tCalPost").combobox('setValue', '');
            $("#tCalPost").next().hide();
            //校验参数是否为正整数
            // if (tCal != "") {
            //     var regex = /^[0-9]*[1-9][0-9]*$/;
            //     if (!regex.test(tCal)) {
            //         MsgAlert({content: '参数必须为正整数', type: 'error'});
            //     }
            // }

        }
        tCal = tCal + tCalUnit + ($("#tCalIfPost").is(":checked") ? " POST " : " ") + tCalPostType + ' ' + tCalPost;
        a[index] = tCal;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    function tLimitedDayChange(value) {
        index = 4;
        //获取tCal
        var tLimitedDay = $("#tLimitedDay").datebox("getValue");
        a[index] = tLimitedDay;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    function flsChange() {
        index = 5;
        var fls1Rf = "  ";
        var ifFls1 = $("#ifFls1").is(":checked");
        var ifFls2 = $("#ifFls2").is(":checked");
        if (ifFls1) {
            fls1Rf = "FLS1";
        }
        if (ifFls2) {
            fls1Rf = "FLS2";
        }
        a[index] = fls1Rf;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    function dtrChange() {
        index = 6;
        var fls1Rf = $("#fls1Rf").combobox("getText");
        var fls2Rf = $("#fls2Rf").textbox("getValue");
        //当fls1Rf或不为空，则勾选上checkbox
        if (fls1Rf != "") {
            document.getElementById('dtr').checked = 'checked';
        }
        if (fls2Rf != "") {
            fls2Rf = " Rf=" + fls2Rf;
        }
        fls1Rf = ($("#dtr").is(":checked") ? "DTR THRSH= " : "") + fls1Rf + fls2Rf;
        a[index] = fls1Rf;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    function fls1RfNull() {
        index = 5;
        var fls1Rf = "";
        a[index] = fls1Rf;
        var v = '';
        $.each(a, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});
    }

    // function fls2Rf2Change() {
    //     index = 6;
    //     //获取tCal
    //     var fls2Rf2 = $("#fls2Rf").textbox("getValue");
    //     //当fls2Rf2不为空，则勾选上checkbox
    //     if (fls2Rf2 != "") {
    //         document.getElementById('ifFls2').checked = 'checked';
    //     }
    //     // fls2Rf2 = "DTR THRES 2,RF：" + fls2Rf2;
    //     fls2Rf2 = ($("#ifFls2").is(":checked") ? " DTR THRES 2,RF： " : " ") + fls2Rf2;
    //     a[index] = fls2Rf2;
    //     var v = '';
    //     $.each(a, function (k, item) {
    //         if (item == "  ") {
    //             v = v;
    //         } else {
    //             v += item ? item + "\r\n" : '';
    //         }
    //     });
    //     $('#thresholdDesc').textbox({value: v});
    // }

    function ivIntervalRule() {
        var value = $("#ivIntervalRule").combobox("getValue");
        index = 0;
        if (value == '') {
            var v = '';
            $('#intervalDesc').textbox({value: v});
            b[index] = value;
        }else {
            b[index] = value=="F"?"先到为准":"后到为准";
        }
        var v = '';
        $.each(b, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#intervalDesc').textbox({value: v});
    }

    function ivFhChange(value) {
        index = 1;
        //获取ivFh
        var ivFh = $("#ivFh").textbox("getValue");
        ivFh = ivFh ? ivFh + ('FH') : '';
        b[index] = ivFh;
        var v = '';
        $.each(b, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#intervalDesc').textbox({value: v});

    }

    function ivFcChange(value) {
        index = 2;
        //获取ivFc
        var ivFc = $("#ivFc").textbox("getValue");
        ivFc = ivFc ? ivFc + ('FC') : '';
        b[index] = ivFc;
        var v = '';
        $.each(b, function (k, item) {
            if (item == "  ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#intervalDesc').textbox({value: v});
    }

    function ivCalChange(value) {
        index = 3;
        //获取ivCal
        var ivCal = $("#ivCal").textbox("getValue");
        var ivCalUnit = $("#ivCalUnit").combobox("getValue");
        //当录入参数3时，需选择对应单位
        if (ivCal != "" || ivCalUnit != "") {
            $("#ivCalUnit").combobox({required: true, value: ivCalUnit});
            $("#ivCal").textbox({required: true});
        } else {
            $("#ivCalUnit").combobox({required: false, value: ""});
            $("#ivCal").textbox({required: false});
        }
        ivCal = ivCal + ivCalUnit;
        b[index] = ivCal;
        var v = '';
        $.each(b, function (k, item) {
            if (item == " ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#intervalDesc').textbox({value: v});
    }


    function tFhPostTypeChange(value) {
        var value = $("#tFhPostType").combobox("getValue");
        index = 2;
        if (value == '') {
            var v = '';
            $('#thresholdDesc').textbox({value: v});
        }
        a[index] = value;
        var v = '';
        $.each(a, function (k, item) {
            if (item == " ") {
                v = v;
            } else {
                v += item ? item + "\r\n" : '';
            }
        });
        $('#thresholdDesc').textbox({value: v});

    }

    function tFhPostChange(value) {
        index = 3;
        if (value == '') {
            var v = '';
            $('#thresholdDesc').textbox({value: v});
        }
        a[index] = value;
        var v = '';
        $.each(a, function (k, item) {
            if (k == 3) {
                v += item;
            } else {
                v += item ? item + "\r\n" : '';
            }

        });
        $('#thresholdDesc').textbox({value: v});

    }


    //间隔类型为自定时
    function ifUdf(a) {
        if (a == "NOTE") {
            $('#thresholdDesc').textbox({editable: true, onlyview: false});
            $('#intervalDesc').textbox({editable: true, onlyview: false});
            $('#tFh').textbox({editable: false, onlyview: true, value: ''});
            $('#tCal').textbox({editable: false, onlyview: true, value: ''});
            $('#tFc').textbox({editable: false, onlyview: true, value: ''});
            $('#tCalUnit').combobox({editable: false, onlyview: true, value: ''});
            $('#tCheck').textbox({editable: false, onlyview: true, value: ''});
            $('#tCheckUnit').combobox({editable: false, onlyview: true, value: ''});
            $('#ivFh').textbox({editable: false, onlyview: true, value: ''});
            $('#ivFc').textbox({editable: false, onlyview: true, value: ''});
            $('#ivCal').textbox({editable: false, onlyview: true, value: ''});
            $('#ivCalUnit').combobox({editable: false, onlyview: true, value: ''});
            $('#infc').textbox({editable: false, onlyview: true, value: ''});
            $('#ivCheck').textbox({editable: false, onlyview: true, value: ''});
            $('#ivCheckUnit').combobox({editable: false, onlyview: true, value: ''});
        } else {
            $('#tFh').textbox({editable: true, onlyview: false});
            $('#tCal').textbox({editable: true, onlyview: false});
            $('#tFc').textbox({editable: true, onlyview: false});
            $('#tCalUnit').combobox({ onlyview: false});
            $('#tCheck').textbox({editable: true, onlyview: false});
            $('#tCheckUnit').combobox({ onlyview: false});
            $('#ivFh').textbox({editable: true, onlyview: false});
            $('#ivFc').textbox({editable: true, onlyview: false});
            $('#ivCal').textbox({editable: true, onlyview: false});
            $('#ivCalUnit').combobox({ onlyview: false});
            $('#infc').textbox({editable: true, onlyview: false});
            $('#ivCheck').textbox({editable: true, onlyview: false});
            $('#ivCheckUnit').combobox({onlyview: false});
            $('#thresholdDesc').textbox({editable: false, onlyview: true});
            $('#intervalDesc').textbox({editable: false, onlyview: true});
        }
    }

    //回显数据
    function InitDataForm(pkid) {
        InitFuncCodeRequest_({
            data: {pkid: pkid, FunctionCode: "EM_MPD_EVAL_INTERVAL_PKID"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ParseFormField_(jdata.data, $("#mform"), Constant.CAMEL_CASE);
                    fhChange();
                    fcChange();
                    $('#intervalType').combobox({value: jdata.data.INTERVAL_TYPE});
                    $('#tIntervalRule').combobox({value: jdata.data.T_INTERVAL_RULE});
                    $('#tCalUnit').combobox({value: jdata.data.T_CAL_UNIT});
                    $('#ivCalUnit').combobox({value: jdata.data.IV_CAL_UNIT});
                    $('#ivIntervalRule').combobox({value: jdata.data.IV_INTERVAL_RULE});
                    $('#tFhPostType').combobox({value: jdata.data.T_FH_POST_TYPE});
                    $('#tFcPostType').combobox({value: jdata.data.T_FC_POST_TYPE});
                    $('#tCalPostType').combobox({value: jdata.data.T_CAL_POST_TYPE});

                    if (jdata.data.T_FH_IF_POST == "Y") {
                        $("#tFhIfPost").attr("checked", true);
                    }
                    if (jdata.data.T_FC_IF_POST == "Y") {
                        $("#tFcIfPost").attr("checked", true);
                    }
                    if (jdata.data.T_CAL_IF_POST == "Y") {
                        $("#tCalIfPost").attr("checked", true);
                    }
                    if (jdata.data.T_IF_STC == "Y") {
                        $("#tIfStc").attr("checked", true);
                        $("#rf1").show();
                        if (jdata.data.IF_FLS1 == "Y") {
                            $("#ifFls1").attr("checked", true);
                        } else {
                            $("#ifFls1").attr("checked", false);
                        }
                        if (jdata.data.IF_FLS2 == "Y") {
                            $("#ifFls2").attr("checked", true);
                        } else {
                            $("#ifFls2").attr("checked", false);
                        }
                        flsChange();
                    }
                    if (jdata.data.T_IF_NOTE == "Y") {
                        $("#tIfNote").attr("checked", true);
                        $("#tIfNote").change();
                        $("#thresholdDesc").textbox('setValue', jdata.data.THRESHOLD_DESC);
                    }
                    if (jdata.data.IV_IF_NOTE == "Y") {
                        $("#ivIfNote").attr("checked", true);
                        $("#ivIfNote").change();
                        $("#intervalDesc").textbox('setValue', jdata.data.INTERVAL_DESC);

                    }
                    if (jdata.data.IF_TBD == "Y") {
                        $("#ifTbd").attr("checked", true);
                        $("#ifTbd").change();
                        $("#intervalDesc").textbox('setValue', jdata.data.INTERVAL_DESC);

                    }

                }
            }
        });
    }

    //关闭窗口
    function closeAdd() {
        $.messager.confirm('', '是否关闭', function (r) {
            if (r) {
                subMitData();
                CloseWindowIframe();
                param.OWindow.reload_();
                $("#dg2").form('clear');
            }
        });
    }

    //预览适用性
    function viewAppl() {
        ShowWindowIframe({
            width: 830,
            height: 370,
            param: {evalNo: evalNo, appltype: appltype, fleet: fleet},
            title: "增加适用性",
            url: "/views/em/emmpdeval/em_mpdeval.previewApp.shtml"
        });
    }

    function alertMassage() {
        $.messager.confirm('', '数据保存成功，若为新增数据，请至少增加一条适用性！', function (r) {
            if (r) {
            }
        });
    }

    //后一页面保存成功后自动保存前一页面
    function subMitData() {
        setTimeout($("#mform").submit(), 1000);
    }

    /** 刷新列表数据 */
    function reload_(timeS) {
        param.OWindow.reloadg3();
        // InitDataGrid();//后一页面加载成功时重新初始化页面数据
        $("#dg2").datagrid("reload");
    }

    function addappl() {
        if (pkid == -1) {
            pkid = $("#pkid").val();
        }
        ShowWindowIframe({
            width: 830,
            height: 370,
            param: {pkid: pkid, fleet: fleet},
            title: "增加适用性",
            url: "/views/em/emmpdeval/em_mpdeval.addApp.shtml"
        });
    }

    function viewappl() {
        ShowWindowIframe({
            width: 1000,
            height: 540,
            param: {pkid: pkid},
            title: "增加预览",
            url: "/views/em/emmpdeval/em_mpdeval.previewApp.shtml"
        });
    }

    function evalMemo() {
        ShowWindowIframe({
            width: 1100,
            height: 550,
            param: {},
            title: "评估",
            url: "/views/em/emmpdeval/em.mpdeval.evalnote.shtml"
        });
    }

    function saveCheck() {
        var isValidate = $("#mform").form('validate');
        var $form = $("#mform");
        var datas = $form.serializeObject();
        var t=0;
        var iv=0;
        if (!isValidate)
            return true;
        //判断首检说明和重检说明是否有值
        var thresholdDesc = $("#thresholdDesc").textbox("getValue");
        var intervalDesc = $("#intervalDesc").textbox("getValue");
        if (thresholdDesc == "" || intervalDesc == "") {
            MsgAlert({content: '首检、重检说明存在空值!', type: 'error'});
            return true;
        } else {

            //首检校验
            if (datas.tFh !=""){
                t=t+1;
            }
            if (datas.tFc !=""){
                t=t+1;
            }
            if (datas.tCal !=""){
                t=t+1;
            }
            if (datas.tLimitedDay !=""){
                t=t+1;
            }
            if (datas.ifFls1 !=""||datas.ifFls2 !=""){
                t=t+1;
            }
            if (datas.dtr !=""){
                t=t+1;
            }
            if (datas.tIntervalRule!=""){
                if (t<2){
                    MsgAlert({content: '单个参数不允许选择首检类型!', type: 'error'});
                    return true;
                }
            }else{
                if (t>1){
                    MsgAlert({content: '多个参数需选择首检类型!', type: 'error'});
                    return true;
                }
            }
            //重检校验
            if (datas.ivFh !=""){
                iv=iv+1;
            }
            if (datas.ivFc !=""){
                iv=iv+1;
            }
            if (datas.ivCal !=""){
                iv=iv+1;
            }
            if (datas.ivIntervalRule!=""){
                if (iv<2){
                    MsgAlert({content: '单个参数不允许选择重检类型!', type: 'error'});
                    return true;
                }
            }else{
                if (iv>1){
                    MsgAlert({content: '多个参数需选择重检类型!', type: 'error'});
                    return true;
                }
            }
            //当勾选结构类时限时，必须选择其中一项参数
            var tIfStc = $("#tIfStc").is(":checked");
            var ifFls1 = $("#ifFls1").is(":checked");
            var ifFls2 = $("#ifFls2").is(":checked");
            var dtr = $("#dtr").is(":checked");
            if (tIfStc && !ifFls1 && !ifFls2 && !dtr) {
                MsgAlert({content: '请勾选涉及时限结构!', type: 'error'});
                return true;
            }
            /*if (tIfStc) {
                if (ifFls1||ifFls2){
                }else {
                    MsgAlert({content: '请勾选FLS1或者FLS2!', type: 'error'});
                    return true;
                }
            }else {
                if (ifFls1||ifFls2){
                    MsgAlert({content: '请勾选涉及时限结构!', type: 'error'});
                    return true;
                }
            }*/
            //save();
        }
        if (datas.tCal != "" || datas.tCalUnit != "") {
            if (datas.tCal == "" || datas.tCalUnit == "") {
                MsgAlert({content: '【首检参数3】、【首检参数3单位】必须选择!', type: 'error'});
                return true;
            }
        }
        if (datas.ivCal != "" || datas.ivCalUnit != "") {
            if (datas.ivCal == "" || datas.ivCalUnit == "") {
                MsgAlert({content: '【间隔参数3】、【间隔参数3单位】必须选择!', type: 'error'});
                return true;
            }
        }
        return false
    }
    //保存
    function save() {

        if (saveCheck()) {
            return;
        }
        var $form = $("#mform");
        var datas = $form.serializeObject();
        //判断该间隔类型是否已存在。
        //evalNo,intervalType
        var dataCheck;
        var intervalType = $("#intervalType").combobox("getValue");
        if (pkid) {
            dataCheck = $.extend({}, {
                evalNo: evalNo,
                intervalType: intervalType,
                pkid: pkid
            }, {FunctionCode: 'EM_MPD_EVAL_INTERVAL_EDIT_CHECK'});
        } else {
            dataCheck = $.extend({}, {
                evalNo: evalNo,
                intervalType: intervalType
            }, {FunctionCode: 'EM_MPD_EVAL_INTERVAL_ADD_CHECK'});
        }
        InitFuncCodeRequest_({
            data: dataCheck, async: false, successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    if (jdata.data.length > 0) {
                        MsgAlert({content: '已存在该间隔类型，不可重复添加', type: 'error'});

                    } else {
                        var $tFhIfPost = document.getElementById('tFhIfPost');
                        var $tFcIfPost = document.getElementById('tFcIfPost');
                        var $tCalIfPost = document.getElementById('tCalIfPost');
                        var $tIfStc = document.getElementById('tIfStc');
                        var $ifFls1 = document.getElementById('ifFls1');
                        var $ifFls2 = document.getElementById('ifFls2');
                        var $tIfNote = document.getElementById('tIfNote');
                        var $ivIfNote = document.getElementById('ivIfNote');
                        var $ifTbd = document.getElementById('ifTbd');
                        var datas = $form.serializeObject();
                        datas.tFhIfPost = $tFhIfPost.checked ? "Y" : "N";
                        datas.tFcIfPost = $tFcIfPost.checked ? "Y" : "N";
                        datas.tCalIfPost = $tCalIfPost.checked ? "Y" : "N";
                        datas.tIfStc = $tIfStc.checked ? "Y" : "N";
                        datas.ifFls1 = $ifFls1.checked ? "Y" : "N";
                        datas.ifFls2 = $ifFls2.checked ? "Y" : "N";
                        datas.tIfNote = $tIfNote.checked ? "Y" : "N";
                        datas.ivIfNote = $ivIfNote.checked ? "Y" : "N";
                        datas.ifTbd = $ifTbd.checked ? "Y" : "N";

                        datas = $.extend({}, datas, {FunctionCode: 'EM_MPD_EVAL_INTERVAL_SAVE'});
                        InitFuncCodeRequest_({
                            data: datas, successCallBack: function (jdata) {
                                console.info(jdata);
                                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                    pkid = jdata.data.pkid;
                                    $("#pkid").val(jdata.data.pkid);
                                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                                    reload_('wholeTable');
                                    param.OWindow.reloadg2_();
                                } else {
                                    MsgAlert({content: jdata.msg, type: 'error'});
                                }
                            }
                        });
                    }
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }
    $.extend($.fn.validatebox.defaults.rules, {
        positive: {
            //正数且保留两位小数
            validator: function(value, param){
                if( /^(?!0+(?:\.0+)?$)(?:[1-9]\d*|0)(?:\.\d{1,2})?$/.test(value) ){
                    return true;
                } else {
                    return false;
                }
                // return value.length >= param[0];
            },
            message: '请输入正数'
        }
    });
</script>
</html>


