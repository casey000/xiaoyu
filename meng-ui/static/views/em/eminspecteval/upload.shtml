<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <!--#include virtual="/views/items/resource_.shtml"-->
    <script type="text/javascript" src="/js/plugins/ajaxfileupload/ajaxfileupload.js"></script>
    <title>文件上传</title>
</head>
<body>


<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="mform">
                <!--<input type="hidden" name="docVer" value="1">-->
                <table class="table table-bordered table-info">
                    <th class="tdl">上传文件：</th>
                    <td class="tdr" colspan="5">
                        <input class="textbox easyui-validatebox" type="file" name="xlsFile" id="xlsFile"
                               data-options="buttonText:'请选择Excel文件'" style="width: 99%;"/>
                    </td>
                    <td colspan="6" align="center"><input class="btn btn-primary" type="submit" id="saveBtn"
                                                          value="提交"/></td>
                    </td>
                </table>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript" src="/js/common.js"></script>
<script type="text/javascript">
    var successCallBack;
    var fileName;
    var pkid;

    function i18nCallBack() {
        param = getParentParam_();
        pkid = param.pkid;
        InitForm_();
    }

    //回填
    function InitForm_() {
        $('#mform').form({
            onSubmit: function () {
                var $form = $("#mform");
                uploadData();
                return false;
            }
        });
    }

    /* $(function () {
         $("#submit").click(function () {

         })
     });*/

    function uploadData() {
        if ($("#xlsFile").val() == "") {
            parent.layer.msg("请选择上传文件！", {icon: 5});
            return false;
        }
        /*if (!validFileSuffix_($("#xlsFile"), ".xls")) {
            parent.layer.msg("上传文件格式必须为[.xls]文件！", {icon: 5});
            return false;
        }*/
        MaskUtil.mask("数据处理时间较长，请耐心等待...");
        $.ajaxFileUpload({
            url: Constant.API_URL + 'EM_AC_IN_CHECK_UPLOAD',
            secureuri: false,
            fileElementId: 'xlsFile',
            dataType: 'json',
            data: {
                "pkid": pkid,
                "fileName": $("#xlsFile").val()
            },
            success: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    MaskUtil.unmask();
                    param.OWindow.reload_();
                    CloseWindowIframe();
                } else {
                    MsgAlert({content: jdata.data ? jdata.data : jdata.msg, type: 'error'});
                    MaskUtil.unmask();
                }
            }
        });
    }

</script>
</body>
</html>
