<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/html">
<head id="i18n_" module="em_cmp">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="">模版管理</title>
    <style>
        .abc {
            cursor: pointer;
        }
    </style>
</head>
<body class="ibody">
<div id="tt" class="easyui-tabs" style="">
    <div title="文件维护" style="">
        <div>

            <br/>
            <table class="table table-bordered table-info">
                <tr>
                    <th class="th" align="right" style="width: 80px;">模版文件：</th>
                    <td class="tdr" style="width: 150px">
                        <span id="awlFileName"></span>
                    </td>
                    <td class="tdr" style="width: 150px">
                        <input class="btn btn-primary" type="button" style="margin-left:30px;"
                               onclick="uploadAwl()" value="上传附件"/>&nbsp;&nbsp;
                    </td>

                </tr>
            </table>
            <br/>
            <br/>
            <!--文件：<span id="fileName"></span>-->
        </div>
    </div>
</div>
</div>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var awlSourceId = 'EMINSPECTEVAL123';
    var cat = 'EMINSPECTEVAL';

    function i18nCallBack() {
        successCallBackAwl();
    }


    $("span").mouseover(function () {
        $(this).css({
            "border-color": "green",
            "color": "blue"
        });
    }).mouseout(function () {
        $(this).css({
            "border-color": "green",
            "color": "green"
        });
    });

    function reload_() {
        successCallBackAwl();
    }

    //上传AWL附件
    function uploadAwl() {
        common_upload_({
            /*  identity: identity,*/
            param: {cat: cat, sourceId: awlSourceId, successCallBack: successCallBackAwl, failCallBack: "bb"},
        });
    }

    function successCallBackAwl() {
        InitFuncCodeRequest_({
            data: {SOURCE_ID: awlSourceId, CATEGORY: cat, FunctionCode: 'ATTACHMENT_RSPL_GET'},
            successCallBack: function (jdata) {
                var html = "";
                var fileName;
                for (var i = 0; i < jdata.data.length; i++) {
                    var erdat = jdata.data[i].ERDAT;
                    var orgName = jdata.data[i].ORG_NAME;
                    orgName = orgName.split(".")[0] + "_" + erdat + "." + orgName.split(".")[1];
                    fileName = '<li>' + orgName + '&nbsp;&nbsp;&nbsp;&nbsp;<span class="abc" style="text-decoration: underline;" name ="del" onclick="deleteFile(\'' + jdata.data[i].PKID + '\');">删除</span>' + '&nbsp;&nbsp;&nbsp;&nbsp;<span class="abc" style="text-decoration: underline;" onclick="downFile(' + jdata.data[i].PKID + ',' + jdata.data[i].PKID + ');">下载</span>' + '</li>';
                    html += fileName
                }
                document.getElementById("awlFileName").innerHTML = html;


            }
        })
    }

    //下载
    function downFile(pkid, filename) {
        InitFuncCodeRequest_({
            data: {pkid: pkid, filename: filename, FunctionCode: 'ATTACHMENT_DOWN'},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    doPost(Constant.API_URL + "/ATTACHMENT_DOWN", {pkid: pkid, filename: filename, down: 'Y'});
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
    }


</script>
</body>
</html>
