<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="RES.EM_SYSCONFIG_REG.TITLE">系统构型</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
</head>
<body class="ibody">
<div id="tt" class="easyui-tabs">
    <div title="系统构型查询">
        <fieldset class="fieldset_eui">
            <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
            <form id="ffSearch" method="post">
                <div id="searchBar">
                    <input type="hidden" name="status" value="RELEASED" />
                    <table class="table table-bordered table-info">
                        <tr>
                            <th style="width: 70px">构型编号：</th>
                            <td>
                                <input class="easyui-textbox" name="configNo" id="configNo"
                                       style="width:120px;"/>
                            </td>
                            <th style="width: 70px">适用类型：</th>
                            <td>
                                <input class="easyui-combobox" name="appType" id="appType"
                                       style="width:120px;"/>
                            </td>
                            <th id="id_fleet" style="width: 70px">机队：</th>
                            <td>
                                <input class="easyui-combobox" name="fleet" id="fleet"
                                       style="width:120px;"/>
                            </td>
<!--                            增加查询条件-->
                            <th style="width: 70px">构型描述：</th>
                            <td>
                                <input class="easyui-textbox" name="configDesc" id="comfigDesc"
                                       style="width:120px;"/>
                            </td>
                            <td>
                                <a class="searchBtn" data-options="iconCls:'icon-search'"
                                   data-i18n="common:COMMON_OPERATION.QUERY" onclick="onSearch_('dg', '#ffSearch')">查询</a>
                                <a class="ridoBtn" data-options="iconCls:'icon-search'"
                                   onclick="helpQuery('dg', 'EM_SYSCONFIG_REG_LIST');" >高级查询</a>
                                <a class="excelBtn" id="excelExport"
                                   onclick="excelExport('dg', '系统构型清单', '')"
                                   data-options="iconCls:'icon-page_excel'">
                                    <span data-i18n="common:COMMON_OPERATION.EXPORT">导出</span>
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </fieldset>
        <table id="dg"></table>
    </div>
    <div title="单机查询">
        <fieldset class="fieldset_eui">
            <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
            <form id="ffSearch1" method="post">
                <div id="searchBar1">
                    <table class="table table-bordered table-info">
                        <tr>
                            <th style="width: 70px">机队：</th>
                            <td style="width: 150px">
                                <input class="easyui-combobox" name="fleet" id="fleet2" style="width:120px;"/>
                            </td>
                            <th style="width: 70px">注册号：</th>
                            <td style="width: 150px">
                                <input class="easyui-combobox" name="appId" id="appId" style="width:120px;"/>
                            </td>
                            <th style="width: 70px">构型编号：</th>
                            <td style="width: 150px;">
                                <input class="easyui-textbox" name="configNo1" id="configNo1"
                                       style="width:120px;"/>
                            </td>
                            <td>
                                <a class="searchBtn" data-options="iconCls:'icon-search'"
                                   data-i18n="common:COMMON_OPERATION.QUERY" onclick="onSearch_('dg1', '#ffSearch1')">查询</a>
                                <a class="ridoBtn" data-options="iconCls:'icon-search'"
                                   onclick="helpQuery('dg1', 'EM_SYSCONFIG_ONBOARD_AC_LIST');" >高级查询</a>
                                <a class="searchBtn" data-options="iconCls:'icon-clear'"
                                   onclick="excelExport('dg1', '单机系统构型','')">导出</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </fieldset>
        <table id="dg1"></table>
    </div>
</div>
<script type="text/javascript">
    var PAGE_DATA = {};
    var wsOrgList = null;
    function i18nCallBack() {
        InitFuncCodeRequest_({
            data: {
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE",
                domainCode:
                    "DA_FLEET," +
                    "DA_ENG_MODEL," +
                    "EM_SYSCONFIG_APP_TYPE," +
                    "EM_SYSCONFIG_STATUS," +
                    "YESORNO," +
                    "WS_USER,WS_ORG," +
                    "EM_SWCONFIG_ACNO" // fleet, appType, validFlag, status
            },
            successCallBack: function (jdata) {
                if (jdata.code === RESULT_CODE.SUCCESS_CODE) {
                    PAGE_DATA['appType'] = DomainCodeToMap_(jdata.data["EM_SYSCONFIG_APP_TYPE"]);
                    PAGE_DATA['validFlag'] = DomainCodeToMap_(jdata.data["YESORNO"]);
                    PAGE_DATA['status'] = DomainCodeToMap_(jdata.data["EM_SYSCONFIG_STATUS"]);
                    PAGE_DATA['userName'] = DomainCodeToMap_(jdata.data["WS_USER"]);
                    wsOrgList = jdata.data.WS_ORG;
                    $('#appType').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_SYSCONFIG_APP_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                        onSelect: function (item) {
                            $('#id_fleet').text(item.VALUE === "APL" ? "机队：" : "型号：");
                            $('#fleet').combobox({
                                panelHeight: '135px',
                                data: item.VALUE === "APL" ? jdata.data.DA_FLEET : jdata.data.DA_ENG_MODEL,
                                valueField: 'VALUE',
                                textField: 'TEXT'
                            });
                        }
                    });
                    $('#appId').combobox({
                        panelHeight: '300px',
                        data: jdata.data.EM_SWCONFIG_ACNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#fleet').combobox({
                        panelHeight: '120px',
                        data: jdata.data.DA_FLEET,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#fleet2').combobox({
                        panelHeight: '120px',
                        data: jdata.data.DA_FLEET,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
                params = getParentParam_();
                if(params.acReg){
                    $('#tt').tabs('select','单机查询');
                    for(let i in jdata.data.EM_SWCONFIG_ACNO){
                        if(jdata.data.EM_SWCONFIG_ACNO[i].TEXT == params.acReg){
                            $('#appId').combobox('setValue',jdata.data.EM_SWCONFIG_ACNO[i].VALUE);
                            InitDataGrid1(jdata.data.EM_SWCONFIG_ACNO[i].VALUE);
                            break;
                        }
                    }
                    InitDataGrid();
                }else{
                    InitDataGrid1();
                    InitDataGrid();
                }


            }
        });
    }

    function InitDataGrid() {
        var identity = 'dg';
        $("#dg").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: true,
            pageSize: 15,
            queryParams: {status: "RELEASED"},
            columns: {
                param: {FunctionCode: 'EM_SYSCONFIG_REG_LIST'},
                alter: {
                    // SEND_TO_DEPT: {
                    //     formatter: function (value) {
                    //         if (value) {
                    //             var ret = [];
                    //             var ds = value.split(",");
                    //             for (var i = 0; i < ds.length; i++) {
                    //                 for (var j = 0; j < wsOrgList.length; j++) {
                    //                     if (ds[i] === wsOrgList[j].ORG_ID) {
                    //                         ret.push(wsOrgList[j].ORG_NAME);
                    //                         break;
                    //                     }
                    //                 }
                    //             }
                    //             return ret.join("，");
                    //         } else {
                    //             return "";
                    //         }
                    //     }
                    // },
                    VALID_FLAG: {
                        formatter: function (value) {
                            return PAGE_DATA['validFlag'][value];
                        }
                    },
                    APP_TYPE: {
                        formatter: function (value) {
                            return PAGE_DATA['appType'][value];
                        }
                    },
                    STATUS: {
                        formatter: function (value) {
                            return PAGE_DATA['status'][value];
                        }
                    },
                    CREATE_BY: {
                        formatter: function (value) {
                            return PAGE_DATA['userName'][value];
                        }
                    },
                    CREATE_DATE: {
                        type: 'date'
                    },
                    APPROVED_DATE: {
                        type: 'date'
                    },
                    // APPROVED_BY: {
                    //     formatter: function (value) {
                    //         return PAGE_DATA['userName'][value];
                    //     }
                    // }
                }
            },
            contextMenus: [
                {
                    id: "m-view",
                    i18nText: "查看",
                    onclick: function () {
                        var rowdata = getDG(identity).datagrid('getSelected');
                        if (!rowdata.PKID) {
                            MsgAlert({content: '请选择记录！', type: 'error'});
                            return;
                        }
                        common_add_edit_({
                            url: "/views/em/emsysconfig/em_sysconfig_view.shtml?pkid=" + rowdata.PKID,
                            identity: identity,
                            isEdit: 0,
                            width: 800,
                            height: 600
                        });
                    }
                }
            ]
        });
    }

    function InitDataGrid1(appId) {
        var identity = 'dg1';
        $("#dg1").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: true,
            pageSize: 15,
            queryParams: {appId: appId || "0"},
            columns: {
                param: {FunctionCode: 'EM_SYSCONFIG_ONBOARD_AC_LIST'},
                alter: {
                    // SEND_DEPT: {
                    //     formatter: function (value) {
                    //         if (value) {
                    //             var ret = [];
                    //             var ds = value.split(",");
                    //             for (var i = 0; i < ds.length; i++) {
                    //                 for (var j = 0; j < wsOrgList.length; j++) {
                    //                     if (ds[i] === wsOrgList[j].ORG_ID) {
                    //                         ret.push(wsOrgList[j].ORG_NAME);
                    //                         break;
                    //                     }
                    //                 }
                    //             }
                    //             return ret.join("，");
                    //         } else {
                    //             return "";
                    //         }
                    //     }
                    // },
                    CREATE_BY: {
                        formatter: function (value) {
                            return PAGE_DATA['userName'][value];
                        }
                    }
                }
            },
            contextMenus: [
                {
                    id: "m-view",
                    i18nText: "查看",
                    onclick: function () {
                        var rowdata = getDG(identity).datagrid('getSelected');
                        if (!rowdata.PKID) {
                            MsgAlert({content: '请选择记录！', type: 'error'});
                            return;
                        }
                        common_add_edit_({
                            url: "/views/em/emsysconfig/em_sysconfig_view.shtml?pkid=" + rowdata.PKID,
                            identity: identity,
                            isEdit: 0,
                            width: 800,
                            height: 600
                        });
                    }
                }
            ]
        });
    }
</script>
</body>
</html>
