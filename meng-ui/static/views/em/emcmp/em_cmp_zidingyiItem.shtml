<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="em_cmp">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="">维修方案</title>
</head>
<body class="ibody">
<div style="">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="nform">
                <table class="table table-bordered table-info">
                    <table class="table table-bordered table-info">
                        <tr>

                            <td class="tdr">
                                <a href="javascript:void(0)" onclick="chakan()" style="width:100px" id="itemNumber"></a>
                            </td>

                            <th class="td1" style="width:80px">修订标识：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="revCode" name="revCode"
                                       style="width:100px" value="N"
                                       data-options="required:true,editable:false,onlyview:false"/>
                            </td>
                            <td class="tdr">
                                <input class="btn btn-primary" type="button" onclick="selectcard()" id="choosecard"
                                       value="选择工卡"/>
                            </td>
                            <th class="td1" style="width:80px">项目号：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="itemNo" name="itemNo"
                                       style="width:200px"
                                       data-options="required:true"/>
                            </td>
                            <td id="baocun" align="right" style="width:38% ">
                                <!-- <input class="btn btn-primary" type="button" onclick="addInteval()" value="增加间隔"/>-->
                                <input class="btn btn-primary" id="tijiao" type="button" onclick="tiJiaoSp()"
                                       value="提交审核"/>
                                <input class="btn btn-primary" type="submit" id="submit" value="保存"/>
                            </td>
                        </tr>
                    </table>
                    <table class="table table-bordered table-info">
                        <tr id="guodu2">
                            <th class="tdl" style="width:100px">过渡要求：</th>
                            <td class="tdr" colspan="10">
                                <input class="easyui-textbox" name="tmpRequire" id="tmpRequire"
                                       data-options="multiline:true "
                                       style="height:60px; width:830px;"/>
                            </td>
                        </tr>
                        <tr id="guodu1">
                            <th class="tdl" style="width:76px">需求过渡：</th>
                            <td class="tdr">
                                <input class="easyui-combobox easyui-validatebox" id="ifTmp" name="ifTmp"
                                       style="width:60px"
                                       data-options="onChange:changeFormatForGudu"/>
                            </td>
                            <th class="tdl" style="width:80px">从方案生效起过渡时限FH：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="tmpFh" name="tmpFh"
                                       style="width:60px"
                                       data-options=""/>
                            </td>
                            <th class="tdl" style="width:80px">过渡时限FC：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="tmpFc" name="tmpFc"
                                       style="width:70px"
                                       data-options=""/>
                            </td>

                            <th class="tdl" style="width:80px">过渡时限日历日：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="tmpCal" name="tmpCal"
                                       style="width:50px"
                                       data-options=""/>

                                <input class="easyui-combobox easyui-validatebox" id="tmpCalUnit"
                                       name="tmpCalUnit"
                                       style="width:60px"
                                       data-options=""/>
                            </td>
                            <th class="tdl" style="width:80px">过渡监控方法：</th>
                            <td class="tdr">
                                <input class="easyui-combobox easyui-validatebox" id="tmpIntervalRule"
                                       name="tmpIntervalRule" style="width:60px"
                                       data-options=""/>
                            </td>
                        </tr>
                        <tr>
                            <th class="tdl" style="width:100px">修订说明：</th>
                            <td class="tdr" colspan="10">
                                <input class="easyui-textbox" name="revDesc" id="revDesc"
                                       data-options="required:true,multiline:true "
                                       style="height:60px; width:830px;"/>
                            </td>
                        </tr>
                    </table>
                    <div id="div2">
                        <fieldset class="fieldset_eui" style="width:99%;margin-right:5px">
                            <legend data-i18n="">CMP信息</legend>
                            <table class="table table-bordered table-info">
                                <input type="hidden" id="count" name="count">
                                <input type="hidden" id="ifPse" name="ifPse">
                                <input type="hidden" id="awlType" name="awlType">
                                <input type="hidden" id="docType" name="docType">
                                <input type="hidden" id="docSource" name="docSource">
                                <input type="hidden" id="pkid" name="pkid">
                                <input type="hidden" id="fleet" name="fleet">
                                <input type="hidden" id="itemPkid" name="itemPkid">
                                <input type="hidden" id="docVer" name="docVer">
                                <!--<input type="hidden" id="ata" name="ata">-->
                                <input type="hidden" id="evalNo" name="evalNo">
                                <input type="hidden" id="evalBy" name="evalBy">
                                <input type="hidden" id="evalState" name="evalState">
                                <input type="hidden" id="writeDeadline" name="writeDeadline">
                                <input type="hidden" id="type" name="type" style="width: 100px;"/>
                                <tr>
                                    <th class="tdl" style="width:100px">适用类型：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="applType" name="applType"
                                               style="width:100px"
                                               data-options="required:true,onChange:changeFormat3"/>
                                    </td>
                                    <th class="tdl" style="width:100px">工作类别：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="taskCode" name="taskCode"
                                               style="width:100px"
                                               data-options="required:true"/>
                                    </td>

                                    <th class="tdl" style="width:100px">检验等级：</th>
                                    <td class="tdr" colspan="3">
                                        <input class="easyui-combobox" id="chkLevel" name="chkLevel"
                                               style="width:100px"
                                               data-options="required:true"/>
                                    </td>
                                </tr>
                                <tr>
                                    <!--  <th class="tdl" style="width:100px">监控方法：</th>
                                      <td class="tdr">
                                          <input class="easyui-combobox" id="intervalRule"
                                                 name="intervalRule"
                                                 style="width:100px"
                                                 data-options="required:true"/>
                                      </td>-->
                                    <th class="tdl" style="width:100px">项目分类：</th>
                                    <td class="tdr">
                                        <input class="easyui-combobox" id="itemType" name="itemType"
                                               style="width:100px"
                                               data-options="required:true,editable:false,onlyview:true"/>
                                    </td>
                                    <td class="tdr" colspan="6">
                                        <input type="checkbox" id="ifWb" name="ifWb" style="width: 30px;" value="Y">&nbsp;称重项目&nbsp;&nbsp;
                                        <input type="checkbox" id="ifSpl" name="ifSpl" style="width: 30px;" value="Y">&nbsp;抽样项目&nbsp;&nbsp;
                                        <input type="checkbox" id="ifOptimized" name="ifOptimized" style="width: 30px;"
                                               value="Y">&nbsp;优化项目
                                    </td>
                                </tr>
                                <tr id="fawei">
                                    <!--    <th class="tdl" style="width:100px">发位：</th>
                                        <td class="tdr">
                                            <input class="easyui-combobox" id="engLocation"
                                                   name="engLocation"
                                                   style="width:120px"
                                                   data-options="required:false"/>
                                        </td>-->
                                </tr>
                                <tr id="leibie">
                                    <th class="tdl" style="width:90px">类别：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" id="source" name="source"
                                               data-options=""
                                               style="height:20px; width:200px;"/>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:90px"><span id="yiju"></span> ：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" id="ammRef" name="ammRef"
                                               style="width:830px;height:60px;"
                                               data-options="multiline:true"/>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tdl" style="width:90px">英文描述：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" id="engDesc" name="engDesc"
                                               data-options="required:true,multiline:true "
                                               style="height:60px; width:830px;"/>
                                    </td>
                                </tr>


                                <tr>
                                    <th class="tdl" style="width:100px">中文描述：</th>
                                    <td class="tdr" colspan="9">
                                        <input class="easyui-textbox" name="chnDesc" id="chnDesc"
                                               data-options="required:true,multiline:true "
                                               style="height:60px; width:830px;"/>
                                    </td>
                                </tr>
                            </table>
                            <table class="table table-bordered table-info">
                                <tr id="">
                                    <th class="tdl" style="width:100px">备注：</th>
                                    <td class="tdr" colspan="10">
                                        <input class="easyui-textbox" name="memo" id="memo"
                                               data-options="multiline:true "
                                               style="height:60px; width:830px;"/>
                                    </td>
                                </tr>
                            </table>
                            <table id="dg"></table>
                        </fieldset>
                    </div>
                    <div id="div3">
                        <table class="table table-bordered table-info">
                            <tr align="right">
                                <td align="right">
                                    <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                           type="button" onclick="addpart()"
                                           style="margin-right:5px;margin-top:5px;float: right"
                                           value="增加"/>
                                </td>
                            </tr>
                        </table>
                        <fieldset class="fieldset_eui" style="float:left;width:1050px;height:230px; margin-right:5px">
                            <legend data-i18n="">部件信息--部件</legend>
                            <table cellspacing="0" cellpadding="2">
                            </table>
                            <table id="dg2"></table>
                        </fieldset>
                    </div>
                    <div id="div4">
                        <table class="table table-bordered table-info">
                            <tr align="right">
                                <td align="right">
                                    <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                           type="button" onclick="viewAppl()"
                                           style="margin-right:5px;margin-top:5px;float: right" value="预览适用性"/>
                                    <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                           type="button" onclick="addInteval()"
                                           style="margin-right:5px;margin-top:5px;float: right"
                                           value="增加"/>
                                </td>
                            </tr>
                        </table>
                        <fieldset class="fieldset_eui" style="float:left;width:1050px;height:230px; margin-right:5px">
                            <legend data-i18n="">维修间隔--机身</legend>
                            <table cellspacing="0" cellpadding="2">
                            </table>
                            <table id="dg3"></table>
                        </fieldset>
                    </div>
                    <div id="div5">
                        <table class="table table-bordered table-info">
                            <tr align="right">
                                <td align="right">
                                    <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                           type="button" onclick="viewAppl()"
                                           style="margin-right:5px;margin-top:5px;float: right" value="预览适用性"/>
                                    <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                           type="button" onclick="addInteval()"
                                           style="margin-right:5px;margin-top:5px;float: right"
                                           value="增加"/>
                                </td>
                            </tr>
                        </table>
                        <fieldset class="fieldset_eui" style="float:left;width:1050px;height:230px; margin-right:5px">
                            <legend data-i18n="">维修间隔--发动机/APU</legend>
                            <table cellspacing="0" cellpadding="2">
                            </table>
                            <table id="dg4"></table>
                        </fieldset>
                    </div>
                    <!-- <div id="div5">
                         <fieldset class="fieldset_eui" style="float:left;width:99%;height:200px;margin-right:5px">
                             <legend data-i18n="">维修间隔&#45;&#45;发动机/APU</legend>
                             <tr align="right">
                                 <td align="right">
                                     <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                            type="button" onclick="addInteval()"
                                            style="margin-right:5px;margin-top:5px;float: right" value="增加"/>
                                     &lt;!&ndash; <input class="btn btn-primary" data-options="iconCls:'icon-filter'"
                                             type="button" onclick="copyappl()" value="复制适用性"/>&ndash;&gt;
                                 </td>
                             </tr>
                             <table cellspacing="0" cellpadding="2">
                             </table>
                             <table id="dg4"></table>
                         </fieldset>
                     </div>-->

                </table>
                <table id="wholeTable"></table>
            </form>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript" src="/js/common.js"></script>

<script type="text/javascript">

    var param = {};
    var itemData;
    var itemNumber;
    var edit;
    var flag;
    /*var engName;*/
    var fleet;
    var count;
    var PKID;
    var INTERVAL_PKID;

    var evalState;
    param = getParentParam_();
    PKID = param.itemPkid;
    // evalNo = itemData.evalNo;
    var isEdit_ = param.itemPkid;
    var itemPkid = param.itemPkid;
    var cmpPkid = param.cmpPkid;
    fleet = param.fleet;
    var itemType = param.type;
    var gbr = param.GB;
    $("#itemType").combobox({value: itemType});
    $("#choosecard").attr("disabled", "true");

    var applType1 = {};
    var applType2 = {};

    function i18nCallBack() {

        InitFuncCodeRequest_({
            data: {
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE",
                domainCode: "EM_ITEM_TYPE,EM_MP_CALENDAR_UNIT,EM_MPD_IF_TMP,EM_ENG_LOCATION,EM_IF_NEW_PART_EVA,EM_MPD_ITEM_TYPE,EM_IF_APPL,EM_IF_REV_CMP,EM_APPL_TYPE,EM_MPD_CTL_TYPE,EM_MP_CHK_LEVEL,EM_INTERVAL_RULE,EM_ATTACH_OPTION"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $('#engLocation').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_ENG_LOCATION,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#tmpIntervalRule').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_INTERVAL_RULE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    /* $('#mpdNo').combobox({
                     panelHeight: '120px',
                     data: jdata.data.EM_MPD_NO,
                     valueField: 'VALUE',
                     textField: 'TEXT',
                     });*/
                    $('#ifTmp').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MPD_IF_TMP,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#tmpCalUnit').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_CALENDAR_UNIT,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });

                    $('#ifNewPartEva').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_IF_NEW_PART_EVA,
                        valueField: 'VALUE',
                        textField: 'TEXT',

                    });
                    $('#attachOption').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_ATTACH_OPTION,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT',

                    });
                    /*    $('#intervalRule').combobox({
                            panelHeight: '120px',
                            data: jdata.data.EM_INTERVAL_RULE,
                            valueField: 'VALUE',
                            textField: 'TEXT',

                        });*/

                    if (!PKID) {
                        if (itemType == 'PART') {
                            $('#applType').combobox({
                                panelHeight: '120px',
                                data: jdata.data.EM_APPL_TYPE2,
                                valueField: 'VALUE',
                                textField: 'TEXT',

                            });
                        } else {
                            $('#applType').combobox({
                                panelHeight: '120px',
                                data: jdata.data.EM_APPL_TYPE1,
                                valueField: 'VALUE',
                                textField: 'TEXT',
                            });
                        }
                    }
                    $('#itemType').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_ITEM_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });

                    $('#chkLevel').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_MP_CHK_LEVEL,
                        valueField: 'VALUE',
                        textField: 'TEXT',

                    });
                    $('#ifAppl').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_IF_APPL,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                    $('#ifRevCmp').combobox({
                        panelHeight: '120px',
                        data: jdata.data.EM_IF_REV_CMP,
                        valueField: 'VALUE',
                        textField: 'TEXT',

                    });
                    /*  $('#ctlType').combobox({
                          panelHeight: '120px',
                          data: jdata.data.EM_MPD_CTL_TYPE,
                          valueField: 'VALUE',
                          textField: 'TEXT',
                      });*/

                    if (isEdit_) {
                        test();
                        $('#type').val(gbr);
                    } else {
                        $("#div3").hide();
                        $("#div4").show();
                        $("#div5").hide();

                    }
                    InitEditForm_();
                    InitDataGrid2();
                    setTimeout("InitDataGrid()", 600);
                    setTimeout("InitDataGrid3()", 600);
                    var d1 = $('#itemType').combobox('getValue');
                    if (d1 == 'PART' || d1 == 'MON') {
                        document.getElementById("yiju").innerHTML = "参考文件";
                        $("#leibie").hide();
                    } else {
                        $("#leibie").show();
                        document.getElementById("yiju").innerHTML = "依据";
                    }
                    //$('#itemNumber').text('eryg');
                    return false;

                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });


    }

    function tiJiaoSp() {
        //检查该项目是否保存
        if (!isEdit_) {
            MsgAlert({content: '请先保存主数据', type: 'error'});
            return false;
        }
        //判断
        var jg = '';
        var syx = '';
        var applType = $("#applType").combobox("getValue");
        //适用类型
        if (applType != "PART") {
            InitFuncCodeRequest_({
                data: {
                    pkid: itemPkid,
                    FunctionCode: "EM_CMP_ITEM_IFHAVE_JG"
                },
                async: false,
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        jg = jdata.data.jg;
                        syx = jdata.data.syx;

                    } else {
                        MsgAlert({content: jdata.msg, type: 'error'});
                    }
                }
            });


            if (jg == 0) {
                MsgAlert({content: "请保证项目至少有一条间隔", type: 'error'});
                return false;
            }
            if (syx) {
                MsgAlert({content: "当前评估间隔中尚未添加适用性", type: 'error'});
                return false;
            }

        }
        ShowWindowIframe({
            width: 300,
            height: 200,
            title: "提交审核",
            param: {itemPkid: itemPkid},
            url: "/views/em/emcmp/em_cmp_commit.shtml"
        });


    }

    function InitEditForm_() {
        var $form = $("#nform");
        $form.form({
            onSubmit: function () {
                var $form = $("#nform");
                var isValidate = $(this).form('validate');
                if (!isValidate) {
                    return false;
                }
                /*  var $ifSpl = document.getElementById('ifSpl');
                  var $ifOptimized = document.getElementById('ifOptimized');
                  var $ifWb = document.getElementById('ifWb');*/
                /*    data.ifSpl = $ifSpl.checked;
                    data.ifOptimized = $ifOptimized.checked;
                    data.ifWb = $ifWb.checked;*/

                //添加之前判断项目唯一性
                //获取项目得pkid
                var num = 0;
                var data = $form.serializeObject();
                if (!isEdit_) {
                    InitFuncCodeRequest_({
                        data: {
                            cmpPkid: cmpPkid,
                            itemNo: data.itemNo,
                            FunctionCode: "EM_ITEM_IF_HAVE"
                        },
                        async: false,
                        successCallBack: function (jdata3) {
                            if (jdata3.code == RESULT_CODE.SUCCESS_CODE) {
                                num = jdata3.data.NUM;

                            }
                            else {
                                MsgAlert({content: jdata3.msg, type: 'error'});
                            }
                        }
                    });
                }
                if (num != 0) {
                    MsgAlert({content: "项目号已存在", type: 'error'});
                    return false;
                }

                data = $.extend({}, data, {
                    FunctionCode: (isEdit_ ? 'EM_CMP_ITEM_UPDATE' : 'EM_CMP_ITEM_ADD'), cmpPkid: cmpPkid
                });
                /* if(!isEdit_)
                 {
                     data.fleet = fleet;
                 }*/
                data.fleet = fleet;
                InitFuncCodeRequest_({
                    data: data,
                    successCallBack: function (jdata) {
                        if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                            MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                            itemPkid = jdata.data.pkid;
                            $("#pkid").val(jdata.data.pkid);
                            isEdit_ = itemPkid;
                            param.OWindow.reload_();
                            reload_();
                        } else {
                            MsgAlert({content: jdata.msg, type: 'error'});
                        }
                    }
                });
                return false;
            }
        });
    }

    //维修间隔--机身
    function InitDataGrid() {
        if (!itemPkid) {
            itemPkid = -1;
        }
        var identity = 'dg3';
        $("#dg3").MyDataGrid({
            identity: identity,
            fit: true,
            queryParams: {itemPkid: itemPkid},
            columns: {
                param: {FunctionCode: 'EM_WEIXIUJG_CMP_JS'},
            },

            /*  validAuth ：function（）{
             if（）{

             }
             }*/
            contextMenus: [

                {
                    id: "m-delete", i18nText: "删除", auth: "",
                    onclick: function () {
                        /*var rowdata = getDG(identity).datagrid('getSelected');
                        var PKID1 = rowdata.TPKID;*/

                        common_delete_({
                            identity: identity,
                            cfmI18next: "msg_tip:TIP.COMMON.DEL_CONFIRM",
                            param: {PKID: "TPKID"},
                            FunctionCode: "EM_CMP_EVAL_INTERVAL_DELETE"
                        });
                    }
                },
                {
                    id: "m-edit", i18nText: "编辑", auth: "",
                    onclick: function () {
                        var $ifSpl = document.getElementById('ifSpl');
                        var $ifOptimized = document.getElementById('ifOptimized');
                        //都不选中时
                        var rowdata = getDG(identity).datagrid('getSelected');
                        var PKID1 = rowdata.TPKID;

                        //两个都没有选的
                        var applType = $('#applType').combobox('getValue');

                        if (applType == "ENG") {
                            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "NULL", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });

                            }
                            //选中抽样和优化时
                            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "CY", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });

                            }
                            //只选中优化时
                            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "Y", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });
                            }
                            //只选中抽样时
                            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "C", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });
                            }
                        } else if (applType == "APU") {
                            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "NULL", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });

                            }
                            //选中抽样和优化时
                            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "CY", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });

                            }
                            //只选中优化时
                            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "Y", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });
                            }
                            //只选中抽样时
                            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "C", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });
                            }
                        } else {
                            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "NULL", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });

                            }
                            //选中抽样和优化时
                            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "CY", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });

                            }
                            //只选中优化时
                            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "Y", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });
                            }
                            //只选中抽样时
                            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {PKID: PKID1, isEdit: 1, type: "C", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });
                            }
                        }
                    }

                },
                {
                    id: "m-edit", i18nText: "复制适用性", auth: "",
                    onclick: function () {
                        var rowdata = getDG(identity).datagrid('getSelected');
                        var PKID1 = rowdata.TPKID;

                        common_add_edit_({
                            identity: identity, isEdit: 1,
                            param: {PKID: PKID1, itemPkid: itemPkid},
                            url: '/views/em/emcmp/em_cmpeval.copyInterval.shtml'
                        });
                    }

                }

            ]
        });
    }

    //部件信息--部件(先不写)
    function InitDataGrid2() {
        if (!itemPkid) {
            itemPkid = -1;
        }
        var identity = 'dg2';
        $("#dg2").MyDataGrid({
            identity: identity,
            fit: true,
            queryParams: {itemPkid: itemPkid},
            columns: {
                param: {FunctionCode: 'EM_CMP_PNTL_LIST'},
            },
            contextMenus: [
                {
                    id: "m-delete", i18nText: "删除", auth: "",
                    onclick: function () {
                        var rowdata = getDG('dg2').datagrid('getSelected');

                        $.messager.confirm('', '是否删除', function (r) {
                            if (r) {
                                InitFuncCodeRequest_({
                                    data: {
                                        PKID: rowdata.PKID,
                                        FunctionCode: "EM_CMP_EVAL_PN_DELETE"
                                    },
                                    successCallBack: function (jdata) {
                                        if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                            reload_();
                                        }
                                        else {
                                            MsgAlert({content: jdata.msg, type: 'error'});
                                        }
                                    }
                                });
                            } else {

                            }
                        });

                    }
                },
                {
                    id: "m-edit", i18nText: "编辑", auth: "",
                    onclick: function () {
                        var rowdata = getDG('dg2').datagrid('getSelected');

                        ShowWindowIframe({
                            width: 980,
                            height: 340,
                            param: {PKID: rowdata.PKID, isEdit: 1},
                            title: "部件增加",
                            url: "/views/em/emcmp/em_cmpeval_addPart2.shtml"
                        });
                    }

                },
            ],
        });
    }

    function selectcard() {
        var itemNo = $("#itemNo").val();
        ShowWindowIframe({
            width: 1100,
            height: 550,
            param: {itemNo: itemNo},
            title: "评估",
            url: "/views/em/emmpdeval/em.mpdeval.evalnote.card.shtml"
        });
    }

    //维修间隔--发动机/APU
    function InitDataGrid3() {
        if (!itemPkid) {
            itemPkid = -1;
        }
        var identity = 'dg4';
        $("#dg4").MyDataGrid({
            identity: identity,
            fit: true,
            queryParams: {itemPkid: itemPkid},
            columns: {
                param: {FunctionCode: 'EM_CMP_WEIXIUJG_APU'},
            },
            contextMenus: [
                {
                    id: "m-delete", i18nText: "删除", auth: "",
                    onclick: function () {
                        var rowdata = getDG(identity).datagrid('getSelected');
                        var PKID1 = rowdata.TPKID;

                        InitFuncCodeRequest_({
                            data: {
                                PKID: PKID1,
                                FunctionCode: "EM_CMP_EVAL_INTERVAL_DELETE"
                            },
                            successCallBack: function (jdata) {
                                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                                    reload_();
                                }
                                else {
                                    MsgAlert({content: jdata.msg, type: 'error'});
                                }
                            }
                        });
                    }
                },
                {
                    id: "m-edit", i18nText: "编辑", auth: "",
                    onclick: function () {

                        var $ifSpl = document.getElementById('ifSpl');
                        var $ifOptimized = document.getElementById('ifOptimized');
                        //都不选中时
                        var rowdata = getDG(identity).datagrid('getSelected');
                        var PKID1 = rowdata.TPKID;
                        //两个都没有选的
                        var applType = $('#applType').combobox('getValue');
                        if (applType == "ENG") {
                            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "NULL", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });
                            }
                            //选中抽样和优化时
                            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "CY", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });
                            }
                            //只选中优化时
                            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "Y", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });
                            }
                            //只选中抽样时
                            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "C", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                                });
                            }
                        } else if (applType == "APU") {
                            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "NULL", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });

                            }
                            //选中抽样和优化时
                            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "CY", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });

                            }
                            //只选中优化时
                            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "Y", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });
                            }
                            //只选中抽样时
                            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "C", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                                });
                            }
                        } else {
                            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "NULL", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });

                            }
                            //选中抽样和优化时
                            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "CY", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });

                            }
                            //只选中优化时
                            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "Y", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });
                            }
                            //只选中抽样时
                            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                                ShowWindowIframe({
                                    width: 970,
                                    height: 340,
                                    param: {itemPkid: itemPkid, PKID: PKID1, isEdit: 1, type: "C", fleet: fleet},
                                    title: "间隔增加",
                                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                                });
                            }
                        }
                    }
                },
                {
                    id: "m-edit", i18nText: "复制适用性", auth: "",
                    onclick: function () {
                        var rowdata = getDG(identity).datagrid('getSelected');
                        var PKID1 = rowdata.TPKID;
                        common_add_edit_({
                            identity: identity, isEdit: 1,
                            param: {PKID: PKID1, itemPkid: itemPkid},
                            url: '/views/em/emcmp/em_cmpeval.copyInterval.shtml'
                        });
                    }

                }
            ]
        });
    }


    function test() {
        InitFuncCodeRequest_({
            data: {pkid: PKID, FunctionCode: "EM_CMP_ITEM_GETONE"},
            async: false,
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {

                    console.log(applType2);

                    if (jdata.data.ITEM_TYPE == 'PART') {
                        $('#applType').combobox({
                            panelHeight: '120px',
                            data: applType2,
                            valueField: 'VALUE',
                            textField: 'TEXT',

                        });
                    } else {
                        $('#applType').combobox({
                            panelHeight: '120px',
                            data: applType1,
                            valueField: 'VALUE',
                            textField: 'TEXT',
                        });
                    }
                    ParseFormField_(jdata.data, null, Constant.CAMEL_CASE);
                    $('#itemNumber').text(jdata.data.ITEM_NUMBER);
                    $('#itemType').combobox({value: jdata.data.ITEM_TYPE});
                    $('#ifAppl').combobox({value: jdata.data.IF_APPL});
                    $('#ifRevCmp').combobox({value: jdata.data.IF_REV_CMP});
                    $('#chkLevel').combobox({value: jdata.data.CHK_LEVEL});
                    /*$('#ctlType').combobox({value: jdata.data.CTL_TYPE});*/
                    $('#applType').combobox({value: jdata.data.APPL_TYPE});
                    if (jdata.data.APPL_TYPE == undefined) {
                        $("#div3").hide();
                        $("#div4").hide();
                        $("#div5").hide();
                    }


                    /* if(jdata.data.APPL_TYPE=='ENG'||jdata.data.APPL_TYPE='APU'){
                     $("#div3").hide();
                     $("#div4").hide();
                     $("#div5").show();
                     }*/
                    if (jdata.data.APPL_TYPE == 'APL') {
                        $("#div3").hide();
                        $("#div4").show();
                        $("#div5").hide();
                    }
                    if (jdata.data.APPL_TYPE == 'PART') {
                        $("#div3").show();
                        $("#div4").hide();
                        $("#div5").hide();
                    }
                    /* $('#intervalRule').combobox({value: jdata.data.INTERVAL_RULE});*/
                    if (jdata.data.REV_CODE == "R" || jdata.data.REV_CODE == "D") {
                        $('#chayi').text('查看差异信息');
                    }
                    if (jdata.data.REV_CODE == "R") {
                        $("#choosecard").removeAttr("disabled");
                        $("#xiuding").show();
                        $("#xuanze").show();
                        $("#selectcard").show();
                    }
                    $('#ifTmp').combobox({value: jdata.data.IF_TMP});
                    if (jdata.data.IF_TMP == "N") {
                        $('#tmpCalUnit').combobox({editable: false, onlyview: true, required: false});
                        $('#tmpFh').textbox({editable: false, onlyview: true, required: false});
                        $('#tmpFc').textbox({editable: false, onlyview: true, required: false});
                        $('#tmpCal').textbox({editable: false, onlyview: true, required: false});
                        $('#tmpIntervalRule').combobox({editable: false, onlyview: true, required: false});
                        $('#tmpRequire').textbox({editable: false, onlyview: true, required: false});
                    }
                    $('#tmpCalUnit').combobox({value: jdata.data.TMP_CAL_UNIT});
                    $('#tmpIntervalRule').combobox({value: jdata.data.TMP_INTERVAL_RULE});
                    $('#attachOption').combobox({value: jdata.data.ATTACH_OPTION});
                    if (jdata.data.ENG_LOCATION != '') {
                        $('#engLocation').combobox({value: jdata.data.ENG_LOCATION});
                    }
                    $('#ifNewPartEva').combobox({value: jdata.data.IF_NEW_PART_EVA});
                    if (jdata.data.IF_NEW_PART_EVA == "Y") {
                        $('#newPn').textbox({editable: true, onlyview: false, required: true});
                        $('#newAta').textbox({editable: true, onlyview: false, required: true});
                        $('#fin').textbox({editable: true, onlyview: false, required: true});
                    } else {
                        $('#newPn').textbox({editable: false, onlyview: true, required: false});
                        $('#newAta').textbox({editable: false, onlyview: true, required: false});
                        $('#fin').textbox({editable: false, onlyview: true, required: false});
                    }
                    //$('#mpdNo').combobox({value: jdata.data.MPD_NO});
                    //判断是不是第一次执行这个方法
                    $('#count').val(0);
                    if (jdata.data.IF_NEW_PART_EVA == "N") {
                        $('#newPn').textbox({editable: true, onlyview: false, requried: true});
                        $('#newAta').textbox({editable: true, onlyview: false, requried: true});
                        $('#fin').textbox({editable: true, onlyview: false, requried: true});
                    } else {
                        $('#newPn').textbox({editable: true, onlyview: false, requried: true});
                        $('#newAta').textbox({editable: true, onlyview: false, requried: true});
                        $('#fin').textbox({editable: true, onlyview: false, requried: true});
                    }
                    if (jdata.data.IF_APPL == "N" || jdata.data.IF_APPL == null) {
                        //隐藏id为div2 的div
                        $('#mpdNo').textbox({editable: false, onlyview: true});
                        $('#cmpNo').textbox({value: ''});
                    }
                    //$('#tmpRequire').textbox({required: true, editable: false, onlyview: true});
                    /* if (jdata.data.ATTACH_OPTION != null || jdata.data.ATTACH_OPTION != '') {
                     $('#attachOption').combobox('setValue', jdata.data.ATTACH_OPTION.split(","));
                     }*/
                    if (jdata.data.MPD_NO == "" || jdata.data.MPD_NO == null) {
                        $('#cmpNo').textbox({value: jdata.data.ITEM_NUMBER});
                    }
                    if (jdata.data.IF_SPL == "Y") {
                        $("[name = ifSpl]:checkbox").attr("checked", true);
                    } else {
                        $("[name = ifSpl]:checkbox").attr("checked", false);
                    }
                    if (jdata.data.IF_WB == "Y") {
                        $("[name = ifWb]:checkbox").attr("checked", true);
                    } else {
                        $("[name = ifWb]:checkbox").attr("checked", false);
                    }
                    if (jdata.data.IF_OPTIMIZED == "Y") {
                        $("[name = ifOptimized]:checkbox").attr("checked", true);
                    } else {
                        $("[name = ifOptimized]:checkbox").attr("checked", false);
                    }
                    //判断文件类型改变对应的数据域
                    if (jdata.data.DOC_TYPE == "UDF") {
                        $('#mpdNo').textbox({value: " "});
                        $('#mpdNo').textbox({editable: false, onlyview: true});
                    }
                    if (jdata.data.DOC_TYPE == "MPD") {
                        $('#mpdNo').textbox({value: jdata.data.ITEM_NUMBER});
                        //changeDomain(jdata.data.FLEET,jdata.data.DOC_TYPE);
                    }
                    if (jdata.data.DOC_TYPE != "UDF" && jdata.data.DOC_TYPE != "MPD") {
                        changeDomain(jdata.data.FLEET, jdata.data.DOC_TYPE);
                    }
                    //当文件类型为机身时隐掉别的对应项目
                    if (jdata.data.APPL_TYPE == "APL") {
                        $('#engLocation').combobox({editable: false, onlyview: true, required: false});
                        $("#div3").hide();
                        $("#div5").hide();
                        /*   $("#guodu1").show();
                           $("#guodu2").show();*/
                    }
                    //当文件类型为部件时隐掉别的对应项目
                    if (jdata.data.APPL_TYPE == "PART") {
                        $('#engLocation').combobox({editable: false, onlyview: true, required: false});
                        $("#div4").hide();
                        $("#div5").hide();
                        /*$("#guodu1").show();
                        $("#guodu2").show();*/
                    }
                    //当文件类型为发动机时隐掉别的对应项目
                    if (jdata.data.APPL_TYPE == "ENG") {
                        $('#engLocation').combobox({editable: true, onlyview: false, required: true});
                        $("#div4").hide();
                        $("#div3").hide();
                        /* $("#guodu1").hide();
                         $("#guodu2").hide();*/
                    }
                    if (jdata.data.APPL_TYPE == "APU") {
                        $('#engLocation').combobox({editable: false, onlyview: true, required: false});
                        $("#div4").hide();
                        $("#div3").hide();
                        $("#fawei").hide();
                        /*  $("#guodu1").hide();
                          $("#guodu2").hide();*/
                    }
                }
            }
        });
    }


    //再次初始化对应MPD的数据域
    function changeDomain(fleet, docType) {
        $("#mpdNo").MyComboGrid({
            idField: 'MPDNO',  //实际选择值
            textField: 'MPDNO', //文本显示值
            panelHeight: 200,
            width: 100,
            queryParams: {fleet: fleet, docType: docType},
            /*  onSelect: function (index, row) {
             engineerId = row.ID;
             },*/
            params: {FunctionCode: 'EM_MPD_NO'},
            columns: [[
                {field: 'MPDNO', title: '对应MPD号', width: 100},
            ]]
        });

    }


    //判断修订标识并提示
    function changeFormat() {
        changeFormatForGudu();//为了触发回填需求过渡条目
        var d1 = $('#ifAppl').combobox('getValue');
        if (d1 == "N" || d1 == null) {
            $("#div2 [textboxname]").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: false});
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false});
                } else {
                    $(it).datetimebox({required: false});
                }
            });
            //隐藏id为div2 的div
            $('#mpdNo').textbox({editable: false, onlyview: true});
            $('#cmpNo').textbox({value: ''});
        }
        if (d1 == "Y") {
            //同步修改cmpNo的值
            var mpdNo = $('#mpdNo').val();
            var count = $('#count').val();//这里是防止第一次进入时获取到空的当不是第一次加载时获取值并回填
            if (count == "0") {
                $('#cmpNo').textbox({value: mpdNo})
            }
            $('#mpdNo').textbox({editable: true, onlyview: false});
            $('#cmpNo').textbox({editable: false});
            $("#div2").show();
        }
    }

    function changeFormat1() {
        var d1 = $('#ifRevCmp').combobox('getValue');
        if (d1 == "N") {
            $("#div2 [textboxname]").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: false, editable: false, onlyview: true});
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: false, editable: false, onlyview: true});
                } else {
                    $(it).datetimebox({required: false, editable: false, onlyview: true});
                }
            });

            var checkbox1 = document.getElementById("ifWb");
            var checkbox2 = document.getElementById("ifSpl");
            var checkbox3 = document.getElementById("ifOptimized");
            checkbox1.disabled = true;
            checkbox2.disabled = true;
            checkbox3.disabled = true;
        }
        if (d1 == "Y") {

            $("#div2 [textboxname]").each(function (k, it) {
                if ($(it).hasClass("combobox-f")) {
                    $(it).combobox({required: true, editable: true, onlyview: false});
                } else if ($(it).hasClass("textbox-f")) {
                    $(it).textbox({required: true, editable: true, onlyview: false});
                } else {
                    $(it).datetimebox({required: true, editable: true, onlyview: false});
                }
            });

            var checkbox1 = document.getElementById("ifWb");
            var checkbox2 = document.getElementById("ifSpl");
            var checkbox3 = document.getElementById("ifOptimized");
            checkbox1.disabled = false;
            checkbox2.disabled = false;
            checkbox3.disabled = false;
        }
        var ifTmp = $('#ifTmp').combobox('getValue');
        if (ifTmp == "Y") {
            /* $('#tmpCalUnit').combobox({editable: true, onlyview: false, required: true});
             $('#tmpFh').textbox({editable: true, onlyview: false, required: true});
             $('#tmpFc').textbox({editable: true, onlyview: false, required: true});
             $('#tmpCal').textbox({editable: true, onlyview: false, required: true});
             $('#tmpIntervalRule').combobox({editable: true, onlyview: false, required: true});
             $('#tmpRequire').textbox({editable: true, onlyview: false, required: true});*/
        } else {
            $('#tmpCalUnit').combobox({editable: false, onlyview: true, required: false});
            $('#tmpFh').textbox({editable: false, onlyview: true, required: false});
            $('#tmpFc').textbox({editable: false, onlyview: true, required: false});
            $('#tmpCal').textbox({editable: false, onlyview: true, required: false});
            $('#tmpIntervalRule').combobox({editable: false, onlyview: true, required: false});
            $('#tmpRequire').textbox({editable: false, onlyview: true, required: false});
        }
    }

    function changeFormatForGudu() {
        var ifTmp = $('#ifTmp').combobox('getValue');
        if (ifTmp == "Y") {
            $('#tmpCalUnit').combobox({editable: true, onlyview: false, required: false});
            $('#tmpFh').textbox({editable: true, onlyview: false, required: false});
            $('#tmpFc').textbox({editable: true, onlyview: false, required: false});
            $('#tmpCal').textbox({editable: true, onlyview: false, required: false});
            $('#tmpIntervalRule').combobox({editable: true, onlyview: false, required: false});
            $('#tmpRequire').textbox({editable: true, onlyview: false, required: false});
        } else {
            $('#tmpCalUnit').combobox({editable: false, onlyview: true, required: false});
            $('#tmpFh').textbox({editable: false, onlyview: true, required: false});
            $('#tmpFc').textbox({editable: false, onlyview: true, required: false});
            $('#tmpCal').textbox({editable: false, onlyview: true, required: false});
            $('#tmpIntervalRule').combobox({editable: false, onlyview: true, required: false});
            $('#tmpRequire').textbox({editable: false, onlyview: true, required: false});
        }
    }


    function changForPartms() {
        var ifNewPartEva = $('#ifNewPartEva').combobox('getValue');
        if (ifNewPartEva == "Y") {
            $('#newPn').textbox({editable: true, onlyview: false, required: true});
            $('#newAta').textbox({editable: true, onlyview: false, required: true});
            $('#fin').textbox({editable: true, onlyview: false, required: true});
        }
        if (ifNewPartEva == "N") {
            $('#newPn').textbox({editable: false, onlyview: true, required: false});
            $('#newAta').textbox({editable: false, onlyview: true, required: false});
            $('#fin').textbox({editable: false, onlyview: true, required: false});
        }
    }

    function changeFormat2() {
        var d1 = $('#mpdNo').combogrid('getValue');
        $('#cmpNo').textbox({value: d1});
    }

    function changeFormat4() {


    }


    function changeFormat3() {
        InitDataGrid();//初始化机身
        InitDataGrid2();//再次初始化部件
        InitDataGrid3();//初始化APU发动机
        var d5 = $('#applType').combobox('getValue');

        if (d5 == "PART") {
            $("#div4").hide();//机身
            $("#div3").show();//部件
            $("#div5").hide();//发动机APU
            /*  $("#guodu1").show();
              $("#guodu2").show();*/
        }
        if (d5 == "APU" || d5 == "ENG") {
            $("#div4").hide();//机身
            $("#div3").hide();//部件
            $("#div5").show();//发动机APU
            /* $("#guodu1").hide();*/
            /* $("#guodu2").hide();*/
        }
        if (d5 == "APL") {
            $("#div4").show();//机身
            $("#div3").hide();//部件
            $("#div5").hide();//发动机APU
            /* $("#guodu1").show();*/
            /* $("#guodu2").show();*/
        }
        /* if (d5 == "PART") {
         $('#ctlType').combobox({value: d5});
         }*/
        if (d5 != "ENG") {
            $('#fawei').hide();
            $('#engLocation').combobox({required: false});
        } else {
            $('#fawei').show();
            $('#engLocation').combobox({required: true, onlyview: false});
        }
    }


    function addInteval() {
        //拿到项目号

        if (itemPkid == -1) {
            MsgAlert({content: "请先保存项目", type: 'error'});
            return false;
        }
        var $ifSpl = document.getElementById('ifSpl');
        var $ifOptimized = document.getElementById('ifOptimized');
        //两个都没有选的
        var applType = $('#applType').combobox('getValue');
        if (applType == "ENG") {
            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "NULL", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                });

            }
            //选中抽样和优化时
            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "CY", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                });

            }
            //只选中优化时
            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "Y", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                });
            }
            //只选中抽样时
            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "C", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.eng.shtml"
                });
            }
        } else if (applType == "APU") {
            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "NULL", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                });

            }
            //选中抽样和优化时
            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "CY", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                });

            }
            //只选中优化时
            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "Y", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                });
            }
            //只选中抽样时
            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "C", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.apu.shtml"
                });
            }
        } else {
            if (!($ifSpl.checked === true && $ifOptimized.checked === true)) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "NULL", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                });

            }
            //选中抽样和优化时
            if ($ifSpl.checked === true && $ifOptimized.checked === true) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "CY", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                });

            }
            //只选中优化时
            if ($ifSpl.checked === false && $ifOptimized.checked === true) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "Y", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                });
            }
            //只选中抽样时
            if ($ifSpl.checked === true && $ifOptimized.checked === false) {
                ShowWindowIframe({
                    width: 970,
                    height: 340,
                    param: {itemPkid: itemPkid, type: "C", appltype: applType, fleet: fleet},
                    title: "间隔增加",
                    url: "/views/em/emcmp/em_cmpeval.addInterval.shtml"
                });
            }
        }
    }

    function addpart() {
        if (itemPkid == -1) {
            MsgAlert({content: "请先保存项目", type: 'error'});
            return false;
        }
        //var cmpNo = $('#cmpNo').textbox('getValue');
        ShowWindowIframe({
            width: 803,
            height: 340,
            param: {itemPkid: itemPkid, cmpPkid: cmpPkid, Add: "1"},
            title: "部件增加",
            url: "/views/em/emcmp/em_cmpeval_addPart2.shtml"
        });
    }

    //刷新参考来源列表
    function reload_() {
        reload2_();
        reload3_();
        reload4_();
    }

    function reload2_() {
        var data = {itemPkid: itemPkid};
        var dgopt = getDgOpts('dg2');
        var url = dgopt.url;
        var $dg = $(dgopt.owner);
        $dg.datagrid({
            url: url,
            queryParams: data
        });
    }

    function reload3_() {
        var data = {itemPkid: itemPkid};
        var dgopt = getDgOpts('dg3');
        var url = dgopt.url;
        var $dg = $(dgopt.owner);
        $dg.datagrid({
            url: url,
            queryParams: data
        });
    }

    function reload4_() {
        var data = {itemPkid: itemPkid};
        var dgopt = getDgOpts('dg4');
        var url = dgopt.url;
        var $dg = $(dgopt.owner);
        $dg.datagrid({
            url: url,
            queryParams: data
        });
    }

    //预览适用性
    function viewAppl() {
        var appltype = $('#applType').combobox('getValue');
        ShowWindowIframe({
            width: 830,
            height: 370,
            param: {itemPkid: itemPkid, appltype: appltype, fleet: fleet},
            title: "增加适用性",
            url: "/views/em/emcmp/em_cmpeval.previewApp.shtml"
        });
    }


</script>
</html>


