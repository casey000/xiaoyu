<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html
>
<head id="i18n_" module="pm_mplanconf">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <script type="text/javascript" src="/js/plugins/ajaxfileupload/ajaxfileupload.js"></script>
    <title></title>
</head>
<body>

<div style="">
    <div class="ibox float-e-margins">
        <div>
            <form class="form-horizontal m-t" id="mform">
                <fieldset class="fieldset_eui">
                    <legend data-i18n="">部件信息</legend>
                    <table class="table table-bordered table-info">
                        <tr>
                            <input type="hidden" id="itemPkid" name="itemPkid">
                            <input type="hidden" id="pkid" name="pkid">
                            <th class="tdl">项次号：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="partitemNo" name="partitemNo"
                                       VALUE="自动生成"
                                       data-options="editable:false,onlyview:true"/>
                            </td>
                            <th class="tdl">OEM厂家：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="oemFactory" name="oemFactory"
                                       data-options=""/>
                            </td>
                        </tr>
                        <tr>
                            <th class="tdl">部件中文名称：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="partCnname" name="partCnname"
                                       data-options="required:true"/>
                            </td>
                            <th class="tdl">部件英文名称：</th>
                            <td class="tdr">
                                <input class="easyui-textbox easyui-validatebox" id="partEnname" name="partEnname"
                                       data-options="required:true"/>
                            </td>

                        </tr>
                        <tr>
                            <th class="tdl">部件清单：</th>
                            <td class="tdr" colspan="4">
                                <input class="easyui-textbox easyui-validatebox" id="partList" name="partList"
                                       style="width:700px;height: 40px"
                                       data-options="required:true"/>
                            </td>

                        </tr>
                    </table>

                    <fieldset class="fieldset_eui" style="float:left;width:50%;margin-right:5px">
                        <legend data-i18n="">结构化装机要求</legend>
                        <table class="table table-bordered table-info">

                            <tr>
                                <th class="tdl">装机要求（中文）：</th>
                                <td class="tdr">
                                    <input class="easyui-textbox easyui-validatebox" id="installCnreq"
                                           name="installCnreq"
                                           style="width:300px;height: 80px"
                                           data-options="multiline:true,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="tdl">装机要求（英文）：</th>
                                <td class="tdr">
                                    <input class="easyui-textbox easyui-validatebox" id="installEnreq"
                                           name="installEnreq"
                                           style="width:300px;height: 80px"
                                           data-options="multiline:true,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                        </table>
                    </fieldset>


                    <fieldset class="fieldset_eui" style="float:left;width:46%; margin-right:5px">
                        <legend data-i18n="">结构化库存要求</legend>
                        <table class="table table-bordered table-info">
                            <tr>
                                <th class="tdl">库存要求（中文）：</th>
                                <td class="tdr">
                                    <input class="easyui-textbox easyui-validatebox" id="storeCnreq" name="storeCnreq"
                                           style="width:300px;height: 80px"
                                           data-options="multiline:true,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                            <tr>
                                <th class="tdl">库存要求（英文）：</th>
                                <td class="tdr">
                                    <input class="easyui-textbox easyui-validatebox" id="storeEnreq" name="storeEnreq"
                                           style="width:300px;height: 80px"
                                           data-options="multiline:true,editable:false,onlyview:true"/>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                    <table class="table table-bordered table-info">
                        <tr>
                            <th class="tdl">参考资料：</th>
                            <td class="tdr" colspan="4">
                                <input class="easyui-textbox easyui-validatebox" id="refence" name="refence"
                                       style="width:700px;height: 40px"
                                       data-options=""/>
                            </td>
                        </tr>
                        <tr>
                            <th class="tdl">工作方式：</th>
                            <td class="tdr">
                                <input class="easyui-combobox easyui-validatebox" id="workMode" name="workMode"
                                       data-options=""/>
                            </td>
                        </tr>
                        <tr>
                            <th class="tdl">说明：</th>
                            <td class="tdr" colspan="4">
                                <input class="easyui-textbox easyui-validatebox" id="remark" name="remark"
                                       style="width:700px;height: 40px"
                                       data-options=""/>
                            </td>

                        </tr>

                        <tr>
                            <td colspan="8" align="right">
                                <input class="btn btn-primary" id="ZJ" value="结构化装机要求" type="button" onclick="addPart()"
                                       style="margin:5px;"/>
                                <input class="btn btn-primary" id="KC" value="结构化库存要求" type="button"
                                       onclick="addParts()"
                                       style="margin:5px;"/>
                                <input class="btn btn-primary" type="submit" value="保存" style="margin:5px;"/>
                                <input class="btn btn-primary" value="关闭" type="button" onclick="CloseWindowIframe();"
                                       style="margin:5px;"/>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </form>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var isEdit_;
    var param = {};
    var PKID;
    var itemPkid;
    var Add;
    var type;
    param = getParentParam_();
    PKID = param.PKID;
    itemPkid = param.itemPkid;
    Add = param.Add;
    isEdit_ = param.isEdit;
    if (Add == "1") {
        /* $("#ZJ").hide();
         $("#KC").hide();*/
        $("#ZJ").attr("disabled", "true");
        $("#KC").attr("disabled", "true");
    }

    function i18nCallBack() {
        InitFuncCodeRequest_({
            data: {FunctionCode: "ANALYSIS_DOMAIN_BYCODE", domainCode: "EM_MP_PN_WORKMODE"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $('#workMode').combobox({
                        panelHeight: '50px',
                        data: jdata.data.EM_MP_PN_WORKMODE,
                        valueField: 'VALUE',
                        textField: 'TEXT',
                    });
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });

        InitEditForm_();
        if (isEdit_) {
            InitFuncCodeRequest_({
                data: {PKID: PKID, FunctionCode: "EM_CMP_PNTL_GETONE"},
                successCallBack: function (jdata) {
                    if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                        ParseFormField_(jdata.data, null, Constant.CAMEL_CASE);
                        //$("#workMode").combobox({value: jdata.data.WORK_MODE});
                    }
                }
            });
        }
    }

    function InitEditForm_() {
        var $form = $("#mform");
        $form.form({
            onSubmit: function () {
                var $form = $("#mform");
                var data = $form.serializeObject();
                if (isEdit_) {
                    itemPkid = $("#itemPkid").val();
                    data.itemPkid = itemPkid;
                    data.PKID = PKID;
                } else {
                    data.itemPkid = itemPkid;
                }
                data = $.extend({}, data, {
                    FunctionCode: (isEdit_ ? 'EM_CMP_PNTL_UPDATE' : 'EM_CMP_PNTL_ADD')
                });
                InitFuncCodeRequest_({
                    data: data,
                    successCallBack: function (jdata) {

                        if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                            /*  $("ZJ").attr("disabled", "true");
                              $("KC").attr("disabled", "true");*/
                            $('#ZJ').removeAttr("disabled");
                            $('#KC').removeAttr("disabled");

                            $("#pkid").val(jdata.data.pkid);
                            MsgAlert({content: jdata.msg ? jdata.msg : $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                            param.OWindow.reload_();

                        } else {
                            MsgAlert({content: jdata.msg, type: 'error'});
                        }
                    }
                });
                return false;
            }
        });
    }

    //这个方法是用于回填中英文库存装机要求等信息
    function filetheDesc() {
        var mPkid = "";
        if (isEdit_) {
            mPkid = PKID;
        } else {
            mPkid = $("#pkid").val();
        }
        InitFuncCodeRequest_({
            data: {PKID: mPkid, FunctionCode: "EM_CMP_PART_REFILE"},
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    $("#installCnreq").textbox({value: jdata.data.installCnreq});
                    $("#installEnreq").textbox({value: jdata.data.installEnreq});
                    $("#storeCnreq").textbox({value: jdata.data.storeCnreq});
                    $("#storeEnreq").textbox({value: jdata.data.storeEnreq});
                }
            }
        });
    }

    //关闭关闭窗口
    function closeAdd() {
        $.messager.confirm('', '是否关闭', function (r) {
            if (r) {
                CloseWindowIframe();
                param.OWindow.reload_();
                $("#dg").form('clear');
            }
        });
    }

    //增加结构化装机要求
    function addPart() {
        if (PKID == undefined) {
            PKID = $("#pkid").val();
        }
        ShowWindowIframe({
            width: 600,
            height: 340,
            param: {PKID: PKID, type: "install"},
            title: "部件结构化装机要求",
            url: "/views/em/emcmp/em_cmpdeval.StructuredRequirement.shtml"
        });

    }

    //增加结构化装机要求
    function addParts() {
        if (PKID == undefined) {
            PKID = $("#pkid").val();
        }
        ShowWindowIframe({
            width: 600,
            height: 340,
            param: {PKID: PKID, type: "store"},
            title: "部件结构化库存要求",
            url: "/views/em/emcmp/em_cmpdeval.StructuredRequirement.shtml"
        });

    }

    /** 刷新列表数据 */
    function reload_() {
        //每次刷新页面时触发一次执行插入回填描述操作
        filetheDesc();
        // $("#dg").datagrid("reload");
    }

</script>
</html>