<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="RES.EM_SYSCONFIG_REG.TITLE">质量监控报表</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
</head>
<body class="ibody" style="width:100%">
<div id="tt" class="easyui-tabs" style="width:100%; height: 100%">
    <div title="源文件及评估符合性-机队总表">
        <fieldset class="fieldset_eui">
            <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
            <form id="ffSearch" method="post">
                <div id="searchBar">
                    <table class="table table-bordered table-info">
                        <tr>
                            <th style="width: 60px">文件编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataNo" id="dataNo" style="width:120px;"/>
                            </td>

                            <th data-i18n="" style="width: 40px">标题：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataTitle" id="dataTitle" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 80px">评估单编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="evaNo" id="evaNo" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 90px">评估单适用性：</th>
                            <td style="width: 100px">
                                <input class="easyui-textbox" name="acno" id="acno" data-options=""
                                       style="width:100px;"/>
                            </td>
                            <th style="width: 70px">文件类型：</th>
                            <td style="width: 80px">
                                <input class="easyui-combobox" name="dataType" id="dataType" style="width:80px;"/>
                            </td>
                            <td>
                                <a class="searchBtn" data-options="iconCls:'icon-search'"
                                   data-i18n="common:COMMON_OPERATION.QUERY"
                                   onclick="onSearch_('dg', '#ffSearch')">查询</a>
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="excelExport('dg','源文件及评估符合性-机队总表','')"><span>导出</span></a>
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="recalculation()"><span>重新计算</span></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </fieldset>
        <table id="dg"></table>
    </div>
    <div title="评估结论符合性-单机子表">
        <fieldset class="fieldset_eui">
            <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
            <form id="ffSearch1" method="post">
                <div id="searchBar1">
                    <table class="table table-bordered table-info">
                        <tr>
                            <th style="width: 60px">文件编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataNo1" id="dataNo1" style="width:120px;"/>
                            </td>

                            <th data-i18n="" style="width: 40px">标题：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataTitle1" id="dataTitle1" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 80px">评估单编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="evaNo1" id="evaNo1" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 90px">适用性：</th>
                            <td style="width: 100px">
                                <input class="easyui-textbox" name="acno1" id="acno1" data-options=""
                                       style="width:100px;"/>
                            </td>
                            <th style="width: 70px">文件类型：</th>
                            <td style="width: 80px">
                                <input class="easyui-combobox" name="dataType1" id="dataType1" style="width:80px;"/>
                            </td>
                            <td>
                                <a class="searchBtn" data-options="iconCls:'icon-search'"
                                   data-i18n="common:COMMON_OPERATION.QUERY"
                                   onclick="onSearch_1('dg1', '#ffSearch1')">查询</a>
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="excelExport('dg1','评估结论符合性-单机子表','')"><span>导出</span></a>
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="recalculation1()"><span>重新计算</span></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </fieldset>
        <table id="dg1"></table>
    </div>
    <div title="控制与执行符合性">
        <fieldset class="fieldset_eui">
            <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
            <form id="ffSearch2" method="post">
                <div id="searchBar2">
                    <table class="table table-bordered table-info">
                        <tr>
                            <th style="width: 80px">文件编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataNo2" id="dataNo2" style="width:120px;"/>
                            </td>

                            <th data-i18n="" style="width: 40px">标题：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataTitle2" id="dataTitle2" data-options=""
                                       style="width:100px;"/>
                            </td>
                            <th data-i18n="" style="width: 90px">执行文件编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="eoNo" id="eoNo" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 100px">执行文件适用性：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="acno2" id="acno2" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th style="width: 70px">机会类型：</th>
                            <td style="width: 80px">
                                <input class="easyui-combobox" name="opportunityCheckFlag" id="opportunityCheckFlag"
                                       style="width:80px;"/>
                            </td>
                            <td  style="width: 120px">
                                <a class="searchBtn" data-options="iconCls:'icon-search'"
                                   data-i18n="common:COMMON_OPERATION.QUERY"
                                   onclick="onSearch_2('dg2', '#ffSearch2')">查询</a>
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="excelExport('dg2','控制与执行符合性','')"><span>导出</span></a>
                            </td>
                        </tr>
                        <tr>
                            <th style="width: 80px">源文件类型：</th>
                            <td style="width: 120px">
                                <input class="easyui-combobox" name="dataType2" id="dataType2" style="width:120px;"/>
                            </td>
                            <th style="width: 60px">章节：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="ata2" id="ata2" style="width:100px;"/>
                            </td>
                            <th data-i18n="" style="width: 100px">工卡编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="jcNo2" id="jcNo2" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 100px">数据分类：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="alertType" id="alertType" style="width:120px;"/>
                            </td>
                            <th style="width: 80px">符合性状态：</th>
                            <td style="width: 120px">
                                <input class="easyui-combobox" name="status2" id="status2" style="width:80px;"/>
                            </td>
                            <td  style="width: 120px">
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="recalculation2()"><span>重新计算</span></a>
                            </td>
                        </tr>
                        <tr>
                            <th data-i18n="" style="width: 90px">适用性状态：</th>
                            <td style="width: 120px">
                                <input class="easyui-combobox" name="appStatus2" id="appStatus2" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 90px">适用类型：</th>
                            <td style="width: 120px">
                                <input class="easyui-combobox" name="applyType2" id="applyType2" data-options=""
                                       style="width:100px;"/>
                            </td>
                            <th class="th" style="width:80px;" align="right">预估到期日期：</th>
                            <td style="width: 120px" class="td5">
                                <input class="easyui-datebox" id="dueDateS" name="dueDateS"
                                       style="width:118px;"/>
                            </td>
                            <th class="th" style="width:80px;" align="right">至：</th>
                            <td style="width: 120px" class="td5">
                                <input class="easyui-datebox" id="dueDateE" name="dueDateE"
                                       style="width:118px;"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </fieldset>
        <table id="dg2"></table>
    </div>
    <div title="单机预警">
        <fieldset class="fieldset_eui">
            <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
            <form id="ffSearch3" method="post">
                <div id="searchBar3">
                    <table class="table table-bordered table-info">
                        <tr>
                            <th style="width: 60px">文件编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataNo1" id="dataNo3" style="width:120px;"/>
                            </td>

                            <th data-i18n="" style="width: 40px">标题：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="dataTitle1" id="dataTitle3" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 80px">评估单编号：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="evaNo1" id="evaNo3" data-options=""
                                       style="width:120px;"/>
                            </td>
                            <th data-i18n="" style="width: 90px">适用性：</th>
                            <td style="width: 100px">
                                <input class="easyui-textbox" name="acno1" id="acno3" data-options=""
                                       style="width:100px;"/>
                            </td>
                            <th style="width: 70px">文件类型：</th>
                            <td style="width: 80px">
                                <input class="easyui-combobox" name="dataType1" id="dataType3" style="width:80px;"/>
                            </td>
                            <td>
                                <a class="excelBtn" auth="QM_CAL_WARN" data-options="iconCls:'icon-page_excel'"
                                   onclick="recalculationWarn()"><span>重新计算</span></a>
                                <a class="excelBtn" auth="QM_CAL_WARN" data-options="iconCls:'icon-page_excel'"
                                   onclick="tlPreCal()"><span>时限预计算</span></a>
                                <a class="searchBtn" data-options="iconCls:'icon-search'"
                                   data-i18n="common:COMMON_OPERATION.QUERY"
                                   onclick="onSearch_3('dg3', '#ffSearch3')">查询</a>
                                <a class="excelBtn" data-options="iconCls:'icon-page_excel'"
                                   onclick="excelExport('dg3','单机预警','')"><span>导出</span></a>
                            </td>
                        </tr>
                        <tr>
                            <th style="width: 60px">机型：</th>
                            <td style="width: 120px">
                                <input class="easyui-textbox" name="applyModel3" id="applyModel3" style="width:120px;"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </fieldset>
        <table id="dg3"></table>
    </div>
</div>
<script type="text/javascript">
    var PAGE_DATA = {};
    var applyTypeFleetDic = '';
    function i18nCallBack() {
        InitFuncCodeRequest_({
            data: {
                domainCode: "OPPORTUNITY_CHECK_FLAG,YESORNO,QM_COM_STATUS,QM_CON_APP,DM_DATA_TYPE_F,DM_DATA_TYPE_S,DM_DATA_TYPE_C,EM_EO_STATUS,EM_MPD_EVAL_STATE,EMTB_STATUS" +
                ",REVSUG_STATUS,EVA_RESULT_SEG_SB,EM_SEG_TASK_NATURE,EM_EVAL_WORK_TYPE_UNION,EM_FILE_EVAL_DEALMEASURE,EM_APPLY_TYPE,QM_REPORT_ALERT_TYPE,REVSUG_FLEET",
                FunctionCode: "ANALYSIS_DOMAIN_BYCODE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    PAGE_DATA['yesorno'] = DomainCodeToMap_(jdata.data["YESORNO"]);
                    PAGE_DATA['appStatus2'] = DomainCodeToMap_(jdata.data["QM_CON_APP"]);
                    PAGE_DATA['applyType2'] = DomainCodeToMap_(jdata.data["EM_APPLY_TYPE"]);
                    PAGE_DATA['REVSUG_STATUS'] = DomainCodeToMap_(jdata.data["REVSUG_STATUS"]);
                    PAGE_DATA['EMTB_STATUS'] = DomainCodeToMap_(jdata.data["EMTB_STATUS"]);
                    PAGE_DATA['EM_MPD_EVAL_STATE'] = DomainCodeToMap_(jdata.data["EM_MPD_EVAL_STATE"]);
                    PAGE_DATA['EM_EO_STATUS'] = DomainCodeToMap_(jdata.data["EM_EO_STATUS"]);
                    PAGE_DATA['EVA_RESULT_SEG_SB'] = DomainCodeToMap_(jdata.data["EVA_RESULT_SEG_SB"]);
                    PAGE_DATA['taskNature'] = DomainCodeToMap_(jdata.data["EM_SEG_TASK_NATURE"]);
                    PAGE_DATA['workType'] = DomainCodeToMap_(jdata.data["EM_EVAL_WORK_TYPE_UNION"]);
                    PAGE_DATA['dealMeasure'] = DomainCodeToMap_(jdata.data["EM_FILE_EVAL_DEALMEASURE"]);
                    PAGE_DATA['ALERT_TYPE'] = DomainCodeToMap_(jdata.data["QM_REPORT_ALERT_TYPE"]);

                    applyTypeFleetDic = jdata.data["REVSUG_FLEET"];
                    $('#ifEva2').combobox({
                        panelHeight: '100px',
                        data: jdata.data.YESORNO,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#applyModel3').combobox({
                        panelHeight: '100px',
                        data: applyTypeFleetDic,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#status2').combobox({
                        panelHeight: '135px',
                        data: jdata.data.QM_COM_STATUS,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#appStatus2').combobox({
                        panelHeight: '135px',
                        data: jdata.data.QM_CON_APP,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#dataType').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_DATA_TYPE_F,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#dataType1').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_DATA_TYPE_S,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#dataType2').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_DATA_TYPE_C,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#applyType2').combobox({
                        panelHeight: '135px',
                        data: jdata.data.EM_APPLY_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#dataType3').combobox({
                        panelHeight: '135px',
                        data: jdata.data.DM_DATA_TYPE_C,
                        multiple: true,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#opportunityCheckFlag').combobox({
                        panelHeight: '135px',
                        data: jdata.data.OPPORTUNITY_CHECK_FLAG,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                    $('#alertType').combobox({
                        panelHeight: '135px',
                        data: jdata.data.QM_REPORT_ALERT_TYPE,
                        valueField: 'VALUE',
                        textField: 'TEXT'
                    });
                } else {
                    MsgAlert({content: jdata.msg, type: 'error'});
                }
            }
        });
        InitDataGrid();
        InitDataGrid1();
        InitDataGrid2();
        InitDataGrid3();
    }

    //1.源文件及评估符合性-机队总表
    function InitDataGrid() {
        var identity = 'dg';
        $("#dg").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: true,
            pageSize: 15,

            columns: {
                param: {FunctionCode: 'EM_FILE_FLEET_REPORT'},
                alter: {}
            },
            rowStyler: function (index, row) {
                var date = row.EVA_DEADLINE;
                var status = row.STATUS;
                if(date != null){
                    var days = diffDays(date);
                    if(!(status == '生效' || status == '归档')){
                        if (days < 0) {
                            return 'background-color:#FF5151;';//红色
                        } else if (days >= 0 && days <= 3) {
                            return 'background-color:#FFFF6F;';//橙黄FFA500
                        }
                    }
                }
            },
            resize: function () {
                return tabs_standard_resize($('#tt'), 50)
            }
        });
    }

    //2.评估结论符合性-单机子表
    function InitDataGrid1() {
        var identity = 'dg1';
        $("#dg1").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: true,
            pageSize: 15,
            columns: {
                param: {FunctionCode: 'EM_FILE_SINGLE_REPORT'},
                alter: {}
            },
            resize: function () {
                return tabs_standard_resize($('#tt'), 50)
            }
        });
    }

    //3.控制与执行符合性
    function InitDataGrid2() {
        var identity = 'dg2';
        $("#dg2").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: true,
            pageSize: 15,
            columns: {
                param: {FunctionCode: 'EM_FILE_CONTROL_REPORT'},
                alter: {
                    ALERT_TYPE: {
                        formatter: function (value) {
                            return PAGE_DATA['ALERT_TYPE'][value];
                        }
                    },
                    IF_EVA: {
                        formatter: function (value) {
                            return PAGE_DATA['yesorno'][value];
                        }
                    },
                    APP_STATUS: {
                        formatter: function (value) {
                            return PAGE_DATA['appStatus2'][value];
                        }
                    },
                    APPLY_TYPE: {
                        formatter: function (value) {
                            return PAGE_DATA['applyType2'][value];
                        }
                    },
                    OPPORTUNITY_CHECK_FLAG: {
                        formatter: function (value) {
                            return PAGE_DATA['yesorno'][value];
                        }
                    },
                    IF_RC_TBD: {
                        formatter: function (value) {
                            return PAGE_DATA['yesorno'][value];
                        }
                    },
                    FACTORY_DATE: {
                        type: 'date'
                    },
                    FINISH_DATE: {
                        type: 'date'
                    },
                    PLAN_DATE: {
                        type: 'date'
                    },
                    DUE_DATE: {
                        type: 'date'
                    },
                }
            },
            rowStyler: function (index, row) {
                var alertType = row.ALERT_TYPE;
                if (alertType == "9") {
                    return 'background-color:#ADADAD;';//灰色
                } else if (alertType == "6" || alertType == "5" || alertType == "4") {
                    return 'background-color:#FFFF00;';//黄色
                } else if (alertType == "3") {
                    return 'background-color:#FF8C00;';//橙色
                } else if (alertType == "2" || alertType == "1") {
                    return 'background-color:#FF5151;';//红色
                }
            },
            resize: function () {
                return tabs_standard_resize($('#tt'), 135)
            }

        });
    }

    //单机预警
    function InitDataGrid3() {
        var identity = 'dg3';
        $("#dg3").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: true,
            pageSize: 15,
            columns: {
                param: {FunctionCode: 'EM_FILE_SINGLE_WARN_LIST'},
                alter: {
                    EXE_FILE_STATUS: {
                        formatter: function (value, row, index) {
                            if (row.EXE_FILE_TYPE == "EO" || row.EXE_FILE_TYPE == "EA") {
                                return PAGE_DATA['EM_EO_STATUS'][value];
                            }
                            if (row.EXE_FILE_TYPE == "MP") {
                                return PAGE_DATA['EM_MPD_EVAL_STATE'][value];
                            }
                            if (row.EXE_FILE_TYPE == "TB") {
                                return PAGE_DATA['EMTB_STATUS'][value];
                            }
                            if (row.EXE_FILE_TYPE == "JYD") {
                                return PAGE_DATA['REVSUG_STATUS'][value];
                            }
                        }
                    },
                    SEG_EVA_RESULT: {
                        formatter: function (value) {
                            return PAGE_DATA['EVA_RESULT_SEG_SB'][value];
                        }
                    },
                    WORK_TYPE: {
                        formatter: function (value) {
                            return PAGE_DATA['workType'][value];
                        }
                    },
                    TASK_NATURE: {
                        formatter: function (value) {
                            return PAGE_DATA['taskNature'][value];
                        }
                    },
                    EXE_FILE_DES: {
                        formatter: function (value) {
                            return PAGE_DATA['dealMeasure'][value];
                        }
                    }
                }
            },
            rowStyler: function (index, row) {
                var date = row.NEXT_DATE;
                if(date != null){
                    var days = diffDays(date);
                    if (days <= 0) {
                        return 'background-color:#FF5151;';//红色
                    } else if (days > 0 && days <= 3) {
                        return 'background-color:#FFFF6F;';//橙黄FFA500
                    }
                }else{
                    return 'background-color:#D1D1D1;';//灰色
                }
            },
            resize: function () {
                return tabs_standard_resize($('#tt'), 90)
            }
        });
    }
    //计算当前日期和今天差的天数
    function diffDays(date) {
        var evaDate = stringToDate(date);
        var nowDate = new Date();
        var year = nowDate.getFullYear();
        var month = nowDate.getMonth();
        var day = nowDate.getDate();
        var now = new Date(year, month, day);
        var time_diff = evaDate.getTime() - now.getTime();
        var days = Math.floor(time_diff / (24 * 3600 * 1000));
        // alert('eva:'+evaDate+',now:'+now+',days:'+days);
        return days;
    }

    //字符串转日期
    function stringToDate(str) {
        str = str.substr(0, 10);
        var arr = str.split('-');
        var date = new Date(arr[0], arr[1] - 1, arr[2]);
        return date;
    }


    function recalculation() {
        ajaxLoading();
        InitFuncCodeRequest_({
            data: {
                flag: "P", FunctionCode: "EM_FILE_CAL_FLEET"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ajaxLoadEnd();
                    MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reload_("#dg");
                } else {
                    MsgAlert({content: '计算失败，请联系管理员！', type: 'error'});
                }
            }
        });
    }

    function recalculation1() {
        ajaxLoading();
        InitFuncCodeRequest_({
            data: {
                flag: "P", FunctionCode: "EM_FILE_CAL_SINGLE"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ajaxLoadEnd();
                    MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reload_("#dg1");
                } else {
                    MsgAlert({content: '计算失败，请联系管理员！', type: 'error'});
                }
            }
        });
    }

    function recalculation2() {
        ajaxLoading();
        InitFuncCodeRequest_({
            data: {
                flag: "P", FunctionCode: "EM_FILE_CAL_CONTROL"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ajaxLoadEnd();
                    MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reload_("#dg2");
                } else {
                    MsgAlert({content: '计算失败，请联系管理员！', type: 'error'});
                }
            }
        });
    }

    function recalculationWarn() {
        ajaxLoading();
        InitFuncCodeRequest_({
            data: {
                flag: "P", FunctionCode: "EM_FILE_CAL_SINGLE_WARN"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ajaxLoadEnd();
                    MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reload_("#dg3");
                } else {
                    MsgAlert({content: '计算失败，请联系管理员！', type: 'error'});
                }
            }
        });
    }

    function tlPreCal() {
        ajaxLoading();
        InitFuncCodeRequest_({
            data: {
                FunctionCode: "EM_FILE_CAL_TL"
            },
            successCallBack: function (jdata) {
                if (jdata.code == RESULT_CODE.SUCCESS_CODE) {
                    ajaxLoadEnd();
                    MsgAlert({content: $.i18n.t('msg_tip:TIP.COMMON.OPT_SUCCESS')});
                    reload_("#dg3");
                } else {
                    ajaxLoadEnd();
                    MsgAlert({content: '计算失败，请联系管理员！', type: 'error'});
                }
            }
        });
    }
    function reload_(dg) {
        $(dg).datagrid("reload");
    }

    function onSearch_(identity, fromId, breforSearch) {
        var data = $("#ffSearch").serializeObject();
        var dataType = $("#dataType").combobox('getValues');
        if (Array.isArray(dataType)) {
            dataType = dataType.join(',');
        }
        fromId = fromId || "#ffSearch";
        var dgopt = getDgOpts(identity);
        var $dg = $(dgopt.owner);
        var url = dgopt.url;
        if ($dg && url) {
            var queryParams = $(fromId).serializeObject();
            queryParams.dataType = dataType;
            queryParams = $.extend({}, dgopt.queryParams, dgopt._params, queryParams);
            if (typeof(breforSearch) == 'function') {
                breforSearch(queryParams);
            }
            clearAdvancedQueryData(queryParams);
            if (dgopt.treeField) {
                $dg.treegrid('load', queryParams);
            } else {
                $dg.datagrid('load', queryParams);
            }
        }
    }

    function onSearch_1(identity, fromId, breforSearch) {
        var data = $("#ffSearch").serializeObject();
        var dataType1 = $("#dataType1").combobox('getValues');
        if (Array.isArray(dataType1)) {
            dataType1 = dataType1.join(',');
        }
        fromId = fromId || "#ffSearch1";
        var dgopt = getDgOpts(identity);
        var $dg = $(dgopt.owner);
        var url = dgopt.url;
        if ($dg && url) {
            var queryParams = $(fromId).serializeObject();
            queryParams.dataType1 = dataType1;
            queryParams = $.extend({}, dgopt.queryParams, dgopt._params, queryParams);
            if (typeof(breforSearch) == 'function') {
                breforSearch(queryParams);
            }
            clearAdvancedQueryData(queryParams);
            if (dgopt.treeField) {
                $dg.treegrid('load', queryParams);
            } else {
                $dg.datagrid('load', queryParams);
            }
        }
    }

    function onSearch_2(identity, fromId, breforSearch) {
        var data = $("#ffSearch").serializeObject();
        var dataType2 = $("#dataType2").combobox('getValues');
        if (Array.isArray(dataType2)) {
            dataType2 = dataType2.join(',');
        }
        fromId = fromId || "#ffSearch2";
        var dgopt = getDgOpts(identity);
        var $dg = $(dgopt.owner);
        var url = dgopt.url;
        if ($dg && url) {
            var queryParams = $(fromId).serializeObject();
            queryParams.dataType2 = dataType2;
            queryParams = $.extend({}, dgopt.queryParams, dgopt._params, queryParams);
            if (typeof(breforSearch) == 'function') {
                breforSearch(queryParams);
            }
            clearAdvancedQueryData(queryParams);
            if (dgopt.treeField) {
                $dg.treegrid('load', queryParams);
            } else {
                $dg.datagrid('load', queryParams);
            }
        }
    }

    function onSearch_3(identity, fromId, breforSearch) {
        var data = $("#ffSearch3").serializeObject();
        var dataType1 = $("#dataType3").combobox('getValues');
        if (Array.isArray(dataType1)) {
            dataType1 = dataType1.join(',');
        }
        fromId = fromId || "#ffSearch3";
        var dgopt = getDgOpts(identity);
        var $dg = $(dgopt.owner);
        var url = dgopt.url;
        if ($dg && url) {
            var queryParams = $(fromId).serializeObject();
            queryParams.dataType1 = dataType1;
            queryParams = $.extend({}, dgopt.queryParams, dgopt._params, queryParams);
            if (typeof(breforSearch) == 'function') {
                breforSearch(queryParams);
            }
            clearAdvancedQueryData(queryParams);
            if (dgopt.treeField) {
                $dg.treegrid('load', queryParams);
            } else {
                $dg.datagrid('load', queryParams);
            }
        }
    }
</script>
</body>
</html>
