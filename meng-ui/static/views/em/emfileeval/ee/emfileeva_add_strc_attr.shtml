<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http：//www.w3.org/TR/html4/loose.dtd">
<html>
<head id="stri18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
</head>
<style>
    .attrBox td{
        text-align: center;
    }
    .attrBox .th-attr{
        width:100px;
    }
    .attrBox .attr-tip{
        width:80px;
    }
    .attrBox .attr-eval-result{
        width:120px;
    }
</style>
<body >
    <div class="attrBox">
        <div  style="margin: 10px;float:right">
            <input class="btn btn-primary" id="strSaveId" onclick="saveStructrue();" type="submit" value="保存"
                   style="margin:5px;"/>
        </div>
        <table class="table table-bordered table-info ">
            <tr>
                <td class="tdr">项目</td>
                <td class="tdr attr-tip">系统提示</td>
                <td class="tdr attr-eval-result">评估结果</td>
                <td class="tdr">备注</td>
            </tr>
            <tr>
                <th  class="th th-attr">APB影响：</th>
                <td class="tdr attr-tip" id="strApb"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isApb"  value="1"> <span style="font-size: 12px">是</span>
                    <input type="radio" name="isApb" checked="checked" style="margin-left: 10px" value="0"><span style="font-size: 12px">否</span>


                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="apbRemark"></td>
            </tr>
            <tr>
                <th  class="th th-attr">PTF影响：</th>
                <td class="tdr attr-tip" id="strPtf"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isPtf"  value="1" > <span style="font-size: 12px">是</span>
                    <input type="radio" name="isPtf"  checked="checked" style="margin-left: 10px" value="0" ><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="ptfRemark"></td>
            </tr>
            <tr>
                <th  class="th th-attr">PTF区域：</th>
                <td class="tdr attr-tip" id="strPtfArea"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isPtfArea"  value="1" > <span style="font-size: 12px">是</span>
                    <input type="radio" name="isPtfArea"  checked="checked" style="margin-left: 10px" value="0"><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="ptfAreaRemark"></td>
            </tr>
            <tr>
                <th  class="th th-attr">PSE：</th>
                <td class="tdr attr-tip" id="strPse"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isPse"  value="1" > <span style="font-size: 12px">是</span>
                    <input type="radio" name="isPse" checked="checked"  style="margin-left: 10px" value="0" ><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="pseRemark"></td>
            </tr>
            <tr>
                <th  class="th th-attr">FCBS：</th>
                <td class="tdr attr-tip" id="strFcbs"></td>
                <td class="tdr attr-eval-result">
                    <select class="easyui-combobox"  id="fcbsId" >
                        <option value="0">否</option>
                        <option value="1">FCBS(1)</option>
                        <option value="2">FCBS(2)</option>
                        <option value="3">FCBS(3)</option>
                        <option value="4">FCAS</option>
                    </select>

                    <!--<input type="radio" name="isFcbs" value="1" > <span style="font-size: 12px">是</span>-->
                    <!--<input type="radio" name="isFcbs"   checked="checked" style="margin-left: 10px" value="0" ><span style="font-size: 12px">否</span>-->
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="fcbsRemark"></td>
            </tr>
            <tr>
                <th class="th th-attr">增压边界：</th>
                <td class="tdr attr-tip" id="strPressurizedRegion"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isPressurizedRegion"  value="1"> <span style="font-size: 12px">是</span>
                    <input type="radio" name="isPressurizedRegion" checked="checked" style="margin-left: 10px" value="0" ><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="pressurizedRegionRemark"></td>
            </tr>
            <tr>
                <th class="th th-attr">气动敏感区域：</th>
                <td class="tdr attr-tip" id="strPneumaticArea"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isPneumaticArea"  value="1" > <span style="font-size: 12px">是</span>
                    <input type="radio" name="isPneumaticArea"  checked="checked" style="margin-left: 10px" value="0" ><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="pneumaticAreaRemark"></td>
            </tr>
            <tr>
                <th class="th th-attr">潮湿区域：</th>
                <td class="tdr attr-tip" id="strWetArea"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isWetArea" value="1" > <span style="font-size: 12px">是</span>
                    <input type="radio" name="isWetArea"  checked="checked"  style="margin-left: 10px" value="0" ><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="wetAreaRemark"></td>
            </tr>
            <tr>
                <th class="th th-attr">结构可更换件：</th>
                <td class="tdr attr-tip" id="strRsc"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isRsc" value="1" > <span style="font-size: 12px">是</span>
                    <input type="radio" name="isRsc"   checked="checked"  style="margin-left: 10px" value="0"><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="rscRemark"></td>
            </tr>
            <tr>
                <th class="th th-attr">SSI：</th>
                <td class="tdr attr-tip" id="strSsi"></td>
                <td class="tdr attr-eval-result">
                    <input type="radio" name="isSsi" value="1" onclick="changeSSI()"> <span style="font-size: 12px">是</span>
                    <input type="radio" name="isSsi"   checked="checked" style="margin-left: 10px" value="0" onclick="changeSSI()"><span style="font-size: 12px">否</span>
                </td>
                <td class="tdr"><input class="easyui-textbox" style="width:100%" id="ssiRemark"></td>
            </tr>
            <tr id="ssiNoLine">
                <th class="th th-attr">SSI NO：</th>
                <td class="tdr"  colspan="2"><input class="easyui-textbox" id="ssiNo" style="width:150px"></td>
                <td class="tdr"></td>
            </tr>
        </table>
    </div>
<script type="text/javascript" src="/js/datagrid_utils.js"></script>
<script type="text/javascript">
    var businessId;
    var PreData;
    param = getParentParam_();

    getModelStructureInfo("PARA",param.segpkid);
    getStructureInfo(param.segpkid);

    function getModelStructureInfo(type,id){
        $.ajax({
            type: "get",
            url: "/ee/emFileEmFileStructuralAttribute/queryModelEmFileStructuralAttribute?type="+type+"&&segId="+id,
            contentType: "application/json;charset=utf-8",
            async:false,
            success: function (result) {
                var data = result.data;
                if(JSON.stringify(data) !== "{}" && data!==undefined){
                    $("#strApb").text( yesOrNo(data.apb));
                    $("#strPtf").text(yesOrNo(data.ptf));
                    $("#strPtfArea").text(yesOrNo(data.ptfArea));
                    $("#strPse").text(yesOrNo(data.pse));
                    $("#strFcbs").text(fcbsFormatter(data.fcbs));
                    $("#strPressurizedRegion").text(yesOrNo(data.pressurizedRegion));
                    $("#strPneumaticArea").text(yesOrNo(data.pneumaticArea));
                    $("#strWetArea").text(yesOrNo(data.wetArea));
                    $("#strRsc").text(yesOrNo(data.rsc));
                    $("#strSsi").text(yesOrNo(data.ssi));
                    PreData = data;
                }
            },
            error: function (data) {
                // alert("结构属性信息查询失败！");
            }
        });
    }

    function getStructureInfo(id) {
        $("#ssiNoLine").hide();
        $.ajax({
            type: "get",
            url: "/ee/emFileEmFileStructuralAttribute/queryEmFileStructuralAttribute?id="+id,
            contentType: "application/json;charset=utf-8",
            async:true,
            success: function (result) {
                var data = {};
                if(JSON.stringify(result.data) !== "{}" && result.data!==undefined){
                    data =result.data;
                }else if(JSON.stringify(PreData) !== "{}" && PreData!==undefined){
                    data = PreData;
                }else{
                    data ={};
                }
                if(JSON.stringify(data) !== "{}" && data!==undefined){
                    $("input:radio[name='isApb'][value=" +data.apb + "]").attr('checked','true');
                    $("input:radio[name='isPtfArea'][value=" +data.ptfArea + "]").attr('checked','true');
                    $("input:radio[name='isPtf'][value=" +data.ptf + "]").attr('checked','true');
                    $("input:radio[name='isPse'][value=" +data.pse + "]").attr('checked','true');
                    $("input:radio[name='isPressurizedRegion'][value=" +data.pressurizedRegion + "]").attr('checked','true');
                    $("input:radio[name='isPneumaticArea'][value=" +data.pneumaticArea + "]").attr('checked','true');
                    $("input:radio[name='isWetArea'][value=" +data.wetArea + "]").attr('checked','true');
                    $("input:radio[name='isRsc'][value=" +data.rsc + "]").attr('checked','true');
                    $("input:radio[name='isSsi'][value=" +data.ssi + "]").attr('checked','true');
                    $("#ssiNo").textbox('setValue',data.ssiNo);
                    $("#fcbsId").combobox("setValue", data.fcbs);
                    $("#apbRemark").textbox('setValue',data.apbRemark);
                    $("#ptfRemark").textbox('setValue',data.ptfRemark);
                    $("#ptfAreaRemark").textbox('setValue',data.ptfAreaRemark);
                    $("#pseRemark").textbox('setValue',data.pseRemark);
                    $("#pressurizedRegionRemark").textbox('setValue',data.pressurizedRegionRemark);
                    $("#wetAreaRemark").textbox('setValue',data.wetAreaRemark);
                    $("#ssiRemark").textbox('setValue',data.ssiRemark);
                    $("#rscRemark").textbox('setValue',data.rscRemark);
                    $("#fcbsRemark").textbox('setValue',data.fcbsRemark);
                    $("#pneumaticAreaRemark").textbox('setValue',data.pneumaticAreaRemark);
                    changeSSI();
                    businessId =data.id;
                }
            },
            error: function (data) {
                // alert("结构属性信息查询失败！");
            }
        });
    }
    function yesOrNo(value) {
        if(value=='0'){
            return "否"
        }else if(value=="1"){
            return "是"
        }
    }
    function fcbsFormatter(value) {
        switch(value){
            case "0":
                return "否";
            case "1":
                return "FCBS(1)";
            case "2":
                return "FCBS(2)";
            case "3":
                return "FCBS(3)";
            case "4":
                return "FCAS";
        }
    }
    function changeSSI(){
        if($("[name='isSsi']:checked").val()=="1"){
            $("#ssiNoLine").show();
        }else{
            $("#ssiNoLine").hide();
            $("#ssiNo").textbox('setValue',"");
        }
    }
    //保存结构件
    function saveStructrue(){
        if($("[name='isSsi']:checked").val()=="1" &&!$("#ssiNo").val()){
            MsgAlert({content: "请填写SSi NO！", type: 'error'});
            return false;
        }
            var strctureInfo = {
                "segId":param.segpkid,
                "evaId":param.evaId,
                "apb":$("[name='isApb']:checked").val(),
                "apbRemark":$("#apbRemark").val(),
                "ptfArea":$("[name='isPtfArea']:checked").val(),
                "ptfAreaRemark":$("#ptfAreaRemark").val(),
                "ptf":$("[name='isPtf']:checked").val(),
                "ptfRemark":$("#ptfRemark").val(),
                "pse":$("[name='isPse']:checked").val(),
                "pseRemark":$("#pseRemark").val(),
                "pressurizedRegion":$("[name='isPressurizedRegion']:checked").val(),
                "pressurizedRegionRemark":$("#pressurizedRegionRemark").val(),
                "pneumaticArea":$("[name='isPneumaticArea']:checked").val(),
                "pneumaticAreaRemark":$("#pneumaticAreaRemark").val(),
                "wetArea":$("[name='isWetArea']:checked").val(),
                "wetAreaRemark":$("#wetAreaRemark").val(),
                "rsc":$("[name='isRsc']:checked").val(),
                "rscRemark":$("#rscRemark").val(),
                "ssi":$("[name='isSsi']:checked").val(),
                "ssiRemark":$("#ssiRemark").val(),
                "fcbs":$("#fcbsId").combobox('getValue'),
                "fcbsRemark":$("#fcbsRemark").val(),
                "ssiNo":$("#ssiNo").val(),
                "manufacturer":"",

            }
            var saveUrl="/ee/emFileEmFileStructuralAttribute/saveEmFileStructuralAttribute";
            if(businessId){
                saveUrl="/ee/emFileEmFileStructuralAttribute/updateEmFileStructuralAttribute"
            }
        $.ajax({
            type: "post",
            url:saveUrl,
            contentType: "application/json;charset=utf-8",
            async:false,
            data:JSON.stringify(strctureInfo),
            dataType: "json",
            success: function (result) {
                MsgAlert({content: "保存成功!"});
                // CloseWindowIframe();
                param.OWindow.getStructureInfo(param.segpkid);
            },
            error: function (err) {
                MsgAlert({content: "保存失败", type: 'error'});
            }
        });

    }


</script>
</body>
</html>
