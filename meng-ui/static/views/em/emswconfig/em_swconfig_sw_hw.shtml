<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <title data-i18n="RES.EM_SWCONFIG_REG.TITLE">软件构型</title>
    <script type="text/javascript" src="/js/datagrid_utils.js"></script>
</head>
<body class="ibody">
<fieldset class="fieldset_eui">
    <legend data-i18n="common:COMMON_OPERATION.SEARCH">搜索</legend>
    <form id="ffSearch" method="post">
        <div id="searchBar">
            <table class="table table-bordered table-info">
                <tr>
                    <th data-i18n="" style="width: 70px">件号：</th>
                    <td>
                        <input class="easyui-textbox" name="partno" id="partno" style="width:120px;"/>
                    </td>
                    <th data-i18n="" style="width: 70px">名称：</th>
                    <td>
                        <input class="easyui-textbox" name="description" id="description" style="width:120px;"/>
                    </td>
                    <td>
                        <a class="searchBtn" data-options="iconCls:'icon-search'"
                           data-i18n="common:COMMON_OPERATION.QUERY" onclick="onSearch_()" >查询</a>
                        <a class="clearBtn" onclick="doClear_()" data-options="iconCls:'icon-clear'">
                            <span data-i18n="common:COMMON_OPERATION.RESET">重置</span></a>
                        <a class="searchBtn" onclick="ok()" >
                            <span>确定</span></a>
                    </td>
                </tr>
                <tr>
                    <td id="id_text" colspan="5"></td>
                </tr>
            </table>
        </div>
    </form>
</fieldset>
<table id="dg"></table>

<script type="text/javascript">
    var param = null;
    var hwPns = [];
    var hwNames = [];

    function i18nCallBack() {
        param = getParentParam_();
        if (!! param.hwPn) {
            hwPns = param.hwPn.split(';');
            hwNames = param.hwName.split(';');
            $('#id_text').text(param.hwPn);
        }

        var identity = 'dg';
        $("#dg").MyDataGrid({
            identity: identity,
            sortable: true,
            singleSelect: false,
            pageSize: 15,
            columns: {
                param: {FunctionCode: 'EM_SWCONFIG_SW_HW'},
            },
            queryParams: {
                fleet: param.fleet
            },
            contextMenus: [
                {
                    id: "m-select",
                    i18nText: "选中",
                    onclick: function () {
                        var rowdata = getDG('dg').datagrid('getSelected');
                        hwPns.push(rowdata.PARTNO);
                        hwNames.push(rowdata.DESCRIPTION);
                        $('#id_text').text(hwPns.join(";"));
                    }
                },
                {
                    id: "m-unselect",
                    i18nText: "取消选中",
                    onclick: function () {
                        var rowdata = getDG('dg').datagrid('getSelected');
                        for (var i = 0; i < hwPns.length; i++) {
                            if (rowdata.PARTNO == hwPns[i]) {
                                hwPns.splice(i, 1);
                                hwNames.splice(i, 1);
                                $('#id_text').text(hwPns.join(";"));
                            }
                        }
                    }
                }
            ]
        });
    }

    //查询
    function searchData() {
        onSearch_('dg', '#ffSearch');
    }

    //重置
    function doClear_() {
        $("#ffSearch").form('clear');
        searchData();
    }

    function ok() {
        param.OWindow.$('#hwPn').textbox('setValue', hwPns.join(';'));
        param.OWindow.$('#hwName').textbox('setValue', hwNames.join(';'));
        CloseWindowIframe();
    }
</script>
</body>
</html>

