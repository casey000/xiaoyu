<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head id="i18n_" module="">
    <!--#include virtual="/views/items/resource_.shtml"-->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <meta charset="UTF-8">
    <title>edit_cancel_socket</title>
    <link href="/css/nrc/nrc_add.css" rel="stylesheet">
    <style type="text/css">
        .cai_type label {
            margin-right: 20px;
        }

        .sousuo_div {
            position: absolute;
            top: 0px;
            left: 0px;
            right: 0px;
            bottom: 0px;
            padding-top: 8px;
            z-index: 10;
        }

        .zhezhao {
            display: none;
            position: absolute;
            z-index: 9;
            top: 0px;
            bottom: 0px;
            right: 0px;
            left: 0px;
        }

        .red {
            color: red;
        }

    </style>
</head>
<body>
<div class="zhezhao" id="dazhehzao" onclick="zhezhao_hide()"></div>
<div class="zhezhao" id="zhezhao"></div>
<div class="nrc_div">
    <div style="display: none"><input id="ccid" type="text"/> <input class="easyui-textbox" id="ac_id"/></div>
    <table class="addnrc_table">
        <tbody>
        <tr>
            <td class="key">MR</td>
            <td><input class="easyui-textbox" disabled="disabled" id="mrNo" style="width: 85%" name="cancelStock.mrNo"
                       type="text"></td>
            <td class="key">任务编号</td>
            <td><input class="easyui-textbox" disabled="disabled" id="cancelStockNo" style="width: 85%" name="cancelStock.cancelStockNo"
                       type="text"></td>
            <td class="key">CC编号</td>
            <td><input class="easyui-textbox" disabled="disabled" id="ccNo" style="width: 85%" name="cancelStock.ccNo"
                       type="text">
            </td>
        </tr>
        <tr>
            <td class="key">件号</td>
            <td><input class="easyui-textbox" disabled="disabled" id="pn" style="width: 85%" name="cancelStock.pn"
                       type="text">
            </td>
            <td class="key">序号</td>
            <td><input class="easyui-textbox" disabled="disabled" id="sn" style="width: 85%"name="cancelStock.sn"
                       type="text">
            </td>
            <td class="key">数量</td>
            <td><input class="easyui-textbox" disabled="disabled" id="qty" style="width: 85%" name="cancelStock.qty"
                       type="text">
            </td>
        </tr>
        <tr>
            <td class="key">单位</td>
            <td><input class="easyui-textbox" disabled="disabled" id="unit" style="width: 85%" name="cancelStock.unit"
                       type="text">
            </td>
            <td class="key">退库数量</td>
            <td><input class="easyui-textbox" id="cancelStockQty" style="width: 85%" name="cancelStock.cancelStockQty"
                       type="text">
            </td>
            <td class="key">航材状态<span>*</span></td>
            <td><input class="easyui-combobox" id="airMaterialState" name="cancelStock.airMaterialState"
                       style="width: 85%"></td>
        </tr>
        <tr>
            <td class="key">退库类型<span>*</span></td>
            <td><input class="easyui-combobox" id="cancelStockType" name="cancelStock.cancelStockType"
                       style="width: 85%"></td>
            <td class="key">目的航站 <span>*</span></td>
            <td><input class="easyui-textbox" id="station" style="width: 85%" type="text">
                <img alt="" class="fangdajin" id="acBtn" onClick="stationQuery()" src="/img/search.png"/>
            </td>
            <td class="key">状态</td>
            <td><input class="easyui-textbox" disabled="disabled" id="cancelStockStatus" style="width: 85%" name="cancelStock.cancelStockStatus"
                       type="text">
            </td>
        </tr>
        </tbody>
    </table>
    <table class="addnrc_table" style="margin-top: 5px">
        <tbody>
        <tr>
            <td class="key">部件故障描述</td>
        </tr>
        <tr>
            <td>
                <textarea id="description" name="cancelStock.description" maxlength="1000"></textarea>
            </td>
        </tr>

        </tbody>
    </table>


    <div class="button_a" style="position: relative">
        <a class="save display_button" onclick="edit()">提交</a>
    </div>
</div>
<script src="/js/plugins/ajaxfileupload/ajaxfileupload.js" type="text/javascript"></script>
<script src="../../../js/datagrid_utils.js" type="text/javascript"></script>
<script type="text/javascript">

    var cancelSocket = getParentParam_();
    console.log(cancelSocket)
    $(function () {
        $("#mrNo").textbox("setValue",cancelSocket.mrNo);
        $("#cancelStockNo").textbox("setValue",cancelSocket.cancelStockNo);
        $("#cancelStockStatus").textbox("setValue",cancelSocket.cancelStockStatus);
        $("#cancelStockQty").textbox("setValue",cancelSocket.cancelStockQty);
        $("#cancelStockType").textbox("setValue",cancelSocket.cancelStockType);
        $("#ccNo").textbox("setValue",cancelSocket.ccNo);
        $("#pn").textbox("setValue",cancelSocket.pn);
        $("#sn").textbox("setValue",cancelSocket.sn);
        $("#qty").textbox("setValue",cancelSocket.qty);
        $("#unit").textbox("setValue",cancelSocket.unit);
        $("#airMaterialState").val(cancelSocket.airMaterialState);
        $("#description").val(cancelSocket.description);
        $("#transport").val(cancelSocket.transport);
        // $("#cancelStockStatus").val(cancelSocket.cancelStockStatus);
        $("#station").val(cancelSocket.toStation);
        $("#fromStation").val(cancelSocket.fromStation);

        //id;
        // mrId;
        //cancelStockId
        //sendBackName;
        //sendBackNumber;
        //receiverName;
        //receiverNumber;
        //flightNo;
        //flightId;
        //workorderId;
    })


    function zhezhao_hide() {
        $(".sousuo_div").hide();
        $("#dazhehzao").hide();
    }


    function filter(tlble, pn, sn, pos) {
        //.date_tr 数据显示行，用于区分标题行
        $("#" + tlble + " tr").each(function (i, e) {
            $(e).hide();
            if (filterTr(e, pn, sn, pos)) {
                $(e).show();
            }
        })
    }


    function edit() {
        var toStation = $("#station").val();
        if (!toStation) {
            alert('目的航站必填');
            return;
        }
        var transport = $("#transport").val();
        if (cancelSocket.fromStation != toStation && (transport == null || transport == "")) {
            alert('任务航站与目的航站不同，运输方式必填');
            return;
        }

        var data = {
            'id': cancelSocket.id,
            'pn': cancelSocket.pn,
            'sn': cancelSocket.sn,
            'cancelStockQty': $("#cancelStockQty").val(),
            'airMaterialState': $("#airMaterialState").val(),
            'cancelStockType': $("#cancelStockType").val(),
            'toStation': toStation,
            'description': $("#description").val(),
            'transport': transport,
            'cancelStockId': cancelSocket.cancelStockId
        };
        var url = "/api/v1/cancelSock/edit";
        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(data),
            dataType: "json",
            success: function (data) {
                //console.log(data);
                if (data.code == 200) {
                    alert("成功！");
                    window.close();
                } else if (data.msgData && data.msgData[0]) {
                    alert(data.msgData[0]);
                } else {
                    alert(data.msg);
                }
            },
            error: function () {
                window.alert("保存失败！");
            }
        });
    }

    function stationQuery() {
        var title_ = $.i18n.t('航站查询');
        var curWidth = ($(window).width() * 0.5).toString();
        var curheight = ($(window).height() * 0.5).toString();
        ShowWindowIframe({
            width: curWidth,
            height: curheight,
            title: title_,
            param: {},
            url: "/views/tbm/flb/station_query.shtml"
        });
    }
</script>
</body>

</html>