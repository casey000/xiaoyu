<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--#include virtual="/views/items/resource_.shtml"-->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
<!-- <script type="text/javascript" src="http://10.88.15.51:8080/js/jquery/lhgdialog/lhgdialog.js"></script> -->
<style type="text/css">
    .table-cell{
        text-align: center;
        padding: 0;
        margin: 0;
    }
    .cell-normal {
        height: 40px;
    }
    .cell-textarea {
        height: 80px;
    }
    td{
        -webkit-user-select:none;
        -moz-user-select:none;
        -ms-user-select:none;
        user-select:none;
    }
    input[type="text"]{
        width: 100px;
        margin: 0 5px 0 5px;
    }
    input[type="remove"]{
        width: 140px;
    }
    .foot-btns{
        bottom: 0;
        float: right;
        margin: 10px 20px 0 0;
    }
</style>
</head>
<body> 
    <form id="addCCform" class="form-horizontal">
        <table class="table table-bordered table-info" width="100%" style="padding-top:10px" id="pdList">
            <tr>
                <th class="table-cell cell-normal" colspan="2">CC TYPE</th>
                <td class="table-cell cell-normal" colspan="11" style="width: 40%">
                    <form style="color: black"  id="ccType" name="ccType">
                        <input type="radio" name="ccType" id="remove" value="1" onchange="cc_type_change(1)" disabled="true"><label for="remove">Remove</label>
                        <input type="radio" name="ccType" id="install" style="margin-left: 15px" value="2" onchange="cc_type_change(2)" disabled="true"><label for="install">Install</label>
                        <input type="radio" name="ccType" id="replace" style="margin-left: 15px" value="3" onchange="cc_type_change(3)" disabled="true"><label for="replace">Replace</label>
                        <input type="radio" name="ccType" id="swap" style="margin-left: 15px" value="4" onchange="cc_type_change(4)" disabled="true"><label for="swap">Swap</label>
                    </form>
                </td>


            </tr>
            <tr id="off1">
                <th class="table-cell cell-normal" style="width: 5%">OFF</th>
                <th class="table-cell cell-normal" style="width: 5%">A/C</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="offAc" name="offAc"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">Name</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="offName" name="offName"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">P/N</th>
                <td class="table-cell cell-normal required" style="width: 10%"><span id="offPn" name="offPn"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">S/N</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="offSn" name="offSn"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">构型</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="gouxin" name="offSn"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">Position</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="offPosition" name="offPosition"></span></td>
            </tr>
            <tr id="on1">
                <th class="table-cell cell-normal" style="width: 5%">ON</th>
                <th class="table-cell cell-normal" style="width: 5%">A/C</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="onAc1" name="onAc1"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">Name</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="onName1" name="onName1"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">P/N</th>
                <td class="table-cell cell-normal required" style="width: 10%"><span id="onPn1" name="onPn1"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">S/N</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="onSn1" name="onSn1"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">构型</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="gouxin1" name="offSn"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">Position</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="onPosition1" name="onPosition1"></span></td>
            </tr>
            <tr id="on2">
                <th class="table-cell cell-normal">ON</th>
                <td class="table-cell cell-normal" colspan="2"></td>
                <th class="table-cell cell-normal">P/N</th>
                <td class="table-cell cell-normal required"><span id="onPn2" name="onPn2"></span></td>
                <th class="table-cell cell-normal">S/N</th>
                <td class="table-cell cell-normal"><span id="onSn2" name="onSn2"></span></td>
                <th class="table-cell cell-normal" style="width: 5%">构型</th>
                <td class="table-cell cell-normal" style="width: 10%"><span id="gouxin2" name="offSn"></span></td>
                <th class="table-cell cell-normal">Position</th>
                <td class="table-cell cell-normal"><span id="onPosition2" name="onPosition2"></span></td>
            </tr>
            <tr>
                <th class="table-cell cell-normal required" colspan="3">Complete Date</th>
                <td class="table-cell cell-normal" colspan="2"><span id="completeDate" name="completeDate"></span></td>
                <th class="table-cell cell-normal required" colspan="2">Flight No.</th>
                <td class="table-cell cell-normal" colspan="2"><span id="flightNo" name="flightNo"></span></td>
                <td class="table-cell cell-normal" colspan="4"></td>
            </tr>
            <tr>
                <th class="table-cell cell-normal required" colspan="2">航材状态</th>
                <td class="table-cell cell-normal"><span name="airMaterialState" id="airMaterial"></span></td>
                <td class="table-cell cell-normal" colspan="10"></td>
            </tr>
            <tr>
                <th class="table-cell cell-normal required" colspan="3">Reason</th>
                <td class="table-cell cell-textarea" colspan="10">
                    <textarea id="reason" name="reason" maxlength="1000" style="height: 100%;width: 100%;resize: none;" readonly="readonly"></textarea>
                </td>
            </tr>
            <tr>
                <th class="table-cell cell-normal required" colspan="3">TAKEN ACTION</th>
                <td class="table-cell cell-textarea" colspan="10">
                    <textarea id="takenAction" name="takenAction" maxlength="1000" style="height: 100%;width: 100%;resize: none;" readonly="readonly"></textarea>
                </td>
            </tr>
            <table id="tableRemove" class="table table-bordered table-info">
                <tr>
                    <th class="table-cell cell-normal" colspan="5">该部件存在以下下级部件请核实是否一起拆下</th>
                </tr>
                <tr>
                    <th class="table-cell cell-normal" style="width: 20%">Name</th>
                    <th class="table-cell cell-normal required" style="width: 20%">P/N</th>
                    <th class="table-cell cell-normal required" style="width: 20%">S/N</th>
                    <th class="table-cell cell-normal required" style="width: 20%">Position</th>
                    <th class="table-cell cell-normal required" style="width: 20%">是否随上层母件一起拆下？</th>
                </tr>
                <!-- <tr>
                    <td class="table-cell cell-normal"><input type="long" name="remove_name" id="remove_name"></td>
                    <td class="table-cell cell-normal"><input type="long" name="remove_pn" id="remove_pn"></td>
                    <td class="table-cell cell-normal"><input type="long" name="remove_sn" id="remove_sn"></td>
                    <td class="table-cell cell-normal"><input type="long" name="remove_position" id="remove_position"></td>
                    <td class="table-cell cell-normal">yes</td>
                </tr> -->
            </table>
            <table id="tableReplace" class="table table-bordered table-info">
                <tr>
                    <th class="table-cell cell-normal" colspan="7">该部件存在以下下级部件请核实是否一起拆换</th>
                </tr>
                <tr>
                    <th class="table-cell cell-normal" style="width: 14%">Name</th>
                    <th class="table-cell cell-normal required" style="width: 14%">P/N(OFF)</th>
                    <th class="table-cell cell-normal required" style="width: 14%">S/N(OFF)</th>
                    <th class="table-cell cell-normal required" style="width: 14%">Position</th>
                    <th class="table-cell cell-normal required" style="width: 16%">是否随上层母件一起拆换？</th>
                    <th class="table-cell cell-normal" style="width: 14%">P/N(ON)</th>
                    <th class="table-cell cell-normal" style="width: 14%">S/N(ON)</th>
                </tr>
            </table>
            <!-- <table id="tableSwap"></table> -->
            <table class="table table-bordered table-info">
                <tr>
                    <th class="table-cell cell-normal" style="width: 20%">Remark</th>
                    <td class="table-cell cell-textarea">
                        <textarea id="remark" name="remark" maxlength="1000" style="height: 100%;width: 100%;resize: none;" readonly="readonly"></textarea>
                    </td>
                </tr>
            </table>
        </table>
    </form>
    <div class="foot-btns">
        <a class="ridoBtn" type="button" onclick="close_window()" data-options="iconCls:'icon-clear'">
            <span data-i18n="common:COMMON_OPERATION.CANCEL"></span>
        </a>
    </div>
    
<script type="text/javascript">
    const params = getParentParam_();
    var global_data = {
        sublength: 0
    };

    const air_material_state_dict = {
        USED: "可用件",
        UNUSED: "不可用件",
        WDISPOSE: "待观察件"
    };

    function get_data(){
        if(params.operation == "add"){
            return;
        }
        let url = "/api/v1/cc/view";
        let form = new FormData();
        form.append('id', params.id);
        axios.post(url, form).then(response=>{
            if(response.data.msg.toUpperCase().indexOf("SUCCESS") != -1){
                if(!!response.data.data){
                    console.log("response.data.data");
                    console.log(response.data.data);
                    init_data(response.data.data)
                }
            }else{
                throw new Error(response.data.msgData[0])
            }
        }).catch(err=>{
            MsgAlert({type: "error", content: "获取cc信息失败: " + err})
        })
    }


    /**
     * 给remove的下级件列表加一行
     * @param {object} row_data 该行对应的数据
     * @param {number} index 该行对应的行号
     */
    function add_table_remove(row_data, index){
        if(!!$(`#remove_tr${index}`)){
            $(`#remove_tr${index}`).empty();
            $(`#remove_tr${index}`).remove();
        }
        let html = `<tr id="remove_tr${index}" name="remove_tr">
                    <td class="table-cell cell-normal"><span name="remove_name${index}" id="remove_name${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="remove_pn${index}" id="remove_pn${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="remove_sn${index}" id="remove_sn${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="remove_position${index}" id="remove_position${index}"></span></td>
                    <td class="table-cell cell-normal">
                        <form style="color: black"  id="remove_status${index}" name="remove_status${index}">
                            <input type="radio" name="remove_status${index}" id="remove_status_yes${index}" value="y" disabled="disabled">是
                            <input type="radio" name="remove_status${index}" id="remove_status_no${index}" style="margin-left: 15px" value="n" disabled="true">否
                        </form>
                    </td>
                </tr>`;
        let node = $(html);
        $("#tableRemove").append(html);
        $(`#remove_name${index}`).text(row_data.name);
        $(`#remove_pn${index}`).text(row_data.offPn);
        $(`#remove_sn${index}`).text(row_data.offSn);
        $(`#remove_position${index}`).text(row_data.offPosition);
        if(row_data.flag == "y"){
            $(`#remove_status_yes${index}`).attr("checked", "checked");
        }else if(row_data.flag == "n"){
            $(`#remove_status_no${index}`).attr("checked", "checked");
        }
    }

    /**
     * 给replace的下级件列表加一行
     * @param {object} row_data 改行对应的数据
     * @param {number} index 该行对应的行号
     */
    function add_table_replace(row_data, index){
        if(!!$(`#replace_tr${index}`)){
            $(`#replace_tr${index}`).empty();
            $(`#replace_tr${index}`).remove();
        }
        let html = `<tr id="replace_tr${index}" name="replace_tr">
                    <td class="table-cell cell-normal"><span name="replace_name${index}" id="replace_name${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="replace_offPn${index}" id="replace_offPn${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="replace_offSn${index}" id="replace_offSn${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="replace_position${index}" id="replace_position${index}"></span></td>
                    <td class="table-cell cell-normal">
                        <form style="color: black"  id="replace_status${index}" name="replace_status${index}">
                            <input type="radio" name="replace_status${index}" id="replace_status_yes${index}" value="y" disabled="disabled">是
                            <input type="radio" name="replace_status${index}" id="replace_status_no${index}" style="margin-left: 15px" value="n" disabled="disabled">否
                        </form>
                    </td>
                    <td class="table-cell cell-normal"><span name="replace_onPn${index}" id="replace_onPn${index}"></span></td>
                    <td class="table-cell cell-normal"><span name="replace_onSn${index}" id="replace_onSn${index}"></span></td>
                </tr>`;
        let node = $(html);
        $("#tableReplace").append(html);
        $(`#replace_name${index}`).text(row_data.name);
        $(`#replace_offPn${index}`).text(row_data.offPn);
        $(`#replace_onPn${index}`).text(row_data.onPn);
        $(`#replace_offSn${index}`).text(row_data.offSn);
        $(`#replace_onSn${index}`).text(row_data.onSn);
        $(`#replace_position${index}`).text(row_data.offPosition);
        if(row_data.flag == "y"){
            $(`#replace_status_yes${index}`).attr("checked", "checked");
        }else if(row_data.flag == "n"){
            $(`#replace_status_no${index}`).attr("checked", "checked");
        }
    }

     function init_data(page_data){
        if(!page_data){
            return
        }
        //先执行cc_type_change处理上部表格,cc_type_change会清空上部数据,执行之后再赋值
        if(page_data.tlbCompCC.ccType == 1){
            //remove
            $("#remove").attr("checked", "checked");
            cc_type_change(1);
            if(Array.isArray(page_data.tlbCompCCSubs)){
                page_data.tlbCompCCSubs.forEach(add_table_remove)
            }
        }else if(page_data.tlbCompCC.ccType == 2){
            //install
            $("#install").attr("checked", "checked");
            cc_type_change(2);
            $("#onAc1").text(page_data.tlbCompCC.onAc);
            $("#onName1").text(page_data.tlbCompCC.onName);
            $("#onPn1").text(page_data.tlbCompCC.onPn);
            $("#onSn1").text(page_data.tlbCompCC.onSn);
            $("#onPosition1").text(page_data.tlbCompCC.onPosition);
            $("#gouxin1").text(page_data.tlbCompCC.onCin);
        }else if(page_data.tlbCompCC.ccType == 3){
            //replace
            $("#replace").attr("checked", "checked");
            cc_type_change(3);
            if(Array.isArray(page_data.tlbCompCCSubs)){
                page_data.tlbCompCCSubs.forEach(add_table_replace)
            }
            $("#onPn2").text(page_data.tlbCompCC.onPn);
            $("#onSn2").text(page_data.tlbCompCC.onSn);
            $("#onPosition2").text(page_data.tlbCompCC.onPosition);
            $("#gouxin2").text(page_data.tlbCompCC.onCin);
        }else if(page_data.tlbCompCC.ccType == 4){
            //swap
            $("#swap").attr("checked", "checked");
            cc_type_change(4);
            $("#onAc1").text(page_data.tlbCompCC.onAc);
            $("#offAc").text(page_data.tlbCompCC.offAc);
            $("#onName1").text(page_data.tlbCompCC.onName);
            $("#onPn1").text(page_data.tlbCompCC.onPn);
            $("#onSn1").text(page_data.tlbCompCC.onSn);
            $("#onPosition1").text(page_data.tlbCompCC.onPosition);
            $("#gouxin1").text(page_data.tlbCompCC.onCin);
        }
        global_data.sublength = (page_data.tlbCompCCSubs || []).length;

        $("#offName").text(page_data.tlbCompCC.offName);
        $("#offSn").text(page_data.tlbCompCC.offSn);
        $("#offPn").text(page_data.tlbCompCC.offPn);
        $("#offPosition").text(page_data.tlbCompCC.offPosition);
        $("#gouxin").text(page_data.tlbCompCC.cin);
        $("#completeDate").text(formatterDate(new Date(page_data.tlbCompCC.completeDate)));
        $("#flightNo").text(page_data.tlbCompCC.flightNo);
         $("#airMaterial").text(air_material_state_dict[page_data.tlbCompCC.airMaterialState]);
         $("#reason").val(page_data.tlbCompCC.reason);
         $("#takenAction").val(page_data.tlbCompCC.takenAction);
        $("#remark").val(page_data.tlbCompCC.remark)
        // $("#offPosition").textbox("setValue", page_data.offPosition);
        // $("#offName").textbox("setValue", page_data.offName);
        // $("#offSn").next("span").children().first().blur(get_component_list);
        // $("#onAc1").textbox();
        // $("#onPosition1").textbox();
        // $("#onName1").textbox();
        // $("#onSn1").textbox();
        // $("#onAc2").textbox();
        // $("#onPosition2").textbox();
        // $("#onName2").textbox();
        // $("#onSn2").textbox();
        // $("#offPn").textbox("setValue", page_data.offPn);
        // $('#airMaterial').combobox("setValue", page_data.airMaterialState);
        // $("#onPn1").textbox();
        // $("#onPn2").textbox();
        // $("#completeDate").datetimebox("setValue", formatterDate(new Date(page_data.completeDate)));
        // $("#remove").attr("checked", "checked");
        // cc_type_change(1)
    }

    function cc_type_change(data){
        // clear_cc_row();
        switch(data){
            case 1:
                console.log("case 1");
                $("#off1").show();
                $("#on1").hide();
                $("#on2").hide();
                $("tr[name='replace_tr']").empty();
                $("tr[name='replace_tr']").remove();
                $("#tableReplace").hide();
                $("#tableRemove").show();
                break;
            case 2:
                console.log("case 2");
                $("#on1").show();
                $("#off1").hide();
                $("#on2").hide();
                break;
            case 3:
                console.log("case 3");
                $("#off1").show();
                $("#on1").hide();
                $("#on2").show();
                $("tr[name='remove_tr']").empty();
                $("tr[name='remove_tr']").remove();
                $("#tableRemove").hide();
                $("#tableReplace").show();
                break;
            case 4:
                console.log("case 4");
                $("#off1").show();
                $("#on1").show();
                $("#on2").hide();
                break;
        }
    }

    /**
     * 初始化easyUI组件
     */
    function init_page(){
        $("#offAc").text(params.defect_info.ac);
        $("#remove").attr("checked", "checked");
        cc_type_change(1)
    }

    /**
     * 关闭当前addCC窗口
     * @return {void}
     */
    function close_window(){
        window.opener=null;
        window.open('','_self');
        window.close();
    }

    $(function(){
        init_page();
        get_data()
    })
    
</script>
</body>
</html>