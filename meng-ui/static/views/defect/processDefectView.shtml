<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--#include virtual="/views/items/resource_.shtml"-->
<!-- <script type="text/javascript" src="http://10.88.15.51:8080/js/jquery/lhgdialog/lhgdialog.js"></script> -->
    <!--#include virtual="/views/defect/defect_js.shtml"-->
<style type="text/css" scoped>
    .table-cell{
        text-align: center;
        padding: 0;
        margin: 0;
    }
    .cell-normal {
        height: 40px;
        line-height: 40px;
    }
    .cell-high {
        height: 100px;
    }
    input[type="radio"], input[type="checkbox"] {
         vertical-align: -2px
    }
    td, #dm, #RIIRCI{
        -webkit-user-select:none;
        -moz-user-select:none;
        -ms-user-select:none;
        user-select:none;
    }
    .panel{
        position: absolute;
        left: 350px;
        top: 150px;
    }
    .foot-btns{
        float: right;
        margin: 10px 20px 10px 0;
    }
</style>
</head>
<body> 
    <table class="table table-bordered table-info" width="100%" style="padding-top:10px">
        <tr>
            <th class="table-cell cell-normal" style="width: 14%">A/C</th>
            <td class="table-cell cell-normal" style="width: 19%">
                <span id="ac"></span>
            </td>
            <th class="table-cell cell-normal" style="width: 14%">Flt. No.</th>
            <td class="table-cell cell-normal" style="width: 16%">
                <span id="fltNo"></span>
            </td>
            <th class="table-cell cell-normal" style="width: 14%">Flt. Date</th>
            <td class="table-cell cell-normal">
                <span id="fltDate"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">Station</th>
            <td class="table-cell cell-normal">
                <span id="station"></span>
            </td>
            <th class="table-cell cell-normal" style="width: 16%">Check Type</th>
            <td class="table-cell cell-normal" colspan="3">
                <span id="checkType"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">Task Type</th>
            <td class="table-cell cell-normal">
                <span id="taskType"></span>
            </td>
            <th class="table-cell cell-normal" style="width: 16%">Doc No.</th>
            <td class="table-cell cell-normal">
                <span id="docNo"></span>
            </td>
            <th class="table-cell cell-normal" style="width: 16%">Status</th>
            <td class="table-cell cell-normal">
                <span id="status"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">Description</th>
            <td class="table-cell cell-normal" colspan="5">
                <span id="description"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">Remark(Last)</th>
            <td class="table-cell cell-normal" colspan="5">
                <span id="remark"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">无TLB NO.</th>
            <td class="table-cell cell-normal">
                <input type="checkbox" name="noTlb" id="noTlb" disabled="true">
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">TLB NO.</th>
            <td class="table-cell cell-normal">
                <span id="tlbNo"></span>
            </td>
<!--            <th class="table-cell cell-normal">DLY/CNL</th>
            <td class="table-cell cell-normal">
                <input type="checkbox" name="dlyCnl" id="dlyCnl" disabled="true">
            </td>-->
            <th class="table-cell cell-normal" id="RIIRCI">
                <label>RII<input style="margin: 0 10px 0 5px" type="checkbox" name="RII" id="RII" disabled="true" /></label>
                <label>RCI<input style="margin: 0 0px 0 5px" type="checkbox" name="RCI" id="RCI" disabled="true" /></label>
            </th>
            <td class="table-cell cell-normal">
                Sign
                <input style="width: 70%; display: inline-block;" class="easyui-textbox" id="sign" disabled="false"/>
            </td>
            <th class="table-cell cell-normal required" style="width: 16%"><span>Finder Sign</span></th>
            <td class="table-cell cell-normal">
                <input  class="easyui-textbox " id="finderSign" style="width: 90%" disabled="true"/>
            </td>
        </tr>
        <!--  -->
        <tr>
            <th class="table-cell cell-normal">Mechanic Sn</th>
            <td class="table-cell cell-normal">
                <span id="mechanicSn"></span>
            </td>
            <th class="table-cell cell-normal">Mechanic</th>
            <td class="table-cell cell-normal">
                <span id="mechanic"></span>
            </td>
            <th class="table-cell cell-normal">ATA</th>
            <td class="table-cell cell-normal">
                <span id="ata"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">ManHours</th>
            <td class="table-cell cell-normal">
                <span id="manHours"></span>
            </td>
            <th class="table-cell cell-normal">Complete Date</th>
            <td class="table-cell cell-normal" colspan="3">
                <span id="completeDate"></span>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-normal">EWIS</th>
            <td class="table-cell cell-normal">
                <form style=""  id="EWIS">
                    <input type="radio" name="EWIS" id="EWISYes" value="y" disabled="disabled" onchange="ewis_y()"><span style="padding-left: 5px">Y</span>
                    <input type="radio" name="EWIS" id="EWISNo" disabled="disabled" onchange="ewis_n()"style="margin-left: 15px" value="n"><span style="padding-left: 5px">N</span>
                </form>
            </td>
            <th class="table-cell cell-normal">油液渗漏</th>
            <td class="table-cell cell-normal">
                <form style=""  id="oilSpill">
                    <input type="radio" name="oilSpill" id="oilSpillYes" disabled="disabled"   onchange="os_y()" value="y"><span style="padding-left: 5px">Y</span>
                    <input type="radio" name="oilSpill" id="oilSpillNo" disabled="disabled" onchange="os_n()"  style="margin-left: 15px"><span style="padding-left: 5px">N</span>
                </form>
            </td>
            <td colspan="2"></td>
        </tr>
        <tr>
            <th class="table-cell cell-high">Taken Action(CHN)</th>
            <td class="table-cell cell-high" colspan="5">
                <textarea id="chineseAction" maxlength="1000" style="height: 100%;width: 100%;resize: none;" readonly="readonly"></textarea>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-high">Taken Action(ENG)</th>
            <td class="table-cell cell-high" colspan="5">
                <textarea id="englishAction" maxlength="1000" style="height: 100%;width: 100%;resize: none;" readonly="readonly"></textarea>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-high">Feed Back</th>
            <td class="table-cell cell-high" colspan="5">
                <textarea id="feedback" maxlength="1000" style="height: 100%;width: 100%;resize: none;" readonly="readonly"></textarea>
            </td>
        </tr>
        <tr>
            <th class="table-cell cell-high">上传附件</th>
            <td class="table-cell cell-high" colspan="5" style="text-align: right">
                <div id="attachmengtList" style="margin-bottom: 5px"></div>
            </td>
        </tr>
        
        
        <!-- <tr>
            <td id="EWISTable" colspan="99"></td>
        </tr> -->
    </table>

    <table class="table table-bordered table-info" id="ccTable" width="100%">
        <tr>
            <th class="table-cell cell-normal" rowspan="99">录入CC</th>
            <th class="table-cell cell-normal" colspan="7"></th>
            <th class="table-cell cell-normal">
            </th>
            <td class="table-cell cell-normal"></td>
        </tr>
        <tr>
            <td class="table-cell cell-normal" style="width: 6%">NO.</td>
            <td class="table-cell cell-normal" style="width: 6%">Type</td>
            <td class="table-cell cell-normal" style="width: 10%">P/N OFF</td>
            <td class="table-cell cell-normal" style="width: 10%">S/N OFF</td>
            <td class="table-cell cell-normal" style="width: 10%">P/N ON</td>
            <td class="table-cell cell-normal" style="width: 10%">S/N ON</td>
            <td class="table-cell cell-normal" style="width: 6%">Status</td>
            <td class="table-cell cell-normal" style="width: 6%">航材状态</td>
            <td class="table-cell cell-normal">Operation</td>
        </tr>
    </table>
    <div class="foot-btns">
        <a class="ridoBtn" type="button" onclick="close_window()" data-options="iconCls:'icon-clear'">
            <span data-i18n="common:COMMON_OPERATION.CANCEL"></span>
        </a>
    </div>

<script type="text/javascript">
    const params = getParentParam_();
    const userName = getLoginInfo().userName;
    const userId = getLoginInfo().accountNumber;
    /** reasons选项的配置 **/
    const reasons_list = [
        {
            value: "Material",
            label: "Material",
            name: "Material"
        },
        {
            value: "Ground Time",
            label: "Ground Time",
            name: "Ground Time"
        },
        {
            value: "Tooling",
            label: "Tooling",
            name: "Tooling"
        },
        {
            value: "Engineering",
            label: "Engineering",
            name: "Engineering"
        },
    ]

    /** category选项配置 **/
    const category_list = [
        {
            value: "a",
            label: "A: 一天",
            name: "a",
            days: 1
        },
        {
            value: "b",
            label: "B: 三天",
            name: "b",
            days: 3
        },
        {
            value: "c",
            label: "C: 十天",
            name: "c",
            days: 10
        },
        {
            value: "d",
            label: "D: 一百二十天",
            name: "d",
            days: 120
        },
        {
            value: "other",
            label: "OTHER",
            name: "other"
        }
    ]

    /** category选项配置 **/
    const reference_list = [
        {
            value: "MEL",
            label: "MEL",
            name: "MEL"
        },
        {
            value: "CDL",
            label: "CDL",
            name: "CDL"
        },
        {
            value: "TE",
            label: "TE",
            name: "TE"
        },
        {
            value: "AMM",
            label: "AMM",
            name: "AMM"
        },
        {
            value: "SRM",
            label: "SRM",
            name: "SRM"
        },
        {
            value: "FIM",
            label: "FIM",
            name: "FIM"
        },
        {
            value: "OTHERS",
            label: "OTHERS",
            name: "OTHERS"
        }
    ]
    /** 保存页面临时信息的全局变量 **/
    var global_data = {
        fh: "",
        fc: "",
        calendarDays: "",
        flyingDays: ""
    }

    
    /** 添加必填标志 **/
    function add_require(){
        $(".required").append("<span style='color: red'>*</span>")
    }

    /** 所有easyui组件的初始化 **/
    function init_page(){
      //  add_require();
        $.ajax({cache: false})
        $('#sign').textbox({
            icons: [{
                iconCls:'icon-search',
                handler: function(e){
                    $.dialog.setting.extendDrag = true;
                    UserUtils.showDialog({
                        callback:function(data){
                            let user_info = data[0]
                            $("#sign").textbox("setValue", user_info.userName + "(" + user_info.sn + ")")
                        }
                    });
                }
            }]
        });
        $("#finderSign").textbox({
            value: `${userName}(${userId})`,
            editable: false,
            icons: [{
                iconCls:'icon-search',
                handler: function(e){
                    $.dialog.setting.extendDrag = true;
                    UserUtils.showDialog({
                        callback:function(data){
                            let user_info = data[0];
                            $("#finderSign").textbox("setValue", user_info.userName + "(" + user_info.sn + ")")
                        }
                    });
                }
            }, {
                iconCls:'icon-cross',
                handler: function(e){
                    $("#finderSign").textbox("setValue", "")
                }
            }]
        });
    }

    /** 页面数据初始化 **/
    function get_data(){
        let url = `/api/v1/defect/defect/action/upload_measures?id=${params.defectId}`;
        if(!!params.id){
            url = `/api/v1/defect/defect/action/edit_upload_measures?id=${params.defectId}&actionId=${params.id}&editFlag=view`
        }
        axios.get(url).then(response=>{
            if(response.data.msg.indexOf("SUCCESS") != -1){
                init_data(response.data.data);
            }else{
                throw new Error(response.data.msgData[0])
            }
        }).catch(err=>{
            MsgAlert({type: "error", content: err.message})
        })
    }


    /** 页面数据初始化 **/
    function init_data(page_data){
        if(!!page_data.defectAction){
            global_data.id = page_data.defectAction.id;
            global_data.defectNo = page_data.defectAction.defectNo;
            $("#chineseAction").html(page_data.defectAction.takenActionChn);
            $("#englishAction").html(page_data.defectAction.takenActionEng);
            // $("#completeDate").html(page_data.defectAction.dateAction);
            $("#completeDate").html(page_data.defectAction.dateAction);
            for (var i = 0; i < page_data.defectAction.attachments.length; i++) {
                var trHTML = '<tr align="left" id="tr'+ page_data.defectAction.attachments[i].fileId+'"><input class="uploadId" value="'+  page_data.defectAction.attachments[i].fileId +'" type="hidden"><td class="td5" align="left" style="text-align:left;"><a target="_blank" onclick="downFile(' + page_data.defectAction.attachments[i].pkid + ',' + page_data.defectAction.attachments[i].pkid + ')">' + page_data.defectAction.attachments[i].orgName + '</a></td><</tr>';
                $("#attachmengtList").append(trHTML);//在table最后面添加一行
                // downFile(jdata.data[i].PKID,jdata.data[i].PKID);
            }
        }

        if(!!page_data.lineJob){
            $("#ac").html(page_data.lineJob.acReg);
            $("#fltNo").html(page_data.lineJob.flightNo);
            $("#acModel").html(page_data.info.minorModel);
            init_zone(page_data.info.model, page_data.defectAction.zone);
            $("#fltDate").html(page_data.lineJob.jobDate);
            $("#station").html(page_data.lineJob.station);
            $("#checkType").html(page_data.lineJob.workType);
        }
        if(!!page_data.maintenanceTask){
            $("#taskType").html(page_data.maintenanceTask.type);
            $("#docNo").html(page_data.maintenanceTask.cardNo);
            $("#status").html(page_data.maintenanceTask.status);
            $("#description").html(page_data.maintenanceTask.description);
            $("completeDate").datetimebox("setValue", page_data.maintenanceTask.completeDate);
            if(page_data.maintenanceTask.dm == "y"){
                $("#dmYes").attr("checked", "checked");
            }else if(page_data.maintenanceTask.dm == "n"){
                $("#dmNo").attr("checked", "checked");
            }
            if(page_data.maintenanceTask.rii == "y"){
                $("input[name='RII']").prop("checked", true);
                $("#sign").textbox("enable")
            }else if(page_data.maintenanceTask.rii == "n"){
                $("input[name='RII']").prop("checked", false);
            }
            if(page_data.maintenanceTask.rci == "y"){
                $("input[name='RCI']").prop("checked", true);
                $("#sign").textbox("enable")
            }else if(page_data.maintenanceTask.rci == "n"){
                $("input[name='RCI']").prop("checked", false);
            }

            $("#ata").html(page_data.maintenanceTask.ata);
            $("#taskType").html(page_data.maintenanceTask.type);
            if(page_data.maintenanceTask.dm === "y"){
                $("#dmYes").attr("checked", "checked");
            }else if(page_data.maintenanceTask.dm === "n"){
                $("#dmNo").attr("checked", "checked");
            }
        }
        if(!!page_data.techLog){
            $("#mechanicSn").html(page_data.techLog.technicianActNo);
            $("#mechanic").html(page_data.techLog.technicianActSign);
            global_data.tlbId = page_data.techLog.tlbId;
            global_data.tlbNo = page_data.techLog.tlbNo;
            global_data.acId = page_data.techLog.acId;
            $("#feedback").html(page_data.techLog.remark);
            // if(page_data.techLog.noTlbNo == "y"){
            //     $("input[name='noTlbNo']").prop("checked", true);
            // }else if(page_data.techLog.noTlbNo == "n"){
            //     $("input[name='noTlbNo']").prop("checked", false);
            // }
            // if(page_data.techLog.dlyCnl == "y"){
            //     $("input[name='dlyCnl']").prop("checked", true);
            // }else if(page_data.techLog.dlyCnl == "n"){
            //     $("input[name='dlyCnl']").prop("checked", false);
            // }
            if(page_data.techLog.isHasEwis == "y"){
              /*  $("#EWISYes").attr("checked", "checked");*/
                $("#EWISYes").prop("checked", true);
               /* $("#EWIS").EWIS("setData", page_data.pageEwislst);*/
            }else if(page_data.techLog.isHasEwis == "n"){
                $("#EWISNo").prop("checked", true);
            }
            if(page_data.techLog.isHasOil == "y"){
/*                $("#oilSpillYes").attr("checked", "checked");*/
                $("#oilSpillYes").prop("checked", true);
                /*$("#oilSpill").oilSpill("setData", page_data.pageOillst);*/
            }else if(page_data.techLog.isHasOil == "n"){
                /*$("#oilSpillNo").attr("checked", "checked");*/
                $("#oilSpillNo").prop("checked", true);
            }
            if (page_data.techLog.inspector != "" && page_data.techLog.inspector != null) {
                $("#sign").html(`${page_data.techLog.inspector}(${page_data.techLog.inspectorNo})`);
            } else {
                $("#sign").html( ``);
            }
            $("#foundDate").html(page_data.techLog.dateFound);
            $("#chineseReport").html(page_data.techLog.faultReportChn);
            $("#englishReport").html(page_data.techLog.faultReportEng);
            // $("#manHours").html(page_data.techLog.manHours);
            $("#manHours").html(page_data.techLog.manHours);
            if(page_data.techLog.dm === "y"){
                $("#dmYes").attr("checked", "checked");
            }else if(page_data.techLog.dm === "n"){
                $("#dmNo").attr("checked", "checked");
            }
            $("#station").html(page_data.techLog.staAction);
            if(page_data.techLog.noTlbNo == "1"){
                $("#noTlb").attr("checked", "checked");
                $("#tlbNo").html("");
            }
            $("#tlbNo").html(page_data.techLog.tlbNo);
            //发现人名字工号设置
            if(page_data.techLog.technicianFound && page_data.techLog.technicianFoundNo){
                $("#finderSign").textbox("setValue", `${page_data.techLog.technicianFound}(${page_data.techLog.technicianFoundNo})`)
            }
        }

        if(!!page_data.processVariables){
            $("#remark").html(page_data.processVariables.lastRemark);
        }
        $("#EWIS").EWIS("view", page_data.pageEwislst);
        $("#oilSpill").oilSpill("view", page_data.pageOillst);
        queryCCTable(global_data.tlbId);
    }
    /**
     * 查询cc列表
     * @param  {String} tlbId tlbId
     * @return {[type]}     [description]
     */
    function queryCCTable(tlbId){
        let url = "/api/v1/cc/list";
        let form = new FormData();
        form.append('tlbId', tlbId || global_data.tlbId);
        axios.post(url, form).then(response=>{
            if(response.data.msg.toUpperCase().indexOf("SUCCESS") != -1){
                if(!!response.data.data && Array.isArray(response.data.data.tlbCompCCS)){
                    $("tr[name='ccRow']").empty();
                    $("tr[name='ccRow']").remove();
                    response.data.data.tlbCompCCS.forEach((item, index)=>{
                        addCCRow(item, index)
                    })
                }
            }else{
                throw new Error(response.data.msgData[0])
            }
        })
    }

    /**
     * 为cc列表添加一行
     * @param {[type]} row_data [description]
     */
    function addCCRow(row_data, index){
        console.log("row_data");
        console.log(row_data);
        let status = "";
        if(row_data.middleStatus == "O"){
            status = "OPEN"
        }else if(row_data.middleStatus == "C"){
            status = "CLOSE"
        }
        let html = `<tr name="ccRow">
            <td class="table-cell cell-normal"><a style="color: #f60" onclick="openAddCC('view', ${row_data.id})">${row_data.ccNo || "view"+(index+1)}</a></td>
            <td class="table-cell cell-normal">${row_data.ccTypeStr}</td>
            <td class="table-cell cell-normal">${row_data.offPn|| ""}</td>
            <td class="table-cell cell-normal">${row_data.offSn|| ""}</td>
            <td class="table-cell cell-normal">${row_data.onPn|| ""}</td>
            <td class="table-cell cell-normal">${row_data.onSn|| ""}</td>
            <td class="table-cell cell-normal">${status}</td>
            <td class="table-cell cell-normal">${row_data.airMaterialState}</td>
            <td class="table-cell cell-normal" >

            </td>
        </tr>`;
        $("#ccTable").append($(html))
    }

    /** 打开addCC页面 **/
    function openAddCC(operation, id){
        let title = "View TLB CC";
        let param = {
            operation: operation,
            defect_info: {
            },
            type:"see"
        };
        if(id){
            param.id = id;
        }
        let url = "/views/defect/new_addcc.shtml";

        ShowWindowIframe({
            width: "1200",
            height: "700",
            title: title,
            param: param,
            url: url
        });
    }
    function init_zone(model, value) {
        axios.get("/api/v1/eo_zone/list/?model=" + model).then(response => {
            $("#zone").combobox({
                data: response.data.data.eoZoneList,
                panelHeight: '150px',
                valueField: 'zone',
                textField: 'zone',
                onSelect: item => {
                    global_data.zone_id = item.id;
                    global_data.zone_flag = 1;
                },
                onChange: item => {
                    global_data.zone_flag = 0;
                }
            });
            $("#zone").next("span").children("input:first").blur(function () {
                if (!global_data.zone_flag) {
                    $("#zone").combobox("clear")
                }
            });
            if (value) {
                $("#zone").combobox("setValue", value)
            }
        })
    }
    /** category other 回填 **/
    function add_category(data){
        for(item in data){
            global_data[item] = data[item]
        }
        let show_data = "";
        if(global_data.fh){
            show_data += global_data.fh + "FH "
        }
        if(global_data.fc){
            show_data += global_data.fc + "FC "
        }
        if(global_data.calendarDays){
            show_data += global_data.calendarDays + "日历日 "
        }
        if(global_data.flyingDays){
            show_data += global_data.flyingDays + "飞行日 "
        }
        $("#categoryOther").textbox("setValue", show_data)
    }

    /** category选择时计算失效时间 **/
    function calculate_expired_date(days){
        let current_date_start = new Date(new Date(new Date().toLocaleDateString()).getTime())
        let res_date = new Date( current_date_start.getTime() + 24*60*60*1000*Number(days) - 1 )
        $("#expiredDate").datetimebox("setValue", formatterDate(res_date))
        return res_date
    }

    function clear_category(){
        $("#categoryOther").textbox("clear")
        global_data.fh = ""
        global_data.fc = ""
        global_data.calendarDays = ""
        global_data.flyingDays = ""
    }

    function get_post_data(){
        let tlbNo = $("#tlbNo").textbox("getValue");
        let reasonOther = $("#others").textbox("getValue");
        let category = $("#category").combobox("getValue");
        let expiredDate = $("#expiredDate").datetimebox("getValue");
        let categoryOther = $("#categoryOther").textbox("getValue");
        let reference = $("#reference").combobox("getValue");
        let referItem = $("#referenceOther").textbox("getValue");
        let dm = $("input[name='dm']:checked").val();
        let manHours = $("#manHours").textbox("getValue"); 
       /* let dlyCnl = $("input[name='dlyCnl']:checked").val() == "on"? "y": "n";*/
        let rii = $("input[name='RII']:checked").val() == "on"? "y": "n";
        let rci = $("input[name='RCI']:checked").val() == "on"? "y": "n";
        let sign = $("#sign").textbox("getValue");
        let inspectorNo = "";
        let inspector = "";
        if(!!sign){
            inspectorNo = sign.match(/\((.+?)\)/).replace(/[()]/g, "");
            inspector = sign.split("(")[0];
        }
        //获取发现人名字工号
        let technicianFoundNo= "";
        let technicianFound = "";
        let finderSign = $("#finderSign").textbox("getValue");
        if (finderSign) {
            technicianFoundNo = finderSign.match(/\((.+?)\)/)[1];
            technicianFound = finderSign.split("(")[0];
        }
        let faultReportChn = $("#chineseReport").val();
        let faultReportEng = $("englishReport").val();
        let isPlacard = $("input[name='placard']:checked").val();
        let isCaution = $("input[name='MCItem']:checked").val();
        let isReview = $("input[name='reviewDuring']:checked").val();
        let isCheck = $("input[name='reviewBefore']:checked").val();
        let isSpecial = $("input[name='SQ']:checked").val();
        let isM = $("input[name='MItem']:checked").val();
        let isO = $("input[name='OItem']:checked").val();
        let isNotify = $("input[name='FCN']:checked").val();
        let applyDate = $("#applyDate").datetimebox("getValue");
        let requester = $("#requestedBy").textbox("getValue");
        let requesterNo = $("#requestedBy").textbox("getValue");
        let requesterLice = $("#license").textbox("getValue");
        let totalCy = $("#fltCycles").textbox("getValue");
        let totalFh = $("#fltHours").textbox("getValue");
        let isHasOil = $("input[name='oilSpill']:checked").val();
        let isHasEwis = $("input[name='EWIS']:checked").val();
        let ewis = $("#EWIS").EWIS("getData");
        if(!ewis){
            return false
        }
        let oilSpill = $("#oilSpill").oilSpill("getData");
        console.log("ewis")
        console.log(ewis)
        let post_data = {
            defectPend: {
                // actionId: 5559000,
                applyDate: applyDate,
                category: "PEND",
                ddDueData: {
                    category: category,
                    categoryExpDate: "",
                    id: 0
                },
                // defectId: 5559000,
                dfralCategory: category,
                dm: dm,
                expiredDate: expiredDate,
                // id: 5559000,
                isCaution: isCaution,
                isCheck: isCaution,
                isM: isM,
                isNotify: isNotify,
                isO: isO,
                isPlacard: isPlacard,
                isReview: isReview,
                isSpecial: isSpecial,
                // lackMater: y,
                // lackTech: y,
                // lackTime: y,
                // lackTool: y,
                // pendCount: 0,
                reasonOther: reasonOther,
                referItem: referItem,
                reference: reference,
                requester: requester,
                requesterLice: requesterLice,
                requesterNo: requesterNo,
                // tlbId: 5559000,
                tlbNo: tlbNo,
                totalCy: totalCy,
                totalFh: totalFh
            },
            ewisList: ewis,
            // ewisList:  [
                // {
                //     allNumber: 123456,
                //     componentType: 插头,
                //     defectId: 0,
                //     delAttaId: ,
                //     ewisAttaIds: [],
                //     ewisRe: ,
                //     ewisType: 0,
                //     id: 0,
                //     otherDescription: abc,
                //     staWlBl: ,
                //     tlbId: 0,
                //     upload: [],
                //     uploadContentType: [],
                //     uploadFileName: []
                // }
            // ],
            oilList: oilSpill,
            // oilList: [
                // {
                //     defectId: 0,
                //     delAttaId: ,
                //     id: 0,
                //     oilAttaIds: [],
                //     oilComponent: 1,
                //     oilLeakPosition: 1,
                //     oilRe: ,
                //     oilRecord: ,
                //     oilType: 1,
                //     otherDescription: abc,
                //     tlbId: 0,
                //     upload: [],
                //     uploadContentType: [],
                //     uploadFileName: []
                // }
            // ],
            tlbTechLog: {
                // defectId: 0,
/*                dlyCnl: dlyCnl,*/
                dm: dm,
                faultReportChn: faultReportChn,
                faultReportEng: faultReportEng,
                inspector: inspector,
                inspectorNo: inspectorNo,
                isHasEwis: isHasEwis,
                isHasOil: isHasOil,
                manHours: manHours,
                rci: rci,
                rii: rii,
                // tlbId: 0,
                tlbNo: tlbNo
            }
        }
        console.log(post_data)
    }

     function ewis_y(){
        $("#EWIS").EWIS("create")
     }

     function ewis_n(){
         $("#EWIS").EWIS("destroy")
     }

     function os_y(){
         $("#oilSpill").oilSpill("create")
    }

     function os_n(){
        $("#oilSpill").oilSpill("destroy")
     }

    // function save(){
    //     let post_data = get_post_data();
    //     let url = "/api/v1/defect/defect/pend/add"
    //     axios.post(url, post_data).then(response=>{
    //         if(response.data.msg.indexOf("ERROR") != -1){
    //             throw new Error(response.data.msgData[0])
    //         }else if(response.data.msg.toUpperCase().indexOf("SUCCESS") != -1){
    //         }
    //     }).catch(err=>{
    //         MsgAlert({type: "error", content: "保存失败" + err})
    //     })
    // }

    function close_window(){
        window.opener=null;
        window.open('','_self');
        window.close();
    }

    $(function(){
        init_page();
        get_data();
    })
    
</script>
</body>
</html>