<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!-- 禁止浏览器从本地缓存中调阅页面。网页不保存在缓存中，每次访问都刷新页面。  -->
    <meta content="no-cache" http-equiv="pragram"/>
    <!-- 同上面意思差不多，必须重新加载页面  -->
    <meta content="no-cache, must-revalidate" http-equiv="cache-control"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <title>无标题文档</title>
    <!-- load css -->
    <!--#include virtual="/views/items/resource_.shtml"-->
    <link href="/css/dialog_default.css" rel="stylesheet" type="text/css"/>
    <style type="text/css">
        .errorMessage {
            color: red
        }

        .td-font-red {
            color: red
        }

        a {
            color: #6e6e6e;
            text-decoration: none;
        }

        .td-line-hight-background {
            background: #f2f2f2;
        }

        .defect-block {
            cursor: pointer;
            margin: 5px 5px 0px 0px;
            display: inline-block;
            width: 120px;
            height: 30px;
            background-color: #eee;
            border: 1px solid #aaa;
            text-align: center;
        }

        .defect-block .content {
            display: inline-block;
            width: 100px;
            color: green;
        }

        .defect-block img {
            vertical-align: middle;
        }
    </style>
    <!-- load js -->
    <script src="/js/jquery/easyui/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>
    <script src="/js/jquery.form.js" type="text/javascript"></script>
    <script src="/js/global_var.js" type="text/javascript"></script>
    <script src="/js/jquery.validate.js" type="text/javascript"></script>
    <script src="/js/custom-validate.js" type="text/javascript"></script>

</head>

<body>
<form action="" id="fault_merging" method="post">
    <table border="1" bordercolor="#B2C9E0" cellpadding="0" cellspacing="0" class="post_table" style="padding-top:10px"
           width="100%">
        <tr>
            <td class="td-line-hight-background" width="25%">Merging Fault</td>
            <td id="mergingFaults">

            </td>
        </tr>
        <tr>
            <td class="td-line-hight-background" width="25%">Defects</td>
            <td id="defects">

            </td>
        </tr>
    </table>
</form>
</body>
<script>
    var api = frameElement.api, W = api.opener;
    var faultType = api.data.faultType;
    var mergingFaultNos = api.data.mergingFaultNos;
    var refDefectNos = api.data.refDefectNos;

    $(function () {

        $.each(mergingFaultNos, function (idx, val) {
            $("#mergingFaults").append("<a>" + val + "</a>&nbsp");
        });
        $.each(refDefectNos, function (idx, val) {
            $("#defects").append('<div class="defect-block"><div class="content" onclick="viewDefect(this)">' + val + '</div></div>');
        });

        api.button({
            name: 'Submit',
            id: 'submit',
            callback: function () {
                api.data['isSave'] = true;
            }
        });

        api.button({
            name: 'Cancel',
            id: 'cancel'
        });

        $("#mergingFaults a").click(function () {
            if (faultType == 'REPEAT') {
                showRepeatFaultsDefectNo($.trim($(this).text()));
            } else if (faultType == 'MULTIPLE') {
                showMultipleFaultsDefectNo($.trim($(this).text()));
            }
        });

    });

    function showRepeatFaultsDefectNo(repeatFaults) {
        $.ajax({
            url: basePath + "/api/v1/defect/repeat/" + repeatFaults + "/faults",
            type: 'get',
            cache: false,
            dataType: "json",
            success: function (dataMsg) {
                if (dataMsg.code == 200) {
                    let defectNoList = dataMsg.data.defectNoList;
                    let deletedDefectNoList = dataMsg.data.deletedDefectNoList;
                    let rowObject = dataMsg.data.defectRepeatFaults;
                    W.$.dialog({
                        id: 'repeatFaults_Info' + new Date().getTime(),
                        title: 'Repeat Faults Info',
                        top: '30%',
                        width: '600px',
                        height: '300px',
                        data: {
                            'rowObject': rowObject,
                            'defectNoList': defectNoList,
                            'deletedDefectNoList': deletedDefectNoList
                        },
                        content: 'url:' + basePath + "/views/defect/multiple_faults/defect_repeatFaults.shtml"
                    });
                } else {
                    W.$.dialog.alert(dataMsg.msg);
                }
            }
        });
    }

    function showMultipleFaultsDefectNo(multipleFaults) {
        $.ajax({
            url: basePath + "/api/v1/defect/multiple/" + multipleFaults + "/faults",
            type: 'get',
            cache: false,
            dataType: "json",
            success: function (dataMsg) {
                if (dataMsg.code == 200) {
                    var defectNoList = dataMsg.data.defectNoList;
                    var deletedDefectNoList = dataMsg.data.deletedDefectNoList;
                    var rowObject = dataMsg.data.defectMultipleFaults;
                    W.$.dialog({
                        id: 'multipleFaults_Info' + new Date().getTime(),
                        title: 'Multiple Faults Info',
                        top: '30%',
                        width: '600px',
                        height: '300px',
                        data: {
                            'rowObject': rowObject,
                            'defectNoList': defectNoList,
                            'deletedDefectNoList': deletedDefectNoList
                        },
                        content: 'url:' + basePath + "/views/defect/multiple_faults/defect_multipleFaults.shtml"
                    });
                } else {
                    W.$.dialog.alert(dataMsg.msg);
                }
            }
        });
    }

    function viewDefect(_this) {
        var defectNo = $.trim($(_this).text());
        ShowWindowIframe({
            width: "1000",
            height: "700",
            title: 'Defect Detail',
            param: {defectId: "", defectNo: defectNo},
            url: "/views/defect/defectDetails.shtml"
        });
    }

</script>
</html>
