<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="/js/jquery/easyui/jquery-1.8.0.min.js" type="text/javascript"></script>
    <!-- 这一段里面包含resource_.shtml里的内容，但是除去了jquery-1.12.0.min.js和easyui-lang-zh_CN.js，因为新旧版本共用会导致冲突 
         但是不引入这一段的话会导致页面样式失效，我也不知道哪些是有用的哪些是没用的 -->

        <link href="/css/style.min862f.css?v=4.1.0" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/css/common.css">
        <link rel="stylesheet" type="text/css" href="/css/icon.css">
        <link rel="stylesheet" type="text/css" href="/css/plugins/easyui/themes/bootstrap/easyui.css" id="swicth-style">
        <link rel="stylesheet" type="text/css" href="/css/plugins/easyui/themes/icon.css">
        <link rel="stylesheet" type="text/css" href="/css/plugins/easyui/themes/color.css">
        <!--<script type="text/javascript" src="/js/jquery-3.1.0.min.js"></script>-->
        <script type="text/javascript" src="/js/constants.js"></script>
        <!--<script type="text/javascript" src="/js/plugins/Validform_v5.3.2/Validform_v5.3.2.js"></script>
        <link rel="stylesheet" type="text/css" href="/js/plugins/Validform_v5.3.2/css/style.css">-->
        <script type="text/javascript" src="/js/plugins/easyui/jquery.easyui.custom.min.js"></script>
        <script type="text/javascript" src="/js/plugins/cookie/jquery.cookie.js"></script>
        <script type="text/javascript" src="/js/base64.js"></script>
        <script type="text/javascript" src="/js/plugins/layer/layer.js?style=default"></script>
        <script src="/js/plugins/i18next/i18next.min.js"></script>
        <script type="text/javascript" src="/js/common.js"></script>
        <script type="text/javascript" src="/js/combobox_utils.js"></script>
        <script type="text/javascript" src="/js/plugins/laytpl/laytpl.js"></script>
        <script src="/js/pdf.worker.js" type="text/javascript"></script>
        <script type="text/javascript" src="/js/axios.min.js"></script>
        <script type="text/javascript" src="/js/sfa-query-1.0.js"></script>
    <!-- most content of resource_.shtml but without jquery-1.12.0.min.js and easyui-lang-zh_CN.js -->
    <link href="/css/jquery-ui-1.8.2.custom.css" rel="stylesheet" type="text/css"/>
    <link href="/css/ui.jqgrid.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_new.css" rel="stylesheet" type="text/css"/>
    <link href="/css/dialog_default.css" rel="stylesheet" type="text/css"/>
    <link href="/css/easyui.css" rel="stylesheet" type="text/css"/>
    <link href="/js/jquery/ztree/zTreeStyle.css" rel="stylesheet" type="text/css"/>
    <link href="/css/easyui/gray/easyui.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/common_qc.css" rel="stylesheet" type="text/css"/>
    <link href="/js/jquery/jquery-ui-multiselect/jquery.multiselect.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="/css/icon.css">

    <link href="/css/mccdoc/to_commons.css" rel="stylesheet" type="text/css"/>
    <link href="/css/mccdoc/mcc_doc_commons.css" rel="stylesheet" type="text/css"/>
    <link href="/css/mccdoc/to_list.css" rel="stylesheet" type="text/css"/>

    <script src="/js/global_var.js"></script>

    <!-- multiSelect -->
    <script src="/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
    <script src="/js/jquery/jquery-ui-multiselect/src/jquery.multiselect.js" type="text/javascript"></script>

    <script src="/js/jquery/easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="/js/jquery/easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>

    <script src="/js/jquery/ztree/jquery.ztree.core-3.4.js" type="text/javascript"></script>
    <script src="/js/jquery/ztree/jquery.ztree.excheck-3.4.js" type="text/javascript"></script>

    <script src="/js/jquery/jqGrid/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="/js/jquery/jqGrid/i18n/grid.locale-cn.js" type="text/javascript"></script>

    <script src="/js/jquery/lhgdialog/lhgdialog.js" type="text/javascript"></script>

    <script src="/js/sfa-query-1.0.js" type="text/javascript"></script>
    <script src="/js/sfa-export.js" type="text/javascript"></script>
    <script type="text/javascript" src="/js/axios.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/desk.css">
    <script src="/js/mccdoc/to_issued_close.js" type="text/javascript"></script>
    <!--#include virtual="/views/defect/defect_js.shtml"-->
    <script type="text/javascript">
        // 对Date的扩展，将 Date 转化为指定格式的String
        // 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符， 
        // 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字) 
        // 例子： 
        // (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423 
        // (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18 
        Date.prototype.Format = function (fmt) { //author: meizz 
            var o = {
                "M+": this.getMonth() + 1, //月份 
                "d+": this.getDate(), //日 
                "h+": this.getHours(), //小时 
                "m+": this.getMinutes(), //分 
                "s+": this.getSeconds(), //秒 
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
                "S": this.getMilliseconds() //毫秒 
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }
    </script>
    <style type="text/css">
        
    </style>
</head>
<body>
    <ul id="sortable">
    </ul>

<script type="text/javascript">
    function append_window(item){
        let html_content = `
        <li>
            <table cellpadding="0" cellspacing="0" class="moduleMargin">
                <tr>
                    <td class="moduleHeader_left"></td>
                    <td class="moduleHeader_middle"><strong>${item.name}</strong></td>
                    <td width="73" class="moduleHeader_middle align_right">
                       <span id="mccRefresh" class="icon-2012080412111" style="display: inline-block; height: 36px; width: 36px; cursor: pointer" onclick="refresh(${item.id})" ></span>
                    </td>
                    <td class="moduleHeader_right"></td>
                </tr>
                <tr height="192px">
                    <td colspan="4" style="border-left: 1px solid #ccc;border-right: 1px solid #ccc;">
                        <div class="listbox" style="min-height: 180px">
                            <div class="gridbox">
                                <div class="grid_tab">
                                    <table id="common_list_grid${item.id}"></table>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="more" colspan="4">
                        <a id="show_more" href="javascript:void(0)" onclick="showMore(${item.id}, '${item.name}', '${item.viewNameLarge}')">more...</a>
                    </td>
                </tr>
                <tr>
                    <td class="b_border" colspan="4">
                        <table cellpadding="0" cellspacing="0" class="moduleBottom">
                            <tr>
                                <td class="moduleBottom_left"></td>
                                <td></td>
                                <td class="moduleBottom_right"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </li>
        `
        $("#sortable").append(html_content)
        $(`#common_list_grid${item.id}`).sfaQuery({
            view : `${item.viewNameSmall}`,
            defaultParam : {
                "id" : `${item.id}`
            },
            gridOptions : {
                gridId : `common_list_grid${item.id}`,
                jqGridSettings : {
                    rowNum : 5,
                    rownumbers:false,
                    multiselect:false
                }
            },
            qcOptions: {

            }
        });
    }

    function showMore(id, name, viewNameLarge){
        P = window;
        var dlg = $("#show_more").sfaQueryDialog({
            dialogId : `common_list_dialog_${id}`,
            data: {
                gid: id
            },
            dialogHeight: 675,
            dialogTitle : name,
            view : viewNameLarge,
            lock:true,
            defaultParam : {
                "id" : id
            },
            qcOptions :{
                qcBoxId : 'qc_box',
                showSavedQueries : false
            },
            gridOptions : {
                gridId : `common_list_grid`,
                jqGridSettings : {
                    rowNum : 15,
                    multiselect:false
                }
            },
            exportOptions : {
                showExport : true,
                fileName : `${name}.xls`
            }
        });
    }

    function refresh(id) {
        $(`#common_list_grid${id || ""}`).sfaQuery().reloadQueryGrid();
    }

    function getUserDesk(){
        let url = "/api/v1/desk_monitor/getUserDesks";
        axios.get(url).then(response=>{
            if(response.data.msg.toUpperCase().indexOf("SUCCESS") != -1){
                response.data.data.forEach(item=>{
                    append_window(item)
                })
            }else{
                throw new Error(response.data.msgData[0])
            }
        })
    }
    $(function(){
        $('#delete_popup').window('close');
        getUserDesk();
        // $("#32").empty();
        // $("#32").remove();
        // append_window("32")
    })
</script>
</body>
</html>